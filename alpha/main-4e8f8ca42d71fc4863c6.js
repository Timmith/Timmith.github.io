!function(e){function webpackJsonpCallback(t){for(var s,o,a=t[0],c=t[1],h=t[2],u=0,l=[];u<a.length;u++)o=a[u],n[o]&&l.push(n[o][0]),n[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(r&&r(t);l.length;)l.shift()();return i.push.apply(i,h||[]),checkDeferredModules()}function checkDeferredModules(){for(var e,t=0;t<i.length;t++){for(var s=i[t],o=!0,a=1;a<s.length;a++){var r=s[a];0!==n[r]&&(o=!1)}o&&(i.splice(t--,1),e=__webpack_require__(__webpack_require__.s=s[0]))}return e}var t={},n={0:0},i=[];function __webpack_require__(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)__webpack_require__.d(n,i,function(t){return e[t]}.bind(null,i));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=webpackJsonpCallback,s=s.slice();for(var a=0;a<s.length;a++)webpackJsonpCallback(s[a]);var r=o;i.push([132,1]),checkDeferredModules()}([,,function(e,t,n){"use strict";n.d(t,"b",function(){return clamp}),n.d(t,"k",function(){return wrap}),n.d(t,"a",function(){return absFloor}),n.d(t,"f",function(){return hitTestPlaneAtPixel}),n.d(t,"h",function(){return lerp}),n.d(t,"i",function(){return rand}),n.d(t,"j",function(){return rand2}),n.d(t,"g",function(){return inferDirection}),n.d(t,"c",function(){return copyXY}),n.d(t,"l",function(){return zeroXY}),n.d(t,"d",function(){return distanceSquaredTo}),n.d(t,"e",function(){return distanceTo});var i=n(1),s=n(0);n(4);function clamp(e,t,n){return Math.min(n,Math.max(t,e))}function wrap(e,t,n){const i=n-t;return((e-t)%i+i)%i+t}function absFloor(e){return Math.floor(Math.abs(e))*(e<0?-1:1)}Math.PI,Math.PI,Math.PI;new s.Ray,new s.Plane(new s.Vector3(0,-1,0),1),new s.Plane(new s.Vector3(0,-1,0),1),new s.Vector3;new s.Vector2,new s.Raycaster;const o=new s.Ray,a=new s.Vector3;function hitTestPlaneAtPixel(e,t,n,i){return i instanceof s.PerspectiveCamera?(o.origin.setFromMatrixPosition(i.matrixWorld),o.direction.set(e,t,.5).unproject(i).sub(o.origin).normalize()):i instanceof s.OrthographicCamera?(o.origin.set(e,t,(i.near+i.far)/(i.near-i.far)).unproject(i),o.direction.set(0,0,-1).transformDirection(i.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type: "+i.type),o.intersectPlane(n,a)?a:null}function lerp(e,t,n){const i=e+n*(t-e);return Math.abs(t-i)>1e-5?i:t}Math.PI,Math.PI;function rand(e=0,t=1){return Math.random()*(t-e)+e}function rand2(e=1,t=0){return(2*Math.random()-1)*e+t}function inferDirection(e,t=1e-5){return e<-t?-1:e>t?1:0}function copyXY(e,t){t.x=e.x,t.y=e.y}function zeroXY(e){e.x=0,e.y=0}const r=new i.Vec2;function distanceSquaredTo(e,t){return r.Copy(e).SelfSub(t).LengthSquared()}function distanceTo(e,t){return Math.sqrt(distanceSquaredTo(e,t))}},function(e,t,n){"use strict";n.d(t,"j",function(){return createPhysicBoxFromPixels}),n.d(t,"i",function(){return createPhysicBox}),n.d(t,"o",function(){return getContactBetweenSensorAndRigidBody}),n.d(t,"l",function(){return deconstructConcavePath2}),n.d(t,"m",function(){return deconstructConcavePath3}),n.d(t,"n",function(){return makePolygonPhysics}),n.d(t,"s",function(){return textToPhysicsBodies}),n.d(t,"c",function(){return convertTob2Space}),n.d(t,"q",function(){return makeBitMask}),n.d(t,"t",function(){return translateCategoryBitsToString}),n.d(t,"k",function(){return createPhysicsCircle}),n.d(t,"g",function(){return createImprovedPhysicsCircle}),n.d(t,"f",function(){return createImprovedCircularSensor}),n.d(t,"h",function(){return createItemBox}),n.d(t,"d",function(){return createEnvironmentBlock}),n.d(t,"b",function(){return WallData}),n.d(t,"e",function(){return createGhostPlacementBlock}),n.d(t,"a",function(){return GhostWallData}),n.d(t,"r",function(){return queryForSingleEnvironmentBlock}),n.d(t,"p",function(){return gridifyVectorToZeroPoint2});var i=n(1),s=n(0),o=n(4),a=n(13),r=n(8),c=n(48),h=n(5),u=n(2),l=n(7),d=n(101);function createPhysicBoxFromPixels(e,t,n,s,o,a=!1){createPhysicBox(e,(t+-16-.5*s)*r.b,(8-n-.5*o)*r.b,s*r.b,o*r.b,i.BodyType.b2_staticBody,void 0,void 0,a)}function createPhysicBox(e,t,n,s,o,a=i.BodyType.b2_staticBody,r=.1,c=1,h=!1){const u=new i.BodyDef,d=new i.FixtureDef;u.fixedRotation=!1,u.type=a;const f=Object(l.a)().createBody(u);f.SetPositionXY(t,n),d.friction=r,d.restitution=.7,d.density=c,d.isSensor=h,a===i.BodyType.b2_staticBody&&(d.filter.categoryBits=makeBitMask(["environment"]));const p=(new i.PolygonShape).SetAsBox(.5*s,.5*o);return d.shape=p,f.CreateFixture(d),f}const f=new class ContactPair{set(e,t){return this.sensor=e,this.rigidBody=t,this}};function getContactBetweenSensorAndRigidBody(e){const t=e.GetFixtureA(),n=e.GetFixtureB();if(t.m_isSensor!==n.m_isSensor)return t.m_isSensor?f.set(t,n):f.set(n,t)}const p=new s.Vector2;class AngledVec2{constructor(e,t){this.vec=e,this.angle=t}}function updateAngle(e,t){const n=t.indexOf(e.vec);return function updateAngledVec(e,t,n){const i=p.subVectors(t,e.vec).angle(),s=p.subVectors(e.vec,n).angle();e.angle=Object(u.k)(s-i,-Math.PI,Math.PI)}(e,Object(h.c)(t,n-1),Object(h.c)(t,n+1)),e}function deconstructConcavePath2(e){const t=[],n=e.slice(),i=e.map(e=>updateAngle(new AngledVec2(e,0),n));for(;n.length>=3;){i.sort((e,t)=>t.angle-e.angle);const e=i.shift(),s=n.indexOf(e.vec),o=[Object(h.c)(n,s-1),e.vec,Object(h.c)(n,s+1)];n.splice(s,1);for(const e of i)-1!==o.indexOf(e.vec)&&updateAngle(e,n);t.push(o)}return t.map(e=>Array.from(new Set(e))).filter(e=>e.length>=3)}class Edge{constructor(e,t){this.v1=e,this.v2=t}}function deconstructConcavePath3(e){const t=deconstructConcavePath2(e);console.warn("Not done yet.");const n=new Map;function findOrSet(e,t){return n.has(e)?n.get(e):void n.set(e,t)}for(const n of t)for(const t of n){const i=Object(h.b)(n,t),s=e.indexOf(t),o=e.indexOf(i);let a;a=s<o?findOrSet(s+"-"+o,new Edge(t,i)):findOrSet(o+"-"+s,new Edge(i,t))}return t}const m=new s.Vector2;function makePolygonPhysics(e,t,n=i.BodyType.b2_staticBody,s=m,o=function deconstructConcavePath(e){const t=[];let n,i=5;do{n=[],i--;let s=[];for(let i=0;i<e.length;i++){const o=Object(h.c)(e,i-1),a=Object(h.c)(e,i),r=Object(h.c)(e,i+1),c=p.subVectors(o,a).angle(),l=p.subVectors(a,r).angle();Object(u.k)(l-c,-Math.PI,Math.PI)>=0?s.push(o,a,r):(n.push(a),t.push(s),s=[a])}t.push(s),e=n}while(n.length>3&&i>0);return t.map(e=>Array.from(new Set(e))).filter(e=>e.length>=3)}){const a=new i.BodyDef;a.type=n;const r=Object(l.a)().createBody(a);r.SetPositionXY(s.x,s.y),t.forEach(e=>createPhysicBox(0,e.x+s.x,e.y+s.y,.002,.002));const c=o(t);for(const e of c){if(e.length<3)continue;const t=new i.FixtureDef,n=new i.PolygonShape;t.shape=n,t.filter.categoryBits=makeBitMask(["environment"]),r.CreateFixture(t)}return r}function textToPhysicsBodies(e,t){const n=[];if(e.geometry instanceof s.BufferGeometry){const t=e.geometry.attributes.position.array,i=4*e.geometry.attributes.position.itemSize,s=e.position;for(let e=0;e<t.length;e+=i){const i=t[e+0],o=t[e+4],a=t[e+1],c=t[e+3],h=createPhysicBox(0,5.275*((i+o)/2+s.x*r.b-.1),5.275*((a+c)/2+s.y*r.b),5.275*(o-i),6.5*(a-c));n.push(h)}}return n}function convertTob2Space(e,t,n){const s=new i.Vec2,r=(t/o.a.width*2-1)*(1/a.c)*o.a.aspect+e.offset.x,c=-(n/o.a.height*2-1)*(1/a.c)+e.offset.y;return s.Set(r,c),s}const y=["environment","hero","heroWeapon","enemy","enemyWeapon","sound","noiseMaker","item","stink"];function makeBitMask(e){let t=0;for(const n of e)t|=Math.pow(2,y.indexOf(n)+1);return t}function translateCategoryBitsToString(e){const t=e.toString(2);if(t.indexOf("1")!==t.lastIndexOf("1"))throw new Error("Category Bits not a power of 2");const n=Math.log2(e)-1;return y[n]}function createPhysicsCircle(e,t,n,s,o=!0){const a=new i.CircleShape(s),r=new i.FixtureDef;r.shape=a,r.density=1,r.friction=.2,r.restitution=.7;const c=new i.BodyDef;c.type=i.BodyType.b2_dynamicBody,r.filter.categoryBits=makeBitMask(["enemy"]);const h=["environment","hero","heroWeapon"];o&&h.push("enemy"),r.filter.maskBits=makeBitMask(h);const u=Object(l.a)().createBody(c);return u.SetPositionXY(t,n),u.CreateFixture(r),u}function createImprovedPhysicsCircle(e,t,n,s,o,a,r,c,h,u,d){const f=new i.CircleShape(s),p=new i.FixtureDef;p.shape=f,p.density=1,u&&(p.density=u),p.friction=.2,p.restitution=.7;const m=new i.BodyDef;m.userData=r,m.type=d||i.BodyType.b2_dynamicBody,o&&a&&(p.filter.categoryBits=makeBitMask(o),p.filter.maskBits=makeBitMask(a)),c&&(p.isSensor=!0),h&&(m.bullet=!0);const y=Object(l.a)().createBody(m);return y.SetPositionXY(t,n),y.CreateFixture(p),y}function createImprovedCircularSensor(e,t,n,s){const o=new i.CircleShape;o.Set(new i.Vec2(0,0),t);const a=new i.FixtureDef;return a.shape=o,a.isSensor=!0,a.filter.categoryBits=makeBitMask(n),a.filter.maskBits=makeBitMask(s),e.CreateFixture(a)}function createItemBox(e,t,n=.1,s=.1,o){const a=new i.BodyDef;a.type=i.BodyType.b2_staticBody;const r=(new i.PolygonShape).SetAsBox(.5*n,.5*s),h=new i.FixtureDef;h.shape=r,h.isSensor=!0,h.filter.categoryBits=makeBitMask(["item"]);const u=Object(l.a)().createBody(a);u.CreateFixture(h),u.SetPositionXY(t.x,t.y);const d=[];d.push(c.a.ammoRefill),d.push(c.a.healthRefill),d.push(c.a.cleanlinessRefill),u.SetUserData(d)}function createEnvironmentBlock(e,t,n=r.c){let s=t.Clone();s=gridifyVectorToZeroPoint2(s);const o=new i.BodyDef;o.userData=new WallData,o.type=i.BodyType.b2_staticBody,o.position.x=s.x,o.position.y=s.y;const a=new i.FixtureDef,c=(new i.PolygonShape).SetAsBox(.5*n,.5*n);a.shape=c,a.isSensor=!1,a.filter.categoryBits=makeBitMask(["environment"]),Object(l.a)().createBody(o).CreateFixture(a)}class WallData{}function createGhostPlacementBlock(e,t,n=.15){let s=t.Clone();s=gridifyVectorToZeroPoint2(s);const o=new i.BodyDef;o.userData=new GhostWallData,o.type=i.BodyType.b2_staticBody,o.position.x=s.x,o.position.y=s.y;const a=new i.FixtureDef,r=(new i.PolygonShape).SetAsBox(.5*n,.5*n);a.shape=r,a.isSensor=!0;const c=Object(l.a)().createBody(o);return c.CreateFixture(a),c}class GhostWallData{}const g=new d.a(void 0);function queryForSingleEnvironmentBlock(e,t,n){n||(n=.001);const s=new i.AABB;if(s.lowerBound.Set(t.x-n,t.y-n),s.upperBound.Set(t.x+n,t.y+n),g.reset(),g.clickedGameSpace=t,e.QueryAABB(g,s),g.environmentBlockBody){const e=g.environmentBlockBody.GetPosition();return console.log(`environmentBlockBody already exists at position: ${e.x}x  ${e.y}y`),g.environmentBlockBody}}function gridifyVectorToZeroPoint2(e){return e.x=e.x/r.c,e.x=Math.round(e.x),e.x=e.x*r.c,e.x=parseFloat(e.x.toFixed(1)),e.y=e.y/r.c,e.y=Math.round(e.y),e.y=e.y*r.c,e.y=parseFloat(e.y.toFixed(1)),e}},function(e,t,n){"use strict";const i=new class Device{constructor(){this.targetFPS=60,this.listeners=new Set,this.cachedPPCm=-1,this.handleChange=()=>{this.useTouch=/Mobi|Android|iPhone|iPad|BlackBerry|Windows Phone|webOS/i.test(navigator.userAgent),this.width===window.innerWidth&&this.height===window.innerHeight||(this.width=window.innerWidth,this.height=window.innerHeight,this.aspect=this.width/this.height,this.deviceHeight=Math.min(this.width,this.height),this.deviceWidth=Math.max(this.width,this.height),this.deviceAspect=this.deviceWidth/this.deviceHeight,this.pixelRatio=window.devicePixelRatio,this.orientation=this.aspect<1?"portrait":"landscape",this.type=this.useTouch?this.deviceWidth<1024&&this.deviceAspect>1.6?"mobile":"tablet":"desktop",this.listeners.forEach(e=>e()))},window.addEventListener("resize",()=>{this.handleChange(),setTimeout(this.handleChange,50)}),this.handleChange()}onChange(e,t=!1){return this.listeners.add(e),t&&e(),()=>this.listeners.delete(e)}get isMobile(){return"mobile"===this.type}get isTablet(){return"tablet"===this.type}get isDesktop(){return"desktop"===this.type}get pixelsPerCm(){if(-1===this.cachedPPCm){const e=document.createElement("div");e.style.height="1in";const t=document.getElementsByTagName("body")[0];t.appendChild(e);const n=getComputedStyle(e,null).getPropertyValue("height");t.removeChild(e),this.cachedPPCm=2.54*parseFloat(n)}return this.cachedPPCm}get screenHeightCms(){return this.height/this.pixelsPerCm}get screenWidthCms(){return this.width/this.pixelsPerCm}get screenShorterCms(){return Math.min(this.width,this.height)/this.pixelsPerCm}setFPS(e=60){this.targetFPS=e}};window.device=i,t.a=i},function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return getArrWrap}),n.d(t,"b",function(){return getArrNext});n(2);const i=(e,t,n=!1)=>{const i=e.indexOf(t);if(-1!==i)e.splice(i,1);else if(n)throw new Error("could not find value in array");return t};const s=(e,t,n,i=!1)=>{e.has(t)||e.set(t,[]);const s=e.get(t);s&&(i?-1===s.indexOf(n)&&s.push(n):s.push(n))},o=(e,t,n)=>{if(!e.has(t))return;const s=e.get(t);s&&(i(s,n),0===s.length&&e.delete(t))};function getArrWrap(e,t){const n=e.length;return e[(t%n+n)%n]}function getArrNext(e,t){return getArrWrap(e,e.indexOf(t)+1)}},function(e,t,n){"use strict";n.d(t,"e",function(){return getUrlParam}),n.d(t,"b",function(){return getUrlFlag}),n.d(t,"c",function(){return getUrlFloat}),n.d(t,"d",function(){return getUrlInt}),n.d(t,"a",function(){return getUrlColor});var i=n(0),s=n(56),o=n(2);function getUrlParam(e){return function __setReminder(e){a.includes(e)||(a.push(e),r||(r=!0,setTimeout(()=>{console.log("Nice Parameters to try: "+a.join(", ")),r=!1},2e3)))}(e),new URL(window.location.href).searchParams.get(e)}function getUrlFlag(e){const t=getUrlParam(e);return!!(""===t||t&&"false"!==t)}function __getUrlNumber(e,t,n,i=-1/0,s=1/0){return Object(o.b)(n(getUrlParam(e)||t.toString()),i,s)}function getUrlFloat(e,t,n=-1/0,i=1/0){return __getUrlNumber(e,t,parseFloat,n,i)}function getUrlInt(e,t,n=-1/0,i=1/0){return __getUrlNumber(e,t,parseInt,n,i)}function getUrlColor(e,t){let n=getUrlParam(e);if(!n){if(t instanceof i.Color)return t;n=t}return Object(s.a)("#"+n)}const a=[];let r=!1},function(e,t,n){"use strict";n.d(t,"a",function(){return getBodyEventManager});var i=n(5);class BodyEventManager{constructor(){this.bodies=[],this.createCallbacks=[],this.destroyCallbacks=[]}init(e){if(this.world)throw new Error("cannot initialize twice");this.world=e}createBody(e){const t=this.world.CreateBody(e);for(const e of this.createCallbacks)e(t);return this.bodies.push(t),t}destroyBody(e){Object(i.e)(this.bodies,e);for(const t of this.destroyCallbacks)t(e);this.world.DestroyBody(e)}startListeningForCreate(e){for(const t of this.bodies)e(t);this.createCallbacks.push(e)}startListeningForDestroy(e){this.destroyCallbacks.push(e)}}let s;function getBodyEventManager(){return s||(s=new BodyEventManager),s}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var i=n(6);const s=Object(i.b)("resetSettings"),o=.05,a=.2},function(e,t,n){"use strict";n.d(t,"b",function(){return PlayerPhysicsCharacter}),n.d(t,"a",function(){return PlayerData});var i=n(1),s=n(15),o=n(45),a=n(57);class PlayerPhysicsCharacter extends a.a{constructor(e,t){super(e,t,new i.Vec2,["hero"],["environment","enemy","enemyWeapon","sound","item"],new PlayerData(t))}postPhysicsUpdate(e){const t=this._avatarBody.GetUserData();t.isDead?(this._maxSpeed=0,t.currentStamina=0,Object(o.c)(this._avatarBody),Object(s.e)(this._avatarBody)):(this.slowDownFactor=1+t.zombieTouchCounter,t.currentStamina>0&&this._brain.requestRunning&&this._desiredSpeed>0?(this._brain.isRunning=!0,t.currentStamina-=e,t.currentStamina<0&&(t.currentStamina=0),t.currentStamina<t.maxStamina&&(t.staminaRechargeDelay=1)):(this._brain.isRunning=!1,t.staminaRechargeDelay>0?t.staminaRechargeDelay-=e:t.currentStamina<t.maxStamina&&(t.currentStamina+=e,t.currentStamina>t.maxStamina&&(t.currentStamina=t.maxStamina)))),super.postPhysicsUpdate(e)}}class PlayerData{constructor(e){this.brain=e,this.currentHealth=10,this.maxHealth=10,this.isHealthChanged=!1,this.currentStamina=3,this.maxStamina=3,this.staminaRechargeDelay=0,this.stinkLevel=0,this.cleanlinessDuration=0,this.meleeDamage=1,this.meleeKnockOutTime=2,this.meleeKnockback=.8,this.rangedDamage=1.5,this.rangedKnockOutTime=.5,this.rangedKnockback=.3,this.buildMode=!1,this.ammo=24,this.wood=30,this.stone=0,this.metal=0,this.guns=["pistol","uzi"],this.currentlyEquippedGun=0,this.isEnemy=!1,this.isDead=!1,this.zombieTouchCounter=0}}},function(e,t,n){"use strict";n.d(t,"b",function(){return ZombiePhysicsCharacter}),n.d(t,"a",function(){return ZombieData});var i=n(1),s=n(12),o=n(3),a=n(48),r=n(2),c=n(57);const h=new i.Vec2;class ZombiePhysicsCharacter extends c.a{constructor(e,t,n,i){super(e,t,n,["enemy"],["environment","hero","heroWeapon","enemy","sound"],new ZombieData(t,i),void 0,10),this._maxSpeed=1.5,this._minSpeed=.1,this._randMoveVec=void 0,this._randMoveInterval=void 0,this._movePauseInterval=void 0,Object(o.f)(this._avatarBody,1,["enemy"],["hero"]),Object(o.f)(this._avatarBody,.175,["enemyWeapon"],["hero"]),Object(o.f)(this._avatarBody,.3,["enemyWeapon"],["stink"]),this._avatarBody.SetLinearDamping(5);const s=this._avatarBody.GetUserData(),r=[];r.push(a.a.ammoRefill),s.pocket=r}postPhysicsUpdate(e){const t=this._avatarBody.GetUserData(),n=this._avatarBody.GetPosition();if(t.brain.knockedOutDuration>0)t.brain.knockedOutDuration-=e;else{if(t.brain.positionOfInterest){h.Copy(t.brain.positionOfInterest).SelfSub(n);const e=h.Clone();h.SelfNormalize().SelfMul(.4),e.Length()<.175&&(t.brain.positionOfInterest=void 0,t.brain.reachedPositionOfInterest=!0),Object(r.c)(h,t.brain.desiredMovementVector)}else if(this._randMoveVec&&!t.brain.reachedPositionOfInterest)Object(r.c)(this._randMoveVec,t.brain.desiredMovementVector),this._randMoveInterval||(Object(s.a)("zombieVoice",n),this._randMoveInterval=setTimeout(()=>{this._randMoveVec=void 0,this._randMoveInterval=void 0},Object(r.i)(2e3,7e3)));else if(Object(r.l)(t.brain.desiredMovementVector),!this._movePauseInterval){let e=Object(r.i)(1e3,3e3);t.brain.reachedPositionOfInterest&&(e=5e3),this._movePauseInterval=setTimeout(()=>{this._randMoveVec=new i.Vec2(Object(r.i)(-.1,.1),Object(r.i)(-.1,.1)),t.brain.reachedPositionOfInterest&&(t.brain.reachedPositionOfInterest=!1),this._movePauseInterval=void 0},e)}super.postPhysicsUpdate(e)}}}class ZombieData{constructor(e,t){this.brain=e,this.originSpawner=t,this.health=3,this.damage=1,this.isEnemy=!0,this.isDead=!1,this.stinkierButInaccessibleArray=[],ZombieData.currentlyActive.push(this)}}ZombieData.currentlyActive=[]},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(52),s=n(5);class TimedTask{constructor(e,t){this.expireTime=e,this._task=t}task(){this._task?(this._task(),this._task=void 0):console.warn("timed task asked to fire twice??")}}const o=new class Timer{constructor(){this.time=0,this.tasks=[]}update(e){for(this.time+=e;this.tasks.length>0&&this.tasks[0].expireTime<=this.time;)this.tasks.shift().task()}add(e,t,n=!1){n&&(t*=i.a.speed);const s=new TimedTask(this.time+t,e);return this.tasks.push(s),this.tasks.sort((e,t)=>e.expireTime-t.expireTime),s}runPrematurely(e){e.task(),Object(s.e)(this.tasks,e)}cancel(e){Object(s.e)(this.tasks,e)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return registerEars}),n.d(t,"a",function(){return playWorldSound});var i=n(97),s=n(6),o=n(2);const a={weaponFireRanged:[1.67,,56,,,.25,3,2.25,7.2,5.8,,,,.9,16,.3,.05,.66,.06,.1],weaponFireMelee:[.7,,355,.01,.27,.22,3,.24,-5.8,,,,,.6,25,.2,,.61,.08,.66],gameOver:[,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],itemPickup:[2.03,,438,,.03,.12,,1.5,,,-753,.05,,,,,.02,.53,.01],playerHit:[,,222,,,.32,2,1.02,-.2,,,,,.6,,.1,,.96,.07],zombieHitWithMelee:[1.09,,209,.03,.01,.11,1,.79,-2.8,-.3,50,-.02,-.03,.8,5.6,.3,.02,.66,.01,.03],zombieHitWithRanged:[1.09,,209,.01,.02,,1,.79,-2.8,-.3,,-.02,-.02,.8,6.6,.4,.03,.56,.01,.04],zombieDeath:[,,18,.04,.24,,,2.22,30.1,.8,-381,.13,.04,-.1,-1],zombieSpawnerDeath:[1.46,,699,.03,.1,.48,1,3.34,.2,,,,,.6,,.6,,.58,.07],zombieSpawnerMakesZombie:[1.24,,790,.16,.08,.04,1,.53,13,,-941,.12,.23,.2,16,,.1,,.09],zombieAttack:[.7,,97,.01,.28,.22,2,.9,-5.7,-.1,50,.01,,1,10,.3,,.71,.07,.66],soundMaker:[1.76,,1035,,.03,.2,4,0,50,,,,.04,,,.1,.08,.63,.05],build:[2.07,,1037,.01,.01,.13,2,.1,33,,,,,,-149,.5,.03,.49,.02,.53],zombieVoice:[,20,6,.11,.27,.14,1,.57,40,,-2,.02,.02,,,,.28,.8,.04,.23],zombieVoiceNoticing:[,5,30,.04,.27,.14,1,.5,40,,-2,.02,.02,.7,1,.1,.28,.8,.07,.23]};let r;function registerEars(e){r=e}const c=4,h=Object(s.c)("volume",1,0,1);function playWorldSound(e,t,n=1){return playSound(e,r?n*Math.pow(Math.max(0,1-Object(o.e)(r.GetPosition(),t)/c),2):.1*n)}function playSound(e,t=1){const n=h*t,s=a[e].slice(0);return s[0]=void 0===s[0]?n:s[0]*n,Object(i.a)(...s)}},function(e,t,n){"use strict";n.d(t,"c",function(){return h}),n.d(t,"b",function(){return y}),n.d(t,"a",function(){return Box2DPreviewMesh});var i=n(1),s=n(0),o=n(4),a=n(98),r=n(6),c=n(2);let h=.6;const u=16,l=6,d=new s.Vector3(1,0,0),f=(new s.Matrix4).compose(new s.Vector3(.5,.5,.5),new s.Quaternion,new s.Vector3(.5,.5,.5)),p=new s.Quaternion,m=new s.Vector3(.5,.5,.5),y={value:Object(r.b)("debugPhysicsPolygon")};class DebugColors{constructor(){this.fixtureColors=new Map,this.bodyMatrices=new Map}getFixtureColor(e){if(!this.fixtureColors.has(e)){const t=new s.Vector3(Object(c.j)(),Object(c.j)(),Object(c.j)()).applyMatrix4(this.getBodyMatrix(e.m_body)).applyMatrix4(f);return this.fixtureColors.set(e,t),t}return this.fixtureColors.get(e)}getBodyMatrix(e){if(!this.bodyMatrices.has(e)){const t=(new s.Matrix4).compose(new s.Vector3(Object(c.j)(.5,.5),Object(c.j)(.5,.5),Object(c.j)(.5,.5)),p,m);return this.bodyMatrices.set(e,t),t}return this.bodyMatrices.get(e)}}function getShapeWorldVerts(e,t){switch(e.m_type){case i.ShapeType.e_polygonShape:return y.value?function getPolygonShapeWorldVerts(e,t){return e.m_vertices.map(e=>{const n=new i.Vec2;return t.GetWorldPoint(e,n),n.x/=o.a.aspect,n})}(e,t):void 0;case i.ShapeType.e_circleShape:return function getCircleShapeWorldVerts(e,t){const n=[],s=e.m_radius,a=e.m_p;for(let e=0;e<u;e++){const r=e/u*Math.PI*2,c=new i.Vec2(Math.cos(r)*s,Math.sin(r)*s).SelfAdd(a),h=new i.Vec2;t.GetWorldPoint(c,h),h.x/=o.a.aspect,n.push(h)}return n}(e,t);default:return void console.error("unsupported box2d shape type for debug view")}}function getShapeWorldVertsCount(e){switch(e.m_type){case i.ShapeType.e_polygonShape:return y.value?e.m_vertices.length:0;case i.ShapeType.e_circleShape:return u;default:return 0}}function getContactWorldVerts(e){const t=[];for(let n=0;n<l;n++){const s=n/l*Math.PI*2,a=new i.Vec2(.02*Math.cos(s),.02*Math.sin(s)).SelfAdd(e);a.x/=o.a.aspect,t.push(a)}return t}function createGeometry(e,t,n){let a=0,r=e.m_bodyList;for(;r;){let e=r.m_fixtureList;for(;e;)a+=getShapeWorldVertsCount(e.m_shape)+3,e=e.m_next;r=r.m_next}const c=e.GetContactManager();let u=c.m_contactList;for(;u;)u.IsTouching()&&(a+=2*(l+3)),u=u.m_next;const f=new s.BufferGeometry;f.boundingSphere=new s.Sphere(void 0,1/0);const p=new Float32Array(2*a),m=new Float32Array(4*a);let y=0,g=0;function writeVert(e,t,n=1){p[y]=e.x,p[y+1]=e.y,y+=2,t.toArray(m,g),m[g+3]=n,g+=4}r=e.m_bodyList;const b=new i.Vec2(n.x/o.a.aspect,n.y);for(;r;){let e=r.m_fixtureList;for(;e;){const n=getShapeWorldVerts(e.m_shape,r);if(n){addVertsToGeometry(n,t.getFixtureColor(e))}e=e.m_next}r=r.m_next}for(u=c.m_contactList;u;){if(u.IsTouching())for(const e of[u.GetFixtureA(),u.GetFixtureB()]){addVertsToGeometry(getContactWorldVerts(e.GetBody().GetPosition()),d)}u=u.m_next}return f.setAttribute("position",new s.Float32BufferAttribute(p,2)),f.setAttribute("color",new s.Float32BufferAttribute(m,4)),f;function addVertsToGeometry(e,t){if(0!==n.x||0!==n.y)for(const t of e)t.SelfSub(b);if("landscape"===o.a.orientation&&o.a.isMobile?h=1.2:"portrait"===o.a.orientation&&o.a.isMobile&&(h=.55),1!==h)for(const t of e)t.SelfMul(h);const i=e[0];writeVert(i,t,0);for(const n of e)writeVert(n,t,1);writeVert(i,t,1),writeVert(i,t,0)}}class Box2DPreviewMesh extends s.Line{constructor(e){const t=new DebugColors,n=new i.Vec2;super(createGeometry(e,t,n),new a.a),this.debugColors=t,this.b2World=e,this.offset=n,this.renderOrder=1e5}update(e){this.geometry.dispose(),this.geometry=createGeometry(this.b2World,this.debugColors,this.offset)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return queueDestruction}),n.d(t,"a",function(){return processDestructions});var i=n(5),s=n(2),o=n(10),a=n(3),r=n(7),c=n(27);const h=[];function queueDestruction(e){h.push(e)}function processDestructions(){if(h.length>0){for(const e of h)destructBody(e);h.length=0}}function destructBody(e){const t=e.GetBody(),n=t.GetWorld(),h=t.GetPosition();try{if(t.GetUserData()instanceof o.a){const e=t.GetUserData();if(e.originSpawner.GetUserData().zombiesSpawned-=1,e.pocket){console.log(`There was a pocket on that zombie, containing: ${e.pocket}`);for(const t of e.pocket){console.log(`${e.pocket[0][0]} ... ${e.pocket[0][1]}`);const i=h.Clone();i.SelfAddXY(Object(s.i)(-.1,.1),Object(s.i)(-.1,.1)),"ammo"===t[0]?Object(a.h)(n,i):"medkit"===t[0]||t[0],console.log(t[0],t[1])}}Object(i.e)(o.a.currentlyActive,e)}else if(t.GetUserData()instanceof c.b){const e=t.GetUserData();e.intervalSpawning&&clearInterval(e.intervalSpawning)}Object(r.a)().destroyBody(t)}catch(e){console.log(e)}}},function(e,t,n){"use strict";n.d(t,"d",function(){return registerSmellyUser}),n.d(t,"e",function(){return unregisterSmellyUser}),n.d(t,"c",function(){return processStinkDissipation}),n.d(t,"b",function(){return processSmellyUsers}),n.d(t,"a",function(){return StinkData});var i=n(1),s=n(5),o=n(9),a=n(10),r=n(3),c=n(14);const h=[];function registerSmellyUser(e){h.push(e)}function unregisterSmellyUser(e){Object(s.e)(h,e)}function processStinkDissipation(e){for(const t of a.a.currentlyActive)void 0!==t.currentDetectedStinkStrength&&(t.currentDetectedStinkStrength-=e);for(const t of StinkData.currentlyActive)t.stinkDuration-=e,t.stinkDuration<=0&&(Object(s.e)(StinkData.currentlyActive,t),Object(c.b)(t.stinkBody.GetFixtureList()))}function processSmellyUsers(e){for(const t of h){const n=t.GetUserData();if(n instanceof o.a)if(n.cleanlinessDuration>0)n.cleanlinessDuration-=e;else if(n.stinkLevel+=e,n.stinkLevel>1){const e=n.brain.avatarBody.GetWorld();if(n.lastStinkDropped){const t=n.brain.currentPosition.Clone(),i=n.lastStinkDropped.Clone();if(t.SelfSub(i).LengthSquared()>.03){const t=dropStink(e,n);n.lastStinkDropped=t.GetPosition()}}else{const t=dropStink(e,n);n.lastStinkDropped=t.GetPosition()}}}}class StinkData{constructor(e,t){this.stinkPower=e,this.stinkDuration=t,StinkData.currentlyActive.push(this)}}function dropStink(e,t,n,s){n||(n=5),s||(s=5);let o=t.stinkLevel/n;o>s&&(o=s);const a=Object(r.g)(e,t.brain.currentPosition.x,t.brain.currentPosition.y,.1,["stink"],["enemyWeapon"],new StinkData(t.stinkLevel,o),!0,!1,1,i.BodyType.b2_staticBody);return a.m_userData.stinkBody=a,a}StinkData.currentlyActive=[]},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsScene});var i=n(1),s=n(13),o=n(7),a=n(3),r=n(2),c=n(29);class TestPhysicsScene extends c.a{constructor(e=!0,t=20,n=!0){super(),this.circleBodies=[];const c=new i.World(new i.Vec2(0,-9.8));Object(o.a)().init(c);const h=new s.a(c);this.scene.add(h),this.b2World=c,this.b2Preview=h;for(let e=0;e<t;e++){const e=Object(a.k)(this.b2World,Object(r.i)(-1,1),1+Object(r.i)(-.2,.2),.05,n);this.circleBodies.push(e)}if(e){Object(a.i)(this.b2World,0,-.3,1,.1),Object(a.i)(this.b2World,.2,.3,1,.1),Object(a.i)(this.b2World,1.8,0,1,.1).SetAngle(.25*Math.PI)}}update(e){super.update(e),this.b2World.Step(e,10,4),this.b2Preview.update(e);for(const e of this.circleBodies){e.GetPosition().y<-2&&(e.SetLinearVelocity(new i.Vec2(0,0)),e.SetPositionXY(Object(r.i)(-1,1),1+Object(r.i)(-.2,.2)))}}render(e,t){super.render(e,t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TextMesh});var i=n(0),s=n(108),o=n.n(s),a=n(33),r=n(75),c=n(60),h=n(61),u=n(24),l=n(109),d=n.n(l),f=n(19),p=n(111),m=n.n(p);class Gradient{constructor(e){Object.keys(e).forEach(t=>{const n=e[t];if(n){const e=k(n);this[t]=e}})}set top(e){this.topLeft=k(e),this.topRight=k(e)}set bottom(e){this.bottomLeft=k(e),this.bottomRight=k(e)}set left(e){this.topLeft=k(e),this.bottomLeft=k(e)}set right(e){this.topRight=k(e),this.bottomRight=k(e)}}const y=new i.Matrix4,g=[];class TextMesh extends i.Mesh{constructor(e="",t=f.a.generic,n,i,s,o=!0){super(v(e,t),b(t)),this.onFontFaceChange=(e,t)=>{t&&(Object(u.b)(t,"msdfTexture",this.onFontTextureUpdate),Object(u.b)(t,"font",this.onFontUpdate)),Object(u.a)(e,"msdfTexture",this.onFontTextureUpdate),Object(u.a)(e,"font",this.onFontUpdate),e.init(),this._fontFace=e},this.onFontTextureUpdate=e=>{this.newTexture=e,this.dirty=!0},this.onFontUpdate=e=>{this.dirty=!0},this.onBeforeRender=(e,t,n,i,s,o)=>{if(this.settings.screenSpace){const e=this.material.uniforms.clipSpacePosition.value;y.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld).premultiply(n.projectionMatrix),e.set(0,0,0,1).applyMatrix4(y)}this.dirty&&(this.dirty=!1,this.regenerateGeometry(),this.newTexture&&(this.optimizeRenderOrder&&(this.renderOrder=this.renderOrder||100+function getFontFaceSubOrder(e){if(!e)return-1;const t=g.indexOf(e);return-1===t?(g.push(e),g.length-1):t}(this.newTexture)),this.material.uniforms.msdf.value=this.newTexture,this.newTexture=void 0))},this.updateText=(e="")=>{this.text=`${e}`},this.onMeasurementsUpdated=s,this.optimizeRenderOrder=o,Object(u.a)(t,"fontFace",this.onFontFaceChange,!0),this._text=e,this.updateMeasurements(),this.userData.isFrontFacing=!0,this.userData.doNotBillboard=!0,this.settings=t,this.livePropObject=n,this.livePropName=i,this.frustumCulled=!1}set text(e){"number"==typeof e&&(e=String(e)),this._text!==e&&(this._text=e,this.dirty=!0)}set color(e){"object"!=typeof e&&(e=k(e)),this._globalColor=e;const{topLeft:t,topRight:n,bottomLeft:i,bottomRight:s}=B(e),o=this.geometry.getAttribute("color");if(o){const e=o.array;for(let o=0;o<e.length;o+=12)e.set(t,o+0),e.set(i,o+3),e.set(s,o+6),e.set(n,o+9);o.needsUpdate=!0}}set strokeWidth(e){const t=this.material;if(t.uniforms.strokeWidth.value!==e){t.uniforms.strokeWidth.value=e;const n=e>0;n!==t.defines.USE_STROKE&&(t.defines.USE_STROKE=n,t.needsUpdate=!0)}}get opacity(){return this.material.uniforms.opacity.value}set opacity(e){this.material.uniforms.opacity.value=e}onAdd(){this.livePropObject&&this.livePropName&&Object(u.a)(this.livePropObject,this.livePropName,this.updateText,!0)}onRemove(){Object(u.b)(this.settings,"fontFace",this.onFontFaceChange),this.livePropObject&&this.livePropName&&Object(u.b)(this.livePropObject,this.livePropName,this.updateText),this._fontFace&&(Object(u.b)(this._fontFace,"msdfTexture",this.onFontTextureUpdate),Object(u.b)(this._fontFace,"font",this.onFontUpdate))}setSize(e,t){}regenerateGeometry(){this.geometry&&this.geometry!==w&&Object(h.b)(()=>this.geometry.dispose()),this.geometry=v(this._text,this.settings,this._globalColor),this.updateMeasurements()}updateMeasurements(){const e=this.geometry.boundingBox;this.width=e.max.x-e.min.x,this.height=Math.abs(e.max.y-e.min.y),this.userData.resolution=new i.Vector2(this.width,this.height),this.onMeasurementsUpdated&&this.onMeasurementsUpdated(this)}}const b=e=>{const t={msdf:new i.Uniform(e.fontFace.msdfTexture),alphaTest:new i.Uniform(e.alphaTest),strokeWidth:new i.Uniform(e.strokeWidth),strokeBias:new i.Uniform(e.strokeBias),strokeColor:new i.Uniform(new i.Color(e.strokeColor)),opacity:new i.Uniform(1)};e.screenSpace&&(t.offset=new i.Uniform(e.offset),t.clipSpacePosition=new i.Uniform(new i.Vector4),t.pixelSizeInClipSpace=a.b,t.prescale=new i.Uniform(e.prescale));const n=e.alphaTest>0&&e.alphaTest<1&&!e.shadow,s=new i.RawShaderMaterial({defines:{USE_STROKE:e.strokeWidth>0,USE_ALPHATEST:n,USE_SHADOW:e.shadow,USE_SCREENSPACE:e.screenSpace,CONSTANT_SIZE_ON_SCREEN:e.constantSizeOnScreen},uniforms:t,vertexShader:m(),fragmentShader:d(),transparent:!0,depthWrite:n,extensions:{derivatives:!0}});return Object.defineProperty(s,"opacity",{get:()=>s.uniforms.opacity.value,set:e=>s.uniforms.opacity.value=e}),s},w=new i.PlaneBufferGeometry(.001,.001);w.computeBoundingBox();const v=(e,t,n)=>t.fontFace.font&&e?S(e,t,n):w,S=(e,t,n)=>{const s=t.fontFace.font,a=(e=>Array.isArray(e)?e.reduce((e,t)=>e.concat(t.text),""):String(e))(e),h=o()({text:`${a}`,font:s,align:t.align,width:void 0!==t.width?t.width/t.size*s.info.size:void 0,lineHeight:void 0!==t.lineHeight?t.lineHeight*s.info.size:void 0,letterSpacing:t.letterSpacing}),u=h.getAttribute("position").array,l=u.length/2,d=_(n||t.color),f=Array.isArray(e)?e:[{text:a,color:d}],{base:p}=s.common,m=new Float32Array(3*l),y=new Float32Array(l);let g=0;f.forEach(e=>{const{topLeft:t,topRight:n,bottomLeft:i,bottomRight:o}=B(e.color),a=e.fontWeight||1,r=e.italicSkew||0,c=e.xOffset||0,h=e.yOffset||0,l=e.text.replace(/\s+/g,""),d=g,f=g+l.length;for(let e=d;e<f;e++){const d=12*e,f=4*e,b=2*f,w=l[e-g],v=s.chars.find(e=>String(e.char)===w);m.set(t,d+0),m.set(i,d+3),m.set(o,d+6),m.set(n,d+9),y[f+0]=a,y[f+1]=a,y[f+2]=a,y[f+3]=a;const S=p*r,k=v.height+v.yoffset-p,_=(p-v.yoffset)/p*S,B=k>0?k/p*-S:0;u[b+0]+=_,u[b+6]+=_,u[b+2]+=B,u[b+4]+=B,u[b+0]+=c,u[b+1]+=h,u[b+2]+=c,u[b+3]+=h,u[b+4]+=c,u[b+5]+=h,u[b+6]+=c,u[b+7]+=h}g=f}),h.addAttribute("color",new i.BufferAttribute(m,3)),h.addAttribute("weight",new i.BufferAttribute(y,1));const b=t.bakedOffset?t.bakedOffset.x:0,w=t.bakedOffset?t.bakedOffset.y:0;h.computeBoundingBox();const v=h.boundingBox;if(t.width){const e=h.layout.width;v.max.x=e-v.min.x}const S=v.min,k=v.max,x=h.attributes.position,C=x.itemSize,M=x.array;if("1"===e)for(let e=0;e<M.length;e+=C)M[e]-=2;const P=k.x-S.x,O=h.layout,D=(O._linesTotal-1)*O.lineHeight+O.capHeight,T=b+P*Object(r.a)(t.align)-S.x,A=w+D*Object(r.b)(t.vAlign);for(let e=0;e<M.length;e+=C)M[e]+=T,M[e+1]+=A;k.x+=T,S.x+=T,k.y+=A,S.y+=A;for(let e=1;e<M.length;e+=C)M[e]*=-1;S.y*=-1,k.y*=-1;let G=t.size/s.info.size;t.scaleDownToPhysicalSize&&(G/=c.a);for(let e=0;e<M.length;e++)M[e]*=G;if(S.multiplyScalar(G),k.multiplyScalar(G),S.y>k.y){const e=S.y;S.y=k.y,k.y=e}return h},k=e=>e instanceof i.Color?e:new i.Color(e),_=e=>e instanceof Gradient?e:new Gradient({top:e,bottom:e}),B=e=>({topLeft:(e=_(e||16777215)).topLeft.toArray(),topRight:e.topRight.toArray(),bottomLeft:e.bottomLeft.toArray(),bottomRight:e.bottomRight.toArray()})},function(e,t,n){"use strict";n.d(t,"a",function(){return TestLightingScene});var i=n(0),s=n(43),o=n(6),a=n(105),r=n(29);class TestLightingScene extends r.a{constructor(e=!0,t=!0){super();const n=Object(a.a)(this.scene,this.bgColor);this.sunLight=n.sunLight,this.ambientLight=n.ambientLight;const r=new s.a(this.camera);Object(o.b)("fpsCam")&&r.toggle(!0);(async()=>{const n=new i.MeshStandardMaterial({color:11197934,roughness:.7});if(t){const e=new i.Mesh(new i.PlaneBufferGeometry(1,1,1,1),n);e.scale.multiplyScalar(10),e.castShadow=!1,e.receiveShadow=!0,this.scene.add(e),e.rotation.x=-.5*Math.PI}if(e){const e=new i.Mesh(new i.SphereBufferGeometry(.3,32,16),n);e.castShadow=!0,e.receiveShadow=!0,e.position.x=-.3,e.position.y=.3,e.name="Sphere",this.scene.add(e);const t=new i.Mesh(new i.BoxBufferGeometry(.6,.6,.6),n);t.castShadow=!0,t.receiveShadow=!0,t.position.x=.3,t.position.y=.3,t.name="Cube",this.scene.add(t)}})()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(38),s=n(28),o=n(110);const a={fontFace:s.a.GothicA1Regular,size:24,align:"center",vAlign:"center",letterSpacing:0,color:i.b,strokeWidth:0,strokeBias:1,alphaTest:0,strokeColor:i.a,scaleDownToPhysicalSize:!0,shadow:!1,screenSpace:!1,constantSizeOnScreen:!1,prescale:1},r=Object.assign({},a,o.a.title,{lineHeight:1.175,size:72,color:13815992,strokeWidth:.5,strokeBias:.5,strokeColor:2898505,fontFace:s.a.GothicA1ExtraBold}),c=Object.assign({},a,{lineHeight:1.175,size:24,color:i.a,fontFace:s.a.GothicA1Regular}),h={generic:a,title:r,keyLabel:c,keyLabelDouble:Object.assign({},c,{lineHeight:1.2,fontFace:s.a.GothicA1Bold,size:14}),keyLabelSmall:Object.assign({},c,{fontFace:s.a.GothicA1Bold,size:10}),code:Object.assign({},a,{align:"left",fontFace:s.a.CourierPrimeRegular,size:32,lineHeight:3,color:39168})}},function(e,t,n){"use strict";n.d(t,"d",function(){return playerRangedAttack}),n.d(t,"b",function(){return RangedAttackData}),n.d(t,"c",function(){return playerMeleeAttack}),n.d(t,"a",function(){return MeleeAttackData});var i=n(1),s=n(12),o=n(2),a=n(11),r=n(7),c=n(3),h=n(46);function playerRangedAttack(e){const t=new i.BodyDef,n=e.GetPosition(),u=e.GetUserData();t.position.Copy(n),t.type=i.BodyType.b2_dynamicBody,t.bullet=!0,t.userData=new RangedAttackData(u.rangedDamage,u.rangedKnockOutTime,u.rangedKnockback);const l=e.GetWorld(),d=Object(r.a)().createBody(t),f=new i.FixtureDef;f.filter.categoryBits=Object(c.q)(["heroWeapon"]),f.filter.maskBits=Object(c.q)(["environment","enemy"]),f.shape=new i.CircleShape(.01),f.restitution=1e-4,f.density=2,u.ammo-=1,u.brain.rangedAttackCooldownDuration+=.5,Object(s.a)("weaponFireRanged",n),Object(h.b)(l,n,2.5);const p=u.brain.aim,m=new i.Vec2;Object(o.c)(p,m),m.SelfNormalize(),m.SelfMul(2),d.SetLinearVelocity(m),d.CreateFixture(f),a.a.add(()=>Object(r.a)().destroyBody(d),1,!0)}class RangedAttackData{constructor(e,t,n){this.rangedDamage=e,this.rangedKnockOutTime=t,this.rangedKnockback=n}}function playerMeleeAttack(e){const t=e.GetPosition(),n=new i.BodyDef;n.position.Copy(t),n.type=i.BodyType.b2_staticBody;const o=e.GetUserData(),h=new MeleeAttackData(o.meleeDamage,o.meleeKnockOutTime,o.meleeKnockback);n.userData=h,o.brain.meleeAttackCooldownDuration+=1,a.a.add(()=>{n.position.Copy(t);const e=Object(r.a)().createBody(n);Object(c.f)(e,.15,["heroWeapon"],["enemy"]),a.a.add(()=>Object(r.a)().destroyBody(e),.05,!0)},.4,!0),Object(s.a)("weaponFireMelee",t)}class MeleeAttackData{constructor(e,t,n){this.meleeDamage=e,this.meleeKnockOutTime=t,this.meleeKnockback=n}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(0);const s=new class MaterialLibrary{get keyboardPlasticKey(){return this._keyboardPlasticKey||(this._keyboardPlasticKey=new i.MeshStandardMaterial({color:15654314})),this._keyboardPlasticKey}get keyboardPlasticKeyMouth(){return this._keyboardPlasticKeyMouth||(this._keyboardPlasticKeyMouth=new i.MeshStandardMaterial({color:2232593,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticKeyMouth}get scoopMask(){return this._scoopMask||(this._scoopMask=new i.MeshBasicMaterial({color:16711935,depthWrite:!1,colorWrite:!1})),this._scoopMask}get keyboardPlasticKeyUnderside(){return this._keyboardPlasticKeyUnderside||(this._keyboardPlasticKeyUnderside=new i.MeshStandardMaterial({color:15654314,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticKeyUnderside}get keyboardPlastic(){return this._keyboardPlastic||(this._keyboardPlastic=new i.MeshStandardMaterial({color:11180441})),this._keyboardPlastic}get keyboardPlasticHole(){return this._keyboardPlasticHole||(this._keyboardPlasticHole=new i.MeshStandardMaterial({color:5588036,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticHole}get levelMaterial(){return this._levelMaterial||(this._levelMaterial=new i.MeshStandardMaterial({color:1122867})),this._levelMaterial}}},function(e,t,n){"use strict";n.d(t,"c",function(){return packVec2}),n.d(t,"f",function(){return unpackVec2}),n.d(t,"a",function(){return packFilter}),n.d(t,"d",function(){return unpackFilter}),n.d(t,"b",function(){return packTransform}),n.d(t,"e",function(){return unpackTransform});var i=n(1);function packVec2(e){return{x:e.x,y:e.y}}function unpackVec2(e){return new i.Vec2(e.x,e.y)}function packFilter(e){return{categoryBits:e.categoryBits,groupIndex:e.groupIndex,maskBits:e.maskBits}}function unpackFilter(e){const t=new i.Filter;return t.categoryBits=e.categoryBits,t.groupIndex=e.groupIndex,t.maskBits=e.maskBits,t}function packTransform(e){return{p:packVec2(e.p),q:(t=e.q,{s:t.s,c:t.c})};var t}function unpackTransform(e){const t=new i.Transform;return t.SetPosition(unpackVec2(e.p)),t.SetRotation(function unpackRot(e){const t=new i.Rot;return t.c=e.c,t.s=e.s,t}(e.q)),t}},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(0),s=n(8),o=n(4),a=n(33),r=n(103);const c=document.createElement("canvas");c.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()};const h=new i.WebGLRenderer({canvas:c,antialias:!0,premultipliedAlpha:!1});document.body.append(c);["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach(e=>{h.context.canvas.style.setProperty("image-rendering",e)}),h.shadowMap.enabled=!0,h.shadowMap.type=i.PCFShadowMap,h.autoClear=!1;const u=new r.a("pixel-down-sample-2","Graphics Quality",2,0,10,e=>e,e=>e+"",!0,s.a,1);let l=1;function updatePixelRatio(){const e=o.a.pixelRatio/l;a.a.value=e,h.setPixelRatio(e)}u.listen(e=>{l=Math.round(e+1),updatePixelRatio()}),o.a.onChange(()=>{updatePixelRatio();const{width:e,height:t}=o.a;h.setSize(e,t),a.a.value=o.a.pixelRatio,a.b.value.set(2/e,2/t)},!0);Math.min(8192,h.capabilities.maxTextureSize);t.b=h},function(e,t,n){"use strict";n.d(t,"a",function(){return listenToProperty}),n.d(t,"b",function(){return stopListeningToProperty});var i=n(5);class LiveProperty{get listenerCount(){return this.listeners.length}constructor(e,t){this.propName=t,this.listeners=[],this.setValue=this.setValue.bind(this),this.attach(e)}attach(e){this.obj&&this.release(),this.obj=e;const t=this.obj[this.propName];Object.defineProperty(e,this.propName,{configurable:!0,set:this.setValue,get:()=>this.value}),this.setValue(t)}release(){Object.defineProperty(this.obj,this.propName,{value:this.value,writable:!0})}hasListener(e){return-1!==this.listeners.indexOf(e)}addListener(e,t=!0){t&&e(this.value,void 0),this.listeners.push(e)}removeListener(e){Object(i.e)(this.listeners,e)}setValue(e){if(this.value===e)return;const t=this.value;this.value=e;for(const n of this.listeners)n(e,t)}}const s=new Map;function getObjectPropGroup(e){return s.has(e)||s.set(e,new Map),s.get(e)}function listenToProperty(e,t,n,i=!0){(function getLiveProperty(e,t){const n=getObjectPropGroup(e);return n.has(t)||n.set(t,new LiveProperty(e,t)),n.get(t)})(e,t).addListener(n,i)}function stopListeningToProperty(e,t,n){const i=s.get(e);if(i){const o=i.get(t);o&&(o.removeListener(n),0===o.listenerCount&&(o.release(),i.delete(t))),0===i.size&&s.delete(e)}}},,function(e,t,n){"use strict";n.d(t,"b",function(){return getChamferedBoxGeometry}),n.d(t,"a",function(){return getCachedChamferedBoxGeometry});var i=n(0),s=n(2);function getChamferedBoxGeometry(e,t,n,o=.005){const a=new i.SphereBufferGeometry(.02,8,5,.125*Math.PI),r=a.attributes.position.array,c=a.attributes.normal.array,h=new i.Vector3,u=new i.Vector3,l=.5*e-o,d=.5*t-o,f=.5*n-o;for(let e=0;e<c.length;e+=3)h.fromArray(c,e),u.fromArray(r,e),h.round(),1===h.y&&h.set(0,1,0),-1===h.y&&h.set(0,-1,0),h.toArray(c,e),h.multiplyScalar(o),h.x+=l*Object(s.g)(u.x),h.y+=d*Object(s.g)(u.y),h.z+=f*Object(s.g)(u.z),h.toArray(r,e);return a}const o=new Map;function getCachedChamferedBoxGeometry(e,t,n,i=.005){const s=`${e};${t};${n};${i};`;return o.has(s)||o.set(s,getChamferedBoxGeometry(e,t,n,i)),o.get(s)}},function(e,t,n){"use strict";n.d(t,"a",function(){return ZombieFactory}),n.d(t,"c",function(){return zombieSpawner}),n.d(t,"b",function(){return ZombieSpawnerData});var i=n(1),s=n(12),o=n(10),a=n(2),r=n(31),c=n(3),h=n(7);class ZombieFactory{constructor(e){this._b2World=e,this.postUpdates=[],this.postUpdate=e=>{for(const t of this.postUpdates)t(e)}}makeZombie(e,t,n){const i=new o.b(this._b2World,e,t,n);this.postUpdates.push(i.postPhysicsUpdate.bind(i))}}function zombieSpawner(e,t,n,o,u=.25,l=.25,d,f){const p=new i.BodyDef;p.type=i.BodyType.b2_staticBody;const m=(new i.PolygonShape).SetAsBox(.5*u,.5*l),y=new i.FixtureDef;y.shape=m,y.filter.categoryBits=Object(c.q)(["enemy"]),p.userData=new ZombieSpawnerData(f);const g=Object(h.a)().createBody(p);g.CreateFixture(y),g.SetPositionXY(t,n);const b=p.userData;g.SetUserData(b),d?d*=1e3:d=5e3,b.intervalSpawning=setInterval(()=>{const e=new i.Vec2(t+Object(a.i)(-.5,.5),n+Object(a.i)(-.5,.5));b.zombiesSpawned<b.zombieSpawnLimit&&(Object(s.a)("zombieSpawnerMakesZombie",e),o.makeZombie(new r.b,e,g),b.zombiesSpawned+=1)},d)}class ZombieSpawnerData{constructor(e){this.health=10,this.isEnemy=!0,this.isDead=!1,this.zombiesSpawned=0,this.zombieSpawnLimit=50,e&&(this.zombieSpawnLimit=e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(0),s=n(76);function url(e,t){return`fonts/${e}.${t}`}class FontFace{constructor(e){this.name=e}async init(){this.initd||(this.initd=!0,this.msdfTexture=await Object(s.b)(url(this.name,"png")),this.msdfTexture.minFilter=i.LinearFilter,this.msdfTexture.magFilter=i.LinearFilter,this.font=await Object(s.a)(url(this.name,"json")))}}const o={CourierPrimeRegular:new FontFace("CourierPrime-Regular"),CourierPrimeBold:new FontFace("CourierPrime-Bold"),GothicA1Black:new FontFace("GothicA1-Black"),GothicA1Bold:new FontFace("GothicA1-Bold"),GothicA1ExtraBold:new FontFace("GothicA1-ExtraBold"),GothicA1ExtraLight:new FontFace("GothicA1-ExtraLight"),GothicA1Light:new FontFace("GothicA1-Light"),GothicA1Medium:new FontFace("GothicA1-Medium"),GothicA1Regular:new FontFace("GothicA1-Regular"),GothicA1SemiBold:new FontFace("GothicA1-SemiBold"),GothicA1Thin:new FontFace("GothicA1-Thin")}},function(e,t,n){"use strict";n.d(t,"a",function(){return BaseTestScene});var i=n(0),s=n(4),o=n(6);const a=35,r=28;class BaseTestScene{constructor(){this.autoClear=!0;const e=new i.Scene,t=Object(o.a)("bgColor",new i.Color(2301728));e.fog=new i.Fog(t.getHex(),0,60),e.autoUpdate=!1,e.matrixAutoUpdate=!1;const n=new i.PerspectiveCamera(s.a.isMobile?r:a,s.a.aspect,.1,100);s.a.onChange(()=>{n.fov=s.a.isMobile?r:a,n.aspect=s.a.aspect,n.updateProjectionMatrix()},!0),n.position.set(0,0,0),n.lookAt(0,0,0),n.updateProjectionMatrix(),e.add(n),this.scene=e,this.camera=n,this.bgColor=t}update(e){this.scene.updateMatrixWorld(!1)}render(e,t){this.autoClear&&(e.setClearColor(this.bgColor,1),e.clear(!0,!0,!0)),e.render(this.scene,this.camera)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return getKeyboardInput}),n.d(t,"b",function(){return rigToKeyboard});var i=n(107);let s;function getKeyboardInput(e=!0){return s||(s=new i.a(e)),s}function rigToKeyboard(e){let t=!1;window.addEventListener("keydown",n=>{t||(t=!0,console.log("Keyboard connected."),e(getKeyboardInput()))})}},function(e,t,n){"use strict";n.d(t,"a",function(){return Brain}),n.d(t,"b",function(){return ZombieBrain});var i=n(1);class Brain{constructor(e){this.avatarBody=e,this.desiredMovementVector=new i.Vec2,this.aim=new i.Vec2,this.requestRunning=!1,this.isRunning=!1,this.knockedOutDuration=0,this.requestMeleeAttack=!1,this.requestRangedAttack=!1,this.meleeAttackCooldownDuration=0,this.rangedAttackCooldownDuration=0}get currentPosition(){return this.avatarBody.GetPosition()}get aimAngle(){return Math.atan2(this.aim.y,this.aim.x)}}class ZombieBrain extends Brain{constructor(){super(...arguments),this.noticeGauge=.1,this.rateOfNoticing=.1,this.reachedPositionOfInterest=!1}get positionOfInterest(){return this._positionOfInterest}set positionOfInterest(e){this._positionOfInterest=e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return RayCastClosestCallback}),n.d(t,"d",function(){return ZombieVisionRayCast}),n.d(t,"c",function(){return WallHitCheckSmellRayCast}),n.d(t,"b",function(){return WallCheckSmellRayCast});var i=n(1),s=n(9),o=n(15),a=n(3);class RayCastClosestCallback extends i.RayCastCallback{constructor(){super(),this.hitPosition=new i.Vec2}reset(){this.hitBody=null}ReportFixture(e,t,n,i){const s=e.GetBody(),o=s.GetUserData();s.GetType();if(o){if(e.m_isSensor)return-1;this.hitPosition.Copy(t),this.hitBody=s}return i}}class ZombieVisionRayCast extends i.RayCastCallback{constructor(){super(),this.hitPosition=new i.Vec2}reset(){this.hitBody=null}ReportFixture(e,t,n,i){const o=Object(a.q)(["environment"]),r=e.GetBody();return r.GetUserData()instanceof s.a?(this.hitPosition.Copy(t),this.hitBody=r):e.GetFilterData().categoryBits===o?this.hitBody=null:i=-1,i}}class WallHitCheckSmellRayCast extends i.RayCastCallback{constructor(){super(),this.hitStinkBodies=[],this.inaccessibleStinkBodies=[]}reset(){this.hitStinkBodies.length=0,this.inaccessibleStinkBodies.length=0}ReportFixture(e,t,n,i){const s=Object(a.q)(["environment"]),r=e.GetBody();if(r.GetUserData()instanceof o.a)return this.hitStinkBodies.push(r),1;if(e.GetFilterData().categoryBits===s){for(const e of this.hitStinkBodies)this.inaccessibleStinkBodies.push(e);return this.hitStinkBodies.length=0,i}return-1}}class WallCheckSmellRayCast extends i.RayCastCallback{constructor(){super(),this.hitStinkBodies=[]}reset(){this.hitStinkBodies.length=0}ReportFixture(e,t,n,i){const s=Object(a.q)(["environment"]),r=e.GetBody();return r.GetUserData()instanceof o.a?(this.hitStinkBodies.push(r),1):e.GetFilterData().categoryBits===s?(this.hitStinkBodies.length=0,i):-1}}},function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var i=n(0),s=n(4);const o=new i.Uniform(0),a=new i.Uniform(s.a.pixelRatio),r=new i.Uniform(new i.Vector2(2/s.a.width,2/s.a.height))},,,function(e,t,n){"use strict";n.d(t,"b",function(){return SimpleGUIOverlay}),n.d(t,"a",function(){return ToggleButtonUserData});var i=n(0),s=n(4),o=n(23),a=n(17),r=n(5);class SimpleGUIOverlay{constructor(){this._narrowerWindowDimension=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,this._squareButtonDimensions=2,this._scene=new i.Scene,this._camera=new i.OrthographicCamera(0,window.innerWidth,0,window.innerHeight,-100,100),this._fixedRadius=33.3,this._uiMeshes=[],this._uiButtonMeshes=[],this._imageLoader=new i.TextureLoader,this._scene.add(this._camera),"landscape"===s.a.orientation&&s.a.isMobile?(this._relativeWidthButtonSpacing=window.innerWidth/18,this._relativeHeightButtonSpacing=window.innerHeight/8):"portrait"===s.a.orientation&&s.a.isMobile?(this._relativeHeightButtonSpacing=window.innerHeight/18,this._relativeWidthButtonSpacing=window.innerWidth/10):(this._relativeWidthButtonSpacing=window.innerWidth/18,this._relativeHeightButtonSpacing=window.innerHeight/8),s.a.onChange(()=>{this._camera.right=window.innerWidth,this._camera.bottom=window.innerHeight,this._camera.updateProjectionMatrix(),this._narrowerWindowDimension=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,"landscape"===s.a.orientation&&s.a.isMobile?(this._relativeWidthButtonSpacing=window.innerWidth/18,this._relativeHeightButtonSpacing=window.innerHeight/8):"portrait"===s.a.orientation&&s.a.isMobile?(this._relativeHeightButtonSpacing=window.innerHeight/18,this._relativeWidthButtonSpacing=window.innerWidth/10):(this._relativeWidthButtonSpacing=window.innerWidth/18,this._relativeHeightButtonSpacing=window.innerHeight/8)},!0)}rayCastForButton(e,t){const n=new i.Raycaster(new i.Vector3(e,t,-100),new i.Vector3(0,0,1),0,200).intersectObjects(this._uiButtonMeshes);for(const e of n)if(e.object.userData instanceof ToggleButtonUserData)return e.object.userData.hit(),!0;return!1}setPosition(e,t,n){e.position.set(t,n,0)}removeUI(e){return this._scene.remove(e),Object(r.e)(this._uiMeshes,e),e}removeButtonUI(e){return this._scene.remove(e),Object(r.e)(this._uiButtonMeshes,e),e}render(e){e.render(this._scene,this._camera)}async makeFullscreenIcon(e,t){const n=await this.getFullscreenEnterTexture(),s=await this.getFullscreenExitTexture(),a=n.image.width/n.image.height,r=new i.BoxBufferGeometry(this._squareButtonDimensions*a,this._squareButtonDimensions),c=this._makeUI(r,e,t,!0,void 0);return c.material=new i.MeshBasicMaterial({map:n,transparent:!0}),c.userData=new ToggleButtonUserData(e=>{e?(o.a.requestFullscreen(),c.material=new i.MeshBasicMaterial({map:s,transparent:!0})):(document.exitFullscreen(),c.material=new i.MeshBasicMaterial({map:n,transparent:!0}))}),c}async makeWeaponContainerIcon(e,t,n){const s=await this.getWeaponContainerTexture(),o=s.image.width/s.image.height,a=new i.BoxBufferGeometry(this._squareButtonDimensions*o,this._squareButtonDimensions),r=this._makeUI(a,e,t,!0,void 0);r.material=new i.MeshBasicMaterial({map:s,transparent:!0,depthWrite:!1,opacity:.6});const c=r;return c.scale.setScalar(33),c}async makePistolIcon(e,t){const n=await this.getPistolTexture(),s=n.image.width/n.image.height,o=new i.BoxBufferGeometry(this._squareButtonDimensions*s,this._squareButtonDimensions),a=this._makeUI(o,e,t,!0,void 0);return a.material=new i.MeshBasicMaterial({map:n,transparent:!0}),a}async makeWeaponIcon(e,t){const n=await this.getPistolTexture(),s=n.image.width/n.image.height,o=new i.BoxBufferGeometry(this._squareButtonDimensions*s,this._squareButtonDimensions),a=this._makeUI(o,e,t,!0,void 0);a.material=new i.MeshBasicMaterial({map:n,transparent:!0});const r=a;return a.userData=new ToggleButtonUserData(e=>{a.material.visible=!e}),r}async makeWhiteHeartIcon(e,t){const n=await this.getWhiteHeartTexture(),s=n.image.width/n.image.height,o=new i.BoxBufferGeometry(this._squareButtonDimensions*s,this._squareButtonDimensions),a=this._makeUI(o,e,t,void 0,void 0);return a.material=new i.MeshBasicMaterial({map:n,transparent:!0,depthWrite:!1}),a.scale.setScalar(16),a}makeStaminaBar(e,t,n,i=!0){const s=this._makeUI(this.getHealthBarGeometry(),e,t,n,i);s.material.color.set("yellow"),s.material.opacity=.5;const o=new a.a("Stamina:");return o.scale.multiplyScalar(100),o.opacity=2,s.add(o),s}makeBiggerCircle(e,t){return this._makeUI(this.getBiggerCircleGeometry(),e,t)}makeBigCircle(e,t){return this._makeUI(this.getBigCircleGeometry(),e,t)}makeMediumCircle(e,t){return this._makeUI(this.getMediumCircleGeometry(),e,t)}makeSmallCircle(e,t){return this._makeUI(this.getSmallCircleGeometry(),e,t)}makeSmallSquare(e,t,n,i=!1){return this._makeUI(this.getSmallSquareGeometry(),e,t,n,i)}_makeUI(e,t,n,s,o=!1){const a=new i.Mesh(e,this.getMaterial(o));return a.position.set(t,n,0),a.rotation.x=Math.PI,a.scale.setScalar(this._fixedRadius),this._scene.add(a),s?this._uiButtonMeshes.push(a):this._uiMeshes.push(a),a}getMaterial(e=!1){return this._material||(this._material=new i.MeshBasicMaterial({opacity:.3,transparent:!0})),e?this._material.clone():this._material}getFullscreenEnterTexture(){return this._fullscreenEnterTextureLoading||(this._fullscreenEnterTextureLoading=this._imageLoader.loadAsync("game/icons/fullscreen-enter.png"),this._fullscreenEnterTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._fullscreenEnterTextureLoading}getFullscreenExitTexture(){return this._fullscreenExitTextureLoading||(this._fullscreenExitTextureLoading=this._imageLoader.loadAsync("game/icons/fullscreen-exit.png"),this._fullscreenExitTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._fullscreenExitTextureLoading}getWhiteHeartTexture(){return this._whiteHeartTextureLoading||(this._whiteHeartTextureLoading=this._imageLoader.loadAsync("game/icons/heart-white.png"),this._whiteHeartTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._whiteHeartTextureLoading}getWeaponContainerTexture(){return this._weaponContainerTextureLoading||(this._weaponContainerTextureLoading=this._imageLoader.loadAsync("game/icons/weapon-container.png"),this._weaponContainerTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._weaponContainerTextureLoading}getPistolTexture(){return this._pistolTextureLoading||(this._pistolTextureLoading=this._imageLoader.loadAsync("game/icons/weapon-pistol.png"),this._pistolTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._pistolTextureLoading}getUziTexture(){return this._uziTextureLoading||(this._uziTextureLoading=this._imageLoader.loadAsync("game/icons/weapon-uzi.png"),this._uziTextureLoading.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter})),this._uziTextureLoading}getBiggerCircleGeometry(){return this._geometryBigger||(this._geometryBigger=new i.CircleBufferGeometry(3.5,32)),this._geometryBigger}getBigCircleGeometry(){return this._geometryBig||(this._geometryBig=new i.CircleBufferGeometry(2.5,32)),this._geometryBig}getMediumCircleGeometry(){return this._geometryMedium||(this._geometryMedium=new i.CircleBufferGeometry(1,32)),this._geometryMedium}getSmallCircleGeometry(){return this._geometrySmall||(this._geometrySmall=new i.CircleBufferGeometry(.5,32)),this._geometrySmall}getSmallSquareGeometry(){return this._geometrySqaureSmall||(this._geometrySqaureSmall=new i.BoxBufferGeometry(this._squareButtonDimensions,this._squareButtonDimensions)),this._geometrySqaureSmall}getHealthBarGeometry(){return this._geometryHealthBar||(this._geometryHealthBar=new i.BoxBufferGeometry(1,1)),this._geometryHealthBar}}class ToggleButtonUserData{constructor(e){this.callback=e,this.enabled=!1}hit(){this.enabled=!this.enabled,this.callback(this.enabled)}}},function(e,t,n){"use strict";function cleanAnalogValue(e){const t=Math.sign(e);return Math.max(0,1.2*Math.abs(e)-.2)*t}function updateVals(e,t,n,i){for(let s=0;s<n.length;s++){const o=n[s];if(t[s]!==o&&i.length>s)for(const t of i[s])t(o,e);t[s]=o}}n.d(t,"a",function(){return cleanAnalogValue}),n.d(t,"b",function(){return rigToGamePad});class GamePadAPI{constructor(e){this.buttonsNow=[],this.buttonsCallbacks=[],this.axesNow=[],this.axesCallbacks=[];let t=0;for(;this.buttonsCallbacks.length<e.buttons.length;)this.buttonsCallbacks.push([]);for(;this.axesCallbacks.length<e.axes.length;)this.axesCallbacks.push([]);setInterval(()=>{const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(!e||0===e.length)return;const n=e[0];t!==n.timestamp&&(updateVals(n.timestamp,this.buttonsNow,n.buttons.map(e=>e.value),this.buttonsCallbacks),updateVals(n.timestamp,this.axesNow,n.axes,this.axesCallbacks),t=n.timestamp)},0)}get buttonsCount(){return this.buttonsCallbacks.length}get axesCount(){return this.axesCallbacks.length}listenToButton(e,t){this.buttonsCallbacks[e].push(t)}listenToAxis(e,t){this.axesCallbacks[e].push(t)}}function rigToGamePad(e){window.addEventListener("gamepadconnected",t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),e(new GamePadAPI(t.gamepad))})}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o});var i=n(0);const s=new i.Color(0),o=new i.Color(16777215);new i.Color(6750054),new i.Color(2273279),new i.Color(6750054),new i.Color(16711680),new i.Color(16050242)},function(e,t,n){"use strict";n.d(t,"b",function(){return startAggression}),n.d(t,"c",function(){return stopAggression}),n.d(t,"a",function(){return processAggression});var i=n(5),s=n(2),o=n(10),a=n(32);const r=new Map;function startAggression(e,t){r.has(e)?r.get(e).push(t):r.set(e,[t])}function stopAggression(e,t){if(r.has(e)){const n=r.get(e);if(Object(i.e)(n,t),0===n.length){r.delete(e);const t=e.GetUserData();t instanceof o.a&&Object(s.l)(t.brain.desiredMovementVector)}}}const c=new a.d;function processAggression(e){for(const t of r.keys()){const n=r.get(t),i=t.GetPosition(),a=t.GetWorld(),h=t.GetUserData();if(h instanceof o.a)if(h.brain.noticeGauge>=h.brain.rateOfNoticing){let e,t=1/0;for(const o of n){const n=o.GetPosition();if(c.reset(),a.RayCast(c,i,n),c.hitBody){const o=Object(s.d)(i,n);o<t&&(t=o,e=n)}}e&&(h.brain.positionOfInterest=e.Clone()),h.brain.noticeGauge=0}else h.brain.noticeGauge<h.brain.rateOfNoticing&&(h.brain.noticeGauge+=e)}}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return cloneGLTFSkinnedMesh});var i=n(0);function cloneGLTFSkinnedMesh(e){const t={animations:e.animations,scene:e.scene.clone(!0)},n={},s={},o={};e.scene.traverse(e=>{e instanceof i.SkinnedMesh&&(n[e.name]=e)}),t.scene.traverse(e=>{e instanceof i.Bone&&(s[e.name]=e),e instanceof i.SkinnedMesh&&(o[e.name]=e)});for(const e in n)if(e in n){const t=n[e].skeleton,a=o[e],r=[];for(const e of t.bones){const t=s[e.name];r.push(t)}a.bind(new i.Skeleton(r,t.boneInverses),a.matrixWorld)}return t}},function(e,t,n){"use strict";n.d(t,"a",function(){return FPSControls});var i=n(0),s=n(102),o=n.n(s),a=n(23),r=n(49),c=n(6),h=n(2),u=n(58);const l=Object(c.c)("camDamping",0,0,.999),d=1-Object(h.b)(l,0,1);class FPSControls{constructor(e){this._camera=e,this._active=!1,this._fpsController=void 0}toggle(e){void 0===e&&(e=!this._active),this._fpsController||(this._cameraLocal=new i.PerspectiveCamera,function copyCam(e,t){e.position.copy(t.position),e.scale.copy(t.scale),e.quaternion.copy(t.quaternion),e.fov=t.fov}(this._cameraLocal,this._camera),this._camera.parent.add(this._cameraLocal),this._fpsController=new o.a(this._cameraLocal,a.b.domElement,{movementSpeed:.01}),u.a.register(this));const t=this._fpsController.onPointerLockAttainSignal,n=t._bindings[0]._listener;t._bindings[0]._listener=()=>{this._active&&n()},e||this._fpsController.onPointerLockReleaseSignal.dispatch(),this._active=e}update(){this._active&&this._fpsController&&(this._fpsController.update(),this._camera.position.lerp(this._cameraLocal.position,d),this._camera.quaternion.slerp(this._cameraLocal.quaternion,d),this._camera.scale.lerp(this._cameraLocal.scale,d),this._camera.fov=Object(h.h)(this._camera.fov,this._cameraLocal.fov,d),r.a.updateProjection())}}new FPSControls(r.a.camera)},function(e,t,n){"use strict";n.d(t,"a",function(){return startControllableCharacters});var i=n(12),s=n(37),o=n(30),a=n(9),r=n(59),c=n(15),h=n(45),u=n(112),l=n(113),d=n(77);function startControllableCharacters(e,t,n,f){let p;const m=[],y=t=>{const s=new a.b(e,t);Object(h.b)(s.avatarBody),Object(c.d)(s.avatarBody),Object(r.b)(s.avatarBody,n),m.push(s.postPhysicsUpdate.bind(s)),p||(p=s,Object(i.b)(s.avatarBody))};Object(s.b)(e=>y(new u.a(e))),Object(o.b)(e=>y(new l.a(e,t,n))),Object(d.b)(e=>y(new d.a(n)));return e=>{p&&f&&f.offset.Copy(p.avatarBody.GetPosition());for(const t of m)t(e)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return registerWeaponUser}),n.d(t,"c",function(){return unregisterWeaponUser}),n.d(t,"a",function(){return processWeaponUsers});var i=n(5),s=n(9),o=n(20);const a=[];function registerWeaponUser(e){a.push(e)}function unregisterWeaponUser(e){Object(i.e)(a,e)}function processWeaponUsers(e){for(const t of a){const n=t.GetUserData();n instanceof s.a&&(n.brain.meleeAttackCooldownDuration>0&&(n.brain.meleeAttackCooldownDuration-=e),n.brain.rangedAttackCooldownDuration>0&&(n.brain.rangedAttackCooldownDuration-=e),n.brain.meleeAttackCooldownDuration>0||!n.brain.requestMeleeAttack?n.brain.rangedAttackCooldownDuration>0||!n.brain.requestRangedAttack||!(n.ammo>0)||0===n.brain.aim.x&&0===n.brain.aim.y||Object(o.d)(t):Object(o.c)(t))}}},function(e,t,n){"use strict";n.d(t,"c",function(){return throwGenericNoiseMaker}),n.d(t,"b",function(){return makeNoise}),n.d(t,"a",function(){return SoundData});var i=n(12),s=n(2),o=n(11),a=n(7),r=n(3);function throwGenericNoiseMaker(e,t,n,c){const h=n.Clone();h.SelfMul(.1);const u=c/(3150*h.Length()),l={soundEvent:o.a.add(()=>{Object(i.a)("soundMaker",d.GetPosition()),function replaceWithSoundEvent(e,t){const n=e.GetPosition();e.SetLinearDamping(Object(s.i)(6,20)),o.a.add(()=>Object(a.a)().destroyBody(e),3,!0),makeNoise(t,n,1.5)}(d,e)},u,!0)},d=Object(r.g)(e,t.x,t.y,.01,["noiseMaker"],["environment"],l,void 0,!0);d.ApplyLinearImpulseToCenter(h)}function makeNoise(e,t,n,i){const s=Object(r.g)(e,t.x,t.y,n,["sound"],["enemy","hero"],new SoundData,!0);i||(i=1),o.a.add(()=>Object(a.a)().destroyBody(s),i,!0)}class SoundData{}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),s=n(25),o=n(96),a=n(42);const r=new class ZombieModelFactory{constructor(){this.status="not started"}init(e){if("not started"!==this.status)throw new Error("cannot initialize twice");{this.status="initializing";const t=new i.LoadingManager;new s.a(t).load("game/models/ZombieSmooth_editeded.gltf",t=>{this.zombieScene=t.scene,this.gltf=t,this.zombieAnimations=t.animations;for(let e=t.scene.children.length-1;e>=0;e--){const n=t.scene.children[e];n.scale.multiplyScalar(.06),this.zombieRoot=n,n.traverse(e=>{e instanceof i.SkinnedMesh&&(e.castShadow=!0,e.receiveShadow=!0)})}this.status="ready",e()},e=>{},e=>{})}}makeZombie(e,t){if("ready"===this.status){const n=Object(a.a)(this.gltf);let s,r;n.scene.traverse(e=>{e instanceof i.SkinnedMesh&&(s=e,(r=new i.AnimationMixer(e)).clipAction(this.zombieAnimations[0]).play())});for(let t=n.scene.children.length-1;t>=0;t--){const i=n.scene.children[t];e.add(i)}if(s&&r&&t)return new o.a(s,r,t,this.zombieAnimations);throw new Error("could not find zombieMesh")}throw new Error("zombieFactory not ready")}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=new class ItemCatalog{constructor(){this.ammoRefill=["ammo",8],this.healthRefill=["medkit",10],this.cleanlinessRefill=["bar of soap",30],this.woodSmallBundle=["wood",3],this.stoneSmallBundle=["stone",3],this.metalSmallBundle=["metal",3],this.woodMediumBundle=["wood",15],this.stoneMediumBundle=["stone",15],this.metalMediumBundle=["metal",15],this.woodLargeBundle=["wood",30],this.stoneLargeBundle=["stone",30],this.metalLargeBundle=["metal",30]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(0),s=n(4),o=n(2);const a=.1,r=200,c=6e3;const h=new i.PerspectiveCamera(s.a.isMobile?28:35,s.a.aspect,.01,10),u=new class CameraShaker{constructor(e){this.camera=e,this._time=0,this._timers=[],this._shakeScale=25e-5,this._shakeStrength=0;const t=e.clone();t.position.set(0,0,0),t.quaternion.setFromEuler(new i.Euler(0,0,0)),t.scale.set(1,1,1),e.add(t),this.shakyCamera=t}set shakeStrength(e){(e=Object(o.b)(e,0,1))!==this._shakeStrength&&(this._shakeStrength=e)}set shakeScale(e){(e=Object(o.b)(e,0,10))!==this._shakeScale&&(this._shakeScale=e)}updateProjection(){this.shakyCamera.fov=this.camera.fov,this.shakyCamera.aspect=this.camera.aspect,this.shakyCamera.updateProjectionMatrix()}update(e){if(this._time+=e,this.shakeStrength=this._shakeStrength+e/a*(this._timers.length>0?12:-1),this._shakeStrength>0){this.shakyCamera.position.set(0,0,0);let e=1;for(let t=r;t<c;t*=1.674,e*=.8){const n=1/e*this._shakeScale*this._shakeStrength;this.shakyCamera.position.x+=Math.sin(this._time*t)*n,this.shakyCamera.position.y+=Math.sin(this._time*t*1.235)*n,this.shakyCamera.position.z+=Math.sin(this._time*t*1.67235)*n}}for(;this._timers.length>0&&this._timers[0]<=this._time;)this._timers.shift()}add(e){this._timers.push(this._time+e),this._timers.sort()}}(h);s.a.onChange(()=>{h.fov=s.a.isMobile?28:35,h.aspect=s.a.aspect,h.updateProjectionMatrix(),u.updateProjection()})},,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=new(n(91).a)(void 0,!1)},function(e,t,n){"use strict";n.d(t,"b",function(){return queueNewSound}),n.d(t,"a",function(){return processQueuedSounds});var i=n(11);const s=[];function queueNewSound(e){if(!e.GetBody().GetUserData())throw new Error("Data is null");s.push(e)}function processQueuedSounds(){if(s.length>0){for(const e of s)triggerSound(e);s.length=0}}function triggerSound(e){const t=e.GetBody().GetUserData().soundEvent;try{i.a.runPrematurely(t)}catch(e){console.log(e)}}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return hexColor});var i=n(0);n(2);new i.Color(1,1,1),new i.Color;function hexColor(e){const t=/^\#([A-Fa-f0-9]+)$/.exec(e);if(t){const e=t[1],n=e.length;if(3===n){const t=new i.Color;return t.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,t.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,t.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,t}if(6===n){const t=new i.Color;return t.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,t.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,t.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,t}}return new i.Color(1,0,1)}},function(e,t,n){"use strict";n.d(t,"a",function(){return PhysicsCharacter});var i=n(1),s=n(3),o=n(2);const a=new i.Vec2(.1,.1);let r=0;class PhysicsCharacter{constructor(e,t,n,i,o,c,h=a,u=1){this._brain=t,this.size=h,this.slowDownFactor=1,this._velocity={x:0,y:0},this._maxSpeed=.75,this._minSpeed=.1,this._desiredVelocity={x:0,y:0},this._movementVector={angle:0,speed:0},this._desiredSpeed=0,this._turningSpeed=.2,this._sharpTurnThreshold=Math.PI/2,this._id=r++;const l=Object(s.g)(e,n.x,n.y,.7*h.x,i,o,c,void 0,void 0,u);this._avatarBody=l,this._avatarBody.SetFixedRotation(!0),this._brain.avatarBody=l}get avatarBody(){return this._avatarBody}postPhysicsUpdate(e){this._desiredVelocity.x=this._brain.desiredMovementVector.x*(this._brain.isRunning?2:1),this._desiredVelocity.y=this._brain.desiredMovementVector.y*(this._brain.isRunning?2:1),this._desiredSpeed=Math.sqrt(Math.pow(this._desiredVelocity.x,2)+Math.pow(this._desiredVelocity.y,2));const t=this._maxSpeed*this._desiredSpeed/this.slowDownFactor;if(this._desiredSpeed>0){const e=Math.atan2(this._desiredVelocity.y,this._desiredVelocity.x),n=Object(o.k)(this._movementVector.angle-e,-Math.PI,Math.PI);n>this._turningSpeed&&n<this._sharpTurnThreshold?this._movementVector.angle-=this._turningSpeed:n<-this._turningSpeed&&n>-this._sharpTurnThreshold?this._movementVector.angle+=this._turningSpeed:this._movementVector.angle=e,this._movementVector.speed<t?this._movementVector.speed+=this._minSpeed:this._movementVector.speed=t}else this._movementVector.speed>this._minSpeed?this._movementVector.speed-=this._minSpeed:this._movementVector.speed=0;this._velocity.x=this._movementVector.speed*Math.cos(this._movementVector.angle),this._velocity.y=this._movementVector.speed*Math.sin(this._movementVector.angle),this._avatarBody.SetLinearVelocity(this._velocity)}}},function(e,t,n){"use strict";var i=n(5);const s=[],o={update:e=>{for(const t of s)t.update(e)},register:e=>{s.push(e)},unregister:e=>{Object(i.e)(s,e)}};t.a=o},function(e,t,n){"use strict";n.d(t,"b",function(){return registerUserHUD}),n.d(t,"a",function(){return processUsersHUD});var i=n(0),s=n(23),o=n(17),a=n(36),r=(n(5),n(9));const c=[],h=new Map,u=new Map,l=new Map,d=40;let f,p;async function registerUserHUD(e,t){f=t,c.push(e),await async function initializeHealthHUD(e){if(e.GetUserData()instanceof r.a){const t=e.GetUserData(),n=[];for(let e=0;e<t.maxHealth;e++){const t=await f.makeWhiteHeartIcon(f._narrowerWindowDimension/40+40*(e+1),40);t.material.color.set(new i.Color(1.2,0,0)),n.push(t)}h.set(e,n)}}(e),await async function initializeWeaponHUD(e){if(e.GetUserData()instanceof r.a){const t=e.GetUserData(),n=await f.makeWeaponContainerIcon(0,0,t);n.position.set(90+n.scale.x/2,90+n.scale.y/2,0),p=await f.makePistolIcon(n.position.x+1,n.position.y);const r=new i.Vector3((p.geometry.parameters.width+.5)*n.scale.x/2,(p.geometry.parameters.height+.5)*n.scale.y/2,0);n.scale.set(r.x,r.y,r.z),n.userData=new a.a(e=>{e?s.a.requestFullscreen():document.exitFullscreen()});const c=new o.a(`Ammo: ${t.ammo}`);c.scale.multiply(r),c.scale.multiply(new i.Vector3((r.x-25)/r.x,1.5,1)),c.opacity=2,n.add(c),c.position.set(0,-1.25,0),u.set(e,n)}}(e),await async function initializeFullscreenButton(e){const t=await f.makeFullscreenIcon(window.innerWidth-f._relativeWidthButtonSpacing,f._relativeHeightButtonSpacing/2);l.set(e,t)}(e)}function processUsersHUD(e){for(const e of c)healthHUDupdate(e),weaponHUDupdate(e),settingsHUDupdate(e)}function weaponHUDupdate(e){if(e.GetUserData()instanceof r.a){const t=e.GetUserData(),n=u.get(e);n.position.set(80+n.scale.x/2,80+n.scale.y/2,0),p.position.set(n.position.x+1,n.position.y,0),n.children[0].text=`Ammo: ${t.ammo}`}}function healthHUDupdate(e){if(e.GetUserData()instanceof r.a){const t=e.GetUserData(),n=h.get(e);let s=0;for(const e of n)s>=t.currentHealth?e.material.color.set(16777215):e.material.color.set(new i.Color(1.2,0,0)),e.position.set(f._narrowerWindowDimension/d+(s+1)*d,d,0),s++}}function settingsHUDupdate(e){if(e.GetUserData()instanceof r.a){e.GetUserData();l.get(e).position.set(window.innerWidth-f._relativeWidthButtonSpacing/2,f._relativeHeightButtonSpacing/2,0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=1/.0254*72},function(e,t,n){"use strict";n.d(t,"a",function(){return nextFrameUpdate}),n.d(t,"b",function(){return onNextFrame});const i=[];function nextFrameUpdate(){i.length>0&&(i.forEach(e=>e()),i.length=0)}function onNextFrame(e){i.push(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestTextPhysicsScene}),n.d(t,"b",function(){return runTextPhysicsTest});var i=n(7),s=n(3),o=n(28),a=n(17),r=n(19),c=n(43),h=n(6),u=n(16);class TestTextPhysicsScene extends u.a{constructor(){super();const e=new c.a(this.camera);Object(h.b)("fpsCam")&&e.toggle(!0);const t=runTextPhysicsTest(this.scene,this.b2World);setTimeout(()=>{t.settings.fontFace=o.a.GothicA1Black},2e3);(async()=>{})()}update(e){super.update(e)}render(e,t){super.render(e,t)}}function runTextPhysicsTest(e,t){let n;new a.a(["/**","* For the brave souls who get this far: You are the chosen ones,","* the valiant knights of programming who toil away, without rest,","* fixing our most awful code. To you, true saviors, kings of men,","* I say this: never gonna give you up, never gonna let you down,","* never gonna run around and desert you. Never gonna make you cry,","* never gonna say goodbye. Never gonna tell a lie and hurt you.","*/"].join("\n"),r.a.code,void 0,void 0);const o=new a.a(["/**","* For the brave souls who get this far: You are the chosen ones,","* the valiant knights of programming who toil away, without rest,","* testCode.scale.multiplyScalar(s)","* testCode.position.z -= 6","* testCode.position.x -= 2","* scene.add(testCode)","* ","* testCode.onMeasurementsUpdated = () => {","*                                            if (lastKnownTextBodies) {","*                                                                                 for (const body of lastKnownTextBodies) {","* }","* lastKnownTextBodies = undefined","* }","* lastKnownTextBodies = textToPhysicsBodies(testCode, b2World)","* }","* return testCode","*/"].join("\n"),r.a.code,void 0,void 0);return o.scale.multiplyScalar(10),o.position.z-=6,o.position.x-=2,e.add(o),o.onMeasurementsUpdated=()=>{if(n){for(const e of n)Object(i.a)().destroyBody(e);n=void 0}n=Object(s.s)(o,t)},o}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestDeadtropolis});var i=n(1),s=n(0),o=n(4),a=n(30),r=n(13),c=n(115),h=n(39),u=n(7),l=n(14),d=n(59),f=n(64),p=n(53),m=n(15),y=n(45),g=n(27),b=n(3),w=n(32),v=n(22),S=n(46),k=n(36),_=n(6),B=n(2),x=n(116),C=n(44);const M=35,P=28;let O=!1,D=!1,T=!1,A=!1,G=!1;class TestDeadtropolis{constructor(e){this.rayCastConverter=e,this.autoClear=!0,this.ui=new k.b,this.b2Preview=void 0,this._postUpdates=[],this.initiateScene();const t=new i.World(new i.Vec2(0,0));if(Object(u.a)().init(t),"b2Preview"===Object(_.e)("test")){const n=new r.a(t);this.b2Preview=n,this.b2Preview&&!e&&(this.rayCastConverter=b.c.bind(null,this.b2Preview)),this.scene.add(this.b2Preview),r.b.value=!0}this.b2World=t;const n=Object(x.a)();n.register(new c.a),this.b2World.SetContactListener(n);const s=new w.a;Object(a.a)().addListener(this.HandleKey);const o=new g.a(t);this._postUpdates.push(o.postUpdate),Object(g.c)(t,0,1.25,o,void 0,void 0,1,10),this._postUpdates.push(Object(C.a)(this.b2World,e,this.ui,this.b2Preview)),function saveLevelBeforeUnload(e){window.onbeforeunload=t=>{const n=[],s={bodies:n};let o=e.GetBodyList();for(;o;){if(!(o.m_userData instanceof b.b&&o.GetFixtureList())){o=o.m_next;continue}const e=o.m_type;let t=o.GetFixtureList();const s=[];for(;t;){const e=t.m_shape;let n;if(e instanceof i.PolygonShape){const t={type:e.m_type,vertices:e.m_vertices.map(v.c),normals:e.m_normals.map(v.c),radius:e.m_radius,count:e.m_count};n=t}if(n){const e={shape:n,density:t.m_density,filter:Object(v.a)(t.m_filter),friction:t.m_friction,isSensor:t.m_isSensor,restitution:t.m_restitution,restitutionThreshold:t.m_restitutionThreshold};s.push(e)}t=t.m_next}const a={bodyType:e,fixtures:s,angularDamping:o.m_angularDamping,angularVelocity:o.m_angularVelocity,fixedRotationFlag:o.m_fixedRotationFlag,linearDamping:o.m_linearDamping,linearVelocity:Object(v.c)(o.m_linearVelocity),torque:o.m_torque,xf:Object(v.b)(o.m_xf),xf0:Object(v.b)(o.m_xf0)};n.push(a),o=o.m_next}localStorage.setItem("level",JSON.stringify(s))}}(t);const h=localStorage.getItem("level");if(h&&!Object(_.b)("resetLevel"))!function loadLevelData(e){const t=JSON.parse(e);for(const e of t.bodies){const t=new i.BodyDef;t.userData=new b.b,t.angularDamping=e.angularDamping,t.angularVelocity=e.angularVelocity,t.type=e.bodyType,t.fixedRotation=e.fixedRotationFlag,t.linearDamping=e.linearDamping;const n=Object(u.a)().createBody(t);n.SetLinearVelocity(Object(v.f)(e.linearVelocity)),n.SetAngularVelocity(e.angularVelocity),n.SetTransform(Object(v.e)(e.xf));for(const t of e.fixtures){const e=new i.FixtureDef;switch(e.density=t.density,e.friction=t.friction,e.isSensor=t.isSensor,e.restitution=t.restitution,e.restitutionThreshold=t.restitutionThreshold,t.shape.type){case i.ShapeType.e_chainShape:case i.ShapeType.e_circleShape:case i.ShapeType.e_edgeShape:break;case i.ShapeType.e_polygonShape:const n=t.shape,s=new i.PolygonShape;s.m_count=n.count,s.m_radius=n.radius,s.m_normals=n.normals.map(v.f),s.m_vertices=n.vertices.map(v.f),e.shape=s;break;case i.ShapeType.e_shapeTypeCount:case i.ShapeType.e_unknown:}const s=n.CreateFixture(e);s.SetFilterData(Object(v.d)(t.filter))}}}(h);else for(let e=0;e<100;e++)Object(b.d)(t,new i.Vec2(Object(B.i)(-3,3),Object(B.i)(-3,3)));document.addEventListener("mousedown",e=>{const n=this.rayCastConverter(e.x,e.y),i=this.b2Preview?this.b2Preview.offset:this.rayCastConverter(window.innerWidth/2,window.innerHeight/2),a=n.Clone().SelfSub(i),r=a.Length();if(a.SelfNormalize(),a.SelfMul(.0075),O&&(s.reset(),this.b2World.RayCast(s,i,n),s.hitBody)){const e=s.hitBody,t=e.GetUserData(),n=e.GetFixtureList();n&&Object(l.b)(n),e.ApplyLinearImpulseToCenter(a),t.isDead&&Object(u.a)().destroyBody(s.hitBody)}D&&Object(b.d)(t,n),T&&Object(b.r)(t,n,.001),A&&Object(S.c)(t,i,a,r),G&&Object(g.c)(t,n.x,n.y,o)},!1)}HandleKey(e,t){switch(e){case"KeyQ":O=t;break;case"KeyZ":D=t;break;case"KeyX":T=t;break;case"KeyC":A=t;break;case"KeyV":G=t}}update(e){this.scene.updateMatrixWorld(!1),this.b2World.Step(e,10,4);for(const t of this._postUpdates)t(e);this.b2Preview&&this.b2Preview.update(e),Object(p.a)(),Object(h.a)(e),Object(y.a)(e),Object(m.b)(e),Object(f.a)(),Object(m.c)(e),Object(l.a)(),Object(d.a)(e)}render(e,t){this.autoClear&&(e.setClearColor(this.bgColor,1),e.clear(!0,!0,!0)),e.render(this.scene,this.camera),this.ui.render(e)}initiateScene(){const e=new s.Scene,t=Object(_.a)("bgColor",new s.Color(2301728));e.fog=new s.Fog(t.getHex(),0,60),e.autoUpdate=!1,e.matrixAutoUpdate=!1;const n=new s.PerspectiveCamera(o.a.isMobile?P:M,o.a.aspect,.1,100);o.a.onChange(()=>{n.fov=o.a.isMobile?P:M,n.aspect=o.a.aspect,n.updateProjectionMatrix()},!0),n.position.set(0,0,0),n.lookAt(0,0,0),n.updateProjectionMatrix(),e.add(n),this.scene=e,this.camera=n,this.bgColor=t}}},function(e,t,n){"use strict";n.d(t,"b",function(){return startSmellInvestigation}),n.d(t,"a",function(){return processSmellInvestigation});n(5);var i=n(10),s=n(32);const o=[];function startSmellInvestigation(e){o.includes(e)||o.push(e)}const a=new s.b;function processSmellInvestigation(){for(const e of o){const t=e.GetUserData();if(t instanceof i.a){const e=t.brain.avatarBody.GetWorld();for(const n of t.stinkierButInaccessibleArray){a.reset();const i=t.brain.currentPosition,s=n.GetPosition();let o;e.RayCast(a,i,s);const r=a.hitStinkBodies;for(const e of r)e===n&&(o=e);if(o){const e=o.GetUserData();if(t.currentDetectedStinkStrength){const n=e.stinkPower;t.currentDetectedStinkStrength<n&&(t.currentDetectedStinkStrength=n,t.currentDetectedStinkLocation=o.GetPosition(),t.brain.positionOfInterest=t.currentDetectedStinkLocation)}else t.currentDetectedStinkStrength=e.stinkPower,t.currentDetectedStinkLocation=o.GetPosition(),t.brain.positionOfInterest=t.currentDetectedStinkLocation}}}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return AvatarContactListener});var i=n(1),s=n(3),o=n(5);class AvatarContactListener extends i.ContactListener{constructor(){super(),this.contactPairs=new Map,this.sensorBeginCallbacks=new Map,this.sensorEndCallbacks=new Map}listenForSensorBeginContact(e,t){Object(o.d)(this.sensorBeginCallbacks,e,t)}listenForSensorEndContact(e,t){Object(o.d)(this.sensorEndCallbacks,e,t)}BeginContact(e){const t=Object(s.o)(e);if(t){if(this.sensorBeginCallbacks.has(t.sensor))for(const e of this.sensorBeginCallbacks.get(t.sensor))e(t.rigidBody);Object(o.d)(this.contactPairs,t.sensor,t.rigidBody)}}EndContact(e){const t=Object(s.o)(e);if(t){if(this.sensorEndCallbacks.has(t.sensor))for(const e of this.sensorEndCallbacks.get(t.sensor))e(t.rigidBody);t&&Object(o.a)(this.contactPairs,t.sensor,t.rigidBody)}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsLevelScene});var i=n(1),s=n(0),o=n(30),a=n(21),r=n(13),c=n(3),h=n(67),u=n(8),l=n(26),d=n(6),f=n(68),p=n(18);class TestGraphicsLevelScene extends p.a{constructor(e="test-layout"){super(!1,!1),this.checkpointBodies=[];const t=new i.World(new i.Vec2(0,-9.8));if(this.b2World=t,Object(d.b)("debugPhysics")){const e=new r.a(t);this.b2Preview=e,this.scene.add(e)}new h.a(Object(d.e)("level")||e,(e,n,i,o,r)=>{const h=16776960===r;Object(c.j)(t,e,n,i,o,h);const d=.5*(i+o);n+o>=32&&(o+=100);const f=a.a.levelMaterial.clone();f.color.setHex(r);const p=new s.Mesh(Object(l.a)(i*u.b,o*u.b,d*u.b,.01),f);p.receiveShadow=!0,p.castShadow=!0,p.position.set((e-.5*i)*u.b-.8,.4-(n+.5*o)*u.b,0),this.scene.add(p);const m=(.5*d+1)*u.b;if(16776960===r){const e=p.clone();e.position.z-=m,p.position.z+=m,this.scene.add(e)}},()=>{const e=new f.a,t=Object(o.a)();t.addListener(e.onKeyCodeEvent),e.scale.multiplyScalar(5),e.position.set(-0,0,-.5),this.scene.add(e),this.keyboardInput=t,this.keyboardMesh=e})}update(e){super.update(e),this.b2World.Step(e,10,4),this.b2Preview&&this.b2Preview.update(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return PNGLevel});var i=n(0);class BlocksRecipes{constructor(){this.blocks=new Map}register(e,t,n,i,s){this.blocks.has(e)||this.blocks.set(e,new Map);const o=this.blocks.get(e);o.has(s)||o.set(s,new Map);const a=o.get(s);a.has(n)||a.set(n,new Map);const r=a.get(n);let c=!1;for(const[e,n]of r.entries())e+n===t&&(r.set(e,n+1),c=!0);c||r.set(t,i)}process(e){this.blocks.forEach((t,n)=>{t.forEach((t,i)=>{t.forEach((t,s)=>{t.forEach((t,o)=>{e(n,o,s,t,i)})})})})}}class PNGLevel{constructor(e,t,n,s){const o=new Image;o.crossOrigin="Anonymous",o.onload=e=>{const s=new BlocksRecipes,a=document.createElement("canvas"),r=o.width,c=o.height;a.width=r,a.height=c;const h=a.getContext("2d");h.drawImage(o,0,0,r,c);const u=h.getImageData(0,0,r,c).data;let l=0;const d=new i.Color,f=new i.Color;function extractColour(e,t){e.r=u[4*t+0]/255,e.g=u[4*t+1]/255,e.b=u[4*t+2]/255}const p=r*c;for(let e=0;e<p;e++){extractColour(d,e);const t=u[4*e+3]>128,n=e+1;extractColour(f,n);const i=u[4*n+3]>128;let o=!1;if(t?(l++,d.equals(f)||(o=!0),t!==i&&(o=!0)):o=!0,n%r==0&&(o=!0),o&&l>0){const t=e%r,n=Math.floor(e/r);s.register(t,n,l,1,d.getHex()),l=0}}s.process(t),n&&n()},o.onerror=e=>{console.error("image not found: "+e)},o.src=`game/levels/${e}.png`}}},function(e,t,n){"use strict";n.d(t,"a",function(){return ProceduralKeyboardMesh});var i=n(0),s=n(21),o=n(26),a=n(123),r=n(69);const c=.015;class KeyInfo{constructor(e,t,n){this.label=e,this.width=t,this.eventCode=n,this.width*=c}}class KeySpace extends KeyInfo{constructor(e){super("",e,void 0)}}const h=[[new KeyInfo("ESC",1,"Escape"),new KeySpace(2),new KeyInfo("F1",1,"F1"),new KeyInfo("F2",1,"F2"),new KeyInfo("F3",1,"F3"),new KeyInfo("F4",1,"F4"),new KeyInfo("F5",1,"F5"),new KeyInfo("F6",1,"F6"),new KeyInfo("F7",1,"F7"),new KeyInfo("F8",1,"F8"),new KeyInfo("F9",1,"F9"),new KeyInfo("F10",1,"F10"),new KeyInfo("F11",1,"F11"),new KeyInfo("F12",1,"F12"),new KeySpace(.5),new KeyInfo("PRNT SCRN",1,"F13"),new KeyInfo("SCR LK",1,"F14"),new KeyInfo("PAUSE",1,"F15")],[new KeyInfo("~",1,"Backquote"),new KeyInfo("!\n1",1,"Digit1"),new KeyInfo("@\n2",1,"Digit2"),new KeyInfo("#\n3",1,"Digit3"),new KeyInfo("$\n4",1,"Digit4"),new KeyInfo("%\n5",1,"Digit5"),new KeyInfo("^\n6",1,"Digit6"),new KeyInfo("&\n7",1,"Digit7"),new KeyInfo("*\n8",1,"Digit8"),new KeyInfo("(\n9",1,"Digit9"),new KeyInfo(")\n0",1,"Digit0"),new KeyInfo("_\n-",1,"Minus"),new KeyInfo("+\n=",1,"Equal"),new KeyInfo("BACKSPACE",2,"Backspace"),new KeySpace(.5),new KeyInfo("INS",1,"Insert"),new KeyInfo("HOME",1,"Home"),new KeyInfo("PAGE UP",1,"PageUp")],[new KeyInfo("TAB",1.55,"Tab"),new KeyInfo("Q",1,"KeyQ"),new KeyInfo("W",1,"KeyW"),new KeyInfo("E",1,"KeyE"),new KeyInfo("R",1,"KeyR"),new KeyInfo("T",1,"KeyT"),new KeyInfo("Y",1,"KeyY"),new KeyInfo("U",1,"KeyU"),new KeyInfo("I",1,"KeyI"),new KeyInfo("O",1,"KeyO"),new KeyInfo("P",1,"KeyP"),new KeyInfo("{\n[",1,"BracketLeft"),new KeyInfo("}\n]",1,"BracketRight"),new KeyInfo("|\n\\",1.45,"Backslash"),new KeySpace(.5),new KeyInfo("DEL",1,"Delete"),new KeyInfo("END",1,"End"),new KeyInfo("PAGE DOWN",1,"PageDown")],[new KeyInfo("CAPS LCK",1.9,"CapsLock"),new KeyInfo("A",1,"KeyA"),new KeyInfo("S",1,"KeyS"),new KeyInfo("D",1,"KeyD"),new KeyInfo("F",1,"KeyF"),new KeyInfo("G",1,"KeyG"),new KeyInfo("H",1,"KeyH"),new KeyInfo("J",1,"KeyJ"),new KeyInfo("K",1,"KeyK"),new KeyInfo("L",1,"KeyL"),new KeyInfo(":\n;",1,"Semicolon"),new KeyInfo("\"\n'",1,"Quote"),new KeyInfo("ENTER",2.25,"Enter")],[new KeyInfo("",2.65,"ShiftLeft"),new KeyInfo("Z",1,"KeyZ"),new KeyInfo("X",1,"KeyX"),new KeyInfo("C",1,"KeyC"),new KeyInfo("V",1,"KeyV"),new KeyInfo("B",1,"KeyB"),new KeyInfo("N",1,"KeyN"),new KeyInfo("M",1,"KeyM"),new KeyInfo("<\n,",1,"Comma"),new KeyInfo(">\n.",1,"Period"),new KeyInfo("?\n/",1,"Slash"),new KeyInfo("",2.65,"ShiftRight"),new KeySpace(.5),new KeySpace(1),new KeyInfo("",1,"ArrowUp")],[new KeyInfo("CTRL",1.5,"ControlLeft"),new KeyInfo("FN",1,void 0),new KeyInfo("CMD",1.5,"MetaLeft"),new KeyInfo("ALT",1.5,"AltLeft"),new KeyInfo(" ",5.9,"Space"),new KeyInfo("ALT",1.5,"AltRight"),new KeyInfo("MENU",1.5,"ContextMenu"),new KeyInfo("CTRL",1.5,"ControlRight"),new KeySpace(.5),new KeyInfo("",1,"ArrowLeft"),new KeyInfo("",1,"ArrowDown"),new KeyInfo("",1,"ArrowRight")]],u=.34,l=.015,d=.13;class ProceduralKeyboardMesh extends i.Mesh{constructor(){super(Object(o.b)(u,l,d),s.a.keyboardPlastic),this.onKeyCodeEvent=(e,t)=>{this.buttonsByEventCode.has(e)&&(this.buttonsByEventCode.get(e).position.y=t?l-.012:l-.0075)},this.castShadow=!0,this.receiveShadow=!0,this.renderOrder=-2;const e=new Map,t=.15*c;let n=.5*-d+.01,i=0;for(const s of h){1===i&&(n+=.5*(c+t)),i++,n+=.5*(c+t);let o=.5*-u+.01;for(const i of s){if(o+=.5*(i.width+t),""!==i.label){const t=new a.a(i.width+.004,.012,c+.004,.001);this.add(t),t.position.set(o,l-.005,n);const s=new r.a(i.width,.01,c,i.label,.0015);void 0===i.eventCode||e.has(i.eventCode)||e.set(i.eventCode,s),this.add(s),s.position.set(o,l-.0075,n)}o+=.5*(i.width+t)}n+=.5*(c+t)}this.buttonsByEventCode=e,this.position.y+=l}}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyButtonMesh});var i=n(0),s=n(124),o=n(21),a=n(17),r=n(19),c=n(26),h=n(60);const u=r.a.keyLabel,l=r.a.keyLabelDouble,d=r.a.keyLabelSmall;class KeyButtonMesh extends i.Mesh{constructor(e,t,n,i="",r=.005){if(super(Object(c.a)(e,t,n,r),o.a.keyboardPlasticKey),""!==i){const t=new a.a(i,Object.assign({},function getFont(e){if(e.length>1&&e.length<=3&&"F"===e[0]){const t=e.split("F");if(Object(s.isNumber)(t[1]))return l}switch(e.length){case 1:return u;case 2:return d;case 3:return e.includes("\n")?l:d;default:return d}}(i),{width:(e-.003)*h.a}));t.position.y+=.0052,t.rotation.x=.5*-Math.PI,this.add(t)}this.renderOrder=10,this.castShadow=!0,this.receiveShadow=!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestKeyboardInputScene});var i=n(30),s=n(68),o=n(18);class TestKeyboardInputScene extends o.a{constructor(){super(!1);const e=new s.a;Object(i.a)().addListener(e.onKeyCodeEvent),this.scene.add(e),e.scale.multiplyScalar(10)}update(e){super.update(e)}render(e,t){super.render(e,t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsPNGScene});var i=n(3),s=n(67),o=n(6),a=n(16);class TestPhysicsPNGScene extends a.a{constructor(e="test",t=20,n){super(!1,t);new s.a(Object(o.e)("level")||e,i.j.bind(this,this.b2World),n)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),s=n(25),o=n(42);const a=new class BulletModelFactory{constructor(){this.status="not started"}init(e){if("not started"!==this.status)throw new Error("cannot initialize twice");{this.status="initializing";const t=new i.LoadingManager;new s.a(t).load("game/models/weapons.gltf",t=>{this.bulletScene=t.scene,this.gltf=t;for(let e=t.scene.children.length-1;e>=0;e--){const n=t.scene.children[e];n.scale.multiplyScalar(.2),this.bulletRoot=n,n.traverse(e=>{e instanceof i.SkinnedMesh&&(e.castShadow=!0,e.receiveShadow=!0)})}this.status="ready",e()},e=>{},e=>{})}}makeBullet(e,t){if("ready"===this.status){const n=Object(o.a)(this.gltf);let s;n.scene.traverse(e=>{e instanceof i.Mesh&&(s=e)});for(let t=n.scene.children.length-1;t>=0;t--){const i=n.scene.children[t];e.add(i)}if(s&&t)return s;throw new Error("could not find bulletMesh")}throw new Error("bulletFactory not ready")}}},,,function(e,t,n){"use strict";function getHorizontalBias(e){switch(e){case"left":return 0;case"center":return-.5;case"right":return-1;default:return 0}}function getVerticalBias(e){switch(e){case"top":return 1;case"center":return.5;case"bottom":default:return 0}}n.d(t,"a",function(){return getHorizontalBias}),n.d(t,"b",function(){return getVerticalBias})},function(e,t,n){"use strict";n.d(t,"a",function(){return loadJson}),n.d(t,"b",function(){return loadTexture});var i=n(0);const s=new i.LoadingManager;let o,a;async function loadJson(e){return new Promise((t,n)=>(function getFileLoader(){return o||(o=new i.FileLoader(s)),o})().load(e,e=>t(JSON.parse(e)),void 0,n))}const r=new Map;async function loadTexture(e,t){let n;return n=r.has(e)?new Promise((t,n)=>{r.get(e).push(t)}):new Promise((n,o)=>{r.set(e,[n]);(function getTextureLoader(){return a||(a=new i.TextureLoader(s)),a})().load(e,n=>{n.name=e,void 0!==t&&(n.flipY=t),r.get(e).forEach(e=>e(n)),r.delete(e)},void 0,o)})}},function(e,t,n){"use strict";n.d(t,"a",function(){return CharacterTouchScreenBrain}),n.d(t,"b",function(){return rigToTouchScreen});var i=n(1),s=n(9),o=n(23),a=n(36),r=n(31);class CharacterTouchScreenBrain extends r.a{constructor(e){super(void 0),this.desiredMovementVector=new i.Vec2,this.aim=new i.Vec2,this.leftSideSecondSuccessiveTap=!1,this.rightSideSecondSuccessiveTap=!1,this.buttonScaling=15*e._squareButtonDimensions,this.buildModeButton=e.makeSmallSquare(window.innerWidth-e._relativeWidthButtonSpacing,e._relativeHeightButtonSpacing,!0,!0),this.buildModeButton.userData=new a.a(e=>{if(this.avatarBody&&this.avatarBody.GetUserData()instanceof s.a){this.avatarBody.GetUserData().buildMode=e,e?(console.log("turned on buildMode"),this.buildModeButton.material.opacity=.75):(console.log("turned off buildMode"),this.buildModeButton.material.opacity=.3)}}),this.secondtestButton=e.makeSmallSquare(window.innerWidth-e._relativeWidthButtonSpacing-2*e._relativeWidthButtonSpacing,e._relativeHeightButtonSpacing,!0,!0),this.secondtestButton.userData=new a.a(e=>{e?(o.a.requestFullscreen(),this.secondtestButton.material.opacity=.75):(document.exitFullscreen(),this.secondtestButton.material.opacity=.3)});document.addEventListener("touchstart",t=>{if(t.preventDefault(),this.avatarBody&&this.avatarBody.GetUserData()instanceof s.a){const n=this.avatarBody.GetUserData(),s=t.changedTouches,o=window.innerWidth/2;for(const t of Array.from(s)){const s=new i.Vec2(t.clientX,t.clientY);if(t.clientX<o&&t.identifier<2)this.leftSideSecondSuccessiveTap?(this.requestRunning=!0,this.leftSideSecondSuccessiveTap=!1,setTimeout(()=>{this.requestRunning=!1},1e3*n.maxStamina)):(this.leftSideSecondSuccessiveTap=!0,setTimeout(()=>{this.leftSideSecondSuccessiveTap=!1},500)),this.debugMovementBaseCursor&&this.debugMovementTracerCursor&&this.debugMovementBasestCursor&&(e.removeUI(this.debugMovementBasestCursor),e.removeUI(this.debugMovementBaseCursor),e.removeUI(this.debugMovementTracerCursor)),this.debugMovementBasestCursor=e.makeBiggerCircle(s.x,s.y),this.debugMovementBaseCursor=e.makeBigCircle(s.x,s.y),this.debugMovementTracerCursor=e.makeMediumCircle(s.x,s.y),this.debugMovementBasePosition=s.Clone(),this.debugMovementTracerPosition=s.Clone(),this.debugMovementIdentifier=t.identifier,this.desiredMovementVector.Set(0,0);else if(t.clientX>o&&t.identifier<2){if(e.rayCastForButton(t.clientX,t.clientY))return;this.rightSideSecondSuccessiveTap?(this.requestMeleeAttack=!0,this.rightSideSecondSuccessiveTap=!1,setTimeout(()=>{this.requestMeleeAttack=!1},250)):(this.rightSideSecondSuccessiveTap=!0,setTimeout(()=>{this.rightSideSecondSuccessiveTap=!1},500)),this.debugAimBaseCursor&&this.debugAimTracerCursor&&this.debugAimBasestCursor&&(e.removeUI(this.debugAimBasestCursor),e.removeUI(this.debugAimBaseCursor),e.removeUI(this.debugAimTracerCursor)),this.debugAimBasestCursor=e.makeBiggerCircle(s.x,s.y),this.debugAimBaseCursor=e.makeBigCircle(s.x,s.y),this.debugAimTracerCursor=e.makeMediumCircle(s.x,s.y),this.debugAimBasePosition=s.Clone(),this.debugAimTracerPosition=s.Clone(),this.debugAimIdentifier=t.identifier}}}},{passive:!1}),document.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation();const n=t.changedTouches;for(const t of Array.from(n))t.identifier===this.debugMovementIdentifier&&this.debugMovementBaseCursor&&this.debugMovementTracerCursor&&this.debugMovementBasestCursor&&(e.removeUI(this.debugMovementBasestCursor),e.removeUI(this.debugMovementBaseCursor),e.removeUI(this.debugMovementTracerCursor),this.requestRunning&&(this.requestRunning=!1),this.debugMovementIdentifier=void 0),t.identifier===this.debugAimIdentifier&&(this.debugAimBaseCursor&&this.debugAimTracerCursor&&this.debugAimBasestCursor&&(e.removeUI(this.debugAimBasestCursor),e.removeUI(this.debugAimBaseCursor),e.removeUI(this.debugAimTracerCursor),this.debugAimIdentifier=void 0),this.requestRangedAttack=!1);this.desiredMovementVector.Set(0,0)},{passive:!1}),document.addEventListener("touchmove",t=>{t.preventDefault(),t.stopPropagation();const n=t.changedTouches;for(const t of Array.from(n)){const n=new i.Vec2(t.clientX,t.clientY);if(t.identifier===this.debugMovementIdentifier&&this.debugMovementBaseCursor&&this.debugMovementTracerCursor&&this.debugMovementBasestCursor&&(e.setPosition(this.debugMovementTracerCursor,n.x,n.y),this.debugMovementTracerPosition&&this.debugMovementTracerPosition.Set(n.x,n.y),this.debugMovementBasePosition&&this.debugMovementTracerPosition&&this.debugMovementBasestCursor)){const e=this.debugMovementTracerPosition.Clone().SelfSub(this.debugMovementBasePosition).SelfMul(.0125);e.y*=-1;const t=e.Clone().SelfNormalize(),n=e.Length(),i=t.Length();this.desiredMovementVector=n>i?t:e}if(t.identifier===this.debugAimIdentifier&&this.debugAimBaseCursor&&this.debugAimTracerCursor&&this.debugAimBasestCursor&&(e.setPosition(this.debugAimTracerCursor,n.x,n.y),this.debugAimTracerPosition&&this.debugAimTracerPosition.Set(n.x,n.y),this.debugAimBasePosition&&this.debugAimTracerPosition)){const e=this.debugAimTracerPosition.Clone().SelfSub(this.debugAimBasePosition).SelfMul(.0125);e.y*=-1;const t=e.Clone().SelfNormalize();e.Length()>t.Length()?(this.aim=t,this.avatarBody&&this.avatarBody.GetUserData()instanceof s.a&&(this.avatarBody.GetUserData().buildMode?console.log("cannot shoot while in buildMode"):this.requestRangedAttack=!0)):this.requestRangedAttack=!1}}},{passive:!1}),document.addEventListener("touchcancel",e=>{e.preventDefault()},{passive:!1})}}let c;function rigToTouchScreen(e){let t=!1;window.addEventListener("touchstart",n=>{t||(t=!0,console.log("TouchScreen connected."),e(function getTouchScreenInput(e=!0){return c||(c=new TouchEvent("touchstart")),c}()))})}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),s=n(25),o=n(120),a=n(42);const r=new class PlayerModelFactory{constructor(){this.status="not started"}init(e){if("not started"!==this.status)throw new Error("cannot initialize twice");{this.status="initializing";const t=new i.LoadingManager;new s.a(t).load("game/models/Smooth_Female_Dress_editeded.gltf",t=>{this.playerScene=t.scene,this.gltf=t,this.playerAnimations=t.animations;for(let e=t.scene.children.length-1;e>=0;e--){const n=t.scene.children[e];n.scale.multiplyScalar(.08),this.playerRoot=n,n.traverse(e=>{e instanceof i.SkinnedMesh&&(e.castShadow=!0,e.receiveShadow=!0)})}this.status="ready",e()},e=>{},e=>{})}}makePlayer(e,t){if("ready"===this.status){const n=Object(a.a)(this.gltf);let s,r;n.scene.traverse(e=>{e instanceof i.SkinnedMesh&&(s=e,r=new i.AnimationMixer(e))});for(let t=n.scene.children.length-1;t>=0;t--){const i=n.scene.children[t];e.add(i)}if(s&&r&&t)return new o.a(s,r,t,this.playerAnimations);throw new Error("could not find playerMesh")}throw new Error("playerFactory not ready")}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),s=n(25),o=n(121);const a=new class WallModelFactory{constructor(){this._status="not started",this._queuedBodies=new Map,this._bodyMeshMap=new Map}makeWall(e,t){if("ready"===this._status){const n=this._actuallyMakeWall(e);this._bodyMeshMap.set(e,n),t(n)}else this._queuedBodies.set(e,t),"not started"===this._status&&this._init()}unmakeWall(e){if(this._queuedBodies.has(e)&&this._queuedBodies.delete(e),this._bodyMeshMap.has(e)){const t=this._bodyMeshMap.get(e);return this._bodyMeshMap.delete(e),t}}_init(){if("not started"!==this._status)throw new Error("cannot initialize twice");{this._status="initializing";const e=new i.LoadingManager;new s.a(e).load("game/models/brick-wall.gltf",e=>{this._gltf=e;for(const t of e.scene.children)t.scale.multiplyScalar(.2),t.traverse(e=>{e instanceof i.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)});this._status="ready",this._queuedBodies.forEach((e,t)=>{e(this._actuallyMakeWall(t))})},e=>{},e=>{})}}_actuallyMakeWall(e){const t=Object(o.a)(this._gltf,"brick-wall"),n=e.GetPosition();return t.position.set(n.x,0,-n.y),this._bodyMeshMap.set(e,t),t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return makeWobblyCircleShapePath});var i=n(0);function makeWobblyCircleShapePath(e=.02,t=.03,n=20,s=3,o=0){const a=[],r=t-e;for(let t=0;t<n;t++){const c=t/n,h=2*Math.PI*(c+o),u=e+(.5*Math.sin(h*s)+.5)*r,l=new i.Vector2(Math.cos(h)*u,Math.sin(h)*u);a.push(l)}return a}},,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return RafTweener});var i=n(92);class RafTweener extends i.a{constructor(e=0,t=!0){super(),this.discreteStepDuration=e,this.speed=1,this.requestStop=!1,this.paused=!1,this.ticking=!1,this.timeSnapshot=0,this.update=e>0?this.discreteStepTick:this.tick,this.rafTick=this._rafTick.bind(this),t&&this.start()}discreteStepTick(e){e*=this.speed;const t=this._now+e;for(;this._now<t;)this.tick(this.discreteStepDuration)}start(){this.timeSnapshot=performance.now(),this.discreteStepDuration>0&&(this.timeSnapshot-=this.timeSnapshot%this.discreteStepDuration),this._now=this.timeSnapshot,this.ticking||(this.ticking=!0,window.requestAnimationFrame(this.rafTick))}stop(){this.ticking&&!this.requestStop&&(this.requestStop=!0,this.ticking=!1)}pause(){this.paused=!0}unpause(){this.paused=!1}_rafTick(){if(this.requestStop)return void(this.requestStop=!1);const e=performance.now();let t=(e-this.timeSnapshot)*this.speed;if(this.paused)t=0;else{const e=this._now;this.update(t),t-=this._now-e}this.timeSnapshot=e-t,this.ticking&&window.requestAnimationFrame(this.rafTick)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return RawTweener});var i=n(93),s=n(2);const o={delay:0,duration:1e3,easing:n(94).a.Linear};class AnimatedProperty{constructor(e,t,n){this.key=e,this.valueStart=t,this.valueEnd=n}}class AnimatedObject{constructor(e,t,n,i,s,o,a,r){this.tweener=e,this.target=t,this.easing=n,this.startTime=i,this.endTime=s,this.animatedProperties=o,this.onUpdate=a,this.duration=s-i,this.finished=new Promise(e=>{this.onComplete=()=>{r&&r(),e()}})}kill(){this.tweener.kill(this)}}class RawTweener{constructor(){this._now=0,this._processingTick=!1,this._animations=[],this._animationsToComplete=[]}to(e){if(this.killTweensOf(e.target),Object(i.a)(e,o),"function"!=typeof e.easing)throw new Error("ease must be an easing function that takes in a number (0..1) and returns a number (0..1)");const t=e.target,n=e.propertyGoals,s=Object.keys(n).map(e=>{const i=t[e],s=n[e];if(isNaN(i)||isNaN(s))throw new Error("values must be numbers");return new AnimatedProperty(e,i,s)}),a=this._now+e.delay,r=a+e.duration,c=new AnimatedObject(this,t,e.easing,a,r,s,e.onUpdate,e.onComplete);return this._animations.push(c),c}tick(e){this._now+=e;const t=this._now,n=this._animations;this._processingTick=!0;for(const e of n)if(t>e.startTime){const n=e.target,i=Math.min((t-e.startTime)/e.duration,1);if(i<1){const t=e.easing(i);for(const i of e.animatedProperties)n[i.key]=Object(s.h)(i.valueStart,i.valueEnd,t);e.onUpdate&&e.onUpdate()}else this._animationsToComplete.push(e)}if(this._processingTick=!1,this._animationsToComplete.length>0){this._animationsToComplete.sort((e,t)=>e.endTime-t.endTime);for(const e of this._animationsToComplete)this.kill(e);this._animationsToComplete.length=0}}killTweensOf(e){if(this._processingTick)throw new Error("Not allowed during processing of tick");const t=this._animations;for(let n=t.length-1;n>=0;n--){const i=t[n];i.target===e&&this.kill(i,n)}}kill(e,t=-1){if(this._processingTick)throw new Error("Not allowed during processing of tick");if(-1===t&&(t=this._animations.indexOf(e)),-1!==t){for(const t of e.animatedProperties)e.target[t.key]=t.valueEnd;e.onUpdate&&e.onUpdate(),e.onComplete&&e.onComplete(),this._animations.splice(t,1)}}}},function(e,t,n){"use strict";function copyDefaults(e,t){for(const n of Object.keys(t))e.hasOwnProperty(n)||(e[n]=t[n])}n.d(t,"a",function(){return copyDefaults})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i={Linear:e=>e,Quadratic:{In:e=>e*e,Out:e=>e*(2-e),InOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Cubic:{In:e=>e*e*e,Out:e=>--e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Quartic:{In:e=>e*e*e*e,Out:e=>1- --e*e*e*e,InOut:e=>(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},Quintic:{In:e=>e*e*e*e*e,Out:e=>--e*e*e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},Sinusoidal:{In:e=>1-Math.cos(e*Math.PI/2),Out:e=>Math.sin(e*Math.PI/2),InOut:e=>.5*(1-Math.cos(Math.PI*e))},Exponential:{In:e=>0===e?0:Math.pow(1024,e-1),Out:e=>1===e?1:1-Math.pow(2,-10*e),InOut:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},Circular:{In:e=>1-Math.sqrt(1-e*e),Out:e=>Math.sqrt(1- --e*e),InOut:e=>(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},Elastic:{In(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)}},Back:{In(e){const t=1.70158;return e*e*((t+1)*e-t)},Out(e){const t=1.70158;return--e*e*((t+1)*e+t)+1},InOut(e){const t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:e=>1-i.Bounce.Out(1-e),Out:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,InOut:e=>e<.5?.5*i.Bounce.In(2*e):.5*i.Bounce.Out(2*e-1)+.5}}},function(e,t,n){"use strict";n.d(t,"a",function(){return GLTFTest});var i=n(0),s=(n(25),n(47)),o=n(18);class GLTFTest extends o.a{constructor(){super(),this.zombiePuppets=[],this.camera.position.set(0,6,6),this.camera.lookAt(new i.Vector3),s.a.init(()=>{for(let e=0;e<125;e++){const e=s.a.makeZombie(this.scene);e&&this.zombiePuppets.push(e)}})}update(e){super.update(e);for(const t of this.zombiePuppets)t.update(e);this.womanAnimationMixer&&this.womanAnimationMixer.update(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return ZombiePuppet});var i=n(10);class ZombiePuppet{constructor(e,t,n,i){this.mesh=e,this.anim=t,this.body=n,this.angle=0,this.lastAngle=0,this.zombieBody=n,this.zombieAnimations=i}update(e){if(this.zombieBody.GetUserData()instanceof i.a){const e=this.zombieBody.GetUserData();this.mesh.parent.position.set(e.brain.currentPosition.x,0,-e.brain.currentPosition.y),0===e.brain.desiredMovementVector.x&&0===e.brain.desiredMovementVector.y?(this.anim.clipAction(this.zombieAnimations[1]).stop(),this.anim.clipAction(this.zombieAnimations[0]).play()):(this.anim.clipAction(this.zombieAnimations[0]).stop(),this.anim.clipAction(this.zombieAnimations[1]).play(),this.angle=Math.atan2(-e.brain.desiredMovementVector.y,e.brain.desiredMovementVector.x))}this.mesh.parent.rotation.z=this.angle-.5*Math.PI,this.anim.update(e)}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return Box2DPreviewMaterial});var i=n(0),s=n(99),o=n.n(s),a=n(100),r=n.n(a);class Box2DPreviewMaterial extends i.RawShaderMaterial{constructor(){super({vertexShader:r(),fragmentShader:o(),transparent:!0,depthWrite:!1,depthTest:!1})}}},function(e,t){e.exports="precision lowp float;\n#define GLSLIFY 1\n\nvarying vec4 vColor;\n\nvoid main() {\n\tgl_FragColor = vColor;\n}\n"},function(e,t){e.exports="precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 color;\n\nvarying vec4 vColor;\n\nvoid main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n    vColor = color;\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return SingleEnvironmentBlockQueryCallBack});var i=n(1),s=n(3);class SingleEnvironmentBlockQueryCallBack extends i.QueryCallback{constructor(e){super(),e&&(this.clickedGameSpace=e)}reset(){this.environmentBlockBody=void 0}ReportFixture(e){const t=e.GetShape();if("environment"===Object(s.t)(e.m_filter.categoryBits)){if(t.TestPoint(e.GetBody().GetTransform(),this.clickedGameSpace))return this.environmentBlockBody=e.GetBody(),!1}return!0}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return NiceParameter});var i=n(5),s=n(104),o=n(6),a=n(2);const r=[];class NiceParameter{constructor(e,t,n,i,a,c,h,u,l=!1,d=.01,f=0){this.name=e,this.label=t,this.defaultValue=n,this.minValue=i,this.maxValue=a,this.step=d,this.distribution=c,this.valueTextConverter=h,this._availableToUserMethod=!0===u||!1===u?()=>u:u,this._listeners=[],l&&(this.value=this.defaultValue),this._value=Object(s.a)("nice-param-"+e,n,i,a);const p=Object(o.c)(e,this._value,i,a);p!==this._value&&(this.value=p),r.push(this),0===f&&(f=r.length),this.sliderOrderPriority=f}listen(e){this._listeners.push(e),e(this.value)}stopListening(e){Object(i.e)(this._listeners,e)}set value(e){e!==this._value&&(e=Object(a.b)(e,this.minValue,this.maxValue))!==this._value&&(this._value=e,localStorage.setItem("nice-param-"+this.name,String(e)),this._listeners.forEach(t=>t(e)))}get value(){return this._value}get availableToUser(){return this._availableToUserMethod()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return getLocalStorageFloat});n(56);var i=n(2);function getLocalStorageParam(e){return localStorage.getItem(e)}function __getLocalStorageNumber(e,t,n,s=-1/0,o=1/0){return Object(i.b)(n(getLocalStorageParam(e)||t.toString()),s,o)}function getLocalStorageFloat(e,t,n=-1/0,i=1/0){return __getLocalStorageNumber(e,t,parseFloat,n,i)}},function(e,t,n){"use strict";n.d(t,"a",function(){return addPrettyLights});var i=n(0),s=n(6);const o=new i.Color(5193519),a=new i.Color(11517935),r=new i.Vector3(8,2,6),c=new i.Vector3(0,.5,.4),h=new i.Vector3;function addPrettyLights(e,t){const n=new i.HemisphereLight(a,o);e.add(n);const u=new i.DirectionalLight(16777135,.75);e.add(u),u.name="sunlight",u.castShadow=!0,u.shadow.camera.near=.1,u.shadow.camera.far=10,u.shadow.camera.left=-5,u.shadow.camera.right=5,u.shadow.camera.top=-3,u.shadow.camera.bottom=3,u.shadow.camera.updateProjectionMatrix(),u.shadow.mapSize.width=u.shadow.mapSize.height=1024,u.shadow.bias=-.0025;u.position.set(5*Math.cos(.6),5*Math.sin(.6),0),u.lookAt(h),u.updateMatrix(),u.updateMatrixWorld(!0);const l=u.shadow.camera;l.updateMatrix(),l.updateMatrixWorld(!0),l.top=-1/0,l.bottom=1/0,l.left=1/0,l.right=-1/0,l.near=1/0,l.far=-1/0;const d=new i.Vector3;for(let e=0;e<8;e++)d.x=e%2-.5,d.y=-(~~(e/2)%2-.5),d.z=~~(e/4)%2-.5,d.multiply(r),d.sub(c),u.worldToLocal(d),l.top=Math.max(l.top,-d.y),l.bottom=Math.min(l.bottom,-d.y),l.left=Math.min(l.left,d.x),l.right=Math.max(l.right,d.x),l.near=Math.min(l.near,d.z+10),l.far=Math.max(l.far,d.z+10);if(l.updateProjectionMatrix(),Object(s.b)("debugLights")){const t=new i.DirectionalLightHelper(u),n=new i.CameraHelper(u.shadow.camera);e.add(t),e.add(n),t.update(),n.update()}return e.fog=new i.Fog(t.getHex(),0,30),{sunLight:u,ambientLight:n}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestCharacterControlScene});var i=n(44),s=n(13),o=n(3),a=n(16);class TestCharacterControlScene extends a.a{constructor(){super(!1,20,!1),s.b.value=!0;for(let e=0;e<10;e++)Object(o.i)(this.b2World,e-5,-.3,.5,.1);this._postUpdate=Object(i.a)(this.b2World,this.b2Preview)}update(e){super.update(e),this._postUpdate(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyboardInput});var i=n(5);class KeyboardInput{constructor(e=!1){this._preventDefault=e,this._listeners=[],this._keyStates=new Map,this.onKeyEvent=(e,t)=>{const n=e.code;this._preventDefault&&e.preventDefault(),this._keyStates.set(n,t);for(const e of this._listeners)e(n,t)},window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1))}addListener(e){this._listeners.push(e)}removeListener(e){Object(i.e)(this._listeners,e)}}},,function(e,t){e.exports="#ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision highp float;\n#define GLSLIFY 1\n\n#ifdef USE_ALPHATEST\nuniform float alphaTest;\n#endif\n\nuniform sampler2D msdf;\nuniform vec2 msdfSize;\n//uniform vec3 color;\nuniform float opacity;\n\n#ifdef USE_STROKE\nuniform float strokeWidth;\nuniform float strokeBias;\nuniform vec3 strokeColor;\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n\n#ifdef USE_SHADOW\nconst vec2 shadowVector = vec2(-0.00025, 0.0005);\nconst float shadowSoftness = 0.5;\nconst float shadowShrink = 0.2;\nconst float shadowOpacity = 0.5;\n#endif\n\nconst float contrastMultiplier = 80.0;\n\nvoid main() {\n  vec3 color = vColor;\n\n  vec3 sample = texture2D(msdf, vUv + vec2(0.0, -0.5/512.0)).rgb;\n  float unsignedDistance = median(sample.r, sample.g, sample.b);\n\n  float signedDistance = unsignedDistance - (1.0 - 0.5 * vWeight);\n\n  if ( unsignedDistance == 0.0 ) discard;\n  float contrast = contrastMultiplier;\n  \n  //float contrast = (abs(dFdx(vUv.x)) + abs(dFdy(vUv.y))) * contrastMultiplier;\n\n  #ifdef USE_STROKE\n    float distanceOpacity = signedDistance + (strokeWidth * strokeBias);\n    float sigDistSrokeInner = signedDistance - (strokeWidth * (1.0 - strokeBias));\n    float colorMix = 1.0 - smoothstep(0.0, 1.0, sigDistSrokeInner / contrast + 0.5);\n    vec3 finalColor = mix(color, strokeColor, colorMix);\n  #else\n    float distanceOpacity = signedDistance;\n    vec3 finalColor = color;\n  #endif\n  \n  float alpha = smoothstep(0.0, 1.0, distanceOpacity / contrast + 0.5);\n  \n  #ifdef USE_SHADOW\n    //compute shadows\n    //shadow color is the same as stroke color for now\n    sample = texture2D(msdf, vUv + shadowVector).rgb;\n    unsignedDistance = median(sample.r, sample.g, sample.b);\n    float shadow = clamp(((unsignedDistance - shadowShrink) / shadowSoftness + shadowShrink), 0.0, 1.0) * shadowOpacity;\n    alpha = max(alpha, shadow);\n  #else \n    #ifdef USE_ALPHATEST\n      if ( alpha < alphaTest ) discard;\n    #endif\n  #endif\n  gl_FragColor = vec4(finalColor, alpha * opacity);\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return s});const i={align:"center",vAlign:"center"},s={centered:i,left:Object.assign({},i,{align:"left"}),right:Object.assign({},i,{align:"right"}),title:Object.assign({},i,{width:300})}},function(e,t){e.exports="#define GLSLIFY 1\nattribute vec2 uv;\nattribute vec4 position;\nattribute vec3 color;\nattribute float weight;\n\n#ifdef USE_SCREENSPACE\nuniform vec2 offset;\nuniform float prescale;\nuniform vec4 clipSpacePosition;\nuniform vec2 pixelSizeInClipSpace;\n#else\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n#endif\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nvoid main() {\n  vUv = uv;\n  vColor = color;\n  vWeight = weight;\n\n  #ifdef USE_SCREENSPACE\n    vec2 finalOffset = (offset + position.xy) * pixelSizeInClipSpace * prescale;\n    #ifdef CONSTANT_SIZE_ON_SCREEN\n     finalOffset *= clipSpacePosition.w;\n    #endif\n    gl_Position = clipSpacePosition;\n    gl_Position.xy += finalOffset;\n  #else\n    gl_Position = projectionMatrix * modelViewMatrix * position;\n  #endif\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return CharacterGamePadBrain});var i=n(37),s=n(31);class CharacterGamePadBrain extends s.a{constructor(e){super();const t=this.aim,n=this.desiredMovementVector;e.listenToAxis(0,(e,t)=>{n.x=Object(i.a)(e)}),e.listenToAxis(1,(e,t)=>{n.y=Object(i.a)(-e)}),e.listenToAxis(2,(e,n)=>{t.x=Object(i.a)(e)}),e.listenToAxis(3,(e,n)=>{t.y=Object(i.a)(-e)}),e.listenToButton(7,e=>{this.requestRangedAttack=e>0}),e.listenToButton(5,e=>{this.requestMeleeAttack=e>0}),e.listenToButton(6,e=>{this.isRunning=0!==e})}}},function(e,t,n){"use strict";n.d(t,"a",function(){return CharacterMouseKeyboardBrain});var i=n(1),s=n(12),o=n(9),a=n(14),r=n(3),c=n(11),h=n(31);const u=Math.cos(.25*Math.PI);class VirtualAxis{constructor(){this.up=!1,this.down=!1,this.left=!1,this.right=!1}get x(){let e=0;return this.left&&(e-=1),this.right&&(e+=1),this.up!==this.down&&(e*=u),e}get y(){let e=0;return this.down&&(e-=1),this.up&&(e+=1),this.left!==this.right&&(e*=u),e}}class CharacterMouseKeyboardBrain extends h.a{constructor(e,t,n){super(void 0),this.rayCastConverter=t,this.desiredMovementVector=new VirtualAxis,this.aim=new i.Vec2,this.currentMousePosition=new i.Vec2,this.modeChangeInCooldown=!1,this.__buildRadius=1;const h=this.desiredMovementVector;e.addListener((e,t)=>{switch(e){case"KeyW":h.up=t;break;case"KeyS":h.down=t;break;case"KeyA":h.left=t;break;case"KeyD":h.right=t;break;case"Space":this.requestMeleeAttack=t;break;case"ShiftLeft":this.requestRunning=t;break;case"KeyB":if(this.avatarBody&&this.avatarBody.GetUserData()instanceof o.a){const e=this.avatarBody.GetUserData();if(e.buildMode||this.modeChangeInCooldown){if(e.buildMode&&!this.modeChangeInCooldown){if(e.buildMode=!1,this.modeChangeInCooldown=!0,c.a.add(()=>{this.modeChangeInCooldown=!1},3),this.ghostPlacementBlock){const e=this.ghostPlacementBlock.GetFixtureList();e&&(Object(a.b)(e),this.ghostPlacementBlock=void 0)}this.buildRadiusFixture&&(this.avatarBody.DestroyFixture(this.buildRadiusFixture),this.buildRadiusFixture=void 0)}}else e.buildMode=!0,this.modeChangeInCooldown=!0,c.a.add(()=>{this.modeChangeInCooldown=!1},3),this.currentMousePosition&&(this.ghostPlacementBlock=Object(r.e)(e.brain.avatarBody.GetWorld(),Object(r.p)(this.currentMousePosition))),this.buildRadiusFixture||(this.buildRadiusFixture=Object(r.f)(this.avatarBody,this.__buildRadius,["hero"],["environment"]))}}});document.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation();const t=n.rayCastForButton(e.clientX,e.clientY),i=this.rayCastConverter(e.clientX,e.clientY);if(this.avatarBody&&this.avatarBody.GetUserData()instanceof o.a){const n=this.avatarBody.GetUserData(),o=this.currentPosition,c=i.Clone().SelfSub(o).Length();if(0!==e.button||t){if(2===e.button&&n.buildMode)if(c>this.__buildRadius);else{const e=Object(r.r)(this.avatarBody.GetWorld(),i);e&&Object(a.b)(e.GetFixtureList())}}else if(n.buildMode)if(c>this.__buildRadius);else{const e=Object(r.r)(this.avatarBody.GetWorld(),i);if(e){const t=e.GetFixtureList();console.log(t.IsSensor()),console.log("cant build there, occupyingBlock exists")}else Object(s.a)("build",i),Object(r.d)(this.avatarBody.GetWorld(),i)}else this.requestRangedAttack=!0}},!1),document.addEventListener("mouseup",e=>{this.requestRangedAttack=!1},!1),document.addEventListener("mousemove",e=>{if(this.avatarBody){const t=this.currentPosition,n=this.rayCastConverter(e.clientX,e.clientY),i=n.Clone().SelfSub(t).Length(),s=n.Clone().SelfSub(t).SelfNormalize();if(this.aim=s,this.currentMousePosition=n,this.avatarBody&&this.avatarBody.GetUserData()instanceof o.a){const e=this.avatarBody.GetUserData();if(e.buildMode)if(this.ghostPlacementBlock)if(i>this.__buildRadius){const e=this.ghostPlacementBlock.GetFixtureList();e&&(Object(a.b)(e),this.ghostPlacementBlock=void 0)}else this.ghostPlacementBlock.SetPosition(Object(r.p)(n));else this.currentMousePosition&&i<this.__buildRadius&&(this.ghostPlacementBlock=Object(r.e)(e.brain.avatarBody.GetWorld(),Object(r.p)(this.currentMousePosition)))}}},!1)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestCharacterControlOnTextScene});var i=n(44),s=n(13),o=n(3),a=n(16),r=n(62);class TestCharacterControlOnTextScene extends a.a{constructor(){super(!1,20,!1),s.b.value=!0;for(let e=0;e<10;e++)Object(o.i)(this.b2World,e-5,-.3,.5,.1);this._postUpdate=Object(i.a)(this.b2World,this.b2Preview),Object(r.b)(this.scene,this.b2World)}update(e){super.update(e),this._postUpdate(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return BaseContactListener});var i=n(1),s=n(12),o=n(3),a=n(5),r=n(11),c=n(9),h=n(10),u=n(39),l=n(14),d=n(64),f=n(53),p=n(15),m=n(27),y=n(20),g=n(32);class BaseContactListener extends i.ContactListener{BeginContact(e){const t=e.GetFixtureA(),n=e.GetFixtureB(),i=o.t,s=i(t.m_filter.categoryBits),a=i(n.m_filter.categoryBits);"enemyWeapon"===s&&"stink"===a?zombieDetectsStink(t,n):"enemyWeapon"===a&&"stink"===s&&zombieDetectsStink(n,t),"heroWeapon"===s&&"environment"===a?Object(l.b)(t):"heroWeapon"===a&&"environment"===s&&Object(l.b)(n),"hero"===s&&"enemy"===a&&n.IsSensor()?Object(u.b)(n.GetBody(),t.GetBody()):"hero"===a&&"enemy"===s&&t.IsSensor()&&Object(u.b)(t.GetBody(),n.GetBody()),"heroWeapon"===s&&"enemy"===a?heroWeaponHitEnemy(t,n):"heroWeapon"===a&&"enemy"===s&&heroWeaponHitEnemy(n,t),"hero"===s&&"enemyWeapon"===a&&n.IsSensor()?withinAttackRange(t,n):"hero"===a&&"enemyWeapon"===s&&t.IsSensor()&&withinAttackRange(n,t),"environment"===s&&"noiseMaker"===a?Object(f.b)(n):"environment"===a&&"noiseMaker"===s&&Object(f.b)(t),"enemy"===s&&"sound"===a&&n.IsSensor()?enemyDetectsSoundSensor(t,n):"enemy"===a&&"sound"===s&&t.IsSensor()&&enemyDetectsSoundSensor(n,t),"hero"===s&&"item"===a?heroCollectsItem(t,n):"hero"===a&&"item"===s&&heroCollectsItem(n,t)}EndContact(e){const t=e.GetFixtureA(),n=e.GetFixtureB(),i=o.t,s=i(t.m_filter.categoryBits),a=i(n.m_filter.categoryBits);"enemyWeapon"===s&&"stink"===a?zombieForgetsStink(t,n):"enemyWeapon"===a&&"stink"===s&&zombieForgetsStink(n,t),"hero"===s&&"enemyWeapon"===a?leaveEnemyAttackRange(t,n):"hero"===a&&"enemyWeapon"===s&&leaveEnemyAttackRange(n,t),"hero"===s&&"enemy"===a&&n.IsSensor()?Object(u.c)(n.GetBody(),t.GetBody()):"hero"===a&&"enemy"===s&&t.IsSensor()&&Object(u.c)(t.GetBody(),n.GetBody())}}function withinAttackRange(e,t){const n=t.GetBody(),i=n.GetUserData(),o=e.GetBody().GetUserData();o.zombieTouchCounter+=1,function queueAttack(){const e=r.a.add(()=>{Object(s.a)("zombieAttack",n.GetPosition()),o.currentHealth-=i.damage,o.isHealthChanged=!0,o.currentHealth<1&&(o.currentHealth=0,o.isDead=!0),queueAttack()},1);i.attackTask=e}()}function leaveEnemyAttackRange(e,t){const n=t.GetBody().GetUserData();e.GetBody().GetUserData().zombieTouchCounter-=1,n.attackTask&&r.a.cancel(n.attackTask)}function heroWeaponHitEnemy(e,t){const n=t.GetBody(),i=n.GetUserData();Object(l.b)(e);const o=e.GetBody().GetUserData();if(i instanceof h.a){if(o instanceof y.a?(Object(s.a)("zombieHitWithMelee",n.GetPosition()),i.health-=o.meleeDamage,i.brain.knockedOutDuration=o.meleeKnockOutTime):o instanceof y.b&&(Object(s.a)("zombieHitWithRanged",n.GetPosition()),i.health-=o.rangedDamage,i.brain.knockedOutDuration=o.rangedKnockOutTime),i.health<1&&(i.isDead=!0),i.isDead)Object(s.a)("zombieDeath",n.GetPosition()),Object(l.b)(t);else if(i.brain&&!i.isDead)if(o instanceof y.a){const t=e.GetBody().GetPosition(),i=n.GetPosition().Clone().SelfSub(t);i.SelfNormalize(),i.SelfMul(o.meleeKnockback),n.ApplyLinearImpulseToCenter(i)}else if(o instanceof y.b){const t=e.GetBody().GetPosition(),i=n.GetPosition().Clone().SelfSub(t);i.SelfNormalize(),i.SelfMul(o.rangedKnockback),n.ApplyLinearImpulseToCenter(i)}}else i instanceof m.b&&(o instanceof y.a?i.health-=o.meleeDamage:o instanceof y.b&&(i.health-=o.rangedDamage),i.health<1&&(Object(s.a)("zombieSpawnerDeath",n.GetPosition()),i.isDead=!0),i.isDead&&(i.intervalSpawning&&clearInterval(i.intervalSpawning),Object(l.b)(t)))}function heroCollectsItem(e,t){const n=e.GetBody().GetUserData(),i=t.GetBody(),o=i.GetUserData();if(Object(s.a)("itemPickup",i.GetPosition()),Object(l.b)(t),n instanceof c.a)for(const e of o)"ammo"===e[0]?n.ammo+=e[1]:"medkit"===e[0]?n.currentHealth=n.currentHealth+e[1]>n.maxHealth?n.maxHealth:n.currentHealth+e[1]:"bar of soap"===e[0]&&(n.stinkLevel=0,n.cleanlinessDuration+=e[1]),console.log(`itemName: ${e[0]} -- quantity: ${e[1]}`)}function enemyDetectsSoundSensor(e,t){if(e.GetBody().GetUserData()instanceof h.a){const n=e.GetBody().GetUserData();let o,a,c;n.brain.positionOfInterest||Object(s.a)("zombieVoiceNoticing",e.GetBody().GetPosition()),n.brain.positionOfInterest=t.GetBody().GetPosition().Clone();let h=0;!function pursueSound(){const e=r.a.add(()=>{h++;const e=new i.Vec2(n.brain.currentPosition.x,n.brain.currentPosition.y),t=parseFloat(e.x.toFixed(2)),s=parseFloat(e.y.toFixed(2));c=new i.Vec2(t,s),o||1!==h?a||2!==h?o&&a&&h>2&&(o.x===a.x&&o.y===a.y&&a.x===c.x&&a.y===c.y&&h>5&&(n.brain.positionOfInterest=void 0),n.brain.positionOfInterest&&(o=a,a=c,pursueSound())):(a=c.Clone(),pursueSound()):(o=c.Clone(),pursueSound())},1);n.investigateSoundTask=e}()}}function zombieDetectsStink(e,t){if(e.GetBody().GetUserData()instanceof h.a&&t.GetBody().GetUserData()instanceof p.a){const n=e.GetBody().GetUserData(),i=t.GetBody().GetUserData(),s=e.GetBody().GetWorld(),o=e.GetBody().GetPosition(),a=t.GetBody().GetPosition(),r=t.GetBody();let c;const h=new g.c;s.RayCast(h,o,a);const u=h.hitStinkBodies,l=h.inaccessibleStinkBodies;for(const e of l)n.stinkierButInaccessibleArray.push(e);n.stinkierButInaccessibleArray.length>0&&Object(d.b)(n.brain.avatarBody);for(const e of u)e===r&&(c=e);if(c)if(n.currentDetectedStinkStrength){const e=i.stinkPower;n.currentDetectedStinkStrength<e&&(n.currentDetectedStinkStrength=e,n.currentDetectedStinkLocation=t.GetBody().GetPosition(),n.brain.positionOfInterest=n.currentDetectedStinkLocation)}else n.currentDetectedStinkStrength=i.stinkPower,n.currentDetectedStinkLocation=t.GetBody().GetPosition(),n.brain.positionOfInterest=n.currentDetectedStinkLocation}}function zombieForgetsStink(e,t){if(e.GetBody().GetUserData()instanceof h.a&&t.GetBody().GetUserData()instanceof p.a){const n=e.GetBody().GetUserData(),i=t.GetBody().GetUserData();n.stinkierButInaccessibleArray.includes(i.stinkBody)&&Object(a.e)(n.stinkierButInaccessibleArray,i.stinkBody)}}BaseContactListener.k_maxContactPoints=2048},function(e,t,n){"use strict";n.d(t,"a",function(){return getMetaContactListener});var i=n(117);let s;function getMetaContactListener(){return s||(s=new i.a),s}},function(e,t,n){"use strict";n.d(t,"a",function(){return MetaContactListener});var i=n(1);class MetaContactListener extends i.ContactListener{constructor(){super(...arguments),this.registry=[]}register(e){this.registry.push(e)}BeginContact(e){for(const t of this.registry)t.BeginContact(e)}EndContact(e){for(const t of this.registry)t.EndContact(e)}BeginContactFixtureParticle(e,t){for(const n of this.registry)n.BeginContactFixtureParticle(e,t)}EndContactFixtureParticle(e,t){for(const n of this.registry)n.EndContactFixtureParticle(e,t)}BeginContactParticleParticle(e,t){for(const n of this.registry)n.BeginContactParticleParticle(e,t)}EndContactParticleParticle(e,t){for(const n of this.registry)n.EndContactParticleParticle(e,t)}PreSolve(e,t){for(const n of this.registry)n.PreSolve(e,t)}PostSolve(e,t){for(const n of this.registry)n.PostSolve(e,t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphics3D});var i=n(1),s=n(0),o=n(4),a=n(119),r=n(8),c=n(2),h=n(63),u=n(18);class TestGraphics3D extends u.a{constructor(){super(!1),this.camera.position.set(0,4,3),this.camera.lookAt(new s.Vector3);const e=new s.Plane(new s.Vector3(0,1,0),.5*-r.c);this.deadtropolis=new h.a((t,n)=>{const s=new i.Vec2(t,n),a=Object(c.f)(t/o.a.width*2-1,-(n/o.a.height*2-1),e,this.camera);return a&&(s.x=a.x,s.y=-a.z),s}),this.graphicsPack=new a.a(this.scene,this.camera)}update(e){this.deadtropolis.update(e),this.graphicsPack.update(e),super.update(e)}render(e,t){super.render(e,t),this.deadtropolis.ui.render(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsPack});var i=n(0),s=n(72),o=n(78),a=n(79),r=n(47),c=n(9),h=n(10),u=n(7),l=n(15),d=n(27),f=n(3),p=n(20),m=n(46),y=n(8),g=n(5),b=n(38),w=n(26);const v=new i.Vector3(0,3,2);class TestGraphicsPack{constructor(e,t){this._camera=t,this.bodyMeshMap=new Map,this._bodiesWaitingForMeshes=[],this.playerPuppets=[],this.zombiePuppets=[],Object(u.a)().startListeningForCreate(t=>{if(t.GetUserData()instanceof f.b)this._bodiesWaitingForMeshes.push(t),a.a.makeWall(t,function onReady(t){e.add(t)});else if(t.GetUserData()instanceof h.a)this.tryAddZombie(e,t);else if(t.GetUserData()instanceof c.a)this.tryAddPlayer(e,t);else if(t.GetUserData()instanceof p.b)this.tryAddBullet(e,t);else if(t.GetUserData()instanceof p.a);else if(t.GetUserData()instanceof m.a);else{let n=this.getSphereGeometry(),s=this.getMaterial();t.GetUserData()instanceof d.b?s=this.getSpawnerMaterial():t.GetUserData()instanceof l.a?s=this.getStinkMaterial():t.GetUserData()instanceof f.a&&(n=Object(w.a)(y.c,y.c,y.c,.1*y.c),s=this.getGhostBlockMaterial());const o=new i.Mesh(n,s);o.receiveShadow=!0,o.castShadow=!s.transparent,e.add(o),o.position.y=.5*y.c,this.bodyMeshMap.set(t,o)}}),Object(u.a)().startListeningForDestroy(t=>{if(t.GetUserData()instanceof h.a)for(const n of this.zombiePuppets)t===n.body&&(e.remove(n.mesh.parent),Object(g.e)(this.zombiePuppets,n));else if(t.GetUserData()instanceof f.b){const n=a.a.unmakeWall(t);n&&e.remove(n)}else{const n=this.bodyMeshMap.get(t);e.remove(n)}this.bodyMeshMap.delete(t)})}update(e){this.bodyMeshMap.forEach((e,t)=>{e.position.x=t.GetPosition().x,e.position.z=-t.GetPosition().y});for(const t of this.zombiePuppets)t.update(e);for(const t of this.playerPuppets)t.update(e);if(this.playerBody){const e=this.bodyMeshMap.get(this.playerBody).position;this._camera.position.copy(e),this._camera.position.add(v),this._camera.lookAt(e)}}tryAddPlayer(e,t){try{o.a.init(()=>{this.addPlayer(e,t)})}catch(n){try{this.addPlayer(e,t)}catch(e){console.log(e)}}}addPlayer(e,t){const n=o.a.makePlayer(e,t);n&&(this.playerPuppets.push(n),this.bodyMeshMap.set(n.playerBody,n.mesh),this.playerBody=n.playerBody)}tryAddZombie(e,t){try{r.a.init(()=>{this.addZombie(e,t)})}catch(n){try{this.addZombie(e,t)}catch(e){console.log(e)}}}addZombie(e,t){const n=r.a.makeZombie(e,t);n&&(this.zombiePuppets.push(n),this.bodyMeshMap.set(n.zombieBody,n.mesh))}tryAddBullet(e,t){try{s.a.init(()=>{const n=s.a.makeBullet(e,t);n&&this.addBullet(n,t)})}catch(n){try{const n=s.a.makeBullet(e,t);n&&this.addBullet(n,t)}catch(e){console.log(e)}}}addBullet(e,t){const n=this.playerBody.GetUserData();e.rotation.z=3*Math.PI/2,e.rotation.y=n.brain.aimAngle,e.position.y=y.c,this.bodyMeshMap.set(t,e)}getMaterial(e=!1){return this._material||(this._material=new i.MeshStandardMaterial({color:b.b,roughness:.9})),e?this._material.clone():this._material}getGhostBlockMaterial(e=!1){return this._ghostBlockMaterial||(this._ghostBlockMaterial=new i.MeshStandardMaterial({color:b.b,roughness:.9,transparent:!0,opacity:.4})),e?this._ghostBlockMaterial.clone():this._ghostBlockMaterial}getStinkMaterial(e=!1){return this._stinkMaterial||(this._stinkMaterial=new i.MeshBasicMaterial({color:new i.Color(0,1,0),transparent:!0,opacity:.2})),e?this._stinkMaterial.clone():this._stinkMaterial}getSpawnerMaterial(e=!1){return this._spawnerMaterial||(this._spawnerMaterial=new i.MeshBasicMaterial({color:new i.Color(.7,0,0)})),e?this._spawnerMaterial.clone():this._spawnerMaterial}getSphereGeometry(){return this._geometry||(this._geometry=new i.SphereBufferGeometry(.5*y.c,32,16)),this._geometry}}},function(e,t,n){"use strict";n.d(t,"a",function(){return PlayerPuppet});var i=n(9),s=n(11);class PlayerPuppet{constructor(e,t,n,i){this.mesh=e,this.anim=t,this.body=n,this.angle=0,this.lastAngle=0,this.playerBody=n,this.playerAnimations=i}update(e){if(this.playerBody.GetUserData()instanceof i.a){const e=this.playerBody.GetUserData();this.mesh.parent.position.set(e.brain.currentPosition.x,0,-e.brain.currentPosition.y),e.isDead?(this.anim.clipAction(this.playerAnimations[2]).stop(),this.anim.clipAction(this.playerAnimations[4]).stop(),this.anim.clipAction(this.playerAnimations[6]).stop(),this.anim.clipAction(this.playerAnimations[11]).stop(),this.anim.clipAction(this.playerAnimations[1]).repetitions=1,this.anim.clipAction(this.playerAnimations[1]).play(),s.a.add(()=>{this.anim.clipAction(this.playerAnimations[1]).paused=!0},1.8)):(0!==e.brain.desiredMovementVector.x||0!==e.brain.desiredMovementVector.y||this.isAttackAnimationInProgress?this.isAttackAnimationInProgress||(this.anim.clipAction(this.playerAnimations[11]).play(),this.anim.clipAction(this.playerAnimations[2]).stop(),this.angle=Math.atan2(-e.brain.desiredMovementVector.y,e.brain.desiredMovementVector.x)):(this.anim.clipAction(this.playerAnimations[6]).stop(),this.anim.clipAction(this.playerAnimations[11]).stop(),this.anim.clipAction(this.playerAnimations[2]).play()),0===e.brain.desiredMovementVector.x&&0===e.brain.desiredMovementVector.y||!e.brain.isRunning||this.isAttackAnimationInProgress?this.anim.clipAction(this.playerAnimations[6]).stop():(this.anim.clipAction(this.playerAnimations[2]).stop(),this.anim.clipAction(this.playerAnimations[11]).stop(),this.anim.clipAction(this.playerAnimations[6]).play()),e.brain.requestMeleeAttack&&(this.anim.clipAction(this.playerAnimations[2]).stop(),this.anim.clipAction(this.playerAnimations[11]).stop(),this.anim.clipAction(this.playerAnimations[6]).stop(),this.anim.clipAction(this.playerAnimations[4]).play(),this.isAttackAnimationInProgress||(this.isAttackAnimationInProgress=!0,s.a.add(()=>{this.anim.clipAction(this.playerAnimations[4]).stop(),this.anim.clipAction(this.playerAnimations[2]).play(),this.isAttackAnimationInProgress=!1},1))))}this.mesh.parent.rotation.y=-this.angle+.5*Math.PI,this.anim.update(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return cloneMeshByName});var i=n(0);function cloneMeshByName(e,t,n=!1){let s;if(e.scene.traverse(e=>{e instanceof i.Mesh&&e.name===t&&(s=e)}),s)return s.clone(n);throw new Error(`Mesh named "${t}" not found in GLTF`)}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsCharacterScene});var i=n(0),s=n(65),o=n(6),a=n(2),r=n(66);class TestGraphicsCharacterScene extends r.a{constructor(){super("test-layout"),this.characters=[];const e=new s.a;this.b2World.SetContactListener(e);for(let e=0;e<Object(o.d)("characters",1,1,4);e++);}update(e){const t=this.characters.length?this.getCharactersPosition():this.keyboardMesh.position;super.update(e);for(const t of this.characters)t.update(e);const n=this.camera.position,i=t.clone();i.x+=.28,i.y+=1.05,i.z+=.35*7,i.y=Math.max(0,i.y),this.camera.position.x=Object(a.h)(n.x,i.x,.1),this.camera.position.y=Object(a.h)(n.y,i.y,.01),this.camera.position.z=i.z;const s=this.camera.quaternion.clone(),o=t.clone();o.x+=.04,this.camera.lookAt(o),this.camera.quaternion.slerp(s,.99),this.sunLight.position.x=this.camera.position.x+.2,this.sunLight.target.position.x=this.camera.position.x,this.sunLight.target.updateMatrixWorld(!0),this.sunLight.updateMatrixWorld(!0)}getCharactersPosition(){const e=new i.Vector3;for(const t of this.characters)e.add(t.visuals.position);return e.multiplyScalar(1/this.characters.length),e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyButtonHoleMesh});var i=n(0),s=n(21),o=n(26);class KeyButtonHoleMesh extends i.Mesh{constructor(e,t,n,i=.005){super(Object(o.a)(e+.001,t,n+.001,2*i),s.a.keyboardPlasticHole),this.renderOrder=-1,this.receiveShadow=!0}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return TestKeyboardCharacterScene});var i=n(13),s=n(29),o=n(70),a=n(16);class TestKeyboardCharacterScene extends s.a{constructor(){super();const e=new o.a,t=new a.a;this.scenes=[e,t],this.scenes[1].autoClear=!1,i.b.value=!0}update(e){for(const t of this.scenes)t.update(e)}render(e,t){for(const n of this.scenes)n.render(e,t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsCharacterScene});var i=n(4),s=n(65),o=n(71);class TestPhysicsCharacterScene extends o.a{constructor(){super("test-run",0,()=>{console.log("level ready")});const e=new s.a;this.b2World.SetContactListener(e)}update(e){const t=this.character,n=t.avatarBody.GetPosition();this.b2Preview.offset.Set(n.x/i.a.aspect,n.y),super.update(e),t.postPhysicsUpdate(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestConcaveBodiesScene});var i=n(1),s=n(0),o=n(80),a=n(13),r=n(3),c=n(16);class TestConcaveBodiesScene extends c.a{constructor(){super(!1,20,!1),this.postUpdates=[],a.b.value=!0;for(let e=0;e<10;e++)Object(r.i)(this.b2World,e-5,-.3,.5,.1);const e=Object(o.a)(.1,.25,40,6);Object(r.n)(this.b2World,e,i.BodyType.b2_staticBody,new s.Vector2(-.5,0),r.l);const t=Object(o.a)(.2,.125,12,3,.25),n=new s.Vector2(-1,0);Object(r.n)(this.b2World,t,i.BodyType.b2_staticBody,n,r.m)}update(e){this.firstCharacter&&this.b2Preview.offset.Copy(this.firstCharacter.avatarBody.GetPosition()),super.update(e);for(const t of this.postUpdates)t(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestStencilsScene});var i=n(129),s=n(18);class TestStencilsScene extends s.a{constructor(){super();const e=new i.a(.013,.012);e.rotation.y+=-.15*Math.PI,e.position.set(0,.15,.3),this.scene.add(e),this.characterMesh=e}update(e){super.update(e),this.characterMesh.rotation.z+=.5*e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return CharacterMesh});var i=n(0),s=n(130),o=n(21),a=n(69);let r=13;class CharacterMesh extends a.a{constructor(e,t,n=""){super(e,t,e,n,.01);const a=new i.SphereBufferGeometry(.045,16,8),c=a.attributes.position.array;for(let e=1;e<c.length;e+=3)c[e]<0&&(c[e]=0);const h=new i.Mesh(a,o.a.keyboardPlasticKeyUnderside);h.receiveShadow=!0,h.renderOrder=r,r+=2,h.position.y=.5*-t-1e-4,h.rotation.y=2*Math.PI/32,this.add(h),Object(s.a)(h),this.castShadow=!0,this.receiveShadow=!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return makeScoopMesh});var i=n(0),s=n(21);function makeScoopMesh(e){const t=new i.Mesh(e.geometry,s.a.scoopMask);t.renderOrder=e.renderOrder-1,e.add(t),t.onBeforeRender=(e,t,n,i,s,o)=>{!function maskPreRender(e,t){t.setTest(!0),t.setClear(1),t.setMask(255),t.setOp(e.KEEP,e.KEEP,e.REPLACE),t.setFunc(e.ALWAYS,2,255)}(e.context,e.state.buffers.stencil)},t.onAfterRender=(e,t,n,i,s,o)=>{e.context,e.state.buffers.stencil},e.onBeforeRender=(e,t,n,i,s,o)=>{!function meshPreRender(e,t){t.setFunc(e.EQUAL,2,255),t.setMask(0)}(e.context,e.state.buffers.stencil)},e.onAfterRender=(e,t,n,i,s,o)=>{!function meshPostRender(e,t){t.setTest(!1)}(e.context,e.state.buffers.stencil)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestTextScene});var i=n(17),s=n(19),o=n(43),a=n(6),r=n(29);class TestTextScene extends r.a{constructor(){super();const e=new o.a(this.camera);Object(a.b)("fpsCam")&&e.toggle(!0);const t=new i.a("Hello World!");t.scale.multiplyScalar(10),this.scene.add(t);const n=new i.a("ANY KEY",s.a.title);n.scale.multiplyScalar(10),this.scene.add(n);const r=new i.a("Q W E R T Y",s.a.keyLabel);r.scale.multiplyScalar(10),r.position.y=-.4,this.scene.add(r);const c=new i.a("    ",s.a.keyLabel);c.scale.multiplyScalar(10),c.position.y=-.5,this.scene.add(c);(async()=>{})()}update(e){super.update(e)}render(e,t){super.render(e,t)}}},function(e,t,n){"use strict";n.r(t);var i=n(0),s=n(52),o=n(95),a=n(106),r=n(114),c=n(63),h=n(118),u=n(122),l=n(66),d=n(125),f=n(70),p=n(18),m=n(16),y=n(126),g=n(127),b=n(71),w=n(128),v=n(131),S=n(62),k=n(23),_=n(33),B=n(49),x=n(6),C=n(61),M=n(11),P=n(58);document.addEventListener("gesturestart",e=>e.preventDefault());const O=new i.Clock;k.b.setClearColor(new i.Color(3425622),1),B.a.camera.position.set(0,.5,.5),B.a.camera.lookAt(new i.Vector3);const D={characterControl:a.a,characterControlOnText:r.a,graphicsLevel:l.a,graphicsCharacter:u.a,keyboard:f.a,keyboardCharacter:d.a,lighting:p.a,physics:m.a,textPhysics:S.a,physicsConcave:g.a,physicsCharacter:y.a,physicsPNG:b.a,stencils:w.a,text:v.a,b2Preview:c.a,GLTFTest:o.a,graphics3D:h.a};let T=p.a;const A=Object(x.e)("test")||"graphics3D",G=Object(x.d)("fps",60,1,240);D.hasOwnProperty(A)&&(T=D[A]);const j=new T;let I=0,F=0;const L=1/G;requestAnimationFrame(function loop(){requestAnimationFrame(loop);const e=Math.min(O.getDelta(),.1)*s.a.speed;(I+=e)-F>L?(F+=L,Object(C.a)(),s.a.rafTick(),P.a.update(L),M.a.update(L),_.c.value+=L,j.update(L),j.render(k.b,L)):0})},,,,,,,function(e,t){},,function(e,t){}]);