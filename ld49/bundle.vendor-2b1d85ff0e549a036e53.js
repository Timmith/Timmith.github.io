(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(t,e,i){"use strict";i.r(e),i.d(e,"ACESFilmicToneMapping",function(){return nt}),i.d(e,"AddEquation",function(){return V}),i.d(e,"AddOperation",function(){return Q}),i.d(e,"AdditiveAnimationBlendMode",function(){return qe}),i.d(e,"AdditiveBlending",function(){return S}),i.d(e,"AlphaFormat",function(){return Ft}),i.d(e,"AlwaysDepth",function(){return W}),i.d(e,"AlwaysStencilFunc",function(){return Mi}),i.d(e,"AmbientLight",function(){return AmbientLight}),i.d(e,"AmbientLightProbe",function(){return AmbientLightProbe}),i.d(e,"AnimationClip",function(){return AnimationClip}),i.d(e,"AnimationLoader",function(){return AnimationLoader}),i.d(e,"AnimationMixer",function(){return AnimationMixer}),i.d(e,"AnimationObjectGroup",function(){return AnimationObjectGroup}),i.d(e,"AnimationUtils",function(){return go}),i.d(e,"ArcCurve",function(){return ArcCurve}),i.d(e,"ArrayCamera",function(){return ArrayCamera}),i.d(e,"ArrowHelper",function(){return ArrowHelper}),i.d(e,"Audio",function(){return Audio}),i.d(e,"AudioAnalyser",function(){return AudioAnalyser}),i.d(e,"AudioContext",function(){return Eo}),i.d(e,"AudioListener",function(){return AudioListener}),i.d(e,"AudioLoader",function(){return AudioLoader}),i.d(e,"AxesHelper",function(){return AxesHelper}),i.d(e,"AxisHelper",function(){return AxisHelper}),i.d(e,"BackSide",function(){return f}),i.d(e,"BasicDepthPacking",function(){return si}),i.d(e,"BasicShadowMap",function(){return h}),i.d(e,"BinaryTextureLoader",function(){return BinaryTextureLoader}),i.d(e,"Bone",function(){return Bone}),i.d(e,"BooleanKeyframeTrack",function(){return BooleanKeyframeTrack}),i.d(e,"BoundingBoxHelper",function(){return BoundingBoxHelper}),i.d(e,"Box2",function(){return Box2}),i.d(e,"Box3",function(){return Box3}),i.d(e,"Box3Helper",function(){return Box3Helper}),i.d(e,"BoxBufferGeometry",function(){return BoxGeometry}),i.d(e,"BoxGeometry",function(){return BoxGeometry}),i.d(e,"BoxHelper",function(){return BoxHelper}),i.d(e,"BufferAttribute",function(){return BufferAttribute}),i.d(e,"BufferGeometry",function(){return BufferGeometry}),i.d(e,"BufferGeometryLoader",function(){return BufferGeometryLoader}),i.d(e,"ByteType",function(){return Vt}),i.d(e,"Cache",function(){return bo}),i.d(e,"Camera",function(){return Camera}),i.d(e,"CameraHelper",function(){return CameraHelper}),i.d(e,"CanvasRenderer",function(){return CanvasRenderer}),i.d(e,"CanvasTexture",function(){return CanvasTexture}),i.d(e,"CatmullRomCurve3",function(){return CatmullRomCurve3}),i.d(e,"CineonToneMapping",function(){return it}),i.d(e,"CircleBufferGeometry",function(){return CircleGeometry}),i.d(e,"CircleGeometry",function(){return CircleGeometry}),i.d(e,"ClampToEdgeWrapping",function(){return mt}),i.d(e,"Clock",function(){return Clock}),i.d(e,"Color",function(){return Color}),i.d(e,"ColorKeyframeTrack",function(){return ColorKeyframeTrack}),i.d(e,"CompressedTexture",function(){return CompressedTexture}),i.d(e,"CompressedTextureLoader",function(){return CompressedTextureLoader}),i.d(e,"ConeBufferGeometry",function(){return ConeGeometry}),i.d(e,"ConeGeometry",function(){return ConeGeometry}),i.d(e,"CubeCamera",function(){return CubeCamera}),i.d(e,"CubeReflectionMapping",function(){return ot}),i.d(e,"CubeRefractionMapping",function(){return at}),i.d(e,"CubeTexture",function(){return CubeTexture}),i.d(e,"CubeTextureLoader",function(){return CubeTextureLoader}),i.d(e,"CubeUVReflectionMapping",function(){return ht}),i.d(e,"CubeUVRefractionMapping",function(){return ut}),i.d(e,"CubicBezierCurve",function(){return CubicBezierCurve}),i.d(e,"CubicBezierCurve3",function(){return CubicBezierCurve3}),i.d(e,"CubicInterpolant",function(){return CubicInterpolant}),i.d(e,"CullFaceBack",function(){return a}),i.d(e,"CullFaceFront",function(){return l}),i.d(e,"CullFaceFrontBack",function(){return c}),i.d(e,"CullFaceNone",function(){return o}),i.d(e,"Curve",function(){return Curve}),i.d(e,"CurvePath",function(){return CurvePath}),i.d(e,"CustomBlending",function(){return A}),i.d(e,"CustomToneMapping",function(){return rt}),i.d(e,"CylinderBufferGeometry",function(){return CylinderGeometry}),i.d(e,"CylinderGeometry",function(){return CylinderGeometry}),i.d(e,"Cylindrical",function(){return Cylindrical}),i.d(e,"DataTexture",function(){return DataTexture}),i.d(e,"DataTexture2DArray",function(){return DataTexture2DArray}),i.d(e,"DataTexture3D",function(){return DataTexture3D}),i.d(e,"DataTextureLoader",function(){return DataTextureLoader}),i.d(e,"DataUtils",function(){return DataUtils}),i.d(e,"DecrementStencilOp",function(){return mi}),i.d(e,"DecrementWrapStencilOp",function(){return fi}),i.d(e,"DefaultLoadingManager",function(){return yo}),i.d(e,"DepthFormat",function(){return Wt}),i.d(e,"DepthStencilFormat",function(){return Ht}),i.d(e,"DepthTexture",function(){return DepthTexture}),i.d(e,"DirectionalLight",function(){return DirectionalLight}),i.d(e,"DirectionalLightHelper",function(){return DirectionalLightHelper}),i.d(e,"DiscreteInterpolant",function(){return DiscreteInterpolant}),i.d(e,"DodecahedronBufferGeometry",function(){return DodecahedronGeometry}),i.d(e,"DodecahedronGeometry",function(){return DodecahedronGeometry}),i.d(e,"DoubleSide",function(){return _}),i.d(e,"DstAlphaFactor",function(){return F}),i.d(e,"DstColorFactor",function(){return O}),i.d(e,"DynamicBufferAttribute",function(){return DynamicBufferAttribute}),i.d(e,"DynamicCopyUsage",function(){return Li}),i.d(e,"DynamicDrawUsage",function(){return Vi}),i.d(e,"DynamicReadUsage",function(){return Bi}),i.d(e,"EdgesGeometry",function(){return EdgesGeometry}),i.d(e,"EdgesHelper",function(){return EdgesHelper}),i.d(e,"EllipseCurve",function(){return EllipseCurve}),i.d(e,"EqualDepth",function(){return J}),i.d(e,"EqualStencilFunc",function(){return yi}),i.d(e,"EquirectangularReflectionMapping",function(){return lt}),i.d(e,"EquirectangularRefractionMapping",function(){return ct}),i.d(e,"Euler",function(){return Euler}),i.d(e,"EventDispatcher",function(){return EventDispatcher}),i.d(e,"ExtrudeBufferGeometry",function(){return ExtrudeGeometry}),i.d(e,"ExtrudeGeometry",function(){return ExtrudeGeometry}),i.d(e,"FaceColors",function(){return xa}),i.d(e,"FileLoader",function(){return FileLoader}),i.d(e,"FlatShading",function(){return g}),i.d(e,"Float16BufferAttribute",function(){return Float16BufferAttribute}),i.d(e,"Float32Attribute",function(){return Float32Attribute}),i.d(e,"Float32BufferAttribute",function(){return Float32BufferAttribute}),i.d(e,"Float64Attribute",function(){return Float64Attribute}),i.d(e,"Float64BufferAttribute",function(){return Float64BufferAttribute}),i.d(e,"FloatType",function(){return Et}),i.d(e,"Fog",function(){return Fog}),i.d(e,"FogExp2",function(){return FogExp2}),i.d(e,"Font",function(){return Font}),i.d(e,"FontLoader",function(){return FontLoader}),i.d(e,"FrontSide",function(){return p}),i.d(e,"Frustum",function(){return Frustum}),i.d(e,"GLBufferAttribute",function(){return GLBufferAttribute}),i.d(e,"GLSL1",function(){return Ii}),i.d(e,"GLSL3",function(){return Di}),i.d(e,"GammaEncoding",function(){return $e}),i.d(e,"GreaterDepth",function(){return X}),i.d(e,"GreaterEqualDepth",function(){return q}),i.d(e,"GreaterEqualStencilFunc",function(){return wi}),i.d(e,"GreaterStencilFunc",function(){return vi}),i.d(e,"GridHelper",function(){return GridHelper}),i.d(e,"Group",function(){return Group}),i.d(e,"HalfFloatType",function(){return Lt}),i.d(e,"HemisphereLight",function(){return HemisphereLight}),i.d(e,"HemisphereLightHelper",function(){return HemisphereLightHelper}),i.d(e,"HemisphereLightProbe",function(){return HemisphereLightProbe}),i.d(e,"IcosahedronBufferGeometry",function(){return IcosahedronGeometry}),i.d(e,"IcosahedronGeometry",function(){return IcosahedronGeometry}),i.d(e,"ImageBitmapLoader",function(){return ImageBitmapLoader}),i.d(e,"ImageLoader",function(){return ImageLoader}),i.d(e,"ImageUtils",function(){return ImageUtils}),i.d(e,"ImmediateRenderObject",function(){return ImmediateRenderObject}),i.d(e,"IncrementStencilOp",function(){return di}),i.d(e,"IncrementWrapStencilOp",function(){return pi}),i.d(e,"InstancedBufferAttribute",function(){return InstancedBufferAttribute}),i.d(e,"InstancedBufferGeometry",function(){return InstancedBufferGeometry}),i.d(e,"InstancedInterleavedBuffer",function(){return InstancedInterleavedBuffer}),i.d(e,"InstancedMesh",function(){return InstancedMesh}),i.d(e,"Int16Attribute",function(){return Int16Attribute}),i.d(e,"Int16BufferAttribute",function(){return Int16BufferAttribute}),i.d(e,"Int32Attribute",function(){return Int32Attribute}),i.d(e,"Int32BufferAttribute",function(){return Int32BufferAttribute}),i.d(e,"Int8Attribute",function(){return Int8Attribute}),i.d(e,"Int8BufferAttribute",function(){return Int8BufferAttribute}),i.d(e,"IntType",function(){return Bt}),i.d(e,"InterleavedBuffer",function(){return InterleavedBuffer}),i.d(e,"InterleavedBufferAttribute",function(){return InterleavedBufferAttribute}),i.d(e,"Interpolant",function(){return Interpolant}),i.d(e,"InterpolateDiscrete",function(){return Ne}),i.d(e,"InterpolateLinear",function(){return Ue}),i.d(e,"InterpolateSmooth",function(){return ze}),i.d(e,"InvertStencilOp",function(){return _i}),i.d(e,"JSONLoader",function(){return JSONLoader}),i.d(e,"KeepStencilOp",function(){return hi}),i.d(e,"KeyframeTrack",function(){return KeyframeTrack}),i.d(e,"LOD",function(){return LOD}),i.d(e,"LatheBufferGeometry",function(){return LatheGeometry}),i.d(e,"LatheGeometry",function(){return LatheGeometry}),i.d(e,"Layers",function(){return Layers}),i.d(e,"LensFlare",function(){return LensFlare}),i.d(e,"LessDepth",function(){return H}),i.d(e,"LessEqualDepth",function(){return j}),i.d(e,"LessEqualStencilFunc",function(){return xi}),i.d(e,"LessStencilFunc",function(){return bi}),i.d(e,"Light",function(){return Light}),i.d(e,"LightProbe",function(){return LightProbe}),i.d(e,"Line",function(){return Line}),i.d(e,"Line3",function(){return Line3}),i.d(e,"LineBasicMaterial",function(){return LineBasicMaterial}),i.d(e,"LineCurve",function(){return LineCurve}),i.d(e,"LineCurve3",function(){return LineCurve3}),i.d(e,"LineDashedMaterial",function(){return LineDashedMaterial}),i.d(e,"LineLoop",function(){return LineLoop}),i.d(e,"LinePieces",function(){return ba}),i.d(e,"LineSegments",function(){return LineSegments}),i.d(e,"LineStrip",function(){return ga}),i.d(e,"LinearEncoding",function(){return Ke}),i.d(e,"LinearFilter",function(){return xt}),i.d(e,"LinearInterpolant",function(){return LinearInterpolant}),i.d(e,"LinearMipMapLinearFilter",function(){return Mt}),i.d(e,"LinearMipMapNearestFilter",function(){return St}),i.d(e,"LinearMipmapLinearFilter",function(){return wt}),i.d(e,"LinearMipmapNearestFilter",function(){return vt}),i.d(e,"LinearToneMapping",function(){return tt}),i.d(e,"Loader",function(){return Loader}),i.d(e,"LoaderUtils",function(){return LoaderUtils}),i.d(e,"LoadingManager",function(){return LoadingManager}),i.d(e,"LogLuvEncoding",function(){return ei}),i.d(e,"LoopOnce",function(){return Fe}),i.d(e,"LoopPingPong",function(){return Oe}),i.d(e,"LoopRepeat",function(){return ke}),i.d(e,"LuminanceAlphaFormat",function(){return Ut}),i.d(e,"LuminanceFormat",function(){return Nt}),i.d(e,"MOUSE",function(){return r}),i.d(e,"Material",function(){return Material}),i.d(e,"MaterialLoader",function(){return MaterialLoader}),i.d(e,"Math",function(){return Ui}),i.d(e,"MathUtils",function(){return Ui}),i.d(e,"Matrix3",function(){return Matrix3}),i.d(e,"Matrix4",function(){return Matrix4}),i.d(e,"MaxEquation",function(){return P}),i.d(e,"Mesh",function(){return Mesh}),i.d(e,"MeshBasicMaterial",function(){return MeshBasicMaterial}),i.d(e,"MeshDepthMaterial",function(){return MeshDepthMaterial}),i.d(e,"MeshDistanceMaterial",function(){return MeshDistanceMaterial}),i.d(e,"MeshFaceMaterial",function(){return MeshFaceMaterial}),i.d(e,"MeshLambertMaterial",function(){return MeshLambertMaterial}),i.d(e,"MeshMatcapMaterial",function(){return MeshMatcapMaterial}),i.d(e,"MeshNormalMaterial",function(){return MeshNormalMaterial}),i.d(e,"MeshPhongMaterial",function(){return MeshPhongMaterial}),i.d(e,"MeshPhysicalMaterial",function(){return MeshPhysicalMaterial}),i.d(e,"MeshStandardMaterial",function(){return MeshStandardMaterial}),i.d(e,"MeshToonMaterial",function(){return MeshToonMaterial}),i.d(e,"MinEquation",function(){return B}),i.d(e,"MirroredRepeatWrapping",function(){return pt}),i.d(e,"MixOperation",function(){return K}),i.d(e,"MultiMaterial",function(){return MultiMaterial}),i.d(e,"MultiplyBlending",function(){return M}),i.d(e,"MultiplyOperation",function(){return Z}),i.d(e,"NearestFilter",function(){return ft}),i.d(e,"NearestMipMapLinearFilter",function(){return yt}),i.d(e,"NearestMipMapNearestFilter",function(){return gt}),i.d(e,"NearestMipmapLinearFilter",function(){return bt}),i.d(e,"NearestMipmapNearestFilter",function(){return _t}),i.d(e,"NeverDepth",function(){return z}),i.d(e,"NeverStencilFunc",function(){return gi}),i.d(e,"NoBlending",function(){return y}),i.d(e,"NoColors",function(){return ya}),i.d(e,"NoToneMapping",function(){return $}),i.d(e,"NormalAnimationBlendMode",function(){return Je}),i.d(e,"NormalBlending",function(){return x}),i.d(e,"NotEqualDepth",function(){return Y}),i.d(e,"NotEqualStencilFunc",function(){return Si}),i.d(e,"NumberKeyframeTrack",function(){return NumberKeyframeTrack}),i.d(e,"Object3D",function(){return Object3D}),i.d(e,"ObjectLoader",function(){return ObjectLoader}),i.d(e,"ObjectSpaceNormalMap",function(){return li}),i.d(e,"OctahedronBufferGeometry",function(){return OctahedronGeometry}),i.d(e,"OctahedronGeometry",function(){return OctahedronGeometry}),i.d(e,"OneFactor",function(){return L}),i.d(e,"OneMinusDstAlphaFactor",function(){return k}),i.d(e,"OneMinusDstColorFactor",function(){return N}),i.d(e,"OneMinusSrcAlphaFactor",function(){return G}),i.d(e,"OneMinusSrcColorFactor",function(){return I}),i.d(e,"OrthographicCamera",function(){return OrthographicCamera}),i.d(e,"PCFShadowMap",function(){return u}),i.d(e,"PCFSoftShadowMap",function(){return d}),i.d(e,"PMREMGenerator",function(){return PMREMGenerator}),i.d(e,"ParametricGeometry",function(){return ParametricGeometry}),i.d(e,"Particle",function(){return Particle}),i.d(e,"ParticleBasicMaterial",function(){return ParticleBasicMaterial}),i.d(e,"ParticleSystem",function(){return ParticleSystem}),i.d(e,"ParticleSystemMaterial",function(){return ParticleSystemMaterial}),i.d(e,"Path",function(){return Path}),i.d(e,"PerspectiveCamera",function(){return PerspectiveCamera}),i.d(e,"Plane",function(){return Plane}),i.d(e,"PlaneBufferGeometry",function(){return PlaneGeometry}),i.d(e,"PlaneGeometry",function(){return PlaneGeometry}),i.d(e,"PlaneHelper",function(){return PlaneHelper}),i.d(e,"PointCloud",function(){return PointCloud}),i.d(e,"PointCloudMaterial",function(){return PointCloudMaterial}),i.d(e,"PointLight",function(){return PointLight}),i.d(e,"PointLightHelper",function(){return PointLightHelper}),i.d(e,"Points",function(){return Points}),i.d(e,"PointsMaterial",function(){return PointsMaterial}),i.d(e,"PolarGridHelper",function(){return PolarGridHelper}),i.d(e,"PolyhedronBufferGeometry",function(){return PolyhedronGeometry}),i.d(e,"PolyhedronGeometry",function(){return PolyhedronGeometry}),i.d(e,"PositionalAudio",function(){return PositionalAudio}),i.d(e,"PropertyBinding",function(){return PropertyBinding}),i.d(e,"PropertyMixer",function(){return PropertyMixer}),i.d(e,"QuadraticBezierCurve",function(){return QuadraticBezierCurve}),i.d(e,"QuadraticBezierCurve3",function(){return QuadraticBezierCurve3}),i.d(e,"Quaternion",function(){return Quaternion}),i.d(e,"QuaternionKeyframeTrack",function(){return QuaternionKeyframeTrack}),i.d(e,"QuaternionLinearInterpolant",function(){return QuaternionLinearInterpolant}),i.d(e,"REVISION",function(){return n}),i.d(e,"RGBADepthPacking",function(){return oi}),i.d(e,"RGBAFormat",function(){return Ot}),i.d(e,"RGBAIntegerFormat",function(){return Zt}),i.d(e,"RGBA_ASTC_10x10_Format",function(){return ye}),i.d(e,"RGBA_ASTC_10x5_Format",function(){return _e}),i.d(e,"RGBA_ASTC_10x6_Format",function(){return ge}),i.d(e,"RGBA_ASTC_10x8_Format",function(){return be}),i.d(e,"RGBA_ASTC_12x10_Format",function(){return xe}),i.d(e,"RGBA_ASTC_12x12_Format",function(){return ve}),i.d(e,"RGBA_ASTC_4x4_Format",function(){return le}),i.d(e,"RGBA_ASTC_5x4_Format",function(){return ce}),i.d(e,"RGBA_ASTC_5x5_Format",function(){return he}),i.d(e,"RGBA_ASTC_6x5_Format",function(){return ue}),i.d(e,"RGBA_ASTC_6x6_Format",function(){return de}),i.d(e,"RGBA_ASTC_8x5_Format",function(){return me}),i.d(e,"RGBA_ASTC_8x6_Format",function(){return pe}),i.d(e,"RGBA_ASTC_8x8_Format",function(){return fe}),i.d(e,"RGBA_BPTC_Format",function(){return Se}),i.d(e,"RGBA_ETC2_EAC_Format",function(){return ae}),i.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return re}),i.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return ne}),i.d(e,"RGBA_S3TC_DXT1_Format",function(){return Qt}),i.d(e,"RGBA_S3TC_DXT3_Format",function(){return $t}),i.d(e,"RGBA_S3TC_DXT5_Format",function(){return te}),i.d(e,"RGBDEncoding",function(){return ri}),i.d(e,"RGBEEncoding",function(){return ti}),i.d(e,"RGBEFormat",function(){return zt}),i.d(e,"RGBFormat",function(){return kt}),i.d(e,"RGBIntegerFormat",function(){return Yt}),i.d(e,"RGBM16Encoding",function(){return ni}),i.d(e,"RGBM7Encoding",function(){return ii}),i.d(e,"RGB_ETC1_Format",function(){return se}),i.d(e,"RGB_ETC2_Format",function(){return oe}),i.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return ie}),i.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return ee}),i.d(e,"RGB_S3TC_DXT1_Format",function(){return Kt}),i.d(e,"RGFormat",function(){return qt}),i.d(e,"RGIntegerFormat",function(){return Xt}),i.d(e,"RawShaderMaterial",function(){return RawShaderMaterial}),i.d(e,"Ray",function(){return Ray}),i.d(e,"Raycaster",function(){return Raycaster}),i.d(e,"RectAreaLight",function(){return RectAreaLight}),i.d(e,"RedFormat",function(){return jt}),i.d(e,"RedIntegerFormat",function(){return Jt}),i.d(e,"ReinhardToneMapping",function(){return et}),i.d(e,"RepeatWrapping",function(){return dt}),i.d(e,"ReplaceStencilOp",function(){return ui}),i.d(e,"ReverseSubtractEquation",function(){return T}),i.d(e,"RingBufferGeometry",function(){return RingGeometry}),i.d(e,"RingGeometry",function(){return RingGeometry}),i.d(e,"SRGB8_ALPHA8_ASTC_10x10_Format",function(){return Ie}),i.d(e,"SRGB8_ALPHA8_ASTC_10x5_Format",function(){return Ee}),i.d(e,"SRGB8_ALPHA8_ASTC_10x6_Format",function(){return Le}),i.d(e,"SRGB8_ALPHA8_ASTC_10x8_Format",function(){return Re}),i.d(e,"SRGB8_ALPHA8_ASTC_12x10_Format",function(){return De}),i.d(e,"SRGB8_ALPHA8_ASTC_12x12_Format",function(){return Ge}),i.d(e,"SRGB8_ALPHA8_ASTC_4x4_Format",function(){return we}),i.d(e,"SRGB8_ALPHA8_ASTC_5x4_Format",function(){return Me}),i.d(e,"SRGB8_ALPHA8_ASTC_5x5_Format",function(){return Ae}),i.d(e,"SRGB8_ALPHA8_ASTC_6x5_Format",function(){return Ve}),i.d(e,"SRGB8_ALPHA8_ASTC_6x6_Format",function(){return Ce}),i.d(e,"SRGB8_ALPHA8_ASTC_8x5_Format",function(){return Te}),i.d(e,"SRGB8_ALPHA8_ASTC_8x6_Format",function(){return Be}),i.d(e,"SRGB8_ALPHA8_ASTC_8x8_Format",function(){return Pe}),i.d(e,"Scene",function(){return Scene}),i.d(e,"SceneUtils",function(){return Sa}),i.d(e,"ShaderChunk",function(){return Gr}),i.d(e,"ShaderLib",function(){return kr}),i.d(e,"ShaderMaterial",function(){return ShaderMaterial}),i.d(e,"ShadowMaterial",function(){return ShadowMaterial}),i.d(e,"Shape",function(){return Shape}),i.d(e,"ShapeBufferGeometry",function(){return ShapeGeometry}),i.d(e,"ShapeGeometry",function(){return ShapeGeometry}),i.d(e,"ShapePath",function(){return ShapePath}),i.d(e,"ShapeUtils",function(){return ShapeUtils}),i.d(e,"ShortType",function(){return Ct}),i.d(e,"Skeleton",function(){return Skeleton}),i.d(e,"SkeletonHelper",function(){return SkeletonHelper}),i.d(e,"SkinnedMesh",function(){return SkinnedMesh}),i.d(e,"SmoothShading",function(){return b}),i.d(e,"Sphere",function(){return Sphere}),i.d(e,"SphereBufferGeometry",function(){return SphereGeometry}),i.d(e,"SphereGeometry",function(){return SphereGeometry}),i.d(e,"Spherical",function(){return Spherical}),i.d(e,"SphericalHarmonics3",function(){return SphericalHarmonics3}),i.d(e,"SplineCurve",function(){return SplineCurve}),i.d(e,"SpotLight",function(){return SpotLight}),i.d(e,"SpotLightHelper",function(){return SpotLightHelper}),i.d(e,"Sprite",function(){return Sprite}),i.d(e,"SpriteMaterial",function(){return SpriteMaterial}),i.d(e,"SrcAlphaFactor",function(){return D}),i.d(e,"SrcAlphaSaturateFactor",function(){return U}),i.d(e,"SrcColorFactor",function(){return R}),i.d(e,"StaticCopyUsage",function(){return Ei}),i.d(e,"StaticDrawUsage",function(){return Ai}),i.d(e,"StaticReadUsage",function(){return Ti}),i.d(e,"StereoCamera",function(){return StereoCamera}),i.d(e,"StreamCopyUsage",function(){return Ri}),i.d(e,"StreamDrawUsage",function(){return Ci}),i.d(e,"StreamReadUsage",function(){return Pi}),i.d(e,"StringKeyframeTrack",function(){return StringKeyframeTrack}),i.d(e,"SubtractEquation",function(){return C}),i.d(e,"SubtractiveBlending",function(){return w}),i.d(e,"TOUCH",function(){return s}),i.d(e,"TangentSpaceNormalMap",function(){return ai}),i.d(e,"TetrahedronBufferGeometry",function(){return TetrahedronGeometry}),i.d(e,"TetrahedronGeometry",function(){return TetrahedronGeometry}),i.d(e,"TextGeometry",function(){return TextGeometry}),i.d(e,"Texture",function(){return Texture}),i.d(e,"TextureLoader",function(){return TextureLoader}),i.d(e,"TorusBufferGeometry",function(){return TorusGeometry}),i.d(e,"TorusGeometry",function(){return TorusGeometry}),i.d(e,"TorusKnotBufferGeometry",function(){return TorusKnotGeometry}),i.d(e,"TorusKnotGeometry",function(){return TorusKnotGeometry}),i.d(e,"Triangle",function(){return Triangle}),i.d(e,"TriangleFanDrawMode",function(){return Ze}),i.d(e,"TriangleStripDrawMode",function(){return Ye}),i.d(e,"TrianglesDrawMode",function(){return Xe}),i.d(e,"TubeBufferGeometry",function(){return TubeGeometry}),i.d(e,"TubeGeometry",function(){return TubeGeometry}),i.d(e,"UVMapping",function(){return st}),i.d(e,"Uint16Attribute",function(){return Uint16Attribute}),i.d(e,"Uint16BufferAttribute",function(){return Uint16BufferAttribute}),i.d(e,"Uint32Attribute",function(){return Uint32Attribute}),i.d(e,"Uint32BufferAttribute",function(){return Uint32BufferAttribute}),i.d(e,"Uint8Attribute",function(){return Uint8Attribute}),i.d(e,"Uint8BufferAttribute",function(){return Uint8BufferAttribute}),i.d(e,"Uint8ClampedAttribute",function(){return Uint8ClampedAttribute}),i.d(e,"Uint8ClampedBufferAttribute",function(){return Uint8ClampedBufferAttribute}),i.d(e,"Uniform",function(){return Uniform}),i.d(e,"UniformsLib",function(){return Fr}),i.d(e,"UniformsUtils",function(){return Vr}),i.d(e,"UnsignedByteType",function(){return At}),i.d(e,"UnsignedInt248Type",function(){return Gt}),i.d(e,"UnsignedIntType",function(){return Pt}),i.d(e,"UnsignedShort4444Type",function(){return Rt}),i.d(e,"UnsignedShort5551Type",function(){return It}),i.d(e,"UnsignedShort565Type",function(){return Dt}),i.d(e,"UnsignedShortType",function(){return Tt}),i.d(e,"VSMShadowMap",function(){return m}),i.d(e,"Vector2",function(){return Vector2}),i.d(e,"Vector3",function(){return Vector3}),i.d(e,"Vector4",function(){return Vector4}),i.d(e,"VectorKeyframeTrack",function(){return VectorKeyframeTrack}),i.d(e,"Vertex",function(){return Vertex}),i.d(e,"VertexColors",function(){return va}),i.d(e,"VideoTexture",function(){return VideoTexture}),i.d(e,"WebGL1Renderer",function(){return WebGL1Renderer}),i.d(e,"WebGLCubeRenderTarget",function(){return WebGLCubeRenderTarget}),i.d(e,"WebGLMultipleRenderTargets",function(){return WebGLMultipleRenderTargets}),i.d(e,"WebGLMultisampleRenderTarget",function(){return WebGLMultisampleRenderTarget}),i.d(e,"WebGLRenderTarget",function(){return WebGLRenderTarget}),i.d(e,"WebGLRenderTargetCube",function(){return WebGLRenderTargetCube}),i.d(e,"WebGLRenderer",function(){return WebGLRenderer}),i.d(e,"WebGLUtils",function(){return WebGLUtils}),i.d(e,"WireframeGeometry",function(){return WireframeGeometry}),i.d(e,"WireframeHelper",function(){return WireframeHelper}),i.d(e,"WrapAroundEnding",function(){return je}),i.d(e,"XHRLoader",function(){return XHRLoader}),i.d(e,"ZeroCurvatureEnding",function(){return We}),i.d(e,"ZeroFactor",function(){return E}),i.d(e,"ZeroSlopeEnding",function(){return He}),i.d(e,"ZeroStencilOp",function(){return ci}),i.d(e,"sRGBEncoding",function(){return Qe});
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const n="133",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,h=0,u=1,d=2,m=3,p=0,f=1,_=2,g=1,b=2,y=0,x=1,S=2,w=3,M=4,A=5,V=100,C=101,T=102,B=103,P=104,E=200,L=201,R=202,I=203,D=204,G=205,F=206,k=207,O=208,N=209,U=210,z=0,W=1,H=2,j=3,J=4,q=5,X=6,Y=7,Z=0,K=1,Q=2,$=0,tt=1,et=2,it=3,nt=4,rt=5,st=300,ot=301,at=302,lt=303,ct=304,ht=306,ut=307,dt=1e3,mt=1001,pt=1002,ft=1003,_t=1004,gt=1004,bt=1005,yt=1005,xt=1006,vt=1007,St=1007,wt=1008,Mt=1008,At=1009,Vt=1010,Ct=1011,Tt=1012,Bt=1013,Pt=1014,Et=1015,Lt=1016,Rt=1017,It=1018,Dt=1019,Gt=1020,Ft=1021,kt=1022,Ot=1023,Nt=1024,Ut=1025,zt=Ot,Wt=1026,Ht=1027,jt=1028,Jt=1029,qt=1030,Xt=1031,Yt=1032,Zt=1033,Kt=33776,Qt=33777,$t=33778,te=33779,ee=35840,ie=35841,ne=35842,re=35843,se=36196,oe=37492,ae=37496,le=37808,ce=37809,he=37810,ue=37811,de=37812,me=37813,pe=37814,fe=37815,_e=37816,ge=37817,be=37818,ye=37819,xe=37820,ve=37821,Se=36492,we=37840,Me=37841,Ae=37842,Ve=37843,Ce=37844,Te=37845,Be=37846,Pe=37847,Ee=37848,Le=37849,Re=37850,Ie=37851,De=37852,Ge=37853,Fe=2200,ke=2201,Oe=2202,Ne=2300,Ue=2301,ze=2302,We=2400,He=2401,je=2402,Je=2500,qe=2501,Xe=0,Ye=1,Ze=2,Ke=3e3,Qe=3001,$e=3007,ti=3002,ei=3003,ii=3004,ni=3005,ri=3006,si=3200,oi=3201,ai=0,li=1,ci=0,hi=7680,ui=7681,di=7682,mi=7683,pi=34055,fi=34056,_i=5386,gi=512,bi=513,yi=514,xi=515,vi=516,Si=517,wi=518,Mi=519,Ai=35044,Vi=35048,Ci=35040,Ti=35045,Bi=35049,Pi=35041,Ei=35046,Li=35050,Ri=35042,Ii="100",Di="300 es";class EventDispatcher{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}let Gi=1234567;const Fi=Math.PI/180,ki=180/Math.PI,Oi=[];for(let t=0;t<256;t++)Oi[t]=(t<16?"0":"")+t.toString(16);const Ni="undefined"!=typeof crypto&&"randomUUID"in crypto;function generateUUID(){if(Ni)return crypto.randomUUID().toUpperCase();const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Oi[255&t]+Oi[t>>8&255]+Oi[t>>16&255]+Oi[t>>24&255]+"-"+Oi[255&e]+Oi[e>>8&255]+"-"+Oi[e>>16&15|64]+Oi[e>>24&255]+"-"+Oi[63&i|128]+Oi[i>>8&255]+"-"+Oi[i>>16&255]+Oi[i>>24&255]+Oi[255&n]+Oi[n>>8&255]+Oi[n>>16&255]+Oi[n>>24&255]).toUpperCase()}function clamp(t,e,i){return Math.max(e,Math.min(i,t))}function euclideanModulo(t,e){return(t%e+e)%e}function lerp(t,e,i){return(1-i)*t+i*e}function isPowerOfTwo(t){return 0==(t&t-1)&&0!==t}function ceilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function floorPowerOfTwo(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Ui=Object.freeze({__proto__:null,DEG2RAD:Fi,RAD2DEG:ki,generateUUID:generateUUID,clamp:clamp,euclideanModulo:euclideanModulo,mapLinear:function mapLinear(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function inverseLerp(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:lerp,damp:function damp(t,e,i,n){return lerp(t,e,1-Math.exp(-i*n))},pingpong:function pingpong(t,e=1){return e-Math.abs(euclideanModulo(t,2*e)-e)},smoothstep:function smoothstep(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function smootherstep(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function randInt(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function randFloat(t,e){return t+Math.random()*(e-t)},randFloatSpread:function randFloatSpread(t){return t*(.5-Math.random())},seededRandom:function seededRandom(t){return void 0!==t&&(Gi=t%2147483647),((Gi=16807*Gi%2147483647)-1)/2147483646},degToRad:function degToRad(t){return t*Fi},radToDeg:function radToDeg(t){return t*ki},isPowerOfTwo:isPowerOfTwo,ceilPowerOfTwo:ceilPowerOfTwo,floorPowerOfTwo:floorPowerOfTwo,setQuaternionFromProperEuler:function setQuaternionFromProperEuler(t,e,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((e+n)/2),h=o((e+n)/2),u=s((e-n)/2),d=o((e-n)/2),m=s((n-e)/2),p=o((n-e)/2);switch(r){case"XYX":t.set(a*h,l*u,l*d,a*c);break;case"YZY":t.set(l*d,a*h,l*u,a*c);break;case"ZXZ":t.set(l*u,l*d,a*h,a*c);break;case"XZX":t.set(a*h,l*p,l*m,a*c);break;case"YXY":t.set(l*m,a*h,l*p,a*c);break;case"ZYZ":t.set(l*p,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Vector2{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],m=i[8],p=n[0],f=n[3],_=n[6],g=n[1],b=n[4],y=n[7],x=n[2],v=n[5],S=n[8];return r[0]=s*p+o*g+a*x,r[3]=s*f+o*b+a*v,r[6]=s*_+o*y+a*S,r[1]=l*p+c*g+h*x,r[4]=l*f+c*b+h*v,r[7]=l*_+c*y+h*S,r[2]=u*p+d*g+m*x,r[5]=u*f+d*b+m*v,r[8]=u*_+d*y+m*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,m=e*h+i*u+n*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=h*p,t[1]=(n*l-c*i)*p,t[2]=(o*i-n*s)*p,t[3]=u*p,t[4]=(c*e-n*a)*p,t[5]=(n*r-o*e)*p,t[6]=d*p,t[7]=(i*a-l*e)*p,t[8]=(s*e-i*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-n*l,n*a,-n*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=e*r+i*a,n[3]=e*s+i*l,n[6]=e*o+i*c,n[1]=-i*r+e*a,n[4]=-i*s+e*l,n[7]=-i*o+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function arrayMax(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}Matrix3.prototype.isMatrix3=!0;const zi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function getTypedArray(t,e){return new zi[t](e)}function createElementNS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}let Wi;class ImageUtils{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Wi&&(Wi=createElementNS("canvas")),Wi.width=t.width,Wi.height=t.height;const i=Wi.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Wi}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let Hi=0;class Texture extends EventDispatcher{constructor(t=Texture.DEFAULT_IMAGE,e=Texture.DEFAULT_MAPPING,i=mt,n=mt,r=xt,s=wt,o=Ot,a=At,l=1,c=Ke){super(),Object.defineProperty(this,"id",{value:Hi++}),this.uuid=generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=generateUUID()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(serializeImage(n[t].image)):e.push(serializeImage(n[t]))}else e=serializeImage(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==st)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case dt:t.x=t.x-Math.floor(t.x);break;case mt:t.x=t.x<0?0:1;break;case pt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case dt:t.y=t.y-Math.floor(t.y);break;case mt:t.y=t.y<0?0:1;break;case pt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function serializeImage(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ImageUtils.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=st,Texture.prototype.isTexture=!0;class Vector4{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],m=s[6],p=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-m)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+m)<.1&&Math.abs(o+h+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(o+1)/2,s=(h+1)/2,f=(p+1)/2,_=(a+c)/4,g=(l+d)/4,b=(u+m)/4;return t>s&&t>f?t<.01?(i=0,n=.707106781,r=.707106781):(n=_/(i=Math.sqrt(t)),r=g/i):s>f?s<.01?(i=.707106781,n=0,r=.707106781):(i=_/(n=Math.sqrt(s)),r=b/n):f<.01?(i=.707106781,n=.707106781,r=0):(i=g/(r=Math.sqrt(f)),n=b/r),this.set(i,n,r,e),this}let f=Math.sqrt((m-u)*(m-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(f)<.001&&(f=1),this.x=(m-u)/f,this.y=(l-d)/f,this.z=(c-a)/f,this.w=Math.acos((o+h+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e),this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:xt,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(t,e,i){super(t,e);const n=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=n.clone()}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}WebGLMultipleRenderTargets.prototype.isWebGLMultipleRenderTargets=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(t,e,i){super(t,e,i),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],m=r[s+2],p=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(h!==p||a!==u||l!==d||c!==m){let t=1-o;const e=a*u+l*d+c*m+h*p,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*t+u*r,l=l*t+d*r,c=c*t+m*r,h=h*t+p*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],m=r[s+3];return t[e]=o*m+c*h+a*d-l*u,t[e+1]=a*m+c*u+l*h-o*d,t[e+2]=l*m+c*d+o*u-a*h,t[e+3]=c*m-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),m=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"YXZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"ZXY":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"ZYX":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"YZX":this._x=u*c*h+l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h-u*d*m;break;case"XZY":this._x=u*c*h-l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ji.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ji.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*n-o*i,c=a*i+o*e-r*n,h=a*n+r*i-s*e,u=-r*e-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ji.copy(this).projectOnVector(t),this.sub(ji)}reflect(t){return this.sub(ji.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Vector3.prototype.isVector3=!0;const ji=new Vector3,Ji=new Quaternion;class Box3{constructor(t=new Vector3(1/0,1/0,1/0),e=new Vector3(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],h=t[a+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),h=t.getZ(a);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,i,n),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Xi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Yi.copy(e.boundingBox),Yi.applyMatrix4(t.matrixWorld),this.union(Yi));const i=t.children;for(let t=0,e=i.length;t<e;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Xi),Xi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(nn),rn.subVectors(this.max,nn),Zi.subVectors(t.a,nn),Ki.subVectors(t.b,nn),Qi.subVectors(t.c,nn),$i.subVectors(Ki,Zi),tn.subVectors(Qi,Ki),en.subVectors(Zi,Qi);let e=[0,-$i.z,$i.y,0,-tn.z,tn.y,0,-en.z,en.y,$i.z,0,-$i.x,tn.z,0,-tn.x,en.z,0,-en.x,-$i.y,$i.x,0,-tn.y,tn.x,0,-en.y,en.x,0];return!!satForAxes(e,Zi,Ki,Qi,rn)&&(!!satForAxes(e=[1,0,0,0,1,0,0,0,1],Zi,Ki,Qi,rn)&&(sn.crossVectors($i,tn),satForAxes(e=[sn.x,sn.y,sn.z],Zi,Ki,Qi,rn)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Xi.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Xi).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(qi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),qi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),qi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),qi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),qi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),qi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),qi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),qi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(qi),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Box3.prototype.isBox3=!0;const qi=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],Xi=new Vector3,Yi=new Box3,Zi=new Vector3,Ki=new Vector3,Qi=new Vector3,$i=new Vector3,tn=new Vector3,en=new Vector3,nn=new Vector3,rn=new Vector3,sn=new Vector3,on=new Vector3;function satForAxes(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){on.fromArray(t,s);const o=r.x*Math.abs(on.x)+r.y*Math.abs(on.y)+r.z*Math.abs(on.z),a=e.dot(on),l=i.dot(on),c=n.dot(on);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const an=new Box3,ln=new Vector3,cn=new Vector3,hn=new Vector3;class Sphere{constructor(t=new Vector3,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):an.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){hn.subVectors(t,this.center);const e=hn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(hn.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return cn.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ln.copy(t.center).add(cn)),this.expandByPoint(ln.copy(t.center).sub(cn)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const un=new Vector3,dn=new Vector3,mn=new Vector3,pn=new Vector3,fn=new Vector3,_n=new Vector3,gn=new Vector3;class Ray{constructor(t=new Vector3,e=new Vector3(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,un)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=un.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(un.copy(this.direction).multiplyScalar(e).add(this.origin),un.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){dn.copy(t).add(e).multiplyScalar(.5),mn.copy(e).sub(t).normalize(),pn.copy(this.origin).sub(dn);const r=.5*t.distanceTo(e),s=-this.direction.dot(mn),o=pn.dot(this.direction),a=-pn.dot(mn),l=pn.lengthSq(),c=Math.abs(1-s*s);let h,u,d,m;if(c>0)if(u=s*o-a,m=r*c,(h=s*a-o)>=0)if(u>=-m)if(u<=m){const t=1/c;d=(h*=t)*(h+s*(u*=t)+2*o)+u*(s*h+u+2*a)+l}else u=r,d=-(h=Math.max(0,-(s*u+o)))*h+u*(u+2*a)+l;else u=-r,d=-(h=Math.max(0,-(s*u+o)))*h+u*(u+2*a)+l;else u<=-m?d=-(h=Math.max(0,-(-s*r+o)))*h+(u=h>0?-r:Math.min(Math.max(-r,-a),r))*(u+2*a)+l:u<=m?(h=0,d=(u=Math.min(Math.max(-r,-a),r))*(u+2*a)+l):d=-(h=Math.max(0,-(s*r+o)))*h+(u=h>0?r:Math.min(Math.max(-r,-a),r))*(u+2*a)+l;else u=s>0?-r:r,d=-(h=Math.max(0,-(s*u+o)))*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(mn).multiplyScalar(u).add(dn),d}intersectSphere(t,e){un.subVectors(t.center,this.origin);const i=un.dot(this.direction),n=un.dot(un)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,un)}intersectTriangle(t,e,i,n,r){fn.subVectors(e,t),_n.subVectors(i,t),gn.crossVectors(fn,_n);let s,o=this.direction.dot(gn);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}pn.subVectors(this.origin,t);const a=s*this.direction.dot(_n.crossVectors(pn,_n));if(a<0)return null;const l=s*this.direction.dot(fn.cross(pn));if(l<0)return null;if(a+l>o)return null;const c=-s*pn.dot(gn);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l,c,h,u,d,m,p,f){const _=this.elements;return _[0]=t,_[4]=e,_[8]=i,_[12]=n,_[1]=r,_[5]=s,_[9]=o,_[13]=a,_[2]=l,_[6]=c,_[10]=h,_[14]=u,_[3]=d,_[7]=m,_[11]=p,_[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/bn.setFromMatrixColumn(t,0).length(),r=1/bn.setFromMatrixColumn(t,1).length(),s=1/bn.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t+r*o,e[4]=n*o-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,i=a*h,n=l*c,r=l*h;e[0]=t-r*o,e[4]=-s*h,e[8]=n+i*o,e[1]=i+n*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,i=s*h,n=o*c,r=o*h;e[0]=a*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=a*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=o*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(xn,t,vn)}lookAt(t,e,i){const n=this.elements;return Mn.subVectors(t,e),0===Mn.lengthSq()&&(Mn.z=1),Mn.normalize(),Sn.crossVectors(i,Mn),0===Sn.lengthSq()&&(1===Math.abs(i.z)?Mn.x+=1e-4:Mn.z+=1e-4,Mn.normalize(),Sn.crossVectors(i,Mn)),Sn.normalize(),wn.crossVectors(Mn,Sn),n[0]=Sn.x,n[4]=wn.x,n[8]=Mn.x,n[1]=Sn.y,n[5]=wn.y,n[9]=Mn.y,n[2]=Sn.z,n[6]=wn.z,n[10]=Mn.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],_=i[14],g=i[3],b=i[7],y=i[11],x=i[15],v=n[0],S=n[4],w=n[8],M=n[12],A=n[1],V=n[5],C=n[9],T=n[13],B=n[2],P=n[6],E=n[10],L=n[14],R=n[3],I=n[7],D=n[11],G=n[15];return r[0]=s*v+o*A+a*B+l*R,r[4]=s*S+o*V+a*P+l*I,r[8]=s*w+o*C+a*E+l*D,r[12]=s*M+o*T+a*L+l*G,r[1]=c*v+h*A+u*B+d*R,r[5]=c*S+h*V+u*P+d*I,r[9]=c*w+h*C+u*E+d*D,r[13]=c*M+h*T+u*L+d*G,r[2]=m*v+p*A+f*B+_*R,r[6]=m*S+p*V+f*P+_*I,r[10]=m*w+p*C+f*E+_*D,r[14]=m*M+p*T+f*L+_*G,r[3]=g*v+b*A+y*B+x*R,r[7]=g*S+b*V+y*P+x*I,r[11]=g*w+b*C+y*E+x*D,r[15]=g*M+b*T+y*L+x*G,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+t[11]*(+e*l*h-e*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+t[15]*(-n*o*c-e*a*h+e*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],m=t[12],p=t[13],f=t[14],_=t[15],g=h*f*l-p*u*l+p*a*d-o*f*d-h*a*_+o*u*_,b=m*u*l-c*f*l-m*a*d+s*f*d+c*a*_-s*u*_,y=c*p*l-m*h*l+m*o*d-s*p*d-c*o*_+s*h*_,x=m*h*a-c*p*a-m*o*u+s*p*u+c*o*f-s*h*f,v=e*g+i*b+n*y+r*x;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/v;return t[0]=g*S,t[1]=(p*u*r-h*f*r-p*n*d+i*f*d+h*n*_-i*u*_)*S,t[2]=(o*f*r-p*a*r+p*n*l-i*f*l-o*n*_+i*a*_)*S,t[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*S,t[4]=b*S,t[5]=(c*f*r-m*u*r+m*n*d-e*f*d-c*n*_+e*u*_)*S,t[6]=(m*a*r-s*f*r-m*n*l+e*f*l+s*n*_-e*a*_)*S,t[7]=(s*u*r-c*a*r+c*n*l-e*u*l-s*n*d+e*a*d)*S,t[8]=y*S,t[9]=(m*h*r-c*p*r-m*i*d+e*p*d+c*i*_-e*h*_)*S,t[10]=(s*p*r-m*o*r+m*i*l-e*p*l-s*i*_+e*o*_)*S,t[11]=(c*o*r-s*h*r-c*i*l+e*h*l+s*i*d-e*o*d)*S,t[12]=x*S,t[13]=(c*p*n-m*h*n+m*i*u-e*p*u-c*i*f+e*h*f)*S,t[14]=(m*o*n-s*p*n-m*i*a+e*p*a+s*i*f-e*o*f)*S,t[15]=(s*h*n-c*o*n+c*i*a-e*h*a-s*i*u+e*o*u)*S,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,m=r*h,p=s*c,f=s*h,_=o*h,g=a*l,b=a*c,y=a*h,x=i.x,v=i.y,S=i.z;return n[0]=(1-(p+_))*x,n[1]=(d+y)*x,n[2]=(m-b)*x,n[3]=0,n[4]=(d-y)*v,n[5]=(1-(u+_))*v,n[6]=(f+g)*v,n[7]=0,n[8]=(m+b)*S,n[9]=(f-g)*S,n[10]=(1-(u+p))*S,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=bn.set(n[0],n[1],n[2]).length();const s=bn.set(n[4],n[5],n[6]).length(),o=bn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],yn.copy(this);const a=1/r,l=1/s,c=1/o;return yn.elements[0]*=a,yn.elements[1]*=a,yn.elements[2]*=a,yn.elements[4]*=l,yn.elements[5]*=l,yn.elements[6]*=l,yn.elements[8]*=c,yn.elements[9]*=c,yn.elements[10]*=c,e.setFromRotationMatrix(yn),i.x=r,i.y=s,i.z=o,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,s){const o=this.elements,a=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Matrix4.prototype.isMatrix4=!0;const bn=new Vector3,yn=new Matrix4,xn=new Vector3(0,0,0),vn=new Vector3(1,1,1),Sn=new Vector3,wn=new Vector3,Mn=new Vector3,An=new Matrix4,Vn=new Quaternion;class Euler{constructor(t=0,e=0,i=0,n=Euler.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-clamp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-clamp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return An.makeRotationFromQuaternion(t),this.setFromRotationMatrix(An,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Vn.setFromEuler(this),this.setFromQuaternion(Vn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0,Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Cn=0;const Tn=new Vector3,Bn=new Quaternion,Pn=new Matrix4,En=new Vector3,Ln=new Vector3,Rn=new Vector3,In=new Quaternion,Dn=new Vector3(1,0,0),Gn=new Vector3(0,1,0),Fn=new Vector3(0,0,1),kn={type:"added"},On={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:Cn++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const t=new Vector3,e=new Euler,i=new Quaternion,n=new Vector3(1,1,1);e._onChange(function onRotationChange(){i.setFromEuler(e,!1)}),i._onChange(function onQuaternionChange(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Bn.setFromAxisAngle(t,e),this.quaternion.multiply(Bn),this}rotateOnWorldAxis(t,e){return Bn.setFromAxisAngle(t,e),this.quaternion.premultiply(Bn),this}rotateX(t){return this.rotateOnAxis(Dn,t)}rotateY(t){return this.rotateOnAxis(Gn,t)}rotateZ(t){return this.rotateOnAxis(Fn,t)}translateOnAxis(t,e){return Tn.copy(t).applyQuaternion(this.quaternion),this.position.add(Tn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Dn,t)}translateY(t){return this.translateOnAxis(Gn,t)}translateZ(t){return this.translateOnAxis(Fn,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Pn.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?En.copy(t):En.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ln.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pn.lookAt(Ln,En,this.up):Pn.lookAt(En,Ln,this.up),this.quaternion.setFromRotationMatrix(Pn),n&&(Pn.extractRotation(n.matrixWorld),Bn.setFromRotationMatrix(Pn),this.quaternion.premultiply(Bn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(kn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(On)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(On)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Pn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Pn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Pn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ln,t,Rn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ln,In,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function serialize(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=serialize(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];serialize(t.shapes,n)}else serialize(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(serialize(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(serialize(t.materials,this.material[i]));n.material=e}else n.material=serialize(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(serialize(t.animations,i))}}if(e){const e=extractFromCache(t.geometries),n=extractFromCache(t.materials),r=extractFromCache(t.textures),s=extractFromCache(t.images),o=extractFromCache(t.shapes),a=extractFromCache(t.skeletons),l=extractFromCache(t.animations);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),o.length>0&&(i.shapes=o),a.length>0&&(i.skeletons=a),l.length>0&&(i.animations=l)}return i.object=n,i;function extractFromCache(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype.isObject3D=!0;const Nn=new Vector3,Un=new Vector3,zn=new Vector3,Wn=new Vector3,Hn=new Vector3,jn=new Vector3,Jn=new Vector3,qn=new Vector3,Xn=new Vector3,Yn=new Vector3;class Triangle{constructor(t=new Vector3,e=new Vector3,i=new Vector3){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Nn.subVectors(t,e),n.cross(Nn);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Nn.subVectors(n,e),Un.subVectors(i,e),zn.subVectors(t,e);const s=Nn.dot(Nn),o=Nn.dot(Un),a=Nn.dot(zn),l=Un.dot(Un),c=Un.dot(zn),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,m=(s*c-o*a)*u;return r.set(1-d-m,m,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Wn),Wn.x>=0&&Wn.y>=0&&Wn.x+Wn.y<=1}static getUV(t,e,i,n,r,s,o,a){return this.getBarycoord(t,e,i,n,Wn),a.set(0,0),a.addScaledVector(r,Wn.x),a.addScaledVector(s,Wn.y),a.addScaledVector(o,Wn.z),a}static isFrontFacing(t,e,i,n){return Nn.subVectors(i,e),Un.subVectors(t,e),Nn.cross(Un).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Nn.subVectors(this.c,this.b),Un.subVectors(this.a,this.b),.5*Nn.cross(Un).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Triangle.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return Triangle.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,o;Hn.subVectors(n,i),jn.subVectors(r,i),qn.subVectors(t,i);const a=Hn.dot(qn),l=jn.dot(qn);if(a<=0&&l<=0)return e.copy(i);Xn.subVectors(t,n);const c=Hn.dot(Xn),h=jn.dot(Xn);if(c>=0&&h<=c)return e.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(i).addScaledVector(Hn,s);Yn.subVectors(t,r);const d=Hn.dot(Yn),m=jn.dot(Yn);if(m>=0&&d<=m)return e.copy(r);const p=d*l-a*m;if(p<=0&&l>=0&&m<=0)return o=l/(l-m),e.copy(i).addScaledVector(jn,o);const f=c*m-d*h;if(f<=0&&h-c>=0&&d-m>=0)return Jn.subVectors(r,n),o=(h-c)/(h-c+(d-m)),e.copy(n).addScaledVector(Jn,o);const _=1/(f+p+u);return s=p*_,o=u*_,e.copy(i).addScaledVector(Hn,s).addScaledVector(jn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Zn=0;class Material extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:Zn++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=p,this.vertexColors=!1,this.opacity=1,this.format=Ot,this.transparent=!1,this.blendSrc=D,this.blendDst=G,this.blendEquation=V,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hi,this.stencilZFail=hi,this.stencilZPass=hi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===g;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenTint&&this.sheenTint.isColor&&(i.sheenTint=this.sheenTint.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(i.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(i.specularTintMap=this.specularTintMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(i.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(i.blending=this.blending),this.side!==p&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==Ot&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=extractFromCache(t.textures),n=extractFromCache(t.images);e.length>0&&(i.textures=e),n.length>0&&(i.images=n)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}Material.prototype.isMaterial=!0;const Kn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qn={h:0,s:0,l:0},$n={h:0,s:0,l:0};function hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Color{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=euclideanModulo(t,1),e=clamp(e,0,1),i=clamp(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=hue2rgb(r,n,t+1/3),this.g=hue2rgb(r,n,t),this.b=hue2rgb(r,n,t-1/3)}return this}setStyle(t){function handleAlpha(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let e;if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=e[1],n=e[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,handleAlpha(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,handleAlpha(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const e=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100;return handleAlpha(t[4]),this.setHSL(e,i,n)}}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=e[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Kn[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const t=r-s;switch(a=l<=.5?t/(r+s):t/(2-r-s),r){case e:o=(i-n)/t+(i<n?6:0);break;case i:o=(n-e)/t+2;break;case n:o=(e-i)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(Qn),Qn.h+=t,Qn.s+=e,Qn.l+=i,this.setHSL(Qn.h,Qn.s,Qn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Qn),t.getHSL($n);const i=lerp(Qn.h,$n.h,e),n=lerp(Qn.s,$n.s,e),r=lerp(Qn.l,$n.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=Kn,Color.prototype.isColor=!0,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class MeshBasicMaterial extends Material{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const tr=new Vector3,er=new Vector2;class BufferAttribute{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=Ai,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Color),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Vector2),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new Vector3),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new Vector4),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)er.fromBufferAttribute(this,e),er.applyMatrix3(t),this.setXY(e,er.x,er.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)tr.fromBufferAttribute(this,e),tr.applyMatrix3(t),this.setXYZ(e,tr.x,tr.y,tr.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)tr.x=this.getX(e),tr.y=this.getY(e),tr.z=this.getZ(e),tr.applyMatrix4(t),this.setXYZ(e,tr.x,tr.y,tr.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)tr.x=this.getX(e),tr.y=this.getY(e),tr.z=this.getZ(e),tr.applyNormalMatrix(t),this.setXYZ(e,tr.x,tr.y,tr.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)tr.x=this.getX(e),tr.y=this.getY(e),tr.z=this.getZ(e),tr.transformDirection(t),this.setXYZ(e,tr.x,tr.y,tr.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Ai&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}BufferAttribute.prototype.isBufferAttribute=!0;class Int8BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int8Array(t),e,i)}}class Uint8BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Int16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Uint16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Int32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint16Array(t),e,i)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Float64BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Float64Array(t),e,i)}}let ir=0;const nr=new Matrix4,rr=new Object3D,sr=new Vector3,or=new Box3,ar=new Box3,lr=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:ir++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Matrix3).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return nr.makeRotationFromQuaternion(t),this.applyMatrix4(nr),this}rotateX(t){return nr.makeRotationX(t),this.applyMatrix4(nr),this}rotateY(t){return nr.makeRotationY(t),this.applyMatrix4(nr),this}rotateZ(t){return nr.makeRotationZ(t),this.applyMatrix4(nr),this}translate(t,e,i){return nr.makeTranslation(t,e,i),this.applyMatrix4(nr),this}scale(t,e,i){return nr.makeScale(t,e,i),this.applyMatrix4(nr),this}lookAt(t){return rr.lookAt(t),rr.updateMatrix(),this.applyMatrix4(rr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sr).negate(),this.translate(sr.x,sr.y,sr.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];or.setFromBufferAttribute(i),this.morphTargetsRelative?(lr.addVectors(this.boundingBox.min,or.min),this.boundingBox.expandByPoint(lr),lr.addVectors(this.boundingBox.max,or.max),this.boundingBox.expandByPoint(lr)):(this.boundingBox.expandByPoint(or.min),this.boundingBox.expandByPoint(or.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(t){const i=this.boundingSphere.center;if(or.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];ar.setFromBufferAttribute(i),this.morphTargetsRelative?(lr.addVectors(or.min,ar.min),or.expandByPoint(lr),lr.addVectors(or.max,ar.max),or.expandByPoint(lr)):(or.expandByPoint(ar.min),or.expandByPoint(ar.max))}or.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)lr.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(lr));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)lr.fromBufferAttribute(s,e),o&&(sr.fromBufferAttribute(t,e),lr.add(sr)),n=Math.max(n,i.distanceToSquared(lr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,o=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const a=e.tangent.array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new Vector3,c[t]=new Vector3;const h=new Vector3,u=new Vector3,d=new Vector3,m=new Vector2,p=new Vector2,f=new Vector2,_=new Vector3,g=new Vector3;function handleTriangle(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),m.fromArray(s,2*t),p.fromArray(s,2*e),f.fromArray(s,2*i),u.sub(h),d.sub(h),p.sub(m),f.sub(m);const r=1/(p.x*f.y-f.x*p.y);isFinite(r)&&(_.copy(u).multiplyScalar(f.y).addScaledVector(d,-p.y).multiplyScalar(r),g.copy(d).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(r),l[t].add(_),l[e].add(_),l[i].add(_),c[t].add(g),c[e].add(g),c[i].add(g))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let t=0,e=b.length;t<e;++t){const e=b[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)handleTriangle(i[t+0],i[t+1],i[t+2])}const y=new Vector3,x=new Vector3,v=new Vector3,S=new Vector3;function handleVertex(t){v.fromArray(r,3*t),S.copy(v);const e=l[t];y.copy(e),y.sub(v.multiplyScalar(v.dot(e))).normalize(),x.crossVectors(S,e);const i=x.dot(c[t])<0?-1:1;a[4*t]=y.x,a[4*t+1]=y.y,a[4*t+2]=y.z,a[4*t+3]=i}for(let t=0,e=b.length;t<e;++t){const e=b[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)handleVertex(i[t+0]),handleVertex(i[t+1]),handleVertex(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Vector3,r=new Vector3,s=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),m=t.getX(u+1),p=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,m),s.fromBufferAttribute(e,p),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,p),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(p,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],o=s.array,a=s.itemSize*e,l=Math.min(o.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)lr.fromBufferAttribute(t,e),lr.normalize(),t.setXYZ(e,lr.x,lr.y,lr.z)}toNonIndexed(){function convertBufferAttribute(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[a++]=i[o++]}return new BufferAttribute(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,e=this.index.array,i=this.attributes;for(const n in i){const r=convertBufferAttribute(i[n],e);t.setAttribute(n,r)}const n=this.morphAttributes;for(const i in n){const r=[],s=n[i];for(let t=0,i=s.length;t<i;t++){const i=convertBufferAttribute(s[t],e);r.push(i)}t.morphAttributes[i]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,i=r.length;e<i;e++){const i=r[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const cr=new Matrix4,hr=new Ray,ur=new Sphere,dr=new Vector3,mr=new Vector3,pr=new Vector3,fr=new Vector3,_r=new Vector3,gr=new Vector3,br=new Vector3,yr=new Vector3,xr=new Vector3,vr=new Vector2,Sr=new Vector2,wr=new Vector2,Mr=new Vector3,Ar=new Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,e=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ur.copy(i.boundingSphere),ur.applyMatrix4(r),!1===t.ray.intersectsSphere(ur))return;if(cr.copy(r).invert(),hr.copy(t.ray).applyMatrix4(cr),null!==i.boundingBox&&!1===hr.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,m=u.length;i<m;i++){const m=u[i],p=n[m.materialIndex];for(let i=Math.max(m.start,d.start),n=Math.min(r.count,Math.min(m.start+m.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);(s=checkBufferGeometryIntersection(this,p,t,hr,o,a,l,c,h,n,u,d))&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=m.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),m=r.getX(i+2);(s=checkBufferGeometryIntersection(this,n,t,hr,o,a,l,c,h,u,d,m))&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],m=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3){(s=checkBufferGeometryIntersection(this,m,t,hr,o,a,l,c,h,i,i+1,i+2))&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){(s=checkBufferGeometryIntersection(this,n,t,hr,o,a,l,c,h,i,i+1,i+2))&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function checkBufferGeometryIntersection(t,e,i,n,r,s,o,a,l,c,h,u){dr.fromBufferAttribute(r,c),mr.fromBufferAttribute(r,h),pr.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){br.set(0,0,0),yr.set(0,0,0),xr.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(fr.fromBufferAttribute(i,c),_r.fromBufferAttribute(i,h),gr.fromBufferAttribute(i,u),o?(br.addScaledVector(fr,e),yr.addScaledVector(_r,e),xr.addScaledVector(gr,e)):(br.addScaledVector(fr.sub(dr),e),yr.addScaledVector(_r.sub(mr),e),xr.addScaledVector(gr.sub(pr),e)))}dr.add(br),mr.add(yr),pr.add(xr)}t.isSkinnedMesh&&(t.boneTransform(c,dr),t.boneTransform(h,mr),t.boneTransform(u,pr));const m=function checkIntersection(t,e,i,n,r,s,o,a){let l;if(null===(l=e.side===f?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,e.side!==_,a)))return null;Ar.copy(a),Ar.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(Ar);return c<i.near||c>i.far?null:{distance:c,point:Ar.clone(),object:t}}(t,e,i,n,dr,mr,pr,Mr);if(m){a&&(vr.fromBufferAttribute(a,c),Sr.fromBufferAttribute(a,h),wr.fromBufferAttribute(a,u),m.uv=Triangle.getUV(Mr,dr,mr,pr,vr,Sr,wr,new Vector2)),l&&(vr.fromBufferAttribute(l,c),Sr.fromBufferAttribute(l,h),wr.fromBufferAttribute(l,u),m.uv2=Triangle.getUV(Mr,dr,mr,pr,vr,Sr,wr,new Vector2));const t={a:c,b:h,c:u,normal:new Vector3,materialIndex:0};Triangle.getNormal(dr,mr,pr,t.normal),m.face=t}return m}Mesh.prototype.isMesh=!0;class BoxGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function buildPlane(t,e,i,n,r,s,m,p,f,_,g){const b=s/f,y=m/_,x=s/2,v=m/2,S=p/2,w=f+1,M=_+1;let A=0,V=0;const C=new Vector3;for(let s=0;s<M;s++){const o=s*y-v;for(let a=0;a<w;a++){const u=a*b-x;C[t]=u*n,C[e]=o*r,C[i]=S,l.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=p>0?1:-1,c.push(C.x,C.y,C.z),h.push(a/f),h.push(1-s/_),A+=1}}for(let t=0;t<_;t++)for(let e=0;e<f;e++){const i=u+e+w*t,n=u+e+w*(t+1),r=u+(e+1)+w*(t+1),s=u+(e+1)+w*t;a.push(i,n,s),a.push(n,r,s),V+=6}o.addGroup(d,V,g),d+=V,u+=A}buildPlane("z","y","x",-1,-1,i,e,t,s,r,0),buildPlane("z","y","x",1,-1,i,e,-t,s,r,1),buildPlane("x","z","y",1,1,t,i,e,n,s,2),buildPlane("x","z","y",1,-1,t,i,-e,n,s,3),buildPlane("x","y","z",1,-1,t,e,i,n,r,4),buildPlane("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function mergeUniforms(t){const e={};for(let i=0;i<t.length;i++){const n=cloneUniforms(t[i]);for(const t in n)e[t]=n[t]}return e}const Vr={clone:cloneUniforms,merge:mergeUniforms};var Cr="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Tr="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Cr,this.fragmentShader=Tr,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*ki*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Fi*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*ki*Math.atan(Math.tan(.5*Fi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Fi*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/o,n*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const Br=90,Pr=1;class CubeCamera extends Object3D{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new PerspectiveCamera(Br,Pr,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);const r=new PerspectiveCamera(Br,Pr,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Vector3(-1,0,0)),this.add(r);const s=new PerspectiveCamera(Br,Pr,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Vector3(0,1,0)),this.add(s);const o=new PerspectiveCamera(Br,Pr,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);const a=new PerspectiveCamera(Br,Pr,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(0,0,1)),this.add(a);const l=new PerspectiveCamera(Br,Pr,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c}}class CubeTexture extends Texture{constructor(t,e,i,n,r,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:ot,i,n,r,s,o,a,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),super(t,t,e),e=e||{},this.texture=new CubeTexture(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:xt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Ot,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new BoxGeometry(5,5,5),r=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:f,blending:y});r.uniforms.tEquirect.value=e;const s=new Mesh(n,r),o=e.minFilter;return e.minFilter===wt&&(e.minFilter=xt),new CubeCamera(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;const Er=new Vector3,Lr=new Vector3,Rr=new Matrix3;class Plane{constructor(t=new Vector3(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Er.subVectors(i,e).cross(Lr.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Er),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Rr.getNormalMatrix(t),n=this.coplanarPoint(Er).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Plane.prototype.isPlane=!0;const Ir=new Sphere,Dr=new Vector3;class Frustum{constructor(t=new Plane,e=new Plane,i=new Plane,n=new Plane,r=new Plane,s=new Plane){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],m=i[10],p=i[11],f=i[12],_=i[13],g=i[14],b=i[15];return e[0].setComponents(o-n,h-a,p-u,b-f).normalize(),e[1].setComponents(o+n,h+a,p+u,b+f).normalize(),e[2].setComponents(o+r,h+l,p+d,b+_).normalize(),e[3].setComponents(o-r,h-l,p-d,b-_).normalize(),e[4].setComponents(o-s,h-c,p-m,b-g).normalize(),e[5].setComponents(o+s,h+c,p+m,b+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Ir.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Ir)}intersectsSprite(t){return Ir.center.set(0,0,0),Ir.radius=.7071067811865476,Ir.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ir)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Dr.x=n.normal.x>0?t.max.x:t.min.x,Dr.y=n.normal.y>0?t.max.y:t.min.y,Dr.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Dr)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let t=null,e=!1,i=null,n=null;function onAnimationFrame(e,r){i(e,r),n=t.requestAnimationFrame(onAnimationFrame)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(onAnimationFrame),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function WebGLAttributes(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function get(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function remove(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function update(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function createBuffer(e,n){const r=e.array,s=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,r,s),e.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array?a=5121:r instanceof Uint8ClampedArray&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function updateBuffer(e,n,r){const s=n.array,o=n.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class PlaneGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=t/o,u=e/a,d=[],m=[],p=[],f=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;m.push(n,-e,0),p.push(0,0,1),f.push(i/o),f.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}const Gr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenTint, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenTint * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenTint, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n\tuniform float sheenRoughness;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Fr={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}}},kr={basic:{uniforms:mergeUniforms([Fr.common,Fr.specularmap,Fr.envmap,Fr.aomap,Fr.lightmap,Fr.fog]),vertexShader:Gr.meshbasic_vert,fragmentShader:Gr.meshbasic_frag},lambert:{uniforms:mergeUniforms([Fr.common,Fr.specularmap,Fr.envmap,Fr.aomap,Fr.lightmap,Fr.emissivemap,Fr.fog,Fr.lights,{emissive:{value:new Color(0)}}]),vertexShader:Gr.meshlambert_vert,fragmentShader:Gr.meshlambert_frag},phong:{uniforms:mergeUniforms([Fr.common,Fr.specularmap,Fr.envmap,Fr.aomap,Fr.lightmap,Fr.emissivemap,Fr.bumpmap,Fr.normalmap,Fr.displacementmap,Fr.fog,Fr.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Gr.meshphong_vert,fragmentShader:Gr.meshphong_frag},standard:{uniforms:mergeUniforms([Fr.common,Fr.envmap,Fr.aomap,Fr.lightmap,Fr.emissivemap,Fr.bumpmap,Fr.normalmap,Fr.displacementmap,Fr.roughnessmap,Fr.metalnessmap,Fr.fog,Fr.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Gr.meshphysical_vert,fragmentShader:Gr.meshphysical_frag},toon:{uniforms:mergeUniforms([Fr.common,Fr.aomap,Fr.lightmap,Fr.emissivemap,Fr.bumpmap,Fr.normalmap,Fr.displacementmap,Fr.gradientmap,Fr.fog,Fr.lights,{emissive:{value:new Color(0)}}]),vertexShader:Gr.meshtoon_vert,fragmentShader:Gr.meshtoon_frag},matcap:{uniforms:mergeUniforms([Fr.common,Fr.bumpmap,Fr.normalmap,Fr.displacementmap,Fr.fog,{matcap:{value:null}}]),vertexShader:Gr.meshmatcap_vert,fragmentShader:Gr.meshmatcap_frag},points:{uniforms:mergeUniforms([Fr.points,Fr.fog]),vertexShader:Gr.points_vert,fragmentShader:Gr.points_frag},dashed:{uniforms:mergeUniforms([Fr.common,Fr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Gr.linedashed_vert,fragmentShader:Gr.linedashed_frag},depth:{uniforms:mergeUniforms([Fr.common,Fr.displacementmap]),vertexShader:Gr.depth_vert,fragmentShader:Gr.depth_frag},normal:{uniforms:mergeUniforms([Fr.common,Fr.bumpmap,Fr.normalmap,Fr.displacementmap,{opacity:{value:1}}]),vertexShader:Gr.meshnormal_vert,fragmentShader:Gr.meshnormal_frag},sprite:{uniforms:mergeUniforms([Fr.sprite,Fr.fog]),vertexShader:Gr.sprite_vert,fragmentShader:Gr.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:Gr.background_vert,fragmentShader:Gr.background_frag},cube:{uniforms:mergeUniforms([Fr.envmap,{opacity:{value:1}}]),vertexShader:Gr.cube_vert,fragmentShader:Gr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Gr.equirect_vert,fragmentShader:Gr.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([Fr.common,Fr.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gr.distanceRGBA_vert,fragmentShader:Gr.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([Fr.lights,Fr.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Gr.shadow_vert,fragmentShader:Gr.shadow_frag}};function WebGLBackground(t,e,i,n,r){const s=new Color(0);let o,a,l=0,c=null,h=0,u=null;function setClear(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),setClear(s,l=e)},getClearAlpha:function(){return l},setClearAlpha:function(t){setClear(s,l=t)},render:function render(i,r){let d=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const _=t.xr,g=_.getSession&&_.getSession();g&&"additive"===g.environmentBlendMode&&(m=null),null===m?setClear(s,l):m&&m.isColor&&(setClear(m,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===ht)?(void 0===a&&((a=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(kr.cube.uniforms),vertexShader:kr.cube.vertexShader,fragmentShader:kr.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,c===m&&h===m.version&&u===t.toneMapping||(a.material.needsUpdate=!0,c=m,h=m.version,u=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&((o=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(kr.background.uniforms),vertexShader:kr.background.vertexShader,fragmentShader:kr.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&h===m.version&&u===t.toneMapping||(o.material.needsUpdate=!0,c=m,h=m.version,u=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function WebGLBindingStates(t,e,i,n){const r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=createBindingState(null);let c=l;function bindVertexArrayObject(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function deleteVertexArrayObject(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function createBindingState(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function initAttributes(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function enableAttribute(t){enableAttributeAndDivisor(t,0)}function enableAttributeAndDivisor(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r}}function disableUnusedAttributes(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function vertexAttribPointer(e,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,o,a):t.vertexAttribIPointer(e,i,r,o,a)}function reset(){resetDefaultState(),c!==l&&bindVertexArrayObject((c=l).object)}function resetDefaultState(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function setup(r,l,h,u,d){let m=!1;if(o){const e=function getBindingState(e,i,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];return void 0===h&&(h=createBindingState(function createVertexArrayObject(){return n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}()),c[o]=h),h}(u,h,l);c!==e&&bindVertexArrayObject((c=e).object),(m=function needsUpdate(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],s=n[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(u,d))&&function saveCache(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],s={};s.attribute=e,e.data&&(s.data=e.data),i[t]=s,r++}c.attributes=i,c.attributesNum=r,c.index=e}(u,d)}else{const t=!0===l.wireframe;c.geometry===u.id&&c.program===h.id&&c.wireframe===t||(c.geometry=u.id,c.program=h.id,c.wireframe=t,m=!0)}!0===r.isInstancedMesh&&(m=!0),null!==d&&i.update(d,34963),m&&(function setupVertexAttributes(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;initAttributes();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i&&i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)enableAttributeAndDivisor(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)enableAttribute(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)vertexAttribPointer(n.location+t,o/n.locationSize,h,e,l*u,(d+o/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)enableAttributeAndDivisor(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)enableAttribute(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)vertexAttribPointer(n.location+t,o/n.locationSize,h,e,o*u,o/n.locationSize*t*u)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}disableUnusedAttributes()}(r,l,h,u),null!==d&&t.bindBuffer(34963,i.get(d).buffer))},reset:reset,resetDefaultState:resetDefaultState,dispose:function dispose(){reset();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)deleteVertexArrayObject(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function releaseStatesOfGeometry(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)deleteVertexArrayObject(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function releaseStatesOfProgram(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)deleteVertexArrayObject(n[t].object),delete n[t];delete i[t.id]}},initAttributes:initAttributes,enableAttribute:enableAttribute,disableUnusedAttributes:disableUnusedAttributes}}function WebGLBufferRenderer(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function setMode(t){s=t},this.render=function render(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function renderInstances(n,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function WebGLCapabilities(t,e,i){let n;function getMaxPrecision(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==i.precision?i.precision:"highp";const o=getMaxPrecision(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const a=r||e.has("WEBGL_draw_buffers"),l=!0===i.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),d=t.getParameter(34076),m=t.getParameter(34921),p=t.getParameter(36347),f=t.getParameter(36348),_=t.getParameter(36349),g=h>0,b=r||e.has("OES_texture_float");return{isWebGL2:r,drawBuffers:a,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:getMaxPrecision,precision:s,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:d,maxAttributes:m,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:_,vertexTextures:g,floatFragmentTextures:b,floatVertexTextures:g&&b,maxSamples:r?t.getParameter(36183):0}}function WebGLClipping(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};function resetGlobalState(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function projectPlanes(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==n||r;return r=e,i=projectPlanes(t,s,0),n=t.length,o},this.beginShadows=function(){s=!0,projectPlanes(null)},this.endShadows=function(){s=!1,resetGlobalState()},this.setState=function(e,o,a){const c=e.clippingPlanes,h=e.clipIntersection,u=e.clipShadows,d=t.get(e);if(!r||null===c||0===c.length||s&&!u)s?projectPlanes(null):resetGlobalState();else{const t=s?0:n,e=4*t;let r=d.clippingState||null;l.value=r,r=projectPlanes(c,o,e,a);for(let t=0;t!==e;++t)r[t]=i[t];d.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=t}}}function WebGLCubeMaps(t){let e=new WeakMap;function mapTextureMapping(t,e){return e===lt?t.mapping=ot:e===ct&&(t.mapping=at),t}function onTextureDispose(t){const i=t.target;i.removeEventListener("dispose",onTextureDispose);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function get(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const n=i.mapping;if(n===lt||n===ct){if(e.has(i))return mapTextureMapping(e.get(i).texture,i.mapping);{const n=i.image;if(n&&n.height>0){const r=t.getRenderTarget(),s=new WebGLCubeRenderTarget(n.height/2);return s.fromEquirectangularTexture(t,i),e.set(i,s),t.setRenderTarget(r),i.addEventListener("dispose",onTextureDispose),mapTextureMapping(s.texture,i.mapping)}return null}}}return i},dispose:function dispose(){e=new WeakMap}}}kr.physical={uniforms:mergeUniforms([kr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenTint:{value:new Color(0)},sheenRoughness:{value:0},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Color(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Color(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Gr.meshphysical_vert,fragmentShader:Gr.meshphysical_frag};class OrthographicCamera extends Camera{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s=(r+=t*this.view.offsetX)+t*this.view.width,a=(o-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}OrthographicCamera.prototype.isOrthographicCamera=!0;class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;const Or=4,Nr=8,Ur=Math.pow(2,Nr),zr=[.125,.215,.35,.446,.526,.582],Wr=Nr-Or+1+zr.length,Hr=20,jr={[Ke]:0,[Qe]:1,[ti]:2,[ii]:3,[ni]:4,[ri]:5,[$e]:6},Jr=new OrthographicCamera,{_lodPlanes:qr,_sizeLods:Xr,_sigmas:Yr}=_createPlanes(),Zr=new Color;let Kr=null;const Qr=(1+Math.sqrt(5))/2,$r=1/Qr,ts=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,Qr,$r),new Vector3(0,Qr,-$r),new Vector3($r,0,Qr),new Vector3(-$r,0,Qr),new Vector3(Qr,$r,0),new Vector3(-Qr,$r,0)];class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function _getBlurShader(t){const e=new Float32Array(t),i=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:jr[Ke]},outputEncoding:{value:jr[Ke]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}(Hr),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Kr=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<qr.length;t++)qr[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Kr),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t){Kr=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:At,format:zt,encoding:_isLDR(t)?t.encoding:ti,depthBuffer:!1},i=_createRenderTarget(e);return i.depthBuffer=!t,this._pingPongRenderTarget=_createRenderTarget(e),i}_compileMaterial(t){const e=new Mesh(qr[0],t);this._renderer.compile(e,Jr)}_sceneToCubeUV(t,e,i,n){const r=new PerspectiveCamera(90,1,e,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,h=a.toneMapping;a.getClearColor(Zr),a.toneMapping=$,a.outputEncoding=Ke,a.autoClear=!1;const u=new MeshBasicMaterial({name:"PMREM.Background",side:f,depthWrite:!1,depthTest:!1}),d=new Mesh(new BoxGeometry,u);let m=!1;const p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,m=!0):(u.color.copy(Zr),m=!0);for(let e=0;e<6;e++){const i=e%3;0==i?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1==i?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e])),_setViewport(n,i*Ur,e>2?Ur:0,Ur,Ur),a.setRenderTarget(n),m&&a.render(d,r),a.render(t,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=h,a.outputEncoding=c,a.autoClear=l,t.background=p}_setEncoding(t,e){!0===this._renderer.capabilities.isWebGL2&&e.format===Ot&&e.type===At&&e.encoding===Qe?t.value=jr[Ke]:t.value=jr[e.encoding]}_textureToCubeUV(t,e){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());const n=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Mesh(qr[0],n),s=n.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(s.inputEncoding,t),this._setEncoding(s.outputEncoding,e.texture),_setViewport(e,0,0,3*Ur,2*Ur),i.setRenderTarget(e),i.render(r,Jr)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<Wr;e++){const i=Math.sqrt(Yr[e]*Yr[e]-Yr[e-1]*Yr[e-1]),n=ts[(e-1)%ts.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Mesh(qr[n],l),h=l.uniforms,u=Xr[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/(2*Hr-1),m=r/d,p=isFinite(r)?1+Math.floor(3*m):Hr;p>Hr&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${Hr}`);const f=[];let _=0;for(let t=0;t<Hr;++t){const e=t/m,i=Math.exp(-e*e/2);f.push(i),0==t?_+=i:t<p&&(_+=2*i)}for(let t=0;t<f.length;t++)f[t]=f[t]/_;h.envMap.value=t.texture,h.samples.value=p,h.weights.value=f,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o),h.dTheta.value=d,h.mipInt.value=Nr-i,this._setEncoding(h.inputEncoding,t.texture),this._setEncoding(h.outputEncoding,t.texture);const g=Xr[n];_setViewport(e,3*Math.max(0,Ur-2*g),(0===n?0:2*Ur)+2*g*(n>Nr-Or?n-Nr+Or:0),3*g,2*g),a.setRenderTarget(e),a.render(c,Jr)}}function _isLDR(t){return void 0!==t&&t.type===At&&(t.encoding===Ke||t.encoding===Qe||t.encoding===$e)}function _createPlanes(){const t=[],e=[],i=[];let n=Nr;for(let r=0;r<Wr;r++){const s=Math.pow(2,n);e.push(s);let o=1/s;r>Nr-Or?o=zr[r-Nr+Or-1]:0==r&&(o=0),i.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,m=3,p=2,f=1,_=new Float32Array(m*d*u),g=new Float32Array(p*d*u),b=new Float32Array(f*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];_.set(n,m*d*t),g.set(h,p*d*t);const r=[t,t,t,t,t,t];b.set(r,f*d*t)}const y=new BufferGeometry;y.setAttribute("position",new BufferAttribute(_,m)),y.setAttribute("uv",new BufferAttribute(g,p)),y.setAttribute("faceIndex",new BufferAttribute(b,f)),t.push(y),n>Or&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function _createRenderTarget(t){const e=new WebGLRenderTarget(3*Ur,3*Ur,t);return e.texture.mapping=ht,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _setViewport(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function _getEquirectShader(){const t=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:jr[Ke]},outputEncoding:{value:jr[Ke]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:jr[Ke]},outputEncoding:{value:jr[Ke]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${_getEncodings()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:y,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _getEncodings(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function WebGLCubeUVMaps(t){let e=new WeakMap,i=null;function onTextureDispose(t){const i=t.target;i.removeEventListener("dispose",onTextureDispose);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function get(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const r=n.mapping,s=r===lt||r===ct,o=r===ot||r===at;if(s||o){if(e.has(n))return e.get(n).texture;{const r=n.image;if(s&&r&&r.height>0||o&&r&&function isCubeTextureComplete(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(r)){const r=t.getRenderTarget();null===i&&(i=new PMREMGenerator(t));const o=s?i.fromEquirectangular(n):i.fromCubemap(n);return e.set(n,o),t.setRenderTarget(r),n.addEventListener("dispose",onTextureDispose),o.texture}return null}}}return n},dispose:function dispose(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function WebGLExtensions(t){const e={};function getExtension(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==getExtension(t)},init:function(t){t.isWebGL2?getExtension("EXT_color_buffer_float"):(getExtension("WEBGL_depth_texture"),getExtension("OES_texture_float"),getExtension("OES_texture_half_float"),getExtension("OES_texture_half_float_linear"),getExtension("OES_standard_derivatives"),getExtension("OES_element_index_uint"),getExtension("OES_vertex_array_object"),getExtension("ANGLE_instanced_arrays")),getExtension("OES_texture_float_linear"),getExtension("EXT_color_buffer_half_float")},get:function(t){const e=getExtension(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function WebGLGeometries(t,e,i,n){const r={},s=new WeakMap;function onGeometryDispose(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",onGeometryDispose),delete r[o.id];const a=s.get(o);a&&(e.remove(a),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function updateWireframeAttribute(t){const i=[],n=t.index,r=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;o=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const a=new(arrayMax(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function get(t,e){return!0===r[e.id]?e:(e.addEventListener("dispose",onGeometryDispose),r[e.id]=!0,i.memory.geometries++,e)},update:function update(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function getWireframeAttribute(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&updateWireframeAttribute(t)}else updateWireframeAttribute(t);return s.get(t)}}}function WebGLIndexedBufferRenderer(t,e,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function setMode(t){s=t},this.setIndex=function setIndex(t){o=t.type,a=t.bytesPerElement},this.render=function render(e,n){t.drawElements(s,n,o,e*a),i.update(n,s,1)},this.renderInstances=function renderInstances(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function WebGLInfo(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function reset(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function update(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class DataTexture2DArray extends Texture{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ft,this.minFilter=ft,this.wrapR=mt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function numericalSort(t,e){return t[0]-e[0]}function absNumericalSort(t,e){return Math.abs(e[1])-Math.abs(t[1])}function denormalize(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function WebGLMorphtargets(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new Vector3,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function update(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const n=c.morphAttributes.position.length;let r=s.get(c);if(void 0===r||r.count!==n){void 0!==r&&r.texture.dispose();const t=void 0!==c.morphAttributes.normal,i=c.morphAttributes.position,a=c.morphAttributes.normal||[],l=!0===t?2:1;let h=c.attributes.position.count*l,u=1;h>e.maxTextureSize&&(u=Math.ceil(h/e.maxTextureSize),h=e.maxTextureSize);const d=new Float32Array(h*u*4*n),m=new DataTexture2DArray(d,h,u,n);m.format=Ot,m.type=Et;const p=4*l;for(let e=0;e<n;e++){const n=i[e],r=a[e],s=h*u*4*e;for(let e=0;e<n.count;e++){o.fromBufferAttribute(n,e),!0===n.normalized&&denormalize(o,n);const i=e*p;d[s+i+0]=o.x,d[s+i+1]=o.y,d[s+i+2]=o.z,d[s+i+3]=0,!0===t&&(o.fromBufferAttribute(r,e),!0===r.normalized&&denormalize(o,r),d[s+i+4]=o.x,d[s+i+5]=o.y,d[s+i+6]=o.z,d[s+i+7]=0)}}r={count:n,texture:m,size:new Vector2(h,u)},s.set(c,r)}let a=0;for(let t=0;t<d.length;t++)a+=d[t];const l=c.morphTargetsRelative?1:1-a;u.getUniforms().setValue(t,"morphTargetBaseInfluence",l),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",r.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",r.size)}else{const e=void 0===d?0:d.length;let i=n[c.id];if(void 0===i||i.length!==e){i=[];for(let t=0;t<e;t++)i[t]=[t,0];n[c.id]=i}for(let t=0;t<e;t++){const e=i[t];e[0]=t,e[1]=d[t]}i.sort(absNumericalSort);for(let t=0;t<8;t++)t<e&&i[t][1]?(a[t][0]=i[t][0],a[t][1]=i[t][1]):(a[t][0]=Number.MAX_SAFE_INTEGER,a[t][1]=0);a.sort(numericalSort);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=a[t],i=e[0],n=e[1];i!==Number.MAX_SAFE_INTEGER&&n?(s&&c.getAttribute("morphTarget"+t)!==s[i]&&c.setAttribute("morphTarget"+t,s[i]),o&&c.getAttribute("morphNormal"+t)!==o[i]&&c.setAttribute("morphNormal"+t,o[i]),r[t]=n,l+=n):(s&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),o&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),r[t]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",h),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function WebGLObjects(t,e,i,n){let r=new WeakMap;function onInstancedMeshDispose(t){const e=t.target;e.removeEventListener("dispose",onInstancedMeshDispose),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function update(t){const s=n.render.frame,o=t.geometry,a=e.get(t,o);return r.get(a)!==s&&(e.update(a),r.set(a,s)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",onInstancedMeshDispose)&&t.addEventListener("dispose",onInstancedMeshDispose),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),a},dispose:function dispose(){r=new WeakMap}}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ft,this.minFilter=ft,this.wrapR=mt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const es=new Texture,is=new DataTexture2DArray,ns=new DataTexture3D,rs=new CubeTexture,ss=[],os=[],as=new Float32Array(16),ls=new Float32Array(9),cs=new Float32Array(4);function flatten(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=ss[r];if(void 0===s&&(s=new Float32Array(r),ss[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function arraysEqual(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function copyArray(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function allocTexUnits(t,e){let i=os[e];void 0===i&&(i=new Int32Array(e),os[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function setValueV1f(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function setValueV2f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;t.uniform2fv(this.addr,e),copyArray(i,e)}}function setValueV3f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(arraysEqual(i,e))return;t.uniform3fv(this.addr,e),copyArray(i,e)}}function setValueV4f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;t.uniform4fv(this.addr,e),copyArray(i,e)}}function setValueM2(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,n))return;cs.set(n),t.uniformMatrix2fv(this.addr,!1,cs),copyArray(i,n)}}function setValueM3(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,n))return;ls.set(n),t.uniformMatrix3fv(this.addr,!1,ls),copyArray(i,n)}}function setValueM4(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,n))return;as.set(n),t.uniformMatrix4fv(this.addr,!1,as),copyArray(i,n)}}function setValueV1i(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function setValueV2i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform2iv(this.addr,e),copyArray(i,e))}function setValueV3i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform3iv(this.addr,e),copyArray(i,e))}function setValueV4i(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform4iv(this.addr,e),copyArray(i,e))}function setValueV1ui(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function setValueV2ui(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform2uiv(this.addr,e),copyArray(i,e))}function setValueV3ui(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform3uiv(this.addr,e),copyArray(i,e))}function setValueV4ui(t,e){const i=this.cache;arraysEqual(i,e)||(t.uniform4uiv(this.addr,e),copyArray(i,e))}function setValueT1(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||es,r)}function setValueT3D1(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||ns,r)}function setValueT6(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||rs,r)}function setValueT2DArray1(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||is,r)}function setValueV1fArray(t,e){t.uniform1fv(this.addr,e)}function setValueV2fArray(t,e){const i=flatten(e,this.size,2);t.uniform2fv(this.addr,i)}function setValueV3fArray(t,e){const i=flatten(e,this.size,3);t.uniform3fv(this.addr,i)}function setValueV4fArray(t,e){const i=flatten(e,this.size,4);t.uniform4fv(this.addr,i)}function setValueM2Array(t,e){const i=flatten(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(t,e){const i=flatten(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(t,e){const i=flatten(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function setValueV1iArray(t,e){t.uniform1iv(this.addr,e)}function setValueV2iArray(t,e){t.uniform2iv(this.addr,e)}function setValueV3iArray(t,e){t.uniform3iv(this.addr,e)}function setValueV4iArray(t,e){t.uniform4iv(this.addr,e)}function setValueV1uiArray(t,e){t.uniform1uiv(this.addr,e)}function setValueV2uiArray(t,e){t.uniform2uiv(this.addr,e)}function setValueV3uiArray(t,e){t.uniform3uiv(this.addr,e)}function setValueV4uiArray(t,e){t.uniform4uiv(this.addr,e)}function setValueT1Array(t,e,i){const n=e.length,r=allocTexUnits(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTexture2D(e[t]||es,r[t])}function setValueT6Array(t,e,i){const n=e.length,r=allocTexUnits(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTextureCube(e[t]||rs,r[t])}function SingleUniform(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}(e.type)}function PureArrayUniform(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}(e.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(e,t)},StructuredUniform.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const hs=/(\w+)(\])?(\[|\.)?/g;function addUniform(t,e){t.seq.push(e),t.map[e.id]=e}function parseUniform(t,e,i){const n=t.name,r=n.length;for(hs.lastIndex=0;;){const s=hs.exec(n),o=hs.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){addUniform(i,void 0===c?new SingleUniform(a,t,e):new PureArrayUniform(a,t,e));break}{let t=i.map[a];void 0===t&&addUniform(i,t=new StructuredUniform(a)),i=t}}}function WebGLUniforms(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);parseUniform(i,t.getUniformLocation(e,i.name),this)}}function WebGLShader(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}WebGLUniforms.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},WebGLUniforms.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},WebGLUniforms.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}},WebGLUniforms.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let us=0;function getEncodingComponents(t){switch(t){case Ke:return["Linear","( value )"];case Qe:return["sRGB","( value )"];case ti:return["RGBE","( value )"];case ii:return["RGBM","( value, 7.0 )"];case ni:return["RGBM","( value, 16.0 )"];case ri:return["RGBD","( value, 256.0 )"];case $e:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function getShaderErrors(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function addLineNumbers(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function getTexelDecodingFunction(t,e){const i=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(t,e){const i=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(t,e){let i;switch(e){case tt:i="Linear";break;case et:i="Reinhard";break;case it:i="OptimizedCineon";break;case nt:i="ACESFilmic";break;case rt:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ds=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(ds,includeReplacer)}function includeReplacer(t,e){const i=Gr[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return resolveIncludes(i)}const ms=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ps=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(t){return t.replace(ps,loopReplacer).replace(ms,deprecatedLoopReplacer)}function deprecatedLoopReplacer(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(t,e,i,n)}function loopReplacer(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function generatePrecision(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function WebGLProgram(t,e,i,n){const r=t.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function generateShadowMapTypeDefine(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===u?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===d?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===m&&(e="SHADOWMAP_TYPE_VSM"),e}(i),c=function generateEnvMapTypeDefine(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ot:case at:e="ENVMAP_TYPE_CUBE";break;case ht:case ut:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),h=function generateEnvMapModeDefine(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case at:case ut:e="ENVMAP_MODE_REFRACTION"}return e}(i),p=function generateEnvMapBlendingDefine(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Z:e="ENVMAP_BLENDING_MULTIPLY";break;case K:e="ENVMAP_BLENDING_MIX";break;case Q:e="ENVMAP_BLENDING_ADD"}return e}(i),f=t.gammaFactor>0?t.gammaFactor:1,_=i.isWebGL2?"":function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(i),g=function generateDefines(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),b=r.createProgram();let y,x,v=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((y=[g].filter(filterEmptyLine).join("\n")).length>0&&(y+="\n"),(x=[_,g].filter(filterEmptyLine).join("\n")).length>0&&(x+="\n")):(y=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),x=[_,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,g,"#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==$?"#define TONE_MAPPING":"",i.toneMapping!==$?Gr.tonemapping_pars_fragment:"",i.toneMapping!==$?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===kt?"#define OPAQUE":"",Gr.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularTintMap?getTexelDecodingFunction("specularTintMapTexelToLinear",i.specularTintMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),o=replaceClippingPlaneNums(o=replaceLightNums(o=resolveIncludes(o),i),i),a=replaceClippingPlaneNums(a=replaceLightNums(a=resolveIncludes(a),i),i),o=unrollLoops(o),a=unrollLoops(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(v="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,x=["#define varying in",i.glslVersion===Di?"":"out highp vec4 pc_fragColor;",i.glslVersion===Di?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const S=v+x+a,w=WebGLShader(r,35633,v+y+o),M=WebGLShader(r,35632,S);if(r.attachShader(b,w),r.attachShader(b,M),void 0!==i.index0AttributeName?r.bindAttribLocation(b,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(b,0,"position"),r.linkProgram(b),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(b).trim(),e=r.getShaderInfoLog(w).trim(),i=r.getShaderInfoLog(M).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(b,35714)){n=!1;const e=getShaderErrors(r,w,"vertex"),i=getShaderErrors(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(b,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:y},fragmentShader:{log:i,prefix:x}})}let A,V;return r.deleteShader(w),r.deleteShader(M),this.getUniforms=function(){return void 0===A&&(A=new WebGLUniforms(r,b)),A},this.getAttributes=function(){return void 0===V&&(V=function fetchAttributeLocations(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}(r,b)),V},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(b),this.program=void 0},this.name=i.shaderName,this.id=us++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=w,this.fragmentShader=M,this}function WebGLPrograms(t,e,i,n,r,s,o){const a=[],l=r.isWebGL2,c=r.logarithmicDepthBuffer,h=r.floatVertexTextures,u=r.maxVertexUniforms,d=r.vertexTextures;let m=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheen","transmission","transmissionMap","thicknessMap"];function getTextureEncodingFromMap(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ke,l&&t&&t.isTexture&&t.format===Ot&&t.type===At&&t.encoding===Qe&&(e=Ke),e}return{getParameters:function getParameters(s,a,g,b,y){const x=b.fog,v=s.isMeshStandardMaterial?b.environment:null,S=(s.isMeshStandardMaterial?i:e).get(s.envMap||v),w=p[s.type],M=y.isSkinnedMesh?function getMaxBones(t){const e=t.skeleton.bones;if(h)return 1024;{const t=u,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;let A,V;if(null!==s.precision&&(m=r.getMaxPrecision(s.precision))!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",m,"instead."),w){const t=kr[w];A=t.vertexShader,V=t.fragmentShader}else A=s.vertexShader,V=s.fragmentShader;const C=t.getRenderTarget(),T=s.alphaTest>0,B=s.clearcoat>0;return{isWebGL2:l,shaderID:w,shaderName:s.type,vertexShader:A,fragmentShader:V,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:m,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:d,outputEncoding:null!==C?getTextureEncodingFromMap(C.texture):t.outputEncoding,map:!!s.map,mapEncoding:getTextureEncodingFromMap(s.map),matcap:!!s.matcap,matcapEncoding:getTextureEncodingFromMap(s.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:getTextureEncodingFromMap(S),envMapCubeUV:!!S&&(S.mapping===ht||S.mapping===ut),lightMap:!!s.lightMap,lightMapEncoding:getTextureEncodingFromMap(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===li,tangentSpaceNormalMap:s.normalMapType===ai,clearcoat:B,clearcoatMap:B&&!!s.clearcoatMap,clearcoatRoughnessMap:B&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:B&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularTintMap:!!s.specularTintMap,specularTintMapEncoding:getTextureEncodingFromMap(s.specularTintMap),alphaMap:!!s.alphaMap,alphaTest:T,gradientMap:!!s.gradientMap,sheen:s.sheen>0,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularTintMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularTintMap||!s.displacementMap),fog:!!x,useFog:s.fog,fogExp2:x&&x.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===y.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:h,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:s.format,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&g.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:$,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===_,flipSided:s.side===f,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function getProgramCacheKey(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<g.length;t++)i.push(e[g[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function getUniforms(t){const e=p[t.type];let i;if(e){const t=kr[e];i=Vr.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function acquireProgram(e,i){let n;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===i){++(n=e).usedTimes;break}}return void 0===n&&(n=new WebGLProgram(t,i,e,s),a.push(n)),n},releaseProgram:function releaseProgram(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function WebGLProperties(){let t=new WeakMap;return{get:function get(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function remove(e){t.delete(e)},update:function update(e,i,n){t.get(e)[i]=n},dispose:function dispose(){t=new WeakMap}}}function painterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function reversePainterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function WebGLRenderList(t){const e=[];let i=0;const n=[],r=[],s=[],o={id:-1};function getNextRenderItem(n,r,s,a,l,c){let h=e[i];const u=t.get(s);return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,program:u.program||o,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},e[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.program=u.program||o,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function init(){i=0,n.length=0,r.length=0,s.length=0},push:function push(t,e,i,o,a,l){const c=getNextRenderItem(t,e,i,o,a,l);i.transmission>0?r.push(c):!0===i.transparent?s.push(c):n.push(c)},unshift:function unshift(t,e,i,o,a,l){const c=getNextRenderItem(t,e,i,o,a,l);i.transmission>0?r.unshift(c):!0===i.transparent?s.unshift(c):n.unshift(c)},finish:function finish(){for(let t=i,n=e.length;t<n;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function sort(t,e){n.length>1&&n.sort(t||painterSortStable),r.length>1&&r.sort(e||reversePainterSortStable),s.length>1&&s.sort(e||reversePainterSortStable)}}}function WebGLRenderLists(t){let e=new WeakMap;return{get:function get(i,n){let r;return!1===e.has(i)?(r=new WebGLRenderList(t),e.set(i,[r])):n>=e.get(i).length?(r=new WebGLRenderList(t),e.get(i).push(r)):r=e.get(i)[n],r},dispose:function dispose(){e=new WeakMap}}}function UniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return t[e.id]=i,i}}}let fs=0;function shadowCastingLightsFirst(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(t,e){const i=new UniformsCache,n=function ShadowUniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new Vector3);const s=new Vector3,o=new Matrix4,a=new Matrix4;return{setup:function setup(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,m=0,p=0,f=0,_=0,g=0;s.sort(shadowCastingLightsFirst);const b=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,y=e.intensity,x=e.distance,v=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*y*b,l+=o.g*y*b,c+=o.b*y*b;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=v,r.directionalShadowMatrix[h]=e.shadow.matrix,f++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(y*b),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=v,r.spotShadowMatrix[d]=e.shadow.matrix,g++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[m]=t,m++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=v,r.pointShadowMatrix[u]=e.shadow.matrix,_++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(y*b),t.groundColor.copy(e.groundColor).multiplyScalar(y*b),r.hemi[p]=t,p++}}m>0&&(e.isWebGL2?(r.rectAreaLTC1=Fr.LTC_FLOAT_1,r.rectAreaLTC2=Fr.LTC_FLOAT_2):!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Fr.LTC_FLOAT_1,r.rectAreaLTC2=Fr.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Fr.LTC_HALF_1,r.rectAreaLTC2=Fr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const y=r.hash;y.directionalLength===h&&y.pointLength===u&&y.spotLength===d&&y.rectAreaLength===m&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===_&&y.numSpotShadows===g||(r.directional.length=h,r.spot.length=d,r.rectArea.length=m,r.point.length=u,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=_,r.spotShadowMatrix.length=g,y.directionalLength=h,y.pointLength=u,y.spotLength=d,y.rectAreaLength=m,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=_,y.numSpotShadows=g,r.version=fs++)},setupView:function setupView(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),h++}}},state:r}}function WebGLRenderState(t,e){const i=new WebGLLights(t,e),n=[],r=[];return{init:function init(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function setupLights(t){i.setup(n,t)},setupLightsView:function setupLightsView(t){i.setupView(n,t)},pushLight:function pushLight(t){n.push(t)},pushShadow:function pushShadow(t){r.push(t)}}}function WebGLRenderStates(t,e){let i=new WeakMap;return{get:function get(n,r=0){let s;return!1===i.has(n)?(s=new WebGLRenderState(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new WebGLRenderState(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function dispose(){i=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=si,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;const _s="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",gs="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function WebGLShadowMap(t,e,i){let n=new Frustum;const r=new Vector2,s=new Vector2,o=new Vector4,a=new MeshDepthMaterial({depthPacking:oi}),l=new MeshDistanceMaterial,c={},h=i.maxTextureSize,d={0:f,1:p,2:_},g=new ShaderMaterial({uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4},samples:{value:8}},vertexShader:_s,fragmentShader:gs}),b=g.clone();b.defines.HORIZONTAL_PASS=1;const x=new BufferGeometry;x.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Mesh(x,g),S=this;function VSMPass(i,n){const r=e.update(v);g.uniforms.shadow_pass.value=i.map.texture,g.uniforms.resolution.value=i.mapSize,g.uniforms.radius.value=i.radius,g.uniforms.samples.value=i.blurSamples,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,g,v,null),b.uniforms.shadow_pass.value=i.mapPass.texture,b.uniforms.resolution.value=i.mapSize,b.uniforms.radius.value=i.radius,b.uniforms.samples.value=i.blurSamples,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,b,v,null)}function getDepthMaterial(e,i,n,r,s,o,h){let u=null;const p=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(u=void 0!==p?p:!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=u.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=u.clone(),i[e]=r),u=r}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=h===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=s,u.farDistance=o),u}function renderObject(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===m)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=getDepthMaterial(i,0,h,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=getDepthMaterial(i,0,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)renderObject(l[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(e,i,a){if(!1===S.enabled)return;if(!1===S.autoUpdate&&!1===S.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const p=u.getFrameExtents();if(r.multiply(p),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/p.x),r.x=s.x*p.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/p.y),r.y=s.y*p.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&this.type===m){const t={minFilter:xt,magFilter:xt,format:Ot};u.map=new WebGLRenderTarget(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.mapPass=new WebGLRenderTarget(r.x,r.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:ft,magFilter:ft,format:Ot};u.map=new WebGLRenderTarget(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const f=u.getViewportCount();for(let t=0;t<f;t++){const e=u.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),u.updateMatrices(c,t),n=u.getFrustum(),renderObject(i,a,u.camera,c,this.type)}u.isPointLightShadow||this.type!==m||VSMPass(u,a),u.needsUpdate=!1}S.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function WebGLState(t,e,i){const n=i.isWebGL2;const r=new function ColorBuffer(){let e=!1;const i=new Vector4;let n=null;const r=new Vector4(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,o,a){!0===a&&(e*=o,n*=o,s*=o),i.set(e,n,s,o),!1===r.equals(i)&&(t.clearColor(e,n,s,o),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},s=new function DepthBuffer(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?enable(2929):disable(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case z:t.depthFunc(512);break;case W:t.depthFunc(519);break;case H:t.depthFunc(513);break;case j:t.depthFunc(515);break;case J:t.depthFunc(514);break;case q:t.depthFunc(518);break;case X:t.depthFunc(516);break;case Y:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},c=new function StencilBuffer(){let e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?enable(2960):disable(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&r===i&&s===o||(t.stencilFunc(e,i,o),n=e,r=i,s=o)},setOp:function(e,i,n){o===e&&a===i&&l===n||(t.stencilOp(e,i,n),o=e,a=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let h={},u=null,d={},m=null,p=!1,g=null,b=null,v=null,Z=null,K=null,Q=null,$=null,tt=!1,et=null,it=null,nt=null,rt=null,st=null;const ot=t.getParameter(35661);let at=!1,lt=0;const ct=t.getParameter(7938);-1!==ct.indexOf("WebGL")?(lt=parseFloat(/^WebGL (\d)/.exec(ct)[1]),at=lt>=1):-1!==ct.indexOf("OpenGL ES")&&(lt=parseFloat(/^OpenGL ES (\d)/.exec(ct)[1]),at=lt>=2);let ht=null,ut={};const dt=t.getParameter(3088),mt=t.getParameter(2978),pt=(new Vector4).fromArray(dt),ft=(new Vector4).fromArray(mt);function createTexture(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return s}const _t={};function enable(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function disable(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}_t[3553]=createTexture(3553,3553,1),_t[34067]=createTexture(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),enable(2929),s.setFunc(j),setFlipSided(!1),setCullFace(a),enable(2884),setBlending(y);const gt={[V]:32774,[C]:32778,[T]:32779};if(n)gt[B]=32775,gt[P]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(gt[B]=t.MIN_EXT,gt[P]=t.MAX_EXT)}const bt={[E]:0,[L]:1,[R]:768,[D]:770,[U]:776,[O]:774,[F]:772,[I]:769,[G]:771,[N]:775,[k]:773};function setBlending(e,i,n,r,s,o,a,l){if(e!==y){if(!1===p&&(enable(3042),p=!0),e===A)s=s||i,o=o||n,a=a||r,i===b&&s===K||(t.blendEquationSeparate(gt[i],gt[s]),b=i,K=s),n===v&&r===Z&&o===Q&&a===$||(t.blendFuncSeparate(bt[n],bt[r],bt[o],bt[a]),v=n,Z=r,Q=o,$=a),g=e,tt=null;else if(e!==g||l!==tt){if(b===V&&K===V||(t.blendEquation(32774),b=V,K=V),l)switch(e){case x:t.blendFuncSeparate(1,771,1,771);break;case S:t.blendFunc(1,1);break;case w:t.blendFuncSeparate(0,0,769,771);break;case M:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case x:t.blendFuncSeparate(770,771,1,771);break;case S:t.blendFunc(770,1);break;case w:t.blendFunc(0,769);break;case M:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,Z=null,Q=null,$=null,g=e,tt=l}}else!0===p&&(disable(3042),p=!1)}function setFlipSided(e){et!==e&&(e?t.frontFace(2304):t.frontFace(2305),et=e)}function setCullFace(e){e!==o?(enable(2884),e!==it&&(e===a?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):disable(2884),it=e}function setPolygonOffset(e,i,n){e?(enable(32823),rt===i&&st===n||(t.polygonOffset(i,n),rt=i,st=n)):disable(32823)}function activeTexture(e){void 0===e&&(e=33984+ot-1),ht!==e&&(t.activeTexture(e),ht=e)}return{buffers:{color:r,depth:s,stencil:c},enable:enable,disable:disable,bindFramebuffer:function bindFramebuffer(e,i){return null===i&&null!==u&&(i=u),d[e]!==i&&(t.bindFramebuffer(e,i),d[e]=i,n&&(36009===e&&(d[36160]=i),36160===e&&(d[36009]=i)),!0)},bindXRFramebuffer:function bindXRFramebuffer(e){e!==u&&(t.bindFramebuffer(36160,e),u=e)},useProgram:function useProgram(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,e){t.side===_?disable(2884):enable(2884);let i=t.side===f;e&&(i=!i),setFlipSided(i),t.blending===x&&!1===t.transparent?setBlending(y):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const n=t.stencilWrite;c.setTest(n),n&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?enable(32926):disable(32926)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(e){e!==nt&&(at&&t.lineWidth(e),nt=e)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(3089):disable(3089)},activeTexture:activeTexture,bindTexture:function bindTexture(e,i){null===ht&&activeTexture();let n=ut[ht];void 0===n&&(n={type:void 0,texture:void 0},ut[ht]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||_t[e]),n.type=e,n.texture=i)},unbindTexture:function unbindTexture(){const e=ut[ht];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function compressedTexImage2D(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function texImage2D(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function texImage3D(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function scissor(e){!1===pt.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),pt.copy(e))},viewport:function viewport(e){!1===ft.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ft.copy(e))},reset:function reset(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},ht=null,ut={},u=null,d={},m=null,p=!1,g=null,b=null,v=null,Z=null,K=null,Q=null,$=null,tt=!1,et=null,it=null,nt=null,rt=null,st=null,pt.set(0,0,t.canvas.width,t.canvas.height),ft.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),c.reset()}}}function WebGLTextures(t,e,i,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=new WeakMap;let m,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function createCanvas(t,e){return p?new OffscreenCanvas(t,e):createElementNS("canvas")}function resizeImage(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?floorPowerOfTwo:Math.floor,s=n(r*t.width),o=n(r*t.height);void 0===m&&(m=createCanvas(s,o));const a=i?createCanvas(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function isPowerOfTwo$1(t){return isPowerOfTwo(t.width)&&isPowerOfTwo(t.height)}function textureNeedsGenerateMipmaps(t,e){return t.generateMipmaps&&e&&t.minFilter!==ft&&t.minFilter!==xt}function generateMipmap(e,i,r,s,o=1){t.generateMipmap(e),n.get(i).__maxMipLevel=Math.log2(Math.max(r,s,o))}function getInternalFormat(i,n,r,s){if(!1===a)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===n&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===n&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=s===Qe?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function filterFallback(t){return t===ft||t===_t||t===bt?9728:9729}function onTextureDispose(e){const i=e.target;i.removeEventListener("dispose",onTextureDispose),function deallocateTexture(e){const i=n.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),n.remove(e)}(i),i.isVideoTexture&&d.delete(i),o.memory.textures--}function onRenderTargetDispose(e){const i=e.target;i.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(e){const i=e.texture,r=n.get(e),s=n.get(i);if(!e)return;void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}let f=0;function setTexture2D(t,e){const r=n.get(t);if(t.isVideoTexture&&function updateVideoTexture(t){const e=o.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void uploadTexture(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function setTextureCube(e,r){const o=n.get(e);e.version>0&&o.__version!==e.version?function uploadCubeTexture(e,n,r){if(6!==n.image.length)return;initTexture(e,n),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=o||l?l?n.image[t].image:n.image[t]:resizeImage(n.image[t],!1,!0,c);const u=h[0],d=isPowerOfTwo$1(u)||a,m=s.convert(n.format),p=s.convert(n.type),f=getInternalFormat(n.internalFormat,m,p,n.encoding);let _;if(setTextureParameters(34067,n,d),o){for(let t=0;t<6;t++){_=h[t].mipmaps;for(let e=0;e<_.length;e++){const r=_[e];n.format!==Ot&&n.format!==kt?null!==m?i.compressedTexImage2D(34069+t,e,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,f,r.width,r.height,0,m,p,r.data)}}e.__maxMipLevel=_.length-1}else{_=n.mipmaps;for(let t=0;t<6;t++)if(l){i.texImage2D(34069+t,0,f,h[t].width,h[t].height,0,m,p,h[t].data);for(let e=0;e<_.length;e++){const n=_[e],r=n.image[t].image;i.texImage2D(34069+t,e+1,f,r.width,r.height,0,m,p,r.data)}}else{i.texImage2D(34069+t,0,f,m,p,h[t]);for(let e=0;e<_.length;e++){const n=_[e];i.texImage2D(34069+t,e+1,f,m,p,n.image[t])}}e.__maxMipLevel=_.length}textureNeedsGenerateMipmaps(n,d)&&generateMipmap(34067,n,u.width,u.height);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))}const _={[dt]:10497,[mt]:33071,[pt]:33648},g={[ft]:9728,[_t]:9984,[bt]:9986,[xt]:9729,[vt]:9985,[wt]:9987};function setTextureParameters(i,s,o){if(o?(t.texParameteri(i,10242,_[s.wrapS]),t.texParameteri(i,10243,_[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,_[s.wrapR]),t.texParameteri(i,10240,g[s.magFilter]),t.texParameteri(i,10241,g[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS===mt&&s.wrapT===mt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,filterFallback(s.magFilter)),t.texParameteri(i,10241,filterFallback(s.minFilter)),s.minFilter!==ft&&s.minFilter!==xt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===Et&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Lt&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function initTexture(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",onTextureDispose),e.__webglTexture=t.createTexture(),o.memory.textures++)}function uploadTexture(e,n,r){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),initTexture(e,n),i.activeTexture(33984+r),i.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function textureNeedsPowerOfTwo(t){return!a&&(t.wrapS!==mt||t.wrapT!==mt||t.minFilter!==ft&&t.minFilter!==xt)}(n)&&!1===isPowerOfTwo$1(n.image),c=resizeImage(n.image,l,!1,h),u=isPowerOfTwo$1(c)||a,d=s.convert(n.format);let m,p=s.convert(n.type),f=getInternalFormat(n.internalFormat,d,p,n.encoding);setTextureParameters(o,n,u);const _=n.mipmaps;if(n.isDepthTexture)f=6402,a?f=n.type===Et?36012:n.type===Pt?33190:n.type===Gt?35056:33189:n.type===Et&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Wt&&6402===f&&n.type!==Tt&&n.type!==Pt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Tt,p=s.convert(n.type)),n.format===Ht&&6402===f&&(f=34041,n.type!==Gt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Gt,p=s.convert(n.type))),i.texImage2D(3553,0,f,c.width,c.height,0,d,p,null);else if(n.isDataTexture)if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)m=_[t],i.texImage2D(3553,t,f,m.width,m.height,0,d,p,m.data);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,f,c.width,c.height,0,d,p,c.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=_.length;t<e;t++)m=_[t],n.format!==Ot&&n.format!==kt?null!==d?i.compressedTexImage2D(3553,t,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,f,m.width,m.height,0,d,p,m.data);e.__maxMipLevel=_.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,d,p,c.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,d,p,c.data),e.__maxMipLevel=0;else if(_.length>0&&u){for(let t=0,e=_.length;t<e;t++)m=_[t],i.texImage2D(3553,t,f,d,p,m);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,f,d,p,c),e.__maxMipLevel=0;textureNeedsGenerateMipmaps(n,u)&&generateMipmap(o,n,c.width,c.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function setupFrameBufferTexture(e,r,o,a,l){const c=s.convert(o.format),h=s.convert(o.type),u=getInternalFormat(o.internalFormat,c,h,o.encoding);32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null),i.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function setupRenderBufferStorage(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===Et?r=36012:e.type===Pt&&(r=33190));const n=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const e=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format),o=s.convert(e.type),a=getInternalFormat(e.internalFormat,r,o,e.encoding);if(n){const e=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,e,a,i.width,i.height)}else t.renderbufferStorage(36161,a,i.width,i.height)}t.bindRenderbuffer(36161,null)}function setupDepthRenderbuffer(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),setTexture2D(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Wt)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==Ht)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function getRenderTargetSamples(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let b=!1,y=!1;this.allocateTextureUnit=function allocateTextureUnit(){const t=f;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),f+=1,t},this.resetTextureUnits=function resetTextureUnits(){f=0},this.setTexture2D=setTexture2D,this.setTexture2DArray=function setTexture2DArray(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?uploadTexture(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function setTexture3D(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?uploadTexture(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=setTextureCube,this.setupRenderTarget=function setupRenderTarget(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",onRenderTargetDispose),!0!==e.isWebGLMultipleRenderTargets&&(h.__webglTexture=t.createTexture(),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,m=!0===e.isWebGLMultisampleRenderTarget,p=l.isDataTexture3D||l.isDataTexture2DArray,f=isPowerOfTwo$1(e)||a;if(!a||l.format!==kt||l.type!==Et&&l.type!==Lt||(l.format=Ot,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(m)if(a){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format),r=s.convert(l.type),o=getInternalFormat(l.internalFormat,n,r,l.encoding),a=getRenderTargetSamples(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),setupRenderBufferStorage(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){i.bindTexture(34067,h.__webglTexture),setTextureParameters(34067,l,f);for(let t=0;t<6;t++)setupFrameBufferTexture(c.__webglFramebuffer[t],e,l,36064,34069+t);textureNeedsGenerateMipmaps(l,f)&&generateMipmap(34067,l,e.width,e.height),i.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),setTextureParameters(3553,s,f),setupFrameBufferTexture(c.__webglFramebuffer,e,s,36064+r,3553),textureNeedsGenerateMipmaps(s,f)&&generateMipmap(3553,s,e.width,e.height)}i.unbindTexture()}else{let t=3553;p&&(a?t=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),i.bindTexture(t,h.__webglTexture),setTextureParameters(t,l,f),setupFrameBufferTexture(c.__webglFramebuffer,e,l,36064,t),textureNeedsGenerateMipmaps(l,f)&&generateMipmap(t,l,e.width,e.height,e.depth),i.unbindTexture()}e.depthBuffer&&setupDepthRenderbuffer(e)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){const e=isPowerOfTwo$1(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(textureNeedsGenerateMipmaps(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(e,r),generateMipmap(e,o,t.width,t.height),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function updateMultisampleRenderTarget(e){if(e.isWebGLMultisampleRenderTarget)if(a){const r=e.width,s=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024);const a=n.get(e);i.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,a.__webglFramebuffer),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function safeSetTexture2D(t,e){t&&t.isWebGLRenderTarget&&(!1===b&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),b=!0),t=t.texture),setTexture2D(t,e)},this.safeSetTextureCube=function safeSetTextureCube(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===y&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),y=!0),t=t.texture),setTextureCube(t,e)}}function WebGLUtils(t,e,i){const n=i.isWebGL2;return{convert:function convert(t){let i;if(t===At)return 5121;if(t===Rt)return 32819;if(t===It)return 32820;if(t===Dt)return 33635;if(t===Vt)return 5120;if(t===Ct)return 5122;if(t===Tt)return 5123;if(t===Bt)return 5124;if(t===Pt)return 5125;if(t===Et)return 5126;if(t===Lt)return n?5131:null!==(i=e.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(t===Ft)return 6406;if(t===kt)return 6407;if(t===Ot)return 6408;if(t===Nt)return 6409;if(t===Ut)return 6410;if(t===Wt)return 6402;if(t===Ht)return 34041;if(t===jt)return 6403;if(t===Jt)return 36244;if(t===qt)return 33319;if(t===Xt)return 33320;if(t===Yt)return 36248;if(t===Zt)return 36249;if(t===Kt||t===Qt||t===$t||t===te){if(null===(i=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Kt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Qt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===$t)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===te)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===ee||t===ie||t===ne||t===re){if(null===(i=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===ee)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ie)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ne)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===re)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===se)return null!==(i=e.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===oe||t===ae)&&null!==(i=e.get("WEBGL_compressed_texture_etc"))){if(t===oe)return i.COMPRESSED_RGB8_ETC2;if(t===ae)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===le||t===ce||t===he||t===ue||t===de||t===me||t===pe||t===fe||t===_e||t===ge||t===be||t===ye||t===xe||t===ve||t===we||t===Me||t===Ae||t===Ve||t===Ce||t===Te||t===Be||t===Pe||t===Ee||t===Le||t===Re||t===Ie||t===De||t===Ge?null!==(i=e.get("WEBGL_compressed_texture_astc"))?t:null:t===Se?null!==(i=e.get("EXT_texture_compression_bptc"))?t:null:t===Gt?n?34042:null!==(i=e.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.cameras=t}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}Group.prototype.isGroup=!0;const bs={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&null!==(n=e.getPose(t.targetRaySpace,i))&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(bs)),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,i))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1);return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class WebXRManager extends EventDispatcher{constructor(t,e){super();const i=this,n=t.state;let r=null,s=1,o=null,a="local-floor",l=null,c=null,h=null,u=null,d=null,m=!1,p=null,f=null,_=null,g=null,b=null,y=null;const x=[],v=new Map,S=new PerspectiveCamera;S.layers.enable(1),S.viewport=new Vector4;const w=new PerspectiveCamera;w.layers.enable(2),w.viewport=new Vector4;const M=[S,w],A=new ArrayCamera;A.layers.enable(1),A.layers.enable(2);let V=null,C=null;function onSessionEvent(t){const e=v.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function onSessionEnd(){v.forEach(function(t,e){t.disconnect(e)}),v.clear(),V=null,C=null,n.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),h&&e.deleteFramebuffer(h),p&&e.deleteFramebuffer(p),f&&e.deleteRenderbuffer(f),_&&e.deleteRenderbuffer(_),h=null,p=null,f=null,_=null,d=null,u=null,c=null,r=null,E.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function onInputSourcesChange(t){const e=r.inputSources;for(let t=0;t<x.length;t++)v.set(e[t],x[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=v.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),v.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=v.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=x[t];return void 0===e&&(e=new WebXRController,x[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=x[t];return void 0===e&&(e=new WebXRController,x[t]=e),e.getGripSpace()},this.getHand=function(t){let e=x[t];return void 0===e&&(e=new WebXRController,x[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(t){if(null!==(r=t)){r.addEventListener("select",onSessionEvent),r.addEventListener("selectstart",onSessionEvent),r.addEventListener("selectend",onSessionEvent),r.addEventListener("squeeze",onSessionEvent),r.addEventListener("squeezestart",onSessionEvent),r.addEventListener("squeezeend",onSessionEvent),r.addEventListener("end",onSessionEnd),r.addEventListener("inputsourceschange",onInputSourcesChange);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers){const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,e,i),r.updateRenderState({baseLayer:d})}else if(e instanceof WebGLRenderingContext){const i={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,e,i),r.updateRenderState({layers:[d]})}else{m=t.antialias;let i=null;t.depth&&(y=256,t.stencil&&(y|=1024),b=t.stencil?33306:36096,i=t.stencil?35056:33190);const o={colorFormat:t.alpha?32856:32849,depthFormat:i,scaleFactor:s};c=new XRWebGLBinding(r,e),u=c.createProjectionLayer(o),h=e.createFramebuffer(),r.updateRenderState({layers:[u]}),m&&(p=e.createFramebuffer(),f=e.createRenderbuffer(),e.bindRenderbuffer(36161,f),e.renderbufferStorageMultisample(36161,4,32856,u.textureWidth,u.textureHeight),n.bindFramebuffer(36160,p),e.framebufferRenderbuffer(36160,36064,36161,f),e.bindRenderbuffer(36161,null),null!==i&&(_=e.createRenderbuffer(),e.bindRenderbuffer(36161,_),e.renderbufferStorageMultisample(36161,4,i,u.textureWidth,u.textureHeight),e.framebufferRenderbuffer(36160,b,36161,_),e.bindRenderbuffer(36161,null)),n.bindFramebuffer(36160,null))}o=await r.requestReferenceSpace(a),E.setContext(r),E.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const T=new Vector3,B=new Vector3;function updateCamera(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;A.near=w.near=S.near=t.near,A.far=w.far=S.far=t.far,V===A.near&&C===A.far||(r.updateRenderState({depthNear:A.near,depthFar:A.far}),V=A.near,C=A.far);const e=t.parent,i=A.cameras;updateCamera(A,e);for(let t=0;t<i.length;t++)updateCamera(i[t],e);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),t.position.copy(A.position),t.quaternion.copy(A.quaternion),t.scale.copy(A.scale),t.matrix.copy(A.matrix),t.matrixWorld.copy(A.matrixWorld);const n=t.children;for(let t=0,e=n.length;t<e;t++)n[t].updateMatrixWorld(!0);2===i.length?function setProjectionFromUnion(t,e,i){T.setFromMatrixPosition(e.matrixWorld),B.setFromMatrixPosition(i.matrixWorld);const n=T.distanceTo(B),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,m=o*u,p=n/(-h+u),f=p*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const _=o+p,g=a+p,b=d-f,y=m+(n-f),x=l*a/g*_,v=c*a/g*_;t.projectionMatrix.makePerspective(b,y,x,v,_,g)}(A,S,w):A.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(t){null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let P=null;const E=new WebGLAnimation;E.setAnimationLoop(function onAnimationFrame(t,i){if(l=i.getViewerPose(o),g=i,null!==l){const t=l.views;null!==d&&n.bindXRFramebuffer(d.framebuffer);let i=!1;t.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(let r=0;r<t.length;r++){const s=t[r];let o=null;if(null!==d)o=d.getViewport(s);else{const t=c.getViewSubImage(u,s);n.bindXRFramebuffer(h),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,b,3553,t.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),o=t.viewport}const a=M[r];a.matrix.fromArray(s.transform.matrix),a.projectionMatrix.fromArray(s.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&A.matrix.copy(a.matrix),!0===i&&A.cameras.push(a)}m&&(n.bindXRFramebuffer(p),null!==y&&e.clear(y))}const s=r.inputSources;for(let t=0;t<x.length;t++){const e=x[t],n=s[t];e.update(n,i,o)}if(P&&P(t,i),m){const t=u.textureWidth,i=u.textureHeight;n.bindFramebuffer(36008,p),n.bindFramebuffer(36009,h),e.invalidateFramebuffer(36008,[b]),e.invalidateFramebuffer(36009,[b]),e.blitFramebuffer(0,0,t,i,0,0,t,i,16384,9728),e.invalidateFramebuffer(36008,[36064]),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),n.bindFramebuffer(36160,p)}g=null}),this.setAnimationLoop=function(t){P=t},this.dispose=function(){}}}function WebGLMaterials(t){function refreshUniformsCommon(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio;const r=t.get(n).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,s;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularTintMap?r=i.specularTintMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap&&(r=i.thicknessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function refreshUniformsStandard(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,i.side===f&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),i.side===f&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function refreshFogUniforms(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function refreshMaterialUniforms(t,e,i,n,r){e.isMeshBasicMaterial?refreshUniformsCommon(t,e):e.isMeshLambertMaterial?(refreshUniformsCommon(t,e),function refreshUniformsLambert(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,e)):e.isMeshToonMaterial?(refreshUniformsCommon(t,e),function refreshUniformsToon(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshPhongMaterial?(refreshUniformsCommon(t,e),function refreshUniformsPhong(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshStandardMaterial?(refreshUniformsCommon(t,e),e.isMeshPhysicalMaterial?function refreshUniformsPhysical(t,e,i){refreshUniformsStandard(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenTint.value.copy(e.sheenTint).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===f&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationTint.value.copy(e.attenuationTint)),t.specularIntensity.value=e.specularIntensity,t.specularTint.value.copy(e.specularTint),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularTintMap&&(t.specularTintMap.value=e.specularTintMap)}(t,e,r):refreshUniformsStandard(t,e)):e.isMeshMatcapMaterial?(refreshUniformsCommon(t,e),function refreshUniformsMatcap(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshDepthMaterial?(refreshUniformsCommon(t,e),function refreshUniformsDepth(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshDistanceMaterial?(refreshUniformsCommon(t,e),function refreshUniformsDistance(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,e)):e.isMeshNormalMaterial?(refreshUniformsCommon(t,e),function refreshUniformsNormal(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===f&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===f&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isLineBasicMaterial?(function refreshUniformsLine(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,e),e.isLineDashedMaterial&&function refreshUniformsDash(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,e)):e.isPointsMaterial?function refreshUniformsPoints(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,e,i,n):e.isSpriteMaterial?function refreshUniformsSprites(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,e):e.isShadowMaterial?(t.color.value.copy(e.color),t.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}}}function WebGLRenderer(t={}){const e=void 0!==t.canvas?t.canvas:function createCanvasElement(){const t=createElementNS("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,d=null;const m=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ke,this.physicallyCorrectLights=!1,this.toneMapping=$,this.toneMappingExposure=1;const b=this;let y=!1,x=0,v=0,S=null,w=-1,M=null;const A=new Vector4,V=new Vector4;let C=null,T=e.width,B=e.height,P=1,E=null,L=null;const R=new Vector4(0,0,T,B),I=new Vector4(0,0,T,B);let D=!1;const G=[],F=new Frustum;let k=!1,O=!1,N=null;const U=new Matrix4,z=new Vector3,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function getTargetPixelRatio(){return null===S?P:1}let H,j,J,q,X,Y,Z,K,Q,tt,et,it,nt,rt,st,ot,at,lt,ct,ht,ut,dt,pt,_t=i;function getContext(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:n,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",onContextLost,!1),e.addEventListener("webglcontextrestored",onContextRestore,!1),null===_t){const e=["webgl2","webgl","experimental-webgl"];if(!0===b.isWebGL1Renderer&&e.shift(),null===(_t=getContext(e,t)))throw getContext(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_t.getShaderPrecisionFormat&&(_t.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function initGLContext(){H=new WebGLExtensions(_t),j=new WebGLCapabilities(_t,H,t),H.init(j),dt=new WebGLUtils(_t,H,j),J=new WebGLState(_t,H,j),G[0]=1029,q=new WebGLInfo(_t),X=new WebGLProperties,Y=new WebGLTextures(_t,H,J,X,j,dt,q),Z=new WebGLCubeMaps(b),K=new WebGLCubeUVMaps(b),Q=new WebGLAttributes(_t,j),pt=new WebGLBindingStates(_t,H,Q,j),tt=new WebGLGeometries(_t,Q,q,pt),et=new WebGLObjects(_t,tt,Q,q),ct=new WebGLMorphtargets(_t,j,Y),ot=new WebGLClipping(X),it=new WebGLPrograms(b,Z,K,H,j,pt,ot),nt=new WebGLMaterials(X),rt=new WebGLRenderLists(X),st=new WebGLRenderStates(H,j),lt=new WebGLBackground(b,Z,J,et,a),at=new WebGLShadowMap(b,et,j),ht=new WebGLBufferRenderer(_t,H,q,j),ut=new WebGLIndexedBufferRenderer(_t,H,q,j),q.programs=it.programs,b.capabilities=j,b.extensions=H,b.properties=X,b.renderLists=rt,b.shadowMap=at,b.state=J,b.info=q}initGLContext();const gt=new WebXRManager(b,_t);function onContextLost(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const t=q.autoReset,e=at.enabled,i=at.autoUpdate,n=at.needsUpdate,r=at.type;initGLContext(),q.autoReset=t,at.enabled=e,at.autoUpdate=i,at.needsUpdate=n,at.type=r}function onMaterialDispose(t){const e=t.target;e.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(t){(function releaseMaterialProgramReferences(t){const e=X.get(t).programs;void 0!==e&&e.forEach(function(t){it.releaseProgram(t)})})(t),X.remove(t)}(e)}this.xr=gt,this.getContext=function(){return _t},this.getContextAttributes=function(){return _t.getContextAttributes()},this.forceContextLoss=function(){const t=H.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=H.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(t){void 0!==t&&(P=t,this.setSize(T,B,!1))},this.getSize=function(t){return t.set(T,B)},this.setSize=function(t,i,n){gt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,B=i,e.width=Math.floor(t*P),e.height=Math.floor(i*P),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(T*P,B*P).floor()},this.setDrawingBufferSize=function(t,i,n){T=t,B=i,P=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(R)},this.setViewport=function(t,e,i,n){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,i,n),J.viewport(A.copy(R).multiplyScalar(P).floor())},this.getScissor=function(t){return t.copy(I)},this.setScissor=function(t,e,i,n){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,i,n),J.scissor(V.copy(I).multiplyScalar(P).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(t){J.setScissorTest(D=t)},this.setOpaqueSort=function(t){E=t},this.setTransparentSort=function(t){L=t},this.getClearColor=function(t){return t.copy(lt.getClearColor())},this.setClearColor=function(){lt.setClearColor.apply(lt,arguments)},this.getClearAlpha=function(){return lt.getClearAlpha()},this.setClearAlpha=function(){lt.setClearAlpha.apply(lt,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),_t.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",onContextLost,!1),e.removeEventListener("webglcontextrestored",onContextRestore,!1),rt.dispose(),st.dispose(),X.dispose(),Z.dispose(),K.dispose(),et.dispose(),pt.dispose(),gt.dispose(),gt.removeEventListener("sessionstart",onXRSessionStart),gt.removeEventListener("sessionend",onXRSessionEnd),N&&(N.dispose(),N=null),yt.stop()},this.renderBufferImmediate=function(t,e){pt.initAttributes();const i=X.get(t);t.hasPositions&&!i.position&&(i.position=_t.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=_t.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=_t.createBuffer()),t.hasColors&&!i.color&&(i.color=_t.createBuffer());const n=e.getAttributes();t.hasPositions&&(_t.bindBuffer(34962,i.position),_t.bufferData(34962,t.positionArray,35048),pt.enableAttribute(n.position.location),_t.vertexAttribPointer(n.position.location,3,5126,!1,0,0)),t.hasNormals&&(_t.bindBuffer(34962,i.normal),_t.bufferData(34962,t.normalArray,35048),pt.enableAttribute(n.normal.location),_t.vertexAttribPointer(n.normal.location,3,5126,!1,0,0)),t.hasUvs&&(_t.bindBuffer(34962,i.uv),_t.bufferData(34962,t.uvArray,35048),pt.enableAttribute(n.uv.location),_t.vertexAttribPointer(n.uv.location,2,5126,!1,0,0)),t.hasColors&&(_t.bindBuffer(34962,i.color),_t.bufferData(34962,t.colorArray,35048),pt.enableAttribute(n.color.location),_t.vertexAttribPointer(n.color.location,3,5126,!1,0,0)),pt.disableUnusedAttributes(),_t.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=W);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=setProgram(t,e,i,n,r);J.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=tt.getWireframeAttribute(i),u=2),pt.setup(r,n,a,i,l);let d=ht;null!==l&&(h=Q.get(l),(d=ut).setIndex(h));const m=null!==l?l.count:c.count,p=i.drawRange.start*u,f=i.drawRange.count*u,_=null!==s?s.start*u:0,g=null!==s?s.count*u:1/0,b=Math.max(p,_),y=Math.min(m,p+f,_+g)-1,x=Math.max(0,y-b+1);if(0!==x){if(r.isMesh)!0===n.wireframe?(J.setLineWidth(n.wireframeLinewidth*getTargetPixelRatio()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),J.setLineWidth(t*getTargetPixelRatio()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(b,x,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(b,x,t)}else d.render(b,x)}},this.compile=function(t,e){(d=st.get(t)).init(),g.push(d),t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))}),d.setupLights(b.physicallyCorrectLights),t.traverse(function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){getProgram(i[n],t,e)}else getProgram(i,t,e)}),g.pop(),d=null};let bt=null;function onXRSessionStart(){yt.stop()}function onXRSessionEnd(){yt.start()}const yt=new WebGLAnimation;function renderScene(t,e,i,n){const r=t.opaque,s=t.transmissive,a=t.transparent;d.setupLightsView(i),s.length>0&&function renderTransmissionPass(t,e,i){if(null===N){const t=!0===o&&!0===j.isWebGL2,e=t?WebGLMultisampleRenderTarget:WebGLRenderTarget;N=new e(1024,1024,{generateMipmaps:!0,type:null!==dt.convert(Lt)?Lt:At,minFilter:wt,magFilter:ft,wrapS:mt,wrapT:mt})}const n=b.getRenderTarget();b.setRenderTarget(N),b.clear();const r=b.toneMapping;b.toneMapping=$,renderObjects(t,e,i),b.toneMapping=r,Y.updateMultisampleRenderTarget(N),Y.updateRenderTargetMipmap(N),b.setRenderTarget(n)}(r,e,i),n&&J.viewport(A.copy(n)),r.length>0&&renderObjects(r,e,i),s.length>0&&renderObjects(s,e,i),a.length>0&&renderObjects(a,e,i)}function renderObjects(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;o.layers.test(i.layers)&&renderObject(o,e,i,a,l,c)}}function renderObject(t,e,i,n,r,s){if(t.onBeforeRender(b,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(b,e,i,n,t,s),t.isImmediateRenderObject){const s=setProgram(i,e,n,r,t);J.setMaterial(r),pt.reset(),function renderObjectImmediate(t,e){t.render(function(t){b.renderBufferImmediate(t,e)})}(t,s)}else!0===r.transparent&&r.side===_?(r.side=f,r.needsUpdate=!0,b.renderBufferDirect(i,e,n,r,t,s),r.side=p,r.needsUpdate=!0,b.renderBufferDirect(i,e,n,r,t,s),r.side=_):b.renderBufferDirect(i,e,n,r,t,s);t.onAfterRender(b,e,i,n,r,s)}function getProgram(t,e,i){!0!==e.isScene&&(e=W);const n=X.get(t),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=it.getParameters(t,r.state,s,e,i),l=it.getProgramCacheKey(a);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?K:Z).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",onMaterialDispose),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return updateCommonMaterialProperties(t,a),h}else a.uniforms=it.getUniforms(t),t.onBuild(a,b),t.onBeforeCompile(a,b),h=it.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ot.uniform),updateCommonMaterialProperties(t,a),n.needsLights=function materialNeedsLights(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=h.getUniforms(),p=WebGLUniforms.seqWithValue(m.seq,u);return n.currentProgram=h,n.uniformsList=p,h}function updateCommonMaterialProperties(t,e){const i=X.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents}function setProgram(t,e,i,n,r){!0!==e.isScene&&(e=W),Y.resetTextureUnits();const s=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===S?b.outputEncoding:S.texture.encoding,l=(n.isMeshStandardMaterial?K:Z).get(n.envMap||o),c=!0===n.vertexColors&&!!i&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i&&!!i.attributes.tangent,u=!!i&&!!i.morphAttributes.position,m=!!i&&!!i.morphAttributes.normal,p=i&&i.morphAttributes.position?i.morphAttributes.position.length:0,f=X.get(n),_=d.state.lights;if(!0===k&&(!0===O||t!==M)){const e=t===M&&n.id===w;ot.setState(n,t,e)}let g=!1;n.version===f.__version?f.needsLights&&f.lightsStateVersion!==_.state.version?g=!0:f.outputEncoding!==a?g=!0:r.isInstancedMesh&&!1===f.instancing?g=!0:r.isInstancedMesh||!0!==f.instancing?r.isSkinnedMesh&&!1===f.skinning?g=!0:r.isSkinnedMesh||!0!==f.skinning?f.envMap!==l?g=!0:n.fog&&f.fog!==s?g=!0:void 0===f.numClippingPlanes||f.numClippingPlanes===ot.numPlanes&&f.numIntersection===ot.numIntersection?f.vertexAlphas!==c?g=!0:f.vertexTangents!==h?g=!0:f.morphTargets!==u?g=!0:f.morphNormals!==m?g=!0:!0===j.isWebGL2&&f.morphTargetsCount!==p&&(g=!0):g=!0:g=!0:g=!0:(g=!0,f.__version=n.version);let y=f.currentProgram;!0===g&&(y=getProgram(n,e,r));let x=!1,v=!1,A=!1;const V=y.getUniforms(),C=f.uniforms;if(J.useProgram(y.program)&&(x=!0,v=!0,A=!0),n.id!==w&&(w=n.id,v=!0),x||M!==t){if(V.setValue(_t,"projectionMatrix",t.projectionMatrix),j.logarithmicDepthBuffer&&V.setValue(_t,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,v=!0,A=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=V.map.cameraPosition;void 0!==e&&e.setValue(_t,z.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&V.setValue(_t,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&V.setValue(_t,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){V.setOptional(_t,r,"bindMatrix"),V.setOptional(_t,r,"bindMatrixInverse");const t=r.skeleton;t&&(j.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),V.setValue(_t,"boneTexture",t.boneTexture,Y),V.setValue(_t,"boneTextureSize",t.boneTextureSize)):V.setOptional(_t,t,"boneMatrices"))}return!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||ct.update(r,i,n,y),(v||f.receiveShadow!==r.receiveShadow)&&(f.receiveShadow=r.receiveShadow,V.setValue(_t,"receiveShadow",r.receiveShadow)),v&&(V.setValue(_t,"toneMappingExposure",b.toneMappingExposure),f.needsLights&&function markUniformsLightsNeedsUpdate(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(C,A),s&&n.fog&&nt.refreshFogUniforms(C,s),nt.refreshMaterialUniforms(C,n,P,B,N),WebGLUniforms.upload(_t,f.uniformsList,C,Y)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(WebGLUniforms.upload(_t,f.uniformsList,C,Y),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&V.setValue(_t,"center",r.center),V.setValue(_t,"modelViewMatrix",r.modelViewMatrix),V.setValue(_t,"normalMatrix",r.normalMatrix),V.setValue(_t,"modelMatrix",r.matrixWorld),y}yt.setAnimationLoop(function onAnimationFrame(t){bt&&bt(t)}),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){bt=t,gt.setAnimationLoop(t),null===t?yt.stop():yt.start()},gt.addEventListener("sessionstart",onXRSessionStart),gt.addEventListener("sessionend",onXRSessionEnd),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===gt.enabled&&!0===gt.isPresenting&&(!0===gt.cameraAutoUpdate&&gt.updateCamera(e),e=gt.getCamera()),!0===t.isScene&&t.onBeforeRender(b,t,e,S),(d=st.get(t,g.length)).init(),g.push(d),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),F.setFromProjectionMatrix(U),O=this.localClippingEnabled,k=ot.init(this.clippingPlanes,O,e),(u=rt.get(t,m.length)).init(),m.push(u),function projectObject(t,e,i,n){if(!1===t.visible)return;const r=t.layers.test(e.layers);if(r)if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||F.intersectsSprite(t)){n&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=et.update(t),r=t.material;r.visible&&u.push(t,e,r,i,z.z,null)}}else if(t.isImmediateRenderObject)n&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U),u.push(t,null,t.material,i,z.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==q.render.frame&&(t.skeleton.update(),t.skeleton.frame=q.render.frame),!t.frustumCulled||F.intersectsObject(t))){n&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=et.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&u.push(t,e,a,i,z.z,o)}}else r.visible&&u.push(t,e,r,i,z.z,null)}const s=t.children;for(let t=0,r=s.length;t<r;t++)projectObject(s[t],e,i,n)}(t,e,0,b.sortObjects),u.finish(),!0===b.sortObjects&&u.sort(E,L),!0===k&&ot.beginShadows();const i=d.state.shadowsArray;if(at.render(i,t,e),!0===k&&ot.endShadows(),!0===this.info.autoReset&&this.info.reset(),lt.render(u,t),d.setupLights(b.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];renderScene(u,t,n,n.viewport)}}else renderScene(u,t,e);null!==S&&(Y.updateMultisampleRenderTarget(S),Y.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(b,t,e),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1),pt.resetDefaultState(),w=-1,M=null,g.pop(),d=g.length>0?g[g.length-1]:null,m.pop(),u=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return S},this.setRenderTarget=function(t,e=0,i=0){S=t,x=e,v=i,t&&void 0===X.get(t).__webglFramebuffer&&Y.setupRenderTarget(t);let n=null,r=!1,s=!1;if(t){const i=t.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(s=!0);const o=X.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=o[e],r=!0):n=t.isWebGLMultisampleRenderTarget?X.get(t).__webglMultisampledFramebuffer:o,A.copy(t.viewport),V.copy(t.scissor),C=t.scissorTest}else A.copy(R).multiplyScalar(P).floor(),V.copy(I).multiplyScalar(P).floor(),C=D;if(J.bindFramebuffer(36160,n)&&j.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const i=t.texture;if(G.length!==i.length||36064!==G[0]){for(let t=0,e=i.length;t<e;t++)G[t]=36064+t;G.length=i.length,e=!0}}else 1===G.length&&36064===G[0]||(G[0]=36064,G.length=1,e=!0);else 1===G.length&&1029===G[0]||(G[0]=1029,G.length=1,e=!0);e&&(j.isWebGL2?_t.drawBuffers(G):H.get("WEBGL_draw_buffers").drawBuffersWEBGL(G))}if(J.viewport(A),J.scissor(V),J.setScissorTest(C),r){const n=X.get(t.texture);_t.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(s){const n=X.get(t.texture),r=e||0;_t.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}w=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=X.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){J.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==Ot&&dt.convert(a)!==_t.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Lt&&(H.has("EXT_color_buffer_half_float")||j.isWebGL2&&H.has("EXT_color_buffer_float"));if(!(l===At||dt.convert(l)===_t.getParameter(35738)||l===Et&&(j.isWebGL2||H.has("OES_texture_float")||H.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===_t.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&_t.readPixels(e,i,n,r,dt.convert(a),dt.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==S?X.get(S).__webglFramebuffer:null;J.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);let o=dt.convert(e.format);j.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),Y.setTexture2D(e,0),_t.copyTexImage2D(3553,i,o,t.x,t.y,r,s,0),J.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,o=dt.convert(i.format),a=dt.convert(i.type);Y.setTexture2D(i,0),_t.pixelStorei(37440,i.flipY),_t.pixelStorei(37441,i.premultiplyAlpha),_t.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?_t.texSubImage2D(3553,n,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?_t.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):_t.texSubImage2D(3553,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&_t.generateMipmap(3553),J.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(b.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=dt.convert(n.format),c=dt.convert(n.type);let h;if(n.isDataTexture3D)Y.setTexture3D(n,0),h=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(n,0),h=35866}_t.pixelStorei(37440,n.flipY),_t.pixelStorei(37441,n.premultiplyAlpha),_t.pixelStorei(3317,n.unpackAlignment);const u=_t.getParameter(3314),d=_t.getParameter(32878),m=_t.getParameter(3316),p=_t.getParameter(3315),f=_t.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;_t.pixelStorei(3314,_.width),_t.pixelStorei(32878,_.height),_t.pixelStorei(3316,t.min.x),_t.pixelStorei(3315,t.min.y),_t.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?_t.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_t.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,_.data)):_t.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,_),_t.pixelStorei(3314,u),_t.pixelStorei(32878,d),_t.pixelStorei(3316,m),_t.pixelStorei(3315,p),_t.pixelStorei(32877,f),0===r&&n.generateMipmaps&&_t.generateMipmap(h),J.unbindTexture()},this.initTexture=function(t){Y.setTexture2D(t,0),J.unbindTexture()},this.resetState=function(){x=0,v=0,S=null,J.reset(),pt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(t,e=25e-5){this.name="",this.color=new Color(t),this.density=e}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}FogExp2.prototype.isFogExp2=!0;class Fog{constructor(t,e=1,i=1e3){this.name="",this.color=new Color(t),this.near=e,this.far=i}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Ai,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const ys=new Vector3;class InterleavedBufferAttribute{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ys.x=this.getX(e),ys.y=this.getY(e),ys.z=this.getZ(e),ys.applyMatrix4(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ys.x=this.getX(e),ys.y=this.getY(e),ys.z=this.getZ(e),ys.applyNormalMatrix(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ys.x=this.getX(e),ys.y=this.getY(e),ys.z=this.getZ(e),ys.transformDirection(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends Material{constructor(t){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let xs;SpriteMaterial.prototype.isSpriteMaterial=!0;const vs=new Vector3,Ss=new Vector3,ws=new Vector3,Ms=new Vector2,As=new Vector2,Vs=new Matrix4,Cs=new Vector3,Ts=new Vector3,Bs=new Vector3,Ps=new Vector2,Es=new Vector2,Ls=new Vector2;class Sprite extends Object3D{constructor(t){if(super(),this.type="Sprite",void 0===xs){xs=new BufferGeometry;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new InterleavedBuffer(t,5);xs.setIndex([0,1,2,0,2,3]),xs.setAttribute("position",new InterleavedBufferAttribute(e,3,0,!1)),xs.setAttribute("uv",new InterleavedBufferAttribute(e,2,3,!1))}this.geometry=xs,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ss.setFromMatrixScale(this.matrixWorld),Vs.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ws.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ss.multiplyScalar(-ws.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;transformVertex(Cs.set(-.5,-.5,0),ws,s,Ss,n,r),transformVertex(Ts.set(.5,-.5,0),ws,s,Ss,n,r),transformVertex(Bs.set(.5,.5,0),ws,s,Ss,n,r),Ps.set(0,0),Es.set(1,0),Ls.set(1,1);let o=t.ray.intersectTriangle(Cs,Ts,Bs,!1,vs);if(null===o&&(transformVertex(Ts.set(-.5,.5,0),ws,s,Ss,n,r),Es.set(0,1),null===(o=t.ray.intersectTriangle(Cs,Bs,Ts,!1,vs))))return;const a=t.ray.origin.distanceTo(vs);a<t.near||a>t.far||e.push({distance:a,point:vs.clone(),uv:Triangle.getUV(vs,Cs,Ts,Bs,Ps,Es,Ls,new Vector2),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function transformVertex(t,e,i,n,r,s){Ms.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(As.x=s*Ms.x-r*Ms.y,As.y=r*Ms.x+s*Ms.y):As.copy(Ms),t.copy(e),t.x+=As.x,t.y+=As.y,t.applyMatrix4(Vs)}Sprite.prototype.isSprite=!0;const Rs=new Vector3,Is=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){Rs.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Rs);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Rs.setFromMatrixPosition(t.matrixWorld),Is.setFromMatrixPosition(this.matrixWorld);const i=Rs.distanceTo(Is)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Ds=new Vector3,Gs=new Vector4,Fs=new Vector4,ks=new Vector3,Os=new Matrix4;class SkinnedMesh extends Mesh{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Gs.fromBufferAttribute(n.attributes.skinIndex,t),Fs.fromBufferAttribute(n.attributes.skinWeight,t),Ds.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Fs.getComponent(t);if(0!==n){const r=Gs.getComponent(t);Os.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(ks.copy(Ds).applyMatrix4(Os),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;class DataTexture extends Texture{constructor(t=null,e=1,i=1,n,r,s,o,a,l=ft,c=ft,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={data:t,width:e,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const Ns=new Matrix4,Us=new Matrix4;class Skeleton{constructor(t=[],e=[]){this.uuid=generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Matrix4;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Us;Ns.multiplyMatrices(r,e[n]),Ns.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=ceilPowerOfTwo(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new DataTexture(e,t,t,Ot,Et);return this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Bone),this.bones.push(r),this.boneInverses.push((new Matrix4).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class InstancedBufferAttribute extends BufferAttribute{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;const zs=new Matrix4,Ws=new Matrix4,Hs=[],js=new Mesh;class InstancedMesh extends Mesh{constructor(t,e,i){super(t,e),this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(js.geometry=this.geometry,js.material=this.material,void 0!==js.material)for(let r=0;r<n;r++){this.getMatrixAt(r,zs),Ws.multiplyMatrices(i,zs),js.matrixWorld=Ws,js.raycast(t,Hs);for(let t=0,i=Hs.length;t<i;t++){const i=Hs[t];i.instanceId=r,i.object=this,e.push(i)}Hs.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}InstancedMesh.prototype.isInstancedMesh=!0;class LineBasicMaterial extends Material{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const Js=new Vector3,qs=new Vector3,Xs=new Matrix4,Ys=new Ray,Zs=new Sphere;class Line extends Object3D{constructor(t=new BufferGeometry,e=new LineBasicMaterial){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Js.fromBufferAttribute(e,t-1),qs.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Js.distanceTo(qs);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Zs.copy(i.boundingSphere),Zs.applyMatrix4(n),Zs.radius+=r,!1===t.ray.intersectsSphere(Zs))return;Xs.copy(n).invert(),Ys.copy(t.ray).applyMatrix4(Xs);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);if(l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o),Ys.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1),Ys.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const Ks=new Vector3,Qs=new Vector3;class LineSegments extends Line{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Ks.fromBufferAttribute(e,t),Qs.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Ks.distanceTo(Qs);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(t,e){super(t,e),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material{constructor(t){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}PointsMaterial.prototype.isPointsMaterial=!0;const $s=new Matrix4,to=new Ray,eo=new Sphere,io=new Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,e=new PointsMaterial){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),eo.copy(i.boundingSphere),eo.applyMatrix4(n),eo.radius+=r,!1===t.ray.intersectsSphere(eo))return;$s.copy(n).invert(),to.copy(t.ray).applyMatrix4($s);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);io.fromBufferAttribute(o,s),testPoint(io,s,a,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)io.fromBufferAttribute(o,i),testPoint(io,i,a,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function testPoint(t,e,i,n,r,s,o){const a=to.distanceSqToPoint(t);if(a<i){const i=new Vector3;to.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}Points.prototype.isPoints=!0;class VideoTexture extends Texture{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.format=void 0!==o?o:kt,this.minFilter=void 0!==s?s:xt,this.magFilter=void 0!==r?r:xt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function updateVideo(){c.needsUpdate=!0,t.requestVideoFrameCallback(updateVideo)})}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(t,e,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(t,e,i,n,r,s,o,a,l){super(t,e,i,n,r,s,o,a,l),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(t,e,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:Wt)!==Wt&&c!==Ht)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Wt&&(i=Tt),void 0===i&&c===Ht&&(i=Gt),super(null,n,r,s,o,a,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:ft,this.minFilter=void 0!==a?a:ft,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CircleGeometry extends BufferGeometry{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],o=[],a=[],l=new Vector3,c=new Vector2;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}static fromJSON(t){return new CircleGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let m=0;const p=[],f=i/2;let _=0;function generateCap(i){const r=m,s=new Vector2,p=new Vector3;let g=0;const b=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,f*y,0),u.push(0,y,0),d.push(.5,.5),m++;const x=m;for(let t=0;t<=n;t++){const e=t/n*a+o,i=Math.cos(e),r=Math.sin(e);p.x=b*r,p.y=f*y,p.z=b*i,h.push(p.x,p.y,p.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),m++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),g+=3}l.addGroup(_,g,!0===i?1:2),_+=g}!function generateTorso(){const s=new Vector3,g=new Vector3;let b=0;const y=(e-t)/i;for(let l=0;l<=r;l++){const c=[],_=l/r,b=_*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*a+o,l=Math.sin(r),p=Math.cos(r);g.x=b*l,g.y=-_*i+f,g.z=b*p,h.push(g.x,g.y,g.z),s.set(l,y,p).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-_),c.push(m++)}p.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=p[e][t],n=p[e+1][t],r=p[e+1][t+1],s=p[e][t+1];c.push(i,n,s),c.push(n,r,s),b+=6}l.addGroup(_,b,0),_+=b}(),!1===s&&(t>0&&generateCap(!0),e>0&&generateCap(!1)),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new ConeGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function subdivideFace(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=t.clone().lerp(i,n/r),a=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?o:o.clone().lerp(a,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(pushVertex(s[t][i+1]),pushVertex(s[t+1][i]),pushVertex(s[t][i])):(pushVertex(s[t][i+1]),pushVertex(s[t+1][i+1]),pushVertex(s[t+1][i]))}}function pushVertex(t){r.push(t.x,t.y,t.z)}function getVertexByIndex(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function correctUV(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function azimuth(t){return Math.atan2(t.z,-t.x)}!function subdivide(t){const i=new Vector3,n=new Vector3,r=new Vector3;for(let s=0;s<e.length;s+=3)getVertexByIndex(e[s+0],i),getVertexByIndex(e[s+1],n),getVertexByIndex(e[s+2],r),subdivideFace(i,n,r,t)}(n),function applyRadius(t){const e=new Vector3;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function generateUVs(){const t=new Vector3;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=azimuth(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-o)}var e;(function correctUVs(){const t=new Vector3,e=new Vector3,i=new Vector3,n=new Vector3,o=new Vector2,a=new Vector2,l=new Vector2;for(let c=0,h=0;c<r.length;c+=9,h+=6){t.set(r[c+0],r[c+1],r[c+2]),e.set(r[c+3],r[c+4],r[c+5]),i.set(r[c+6],r[c+7],r[c+8]),o.set(s[h+0],s[h+1]),a.set(s[h+2],s[h+3]),l.set(s[h+4],s[h+5]),n.copy(t).add(e).add(i).divideScalar(3);const u=azimuth(n);correctUV(o,h+0,t,u),correctUV(a,h+2,e,u),correctUV(l,h+4,i,u)}})(),function correctSeam(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(r.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new PolyhedronGeometry(t.vertices,t.indices,t.radius,t.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new DodecahedronGeometry(t.radius,t.detail)}}const no=new Vector3,ro=new Vector3,so=new Vector3,oo=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(Fi*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:a}=oo;if(e.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),oo.getNormal(so),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=oo[c[t]],o=oo[c[e]],a=`${i}_${n}`,m=`${n}_${i}`;m in u&&u[m]?(so.dot(u[m].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[m]=null):a in u||(u[a]={index0:l[t],index1:l[e],normal:so.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];no.fromBufferAttribute(o,e),ro.fromBufferAttribute(o,i),d.push(no.x,no.y,no.z),d.push(ro.x,ro.y,ro.z)}this.setAttribute("position",new Float32BufferAttribute(d,3))}}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)r+=(i=this.getPoint(s/t)).distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if((o=i[n=Math.floor(a+(l-a)/2)]-s)<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(i[n=l]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),s=this.getPoint(n),o=e||(r.isVector2?new Vector2:new Vector3);return o.copy(s).sub(r).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Vector3,n=[],r=[],s=[],o=new Vector3,a=new Matrix4;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Vector3)}r[0]=new Vector3,s[0]=new Vector3;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(clamp(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(clamp(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const i=e||new Vector2,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function CubicPoly(){let t=0,e=0,i=0,n=0;function init(r,s,o,a){t=r,e=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(t,e,i,n,r){init(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,s,o){let a=(e-t)/r-(i-t)/(r+s)+(i-e)/s,l=(i-e)/s-(n-e)/(s+o)+(n-i)/o;init(e,i,a*=s,l*=s)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}ArcCurve.prototype.isArcCurve=!0;const ao=new Vector3,lo=new CubicPoly,co=new CubicPoly,ho=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new Vector3){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:(ao.subVectors(n[0],n[1]).add(n[0]),o=ao);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(ao.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=ao),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),lo.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,n),co.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,n),ho.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(lo.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),co.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),ho.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(lo.calc(c),co.calc(c),ho.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector3).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function CatmullRom(t,e,i,n,r){const s=.5*(n-e),o=.5*(r-i),a=t*t;return(2*i-2*n+s+o)*(t*a)+(-3*i+3*n-2*s-o)*a+s*t+i}function QuadraticBezier(t,e,i,n){return function QuadraticBezierP0(t,e){const i=1-t;return i*i*e}(t,e)+function QuadraticBezierP1(t,e){return 2*(1-t)*t*e}(t,i)+function QuadraticBezierP2(t,e){return t*t*e}(t,n)}function CubicBezier(t,e,i,n,r){return function CubicBezierP0(t,e){const i=1-t;return i*i*i*e}(t,e)+function CubicBezierP1(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function CubicBezierP2(t,e){return 3*(1-t)*t*t*e}(t,n)+function CubicBezierP3(t,e){return t*t*t*e}(t,r)}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;class CubicBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,i=new Vector2,n=new Vector2){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Vector2){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(CubicBezier(t,n.x,r.x,s.x,o.x),CubicBezier(t,n.y,r.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,i=new Vector3,n=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Vector3){const i=e,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(CubicBezier(t,n.x,r.x,s.x,o.x),CubicBezier(t,n.y,r.y,s.y,o.y),CubicBezier(t,n.z,r.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(t=new Vector2,e=new Vector2){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Vector2){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Vector3){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,i=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Vector2){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(QuadraticBezier(t,n.x,r.x,s.x),QuadraticBezier(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,i=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Vector3){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(QuadraticBezier(t,n.x,r.x,s.x),QuadraticBezier(t,n.y,r.y,s.y),QuadraticBezier(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Vector2){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(CatmullRom(o,a.x,l.x,c.x,h.x),CatmullRom(o,a.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector2).fromArray(i))}return this}}SplineCurve.prototype.isSplineCurve=!0;var uo=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new LineCurve(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new uo[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new LineCurve(this.currentPoint.clone(),new Vector2(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,n),new Vector2(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new SplineCurve(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,o,a),this}absellipse(t,e,i,n,r,s,o,a){const l=new EllipseCurve(t,e,i,n,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Shape extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Path).fromJSON(i))}return this}}const mo={triangulate:function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=linkedList(t,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,m;if(n&&(s=function eliminateHoles(t,e,i,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:t.length,(c=linkedList(t,a,l,n,!1))===c.next&&(c.steiner=!0),r.push(getLeftmost(c));for(r.sort(compareX),s=0;s<r.length;s++)eliminateHole(r[s],i),i=filterPoints(i,i.next);return i}(t,e,s,i)),t.length>80*i){a=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)(u=t[e])<a&&(a=u),(d=t[e+1])<l&&(l=d),u>c&&(c=u),d>h&&(h=d);m=0!==(m=Math.max(c-a,h-l))?1/m:0}return earcutLinked(s,o,i,a,l,m),o}};function linkedList(t,e,i,n,r){let s,o;if(r===function signedArea(t,e,i,n){let r=0;for(let s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)o=insertNode(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=insertNode(s,t[s],t[s+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function earcutLinked(t,e,i,n,r,s,o){if(!t)return;!o&&s&&function indexCurve(t,e,i,n){let r=t;do{null===r.z&&(r.z=zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function sortLinked(t){let e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1);return t}(r)}(t,n,r,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?isEarHashed(t,n,r,s):isEar(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),removeNode(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?earcutLinked(t=cureLocalIntersections(filterPoints(t),e,i),e,i,n,r,s,2):2===o&&splitEarcut(t,e,i,n,r,s):earcutLinked(filterPoints(t),e,i,n,r,s,1);break}}function isEar(t){const e=t.prev,i=t,n=t.next;if(area(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(t,e,i,n){const r=t.prev,s=t,o=t.next;if(area(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=zOrder(a,l,e,i,n),d=zOrder(c,h,e,i,n);let m=t.prevZ,p=t.nextZ;for(;m&&m.z>=u&&p&&p.z<=d;){if(m!==t.prev&&m!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,p!==t.prev&&p!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;m&&m.z>=u;){if(m!==t.prev&&m!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!equals(r,s)&&intersects(r,n,n.next,s)&&locallyInside(r,s)&&locallyInside(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),removeNode(n),removeNode(n.next),n=t=s),n=n.next}while(n!==t);return filterPoints(n)}function splitEarcut(t,e,i,n,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&isValidDiagonal(o,t)){let a=splitPolygon(o,t);return o=filterPoints(o,o.next),a=filterPoints(a,a.next),earcutLinked(o,e,i,n,r,s),void earcutLinked(a,e,i,n,r,s)}t=t.next}o=o.next}while(o!==t)}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=function findHoleBridge(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&pointInTriangle(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),locallyInside(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&sectorContainsSector(s,i)))&&(s=i,u=h)),i=i.next}while(i!==a);return s}(t,e)){const i=splitPolygon(e,t);filterPoints(e,e.next),filterPoints(i,i.next)}}function sectorContainsSector(t,e){return area(t.prev,t,e.prev)<0&&area(e.next,t,t.next)<0}function zOrder(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function intersectsPolygon(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&function middleInside(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(area(t.prev,t,e.prev)||area(t,e.prev,e))||equals(t,e)&&area(t.prev,t,t.next)>0&&area(e.prev,e,e.next)>0)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,n){const r=sign(area(t,e,i)),s=sign(area(t,e,n)),o=sign(area(i,n,t)),a=sign(area(i,n,e));return r!==s&&o!==a||(!(0!==r||!onSegment(t,i,e))||(!(0!==s||!onSegment(t,n,e))||(!(0!==o||!onSegment(i,t,n))||!(0!==a||!onSegment(i,e,n)))))}function onSegment(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function splitPolygon(t,e){const i=new Node(t.i,t.x,t.y),n=new Node(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function insertNode(t,e,i,n){const r=new Node(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ShapeUtils{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];removeDupEndPts(t),addContour(i,t);let s=t.length;e.forEach(removeDupEndPts);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,addContour(i,e[t]);const o=mo.triangulate(i,n);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function removeDupEndPts(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function addContour(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){addShape(t[e])}function addShape(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,m=void 0!==e.bevelSegments?e.bevelSegments:3;const p=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:po;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let _,g,b,y,x,S=!1;p&&(_=p.getSpacedPoints(a),S=!0,c=!1,g=p.computeFrenetFrames(a,!1),b=new Vector3,y=new Vector3,x=new Vector3),c||(m=0,h=0,u=0,d=0);const w=t.extractPoints(o);let M=w.shape;const A=w.holes;if(!ShapeUtils.isClockWise(M)){M=M.reverse();for(let t=0,e=A.length;t<e;t++){const e=A[t];ShapeUtils.isClockWise(e)&&(A[t]=e.reverse())}}const V=ShapeUtils.triangulateShape(M,A),C=M;for(let t=0,e=A.length;t<e;t++){const e=A[t];M=M.concat(e)}function scalePt2(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const T=M.length,B=V.length;function getBevelVec(t,e,i){let n,r,s;const o=t.x-e.x,a=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),m=e.x-a/u,p=e.y+o/u,f=((i.x-c/d-m)*c-(i.y+l/d-p)*l)/(o*c-a*l),_=(n=m+o*f-t.x)*n+(r=p+a*f-t.y)*r;if(_<=2)return new Vector2(n,r);s=Math.sqrt(_/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new Vector2(n/s,r/s)}const P=[];for(let t=0,e=C.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),P[t]=getBevelVec(C[t],C[i],C[n]);const E=[];let L,R=P.concat();for(let t=0,e=A.length;t<e;t++){const e=A[t];L=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[t]=getBevelVec(e[t],e[n],e[r]);E.push(L),R=R.concat(L)}for(let t=0;t<m;t++){const e=t/m,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=C.length;t<e;t++){const e=scalePt2(C[t],P[t],n);v(e.x,e.y,-i)}for(let t=0,e=A.length;t<e;t++){const e=A[t];L=E[t];for(let t=0,r=e.length;t<r;t++){const r=scalePt2(e[t],L[t],n);v(r.x,r.y,-i)}}}const I=u+d;for(let t=0;t<T;t++){const e=c?scalePt2(M[t],R[t],I):M[t];S?(y.copy(g.normals[0]).multiplyScalar(e.x),b.copy(g.binormals[0]).multiplyScalar(e.y),x.copy(_[0]).add(y).add(b),v(x.x,x.y,x.z)):v(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<T;e++){const i=c?scalePt2(M[e],R[e],I):M[e];S?(y.copy(g.normals[t]).multiplyScalar(i.x),b.copy(g.binormals[t]).multiplyScalar(i.y),x.copy(_[t]).add(y).add(b),v(x.x,x.y,x.z)):v(i.x,i.y,l/a*t)}for(let t=m-1;t>=0;t--){const e=t/m,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=C.length;t<e;t++){const e=scalePt2(C[t],P[t],n);v(e.x,e.y,l+i)}for(let t=0,e=A.length;t<e;t++){const e=A[t];L=E[t];for(let t=0,r=e.length;t<r;t++){const r=scalePt2(e[t],L[t],n);S?v(r.x,r.y+_[a-1].y,_[a-1].x+i):v(r.x,r.y,l+i)}}}function sidewalls(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=a+2*m;t<i;t++){const i=T*t,s=T*(t+1);f4(e+n+i,e+r+i,e+r+s,e+n+s)}}}function v(t,e,i){s.push(t),s.push(e),s.push(i)}function f3(t,e,r){addVertex(t),addVertex(e),addVertex(r);const s=n.length/3,o=f.generateTopUV(i,n,s-3,s-2,s-1);addUV(o[0]),addUV(o[1]),addUV(o[2])}function f4(t,e,r,s){addVertex(t),addVertex(e),addVertex(s),addVertex(e),addVertex(r),addVertex(s);const o=n.length/3,a=f.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);addUV(a[0]),addUV(a[1]),addUV(a[3]),addUV(a[1]),addUV(a[2]),addUV(a[3])}function addVertex(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function addUV(t){r.push(t.x),r.push(t.y)}!function buildLidFaces(){const t=n.length/3;if(c){let t=0,e=T*t;for(let t=0;t<B;t++){const i=V[t];f3(i[2]+e,i[1]+e,i[0]+e)}e=T*(t=a+2*m);for(let t=0;t<B;t++){const i=V[t];f3(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<B;t++){const e=V[t];f3(e[2],e[1],e[0])}for(let t=0;t<B;t++){const e=V[t];f3(e[0]+T*a,e[1]+T*a,e[2]+T*a)}}i.addGroup(t,n.length/3-t,0)}(),function buildSideFaces(){const t=n.length/3;let e=0;sidewalls(C,e),e+=C.length;for(let t=0,i=A.length;t<i;t++){const i=A[t];sidewalls(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function toJSON$1(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new uo[n.type]).fromJSON(n)),new ExtrudeGeometry(i,t.options)}}const po={generateTopUV:function(t,e,i,n,r){const s=e[3*i],o=e[3*i+1],a=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new Vector2(s,o),new Vector2(a,l),new Vector2(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const o=e[3*i],a=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],m=e[3*r+1],p=e[3*r+2],f=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new Vector2(o,1-l),new Vector2(c,1-u),new Vector2(d,1-p),new Vector2(f,1-g)]:[new Vector2(a,1-l),new Vector2(h,1-u),new Vector2(m,1-p),new Vector2(_,1-g)]}};class IcosahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new IcosahedronGeometry(t.radius,t.detail)}}class LatheGeometry extends BufferGeometry{constructor(t=[new Vector2(0,.5),new Vector2(.5,0),new Vector2(0,-.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=clamp(n,0,2*Math.PI);const r=[],s=[],o=[],a=1/e,l=new Vector3,c=new Vector2;for(let r=0;r<=e;r++){const h=i+r*a*n,u=Math.sin(h),d=Math.cos(h);for(let i=0;i<=t.length-1;i++)l.x=t[i].x*u,l.y=t[i].y,l.z=t[i].x*d,s.push(l.x,l.y,l.z),c.x=r/e,c.y=i/(t.length-1),o.push(c.x,c.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,o=n+t.length,a=n+t.length+1,l=n+1;r.push(s,o,l),r.push(o,a,l)}if(this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new Vector3,r=new Vector3,s=new Vector3,o=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],r.x=i[o+a+0],r.y=i[o+a+1],r.z=i[o+a+2],s.addVectors(n,r).normalize(),i[a+0]=i[o+a+0]=s.x,i[a+1]=i[o+a+1]=s.y,i[a+2]=i[o+a+2]=s.z}}static fromJSON(t){return new LatheGeometry(t.points,t.segments,t.phiStart,t.phiLength)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new OctahedronGeometry(t.radius,t.detail)}}class RingGeometry extends BufferGeometry{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new Vector3,m=new Vector2;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),a.push(d.x,d.y,d.z),l.push(0,0,1),m.x=(d.x/e+1)/2,m.y=(d.y/e+1)/2,c.push(m.x,m.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,a=n+i+2,l=n+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}static fromJSON(t){return new RingGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))addShape(t);else for(let e=0;e<t.length;e++)addShape(t[e]),this.addGroup(o,a,e),o+=a,a=0;function addShape(t){const o=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===ShapeUtils.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===ShapeUtils.isClockWise(e)&&(h[t]=e.reverse())}const u=ShapeUtils.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+o,r=e[1]+o,s=e[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2))}toJSON(){const t=super.toJSON();return function toJSON(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new ShapeGeometry(i,t.curveSegments)}}class SphereGeometry extends BufferGeometry{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new Vector3,u=new Vector3,d=[],m=[],p=[],f=[];for(let d=0;d<=i;d++){const _=[],g=d/i;let b=0;0==d&&0==s?b=.5/e:d==i&&a==Math.PI&&(b=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(n+a*r)*Math.sin(s+g*o),h.y=t*Math.cos(s+g*o),h.z=t*Math.sin(n+a*r)*Math.sin(s+g*o),m.push(h.x,h.y,h.z),u.copy(h).normalize(),p.push(u.x,u.y,u.z),f.push(a+b,1-g),_.push(l++)}c.push(_)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],o=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new TetrahedronGeometry(t.radius,t.detail)}}class TorusGeometry extends BufferGeometry{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],l=[],c=new Vector3,h=new Vector3,u=new Vector3;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const m=d/n*r,p=s/i*Math.PI*2;h.x=(t+e*Math.cos(p))*Math.cos(m),h.y=(t+e*Math.cos(p))*Math.sin(m),h.z=e*Math.sin(p),o.push(h.x,h.y,h.z),c.x=t*Math.cos(m),c.y=t*Math.sin(m),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,o=(n+1)*(t-1)+e,a=(n+1)*t+e;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}static fromJSON(t){return new TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new Vector3,u=new Vector3,d=new Vector3,m=new Vector3,p=new Vector3,f=new Vector3,_=new Vector3;for(let o=0;o<=i;++o){const g=o/i*r*Math.PI*2;calculatePositionOnCurve(g,r,s,t,d),calculatePositionOnCurve(g+.01,r,s,t,m),f.subVectors(m,d),_.addVectors(m,d),p.crossVectors(f,_),_.crossVectors(p,f),p.normalize(),_.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),m=e*Math.sin(r);h.x=d.x+(s*_.x+m*p.x),h.y=d.y+(s*_.y+m*p.y),h.z=d.z+(s*_.z+m*p.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(o/i),c.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;o.push(i,r,a),o.push(r,s,a)}function calculatePositionOnCurve(t,e,i,n,r){const s=Math.cos(t),o=Math.sin(t),a=i/e*t,l=Math.cos(a);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}static fromJSON(t){return new TorusKnotGeometry(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class TubeGeometry extends BufferGeometry{constructor(t=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new Vector3,a=new Vector3,l=new Vector2;let c=new Vector3;const h=[],u=[],d=[],m=[];function generateSegment(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function generateBufferData(){for(let t=0;t<e;t++)generateSegment(t);generateSegment(!1===r?e:0),function generateUVs(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function generateIndices(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;m.push(i,r,o),m.push(r,s,o)}}()}(),this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new TubeGeometry((new uo[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class WireframeGeometry extends BufferGeometry{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new Vector3,r=new Vector3;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=a.length;t<l;++t){const l=a[t],c=l.start;for(let t=c,a=c+l.count;t<a;t+=3)for(let a=0;a<3;a++){const l=o.getX(t+a),c=o.getX(t+(a+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===isUniqueEdge(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,l=3*t+(o+1)%3;n.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===isUniqueEdge(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Float32BufferAttribute(e,3))}}}function isUniqueEdge(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n,r),!0)}var fo=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends Material{constructor(t){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class MeshStandardMaterial extends Material{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new Color(0),this.sheenRoughness=1,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Color(1,1,1),this.specularTintMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenTint.copy(t.sheenTint),this.sheenRoughness=t.sheenRoughness,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationTint.copy(t.attenuationTint),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularTint.copy(t.specularTint),this.specularTintMap=t.specularTintMap,this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends Material{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ai,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;var _o=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const go={arraySlice:function(t,e,i){return go.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort(function compareTime(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[o++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=s[n])&&(e.push(s.time),i.push.apply(i,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{void 0!==(o=s[n])&&(e.push(s.time),o.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{void 0!==(o=s[n])&&(e.push(s.time),i.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<a;++i)c.push(e.values[t*a+i])}}0!==l.length&&(e.times=go.convertArray(l,e.times.constructor),e.values=go.convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find(function(t){return t.name===n.name&&t.ValueTypeName===r});if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=a,e=l-a;d=go.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+a,e=t+l-a;d=go.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=a,i=l-a;t.evaluate(s),d=go.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new Quaternion).fromArray(d).normalize().conjugate().toArray(d)}const m=o.times.length;for(let t=0;t<m;++t){const e=t*h+c;if("quaternion"===r)Quaternion.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=qe,t}};class Interpolant{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,t<(n=e[++i]))break e}s=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,t>=(r=e[--i-1]))break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_,Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:We,endingEnd:We}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case He:r=t,o=2*e-i;break;case je:o=e+n[r=n.length-2]-n[r+1];break;default:r=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case He:s=t,a=2*i-e;break;case je:s=1,a=i+n[1]-n[0];break;default:s=t-1,a=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,m=(i-e)/(n-e),p=m*m,f=p*m,_=-u*f+2*u*p-u*m,g=(1+u)*f+(-1.5-2*u)*p+(-.5+u)*m+1,b=(-1-d)*f+(1.5+d)*p+.5*m,y=d*f-d*p;for(let t=0;t!==o;++t)r[t]=_*s[c+t]+g*s[l+t]+b*s[a+t]+y*s[h+t];return r}}class LinearInterpolant extends Interpolant{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==o;++t)r[t]=s[l+t]*h+s[a+t]*c;return r}}class DiscreteInterpolant extends Interpolant{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=go.convertArray(e,this.TimeBufferType),this.values=go.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:go.convertArray(t.times,Array),values:go.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Ne:e=this.InterpolantFactoryMethodDiscrete;break;case Ue:e=this.InterpolantFactoryMethodLinear;break;case ze:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ne;case this.InterpolantFactoryMethodLinear:return Ue;case this.InterpolantFactoryMethodSmooth:return ze}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(r=(s=Math.max(s,1))-1);const t=this.getValueSize();this.times=go.arraySlice(i,r,s),this.values=go.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&go.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=go.arraySlice(this.times),e=go.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===ze,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)r=!0;else{const t=o*i,n=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const n=o*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,o=0;o!==i;++o)e[n+o]=e[t+o];++s}return s!==t.length?(this.times=go.arraySlice(t,0,s),this.values=go.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=go.arraySlice(this.times,0),e=go.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=Ue;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=Ne,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Quaternion.slerpFlat(r,0,s,l-o,s,l,a);return r}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=Ue,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=Ne,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t,e=-1,i,n=Je){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(parseKeyframeTrack(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(KeyframeTrack.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=go.getKeyframeOrder(o);o=go.sortedArray(o,1,l),a=go.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],o=[];go.flattenJSON(i,s,o,n),0!==s.length&&r.push(new t(e,s,o))}},n=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+i+"]",t,s))}a=t.length*(s||1)}else{const s=".bones["+e[t].name+"]";i(VectorKeyframeTrack,s+".position",r,"pos",n),i(QuaternionKeyframeTrack,s+".quaternion",r,"rot",n),i(VectorKeyframeTrack,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];go.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const bo={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class LoadingManager{constructor(t,e,i){const n=this;let r=!1,s=0,o=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===r&&void 0!==n.onStart&&n.onStart(t,s,o),r=!0},this.itemEnd=function(t){s++,void 0!==n.onProgress&&n.onProgress(t,s,o),s===o&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const yo=new LoadingManager;class Loader{constructor(t){this.manager=void 0!==t?t:yo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(n,r){i.load(t,n,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const xo={};class FileLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=bo.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;if(void 0!==xo[t])return void xo[t].push({onLoad:e,onProgress:i,onError:n});const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const i=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let s;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);s="blob"===o?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const e=new DOMParser;s=e.parseFromString(a,i);break;case"json":s=JSON.parse(a);break;default:s=a}setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{xo[t]=[],xo[t].push({onLoad:e,onProgress:i,onError:n}),(a=new XMLHttpRequest).open("GET",t,!0),a.addEventListener("load",function(e){const i=this.response,n=xo[t];if(delete xo[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bo.add(t,i);for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onLoad&&e.onLoad(i)}r.manager.itemEnd(t)}else{for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),a.addEventListener("progress",function(e){const i=xo[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onProgress&&n.onProgress(e)}},!1),a.addEventListener("error",function(e){const i=xo[t];delete xo[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),a.addEventListener("abort",function(e){const i=xo[t];delete xo[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)a.setRequestHeader(t,this.requestHeader[t]);a.send(null)}return r.manager.itemStart(t),a}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class AnimationLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=AnimationClip.parse(t[i]);e.push(n)}return e}}class CompressedTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],o=new CompressedTexture,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function loadTexture(c){a.load(t[c],function(t){const i=r.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(o.minFilter=xt),o.image=s,o.format=i.format,o.needsUpdate=!0,e&&e(o))},i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)loadTexture(e);else a.load(t,function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=xt),o.format=i.format,o.needsUpdate=!0,e&&e(o)},i,n);return o}}class ImageLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=bo.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;const o=createElementNS("img");function onImageLoad(){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),bo.add(t,this),e&&e(this),r.manager.itemEnd(t)}function onImageError(e){o.removeEventListener("load",onImageLoad,!1),o.removeEventListener("error",onImageError,!1),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}return o.addEventListener("load",onImageLoad,!1),o.addEventListener("error",onImageError,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class CubeTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=new CubeTexture,s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function loadTexture(i){s.load(t[i],function(t){r.images[i]=t,6===++o&&(r.needsUpdate=!0,e&&e(r))},void 0,n)}for(let e=0;e<t.length;++e)loadTexture(e);return r}}class DataTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:mt,s.wrapT=void 0!==i.wrapT?i.wrapT:mt,s.magFilter=void 0!==i.magFilter?i.magFilter:xt,s.minFilter=void 0!==i.minFilter?i.minFilter:xt,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=wt),1===i.mipmapCount&&(s.minFilter=xt),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))},i,n),s}}class TextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=new Texture,s=new ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},i,n),r}}class Light extends Object3D{constructor(t,e=1){super(),this.type="Light",this.color=new Color(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(e)}copy(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const vo=new Matrix4,So=new Vector3,wo=new Vector3;class LightShadow{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;So.setFromMatrixPosition(t.matrixWorld),e.position.copy(So),wo.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(wo),e.updateMatrixWorld(),vo.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vo),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*ki*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const Mo=new Matrix4,Ao=new Vector3,Vo=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Ao.setFromMatrixPosition(t.matrixWorld),i.position.copy(Ao),Vo.copy(i.position),Vo.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Vo),i.updateMatrixWorld(),n.makeTranslation(-Ao.x,-Ao.y,-Ao.z),Mo.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mo)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(t,e){super(t,e),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(t=new SphericalHarmonics3,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}LightProbe.prototype.isLightProbe=!0;class MaterialLoader extends Loader{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new FileLoader(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)}parse(t){const e=this.textures;function getTexture(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=new _o[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenTint&&(i.sheenTint=(new Color).setHex(t.sheenTint)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularTint&&void 0!==i.specularTint&&i.specularTint.setHex(t.specularTint),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationTint&&void 0!==i.attenuationTint&&i.attenuationTint.setHex(t.attenuationTint),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.format&&(i.format=t.format),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const n=t.uniforms[e];switch(i.uniforms[e]={},n.type){case"t":i.uniforms[e].value=getTexture(n.value);break;case"c":i.uniforms[e].value=(new Color).setHex(n.value);break;case"v2":i.uniforms[e].value=(new Vector2).fromArray(n.value);break;case"v3":i.uniforms[e].value=(new Vector3).fromArray(n.value);break;case"v4":i.uniforms[e].value=(new Vector4).fromArray(n.value);break;case"m3":i.uniforms[e].value=(new Matrix3).fromArray(n.value);break;case"m4":i.uniforms[e].value=(new Matrix4).fromArray(n.value);break;default:i.uniforms[e].value=n.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=getTexture(t.map)),void 0!==t.matcap&&(i.matcap=getTexture(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=getTexture(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=getTexture(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=getTexture(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=getTexture(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=getTexture(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=getTexture(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=getTexture(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=getTexture(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=getTexture(t.specularIntensityMap)),void 0!==t.specularTintMap&&(i.specularTintMap=getTexture(t.specularTintMap)),void 0!==t.envMap&&(i.envMap=getTexture(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=getTexture(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=getTexture(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=getTexture(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=getTexture(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=getTexture(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=getTexture(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(i.transmissionMap=getTexture(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=getTexture(t.thicknessMap)),i}setTextures(t){return this.textures=t,this}}class LoaderUtils{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class BufferGeometryLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new FileLoader(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)}parse(t){const e={},i={};function getInterleavedBuffer(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function getArrayBuffer(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),o=getTypedArray(r.type,s),a=new InterleavedBuffer(o,r.stride);return a.uuid=r.uuid,e[n]=a,a}const n=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,r=t.data.index;if(void 0!==r){const t=getTypedArray(r.type,r.array);n.setIndex(new BufferAttribute(t,1))}const s=t.data.attributes;for(const e in s){const i=s[e];let r;if(i.isInterleavedBufferAttribute){const e=getInterleavedBuffer(t.data,i.data);r=new InterleavedBufferAttribute(e,i.itemSize,i.offset,i.normalized)}else{const t=getTypedArray(i.type,i.array);r=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,i.itemSize,i.normalized)}void 0!==i.name&&(r.name=i.name),void 0!==i.usage&&r.setUsage(i.usage),void 0!==i.updateRange&&(r.updateRange.offset=i.updateRange.offset,r.updateRange.count=i.updateRange.count),n.setAttribute(e,r)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];let s;if(n.isInterleavedBufferAttribute){const e=getInterleavedBuffer(t.data,n.data);s=new InterleavedBufferAttribute(e,n.itemSize,n.offset,n.normalized)}else{const t=getTypedArray(n.type,n.array);s=new BufferAttribute(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),r.push(s)}n.morphAttributes[e]=r}t.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const a=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==a)for(let t=0,e=a.length;t!==e;++t){const e=a[t];n.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new Vector3;void 0!==l.center&&t.fromArray(l.center),n.boundingSphere=new Sphere(t,l.radius)}return t.name&&(n.name=t.name),t.userData&&(n.userData=t.userData),n}}class ObjectLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)},i,n)}async loadAsync(t,e){const i=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,function(){void 0!==e&&e(l)}),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,a,o,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,n,o,s,e),l=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Shape).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse(function(t){t.isBone&&(n[t.uuid]=t)}),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Skeleton).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new BufferGeometryLoader;for(let r=0,s=t.length;r<s;r++){let s;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in fo?s=fo[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new MaterialLoader;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const n=s.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=AnimationClip.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function deserializeImage(t){if("string"==typeof t){const e=t;return function loadImage(t){return i.manager.itemStart(t),r.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t),i.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new LoadingManager(e);(r=new ImageLoader(i)).setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){n[i.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=deserializeImage(r[t]);null!==e&&(e instanceof HTMLImageElement?n[i.uuid].push(e):n[i.uuid].push(new DataTexture(e.data,e.width,e.height)))}}else{const t=deserializeImage(i.url);null!==t&&(n[i.uuid]=t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function deserializeImage(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){(n=new ImageLoader(this.manager)).setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=r[t],s=await deserializeImage(e);null!==s&&(s instanceof HTMLImageElement?i[n.uuid].push(s):i[n.uuid].push(new DataTexture(s.data,s.width,s.height)))}}else{const t=await deserializeImage(n.url);null!==t&&(i[n.uuid]=t)}}}return i}parseTextures(t,e){function parseConstant(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=t[n];let s;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===e[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const o=e[r.image];Array.isArray(o)?(s=new CubeTexture(o),6===o.length&&(s.needsUpdate=!0)):(s=o&&o.data?new DataTexture(o.data,o.width,o.height):new Texture(o),o&&(s.needsUpdate=!0)),s.uuid=r.uuid,void 0!==r.name&&(s.name=r.name),void 0!==r.mapping&&(s.mapping=parseConstant(r.mapping,Co)),void 0!==r.offset&&s.offset.fromArray(r.offset),void 0!==r.repeat&&s.repeat.fromArray(r.repeat),void 0!==r.center&&s.center.fromArray(r.center),void 0!==r.rotation&&(s.rotation=r.rotation),void 0!==r.wrap&&(s.wrapS=parseConstant(r.wrap[0],To),s.wrapT=parseConstant(r.wrap[1],To)),void 0!==r.format&&(s.format=r.format),void 0!==r.type&&(s.type=r.type),void 0!==r.encoding&&(s.encoding=r.encoding),void 0!==r.minFilter&&(s.minFilter=parseConstant(r.minFilter,Bo)),void 0!==r.magFilter&&(s.magFilter=parseConstant(r.magFilter,Bo)),void 0!==r.anisotropy&&(s.anisotropy=r.anisotropy),void 0!==r.flipY&&(s.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(s.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(s.unpackAlignment=r.unpackAlignment),i[r.uuid]=s}return i}parseObject(t,e,i,n,r){let s,o,a;function getGeometry(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function getMaterial(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function getTexture(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new Scene,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Color(t.background):s.background=getTexture(t.background)),void 0!==t.environment&&(s.environment=getTexture(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":s=new DirectionalLight(t.color,t.intensity);break;case"PointLight":s=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":o=getGeometry(t.geometry),a=getMaterial(t.material),s=new SkinnedMesh(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=getGeometry(t.geometry),a=getMaterial(t.material),s=new Mesh(o,a);break;case"InstancedMesh":o=getGeometry(t.geometry),a=getMaterial(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;(s=new InstancedMesh(o,a,e)).instanceMatrix=new InstancedBufferAttribute(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new InstancedBufferAttribute(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new LOD;break;case"Line":s=new Line(getGeometry(t.geometry),getMaterial(t.material));break;case"LineLoop":s=new LineLoop(getGeometry(t.geometry),getMaterial(t.material));break;case"LineSegments":s=new LineSegments(getGeometry(t.geometry),getMaterial(t.material));break;case"PointCloud":case"Points":s=new Points(getGeometry(t.geometry),getMaterial(t.material));break;case"Sprite":s=new Sprite(getMaterial(t.material));break;case"Group":s=new Group;break;case"Bone":s=new Bone;break;default:s=new Object3D}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}})}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const Co={UVMapping:st,CubeReflectionMapping:ot,CubeRefractionMapping:at,EquirectangularReflectionMapping:lt,EquirectangularRefractionMapping:ct,CubeUVReflectionMapping:ht,CubeUVRefractionMapping:ut},To={RepeatWrapping:dt,ClampToEdgeWrapping:mt,MirroredRepeatWrapping:pt},Bo={NearestFilter:ft,NearestMipmapNearestFilter:_t,NearestMipmapLinearFilter:bt,LinearFilter:xt,LinearMipmapNearestFilter:vt,LinearMipmapLinearFilter:wt};class ImageBitmapLoader extends Loader{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=bo.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(i){bo.add(t,i),e&&e(i),r.manager.itemEnd(t)}).catch(function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}let Po;ImageBitmapLoader.prototype.isImageBitmapLoader=!0;const Eo={getContext:function(){return void 0===Po&&(Po=new(window.AudioContext||window.webkitAudioContext)),Po},setContext:function(t){Po=t}};class AudioLoader extends Loader{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new FileLoader(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(i){try{const s=i.slice(0);Eo.getContext().decodeAudioData(s,function(t){e(t)})}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)}}class HemisphereLightProbe extends LightProbe{constructor(t,e,i=1){super(void 0,i);const n=(new Color).set(t),r=(new Color).set(e),s=new Vector3(n.r,n.g,n.b),o=new Vector3(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(t,e=1){super(void 0,e);const i=(new Color).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const Lo=new Matrix4,Ro=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),n=e.eyeSep/2,r=n*e.near/e.focus,s=e.near*Math.tan(Fi*e.fov*.5)/e.zoom;let o,a;Ro.elements[12]=-n,Lo.elements[12]=n,o=-s*e.aspect+r,a=s*e.aspect+r,i.elements[0]=2*e.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(i),o=-s*e.aspect-r,a=s*e.aspect-r,i.elements[0]=2*e.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Ro),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Lo)}}class Clock{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const Io=new Vector3,Do=new Quaternion,Go=new Vector3,Fo=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=Eo.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Io,Do,Go),Fo.set(0,0,-1).applyQuaternion(Do),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Io.x,t),e.positionY.linearRampToValueAtTime(Io.y,t),e.positionZ.linearRampToValueAtTime(Io.z,t),e.forwardX.linearRampToValueAtTime(Fo.x,t),e.forwardY.linearRampToValueAtTime(Fo.y,t),e.forwardZ.linearRampToValueAtTime(Fo.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(Io.x,Io.y,Io.z),e.setOrientation(Fo.x,Fo.y,Fo.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const ko=new Vector3,Oo=new Quaternion,No=new Vector3,Uo=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ko,Oo,No),Uo.set(0,0,1).applyQuaternion(Oo);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ko.x,t),e.positionY.linearRampToValueAtTime(ko.y,t),e.positionZ.linearRampToValueAtTime(ko.z,t),e.orientationX.linearRampToValueAtTime(Uo.x,t),e.orientationY.linearRampToValueAtTime(Uo.y,t),e.orientationZ.linearRampToValueAtTime(Uo.z,t)}else e.setPosition(ko.x,ko.y,ko.z),e.setOrientation(Uo.x,Uo.y,Uo.z)}}class AudioAnalyser{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class PropertyMixer{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{const t=e/(s+=e);this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){Quaternion.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;Quaternion.multiplyQuaternionsFlat(t,s,t,e,t,i),Quaternion.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[i+o]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const zo=new RegExp("[\\[\\]\\.:\\/]","g"),Wo="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ho=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),jo=/(WCOD+)?/.source.replace("WCOD",Wo),Jo=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),qo=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Xo=new RegExp("^"+Ho+jo+Jo+qo+"$"),Yo=["material","materials","bones"];class PropertyBinding{constructor(t,e,i){this.path=e,this.parsedPath=i||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,i):new PropertyBinding(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(zo,"")}static parseTrackName(t){const e=Xo.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Yo.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=class Composite{constructor(t,e,i){const n=i||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let o=void 0,a=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new PropertyBinding(h,i[t],n[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new PropertyBinding(h,i[t],n[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<r){const o=--r,a=t[o],c=--s,h=t[c];e[a.uuid]=l,t[l]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[o],r=e[c];e[l]=n,e[o]=r,e.pop()}}else{const r=--s,o=t[r];r>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),o.push(e),r.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new PropertyBinding(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=i,s[i]=a,s.pop(),r[i]=r[o],r.pop(),n[i]=n[o],n.pop()}}}AnimationObjectGroup.prototype.isAnimationObjectGroup=!0;class AnimationAction{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:We,endingEnd:We};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ke,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case qe:for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);break;case Je:default:for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,o)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=i===Oe;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(i===Fe){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=He,n.endingEnd=He):(n.endingStart=t?this.zeroSlopeAtStart?He:We:je,n.endingEnd=e?this.zeroSlopeAtEnd?He:We:je)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=i,this}}class AnimationMixer extends EventDispatcher{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)s[t]=h;else{if(void 0!==(h=s[t])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;++(h=new PropertyMixer(PropertyBinding.create(i,l,n),r.ValueTypeName,r.getValueSize())).referenceCount,this._addInactiveBinding(h,a,l),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&((i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?AnimationClip.findByName(n,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:Je),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new AnimationAction(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?AnimationClip.findByName(i,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o){e[o]._update(n,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Uniform{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class GLBufferAttribute{constructor(t,e,i,n,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}GLBufferAttribute.prototype.isGLBufferAttribute=!0;class Raycaster{constructor(t,e,i=0,n=1/0){this.ray=new Ray(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return intersectObject(t,this,i,e),i.sort(ascSort),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)intersectObject(t[n],this,i,e);return i.sort(ascSort),i}}function ascSort(t,e){return t.distance-e.distance}function intersectObject(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)intersectObject(n[t],e,i,!0)}}class Spherical{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(clamp(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}const Zo=new Vector2;class Box2{constructor(t=new Vector2(1/0,1/0),e=new Vector2(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Zo.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Zo.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Box2.prototype.isBox2=!0;const Ko=new Vector3,Qo=new Vector3;class Line3{constructor(t=new Vector3,e=new Vector3){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Ko.subVectors(t,this.start),Qo.subVectors(this.end,this.start);const i=Qo.dot(Qo);let n=Qo.dot(Ko)/i;return e&&(n=clamp(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class ImmediateRenderObject extends Object3D{constructor(t){super(),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const $o=new Vector3;class SpotLightHelper extends Object3D{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Float32BufferAttribute(n,3));const r=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),$o.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($o),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ta=new Vector3,ea=new Matrix4,ia=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=function getBoneList(t){const e=[];t&&t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,getBoneList(t.children[i]));return e}(t),i=new BufferGeometry,n=[],r=[],s=new Color(0,0,1),o=new Color(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute(r,3)),super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");ia.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(ea.multiplyMatrices(ia,r.matrixWorld),ta.setFromMatrixPosition(ea),n.setXYZ(i,ta.x,ta.y,ta.z),ea.multiplyMatrices(ia,r.parent.matrixWorld),ta.setFromMatrixPosition(ea),n.setXYZ(i+1,ta.x,ta.y,ta.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}class PointLightHelper extends Mesh{constructor(t,e,i){super(new SphereGeometry(e,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const na=new Vector3,ra=new Color,sa=new Color;class HemisphereLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new OctahedronGeometry(e);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new BufferAttribute(s,3)),this.add(new Mesh(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");ra.copy(this.light.color),sa.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?ra:sa;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(na.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,e=10,i=4473924,n=8947848){i=new Color(i),n=new Color(n);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new BufferGeometry;c.setAttribute("position",new Float32BufferAttribute(a,3)),c.setAttribute("color",new Float32BufferAttribute(l,3)),super(c,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new Color(r),s=new Color(s);const o=[],a=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,c=Math.cos(n)*t;o.push(0,0,0),o.push(l,0,c);const h=1&i?r:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<=i;e++){const l=1&e?r:s,c=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;o.push(i,0,r),a.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,o.push(i,0,r),a.push(l.r,l.g,l.b)}}const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute(o,3)),l.setAttribute("color",new Float32BufferAttribute(a,3)),super(l,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const oa=new Vector3,aa=new Vector3,la=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(n,r),this.add(this.lightPlane),(n=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){oa.setFromMatrixPosition(this.light.matrixWorld),aa.setFromMatrixPosition(this.light.target.matrixWorld),la.subVectors(aa,oa),this.lightPlane.lookAt(aa),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(aa),this.targetLine.scale.z=la.length()}}const ca=new Vector3,ha=new Camera;class CameraHelper extends LineSegments{constructor(t){const e=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},o=new Color(16755200),a=new Color(16711680),l=new Color(43775),c=new Color(16777215),h=new Color(3355443);function addLine(t,e,i){addPoint(t,i),addPoint(e,i)}function addPoint(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}addLine("n1","n2",o),addLine("n2","n4",o),addLine("n4","n3",o),addLine("n3","n1",o),addLine("f1","f2",o),addLine("f2","f4",o),addLine("f4","f3",o),addLine("f3","f1",o),addLine("n1","f1",o),addLine("n2","f2",o),addLine("n3","f3",o),addLine("n4","f4",o),addLine("p","n1",a),addLine("p","n2",a),addLine("p","n3",a),addLine("p","n4",a),addLine("u1","u2",l),addLine("u2","u3",l),addLine("u3","u1",l),addLine("c","t",c),addLine("p","c",h),addLine("cn1","cn2",h),addLine("cn3","cn4",h),addLine("cf1","cf2",h),addLine("cf3","cf4",h),e.setAttribute("position",new Float32BufferAttribute(n,3)),e.setAttribute("color",new Float32BufferAttribute(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;ha.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",e,t,ha,0,0,-1),setPoint("t",e,t,ha,0,0,1),setPoint("n1",e,t,ha,-1,-1,-1),setPoint("n2",e,t,ha,1,-1,-1),setPoint("n3",e,t,ha,-1,1,-1),setPoint("n4",e,t,ha,1,1,-1),setPoint("f1",e,t,ha,-1,-1,1),setPoint("f2",e,t,ha,1,-1,1),setPoint("f3",e,t,ha,-1,1,1),setPoint("f4",e,t,ha,1,1,1),setPoint("u1",e,t,ha,.7,1.1,-1),setPoint("u2",e,t,ha,-.7,1.1,-1),setPoint("u3",e,t,ha,0,2,-1),setPoint("cf1",e,t,ha,-1,0,1),setPoint("cf2",e,t,ha,1,0,1),setPoint("cf3",e,t,ha,0,-1,1),setPoint("cf4",e,t,ha,0,1,1),setPoint("cn1",e,t,ha,-1,0,-1),setPoint("cn2",e,t,ha,1,0,-1),setPoint("cn3",e,t,ha,0,-1,-1),setPoint("cn4",e,t,ha,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(t,e,i,n,r,s,o){ca.set(r,s,o).unproject(n);const a=e[t];if(void 0!==a){const t=i.getAttribute("position");for(let e=0,i=a.length;e<i;e++)t.setXYZ(a[e],ca.x,ca.y,ca.z)}}const ua=new Box3;class BoxHelper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new BufferGeometry;r.setIndex(new BufferAttribute(i,1)),r.setAttribute("position",new BufferAttribute(n,3)),super(r,new LineBasicMaterial({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ua.setFromObject(this.object),ua.isEmpty())return;const e=ua.min,i=ua.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this}}class Box3Helper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new LineBasicMaterial({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class PlaneHelper extends Line{constructor(t,e=1,i=16776960){const n=i,r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new LineBasicMaterial({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new Mesh(s,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?f:p,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const da=new Vector3;let ma,pa;class ArrowHelper extends Object3D{constructor(t=new Vector3(0,0,1),e=new Vector3(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===ma&&((ma=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(pa=new CylinderGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Line(ma,new LineBasicMaterial({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(pa,new MeshBasicMaterial({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{da.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(da,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class AxesHelper extends LineSegments{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(e,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Color,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function toShapesNoHoles(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Shape;r.curves=n.curves,e.push(r)}return e}function isPointInsidePolygon(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],o=e[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],a=-a,o=e[r],l=-l),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return n}const i=ShapeUtils.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===e)return toShapesNoHoles(n);let r,s,o;const a=[];if(1===n.length)return s=n[0],(o=new Shape).curves=s.curves,a.push(o),a;let l=!i(n[0].getPoints());l=t?!l:l;const c=[],h=[];let u,d,m=[],p=0;h[p]=void 0,m[p]=[];for(let e=0,o=n.length;e<o;e++)r=i(u=(s=n[e]).getPoints()),(r=t?!r:r)?(!l&&h[p]&&p++,h[p]={s:new Shape,p:u},h[p].s.curves=s.curves,l&&p++,m[p]=[]):m[p].push({h:s,p:u[0]});if(!h[0])return toShapesNoHoles(n);if(h.length>1){let t=!1;const e=[];for(let t=0,e=h.length;t<e;t++)c[t]=[];for(let i=0,n=h.length;i<n;i++){const n=m[i];for(let r=0;r<n.length;r++){const s=n[r];let o=!0;for(let n=0;n<h.length;n++)isPointInsidePolygon(s.p,h[n].p)&&(i!==n&&e.push({froms:i,tos:n,hole:r}),o?(o=!1,c[n].push(s)):t=!0);o&&c[i].push(s)}}e.length>0&&(t||(m=c))}for(let t=0,e=h.length;t<e;t++){o=h[t].s,a.push(o);for(let e=0,i=(d=m[t]).length;e<i;e++)o.holes.push(d[e].h)}return a}}const fa=new Float32Array(1),_a=new Int32Array(fa.buffer);class DataUtils{static toHalfFloat(t){t>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),t=65504),fa[0]=t;const e=_a[0];let i=e>>16&32768,n=e>>12&2047;const r=e>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&e):r<113?i|=((n|=2048)>>114-r)+(n>>113-r&1):(i|=r-112<<10|n>>1,i+=1&n)}}const ga=0,ba=1,ya=0,xa=1,va=2;function MeshFaceMaterial(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function MultiMaterial(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function PointCloud(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(t,e)}function Particle(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(t)}function ParticleSystem(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(t,e)}function PointCloudMaterial(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleBasicMaterial(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleSystemMaterial(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function Vertex(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(t,e,i)}function DynamicBufferAttribute(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(t,e).setUsage(Vi)}function Int8Attribute(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(t,e)}function Uint8Attribute(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(t,e)}function Uint8ClampedAttribute(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(t,e)}function Int16Attribute(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(t,e)}function Uint16Attribute(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(t,e)}function Int32Attribute(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(t,e)}function Uint32Attribute(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(t,e)}function Float32Attribute(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(t,e)}function Float64Attribute(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(t,e)}function AxisHelper(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(t)}function BoundingBoxHelper(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(t,e)}function EdgesHelper(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function WireframeHelper(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function XHRLoader(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(t)}function BinaryTextureLoader(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(t)}function WebGLRenderTargetCube(t,e,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(t,i)}function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}Curve.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Path.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Loader.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(t)},Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Box2.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Box2.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box2.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Box2.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Box3.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box3.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Box3.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Box3.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Frustum.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Line3.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Matrix3.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Matrix3.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Matrix3.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Matrix3.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Matrix4.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Matrix4.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},Matrix4.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Matrix4.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Matrix4.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Matrix4.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Matrix4.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Matrix4.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Matrix4.prototype.makeFrustum=function(t,e,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,s)},Matrix4.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Plane.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Quaternion.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ray.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ray.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Ray.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Triangle.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Triangle.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Triangle.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Triangle.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Triangle.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(t,e,i,n,r)},Triangle.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(t,e,i,n)},Shape.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Shape.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,t)},Shape.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,t)},Vector2.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Vector2.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vector3.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Vector3.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Vector3.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Vector3.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Vector3.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Vector3.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector4.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Object3D.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Object3D.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Object3D.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xe},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},PerspectiveCamera.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Vi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Vi)}}}),BufferAttribute.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Vi:Ai),this},BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},BufferGeometry.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},BufferGeometry.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new BufferAttribute(arguments[1],arguments[2])))},BufferGeometry.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},BufferGeometry.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},BufferGeometry.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),InterleavedBuffer.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Vi:Ai),this},InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Uniform.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===g}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),WebGLRenderer.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},WebGLRenderer.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},WebGLRenderer.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},WebGLRenderer.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},WebGLRenderer.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},WebGLRenderer.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},WebGLRenderer.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},WebGLRenderer.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},WebGLRenderer.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},WebGLRenderer.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},WebGLRenderer.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},WebGLRenderer.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},WebGLRenderer.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},WebGLRenderer.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},WebGLRenderer.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},WebGLRenderer.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},WebGLRenderer.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},WebGLRenderer.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},WebGLRenderer.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},WebGLRenderer.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},WebGLRenderer.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},WebGLRenderer.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},WebGLRenderer.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},WebGLRenderer.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},WebGLRenderer.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Qe:Ke}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Audio.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new AudioLoader).load(t,function(t){e.setBuffer(t)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},CubeCamera.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new TextureLoader;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},ImageUtils.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new CubeTextureLoader;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Sa={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function ParametricGeometry(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new BufferGeometry}function TextGeometry(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new BufferGeometry}function FontLoader(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function Font(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},function(t,e,i){!function(t){"use strict";class b2Color{constructor(t=.5,e=.5,i=.5,n=1){this.r=t,this.g=e,this.b=i,this.a=n}Clone(){return(new b2Color).Copy(this)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}Set(t,e,i,n=this.a){this.SetRGBA(t,e,i,n)}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}SelfMul(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}Mix(t,e){b2Color.MixColors(this,t,e)}static MixColors(t,e,i){const n=i*(e.r-t.r),r=i*(e.g-t.g),s=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=n,t.g+=r,t.b+=s,t.a+=o,e.r-=n,e.g-=r,e.b-=s,e.a-=o}MakeStyleString(t=this.a){return b2Color.MakeStyleString(this.r,this.g,this.b,t)}static MakeStyleString(t,e,i,n=1){return t*=255,e*=255,i*=255,n<1?`rgba(${t},${e},${i},${n})`:`rgb(${t},${e},${i})`}}b2Color.ZERO=new b2Color(0,0,0,0),b2Color.RED=new b2Color(1,0,0),b2Color.GREEN=new b2Color(0,1,0),b2Color.BLUE=new b2Color(0,0,1);class b2TypedColor{constructor(...t){if(t[0]instanceof Float32Array){if(4!==t[0].length)throw new Error;this.data=t[0]}else{const e="number"==typeof t[0]?t[0]:.5,i="number"==typeof t[1]?t[1]:.5,n="number"==typeof t[2]?t[2]:.5,r="number"==typeof t[3]?t[3]:1;this.data=new Float32Array([e,i,n,r])}}get r(){return this.data[0]}set r(t){this.data[0]=t}get g(){return this.data[1]}set g(t){this.data[1]=t}get b(){return this.data[2]}set b(t){this.data[2]=t}get a(){return this.data[3]}set a(t){this.data[3]=t}Clone(){return new b2TypedColor(new Float32Array(this.data))}Copy(t){return t instanceof b2TypedColor?this.data.set(t.data):(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a),this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}Set(t,e,i,n=this.a){this.SetRGBA(t,e,i,n)}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}SelfMul(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}Mix(t,e){b2Color.MixColors(this,t,e)}MakeStyleString(t=this.a){return b2Color.MakeStyleString(this.r,this.g,this.b,t)}}var e;function b2Maybe(t,e){return void 0!==t?t:e}(e=t.DrawFlags||(t.DrawFlags={}))[e.e_none=0]="e_none",e[e.e_shapeBit=1]="e_shapeBit",e[e.e_jointBit=2]="e_jointBit",e[e.e_aabbBit=4]="e_aabbBit",e[e.e_pairBit=8]="e_pairBit",e[e.e_centerOfMassBit=16]="e_centerOfMassBit",e[e.e_particleBit=32]="e_particleBit",e[e.e_controllerBit=64]="e_controllerBit",e[e.e_all=63]="e_all";const i=1e37,n=1e-5,r=n*n,s=3.14159265359,o=1,a=8,l=2,c=.1*o,h=4,u=.005*o,d=2/180*s,m=2*u,p=8,f=32,_=.2*o,g=8/180*s,b=2*o,y=b*b,x=.5*s,v=x*x,S=.2,w=.75,M=-1,A=.75,V=1,C=.25,T=.5,B=2*o,P=B*B,E=256,L=2.5,R=.5,I=.01*o,D=2/180*s;class b2Version{constructor(t=0,e=0,i=0){this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}toString(){return this.major+"."+this.minor+"."+this.revision}}const G=new b2Version(2,4,1);function b2MakeArray(t,e){const i=new Array(t);for(let n=0;n<t;++n)i[n]=e(n);return i}function b2MakeNumberArray(t,e=0){const i=new Array(t);for(let n=0;n<t;++n)i[n]=e;return i}class b2GrowableStack{constructor(t){this.m_stack=[],this.m_count=0,this.m_stack=b2MakeArray(t,t=>null),this.m_count=0}Reset(){return this.m_count=0,this}Push(t){this.m_stack[this.m_count]=t,this.m_count++}Pop(){this.m_count--;const t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}GetCount(){return this.m_count}}const F=s/180,k=180/s,O=2*s,N=Math.abs;function b2Min(t,e){return t<e?t:e}function b2Max(t,e){return t>e?t:e}function b2Clamp(t,e,i){return t<e?e:t>i?i:t}const U=isFinite;function b2Sq(t){return t*t}function b2InvSqrt(t){return 1/Math.sqrt(t)}const z=Math.sqrt,W=Math.pow,H=Math.cos,j=Math.sin,J=Math.acos,q=Math.asin,X=Math.atan2;class b2Vec2{constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new b2Vec2(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,e){return this.x+=t,this.y+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,e){return this.x-=t,this.y-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SelfMulSub(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}LengthSquared(){const t=this.x,e=this.y;return t*t+e*e}Normalize(){const t=this.Length();if(t>=n){const e=1/t;this.x*=e,this.y*=e}return t}SelfNormalize(){const t=this.Length();if(t>=n){const e=1/t;this.x*=e,this.y*=e}return this}SelfRotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}SelfRotateCosSin(t,e){const i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const e=this.x;return this.x=t*this.y,this.y=-t*e,this}SelfCrossSV(t){const e=this.x;return this.x=-t*this.y,this.y=t*e,this}SelfMinV(t){return this.x=b2Min(this.x,t.x),this.y=b2Min(this.y,t.y),this}SelfMaxV(t){return this.x=b2Max(this.x,t.x),this.y=b2Max(this.y,t.y),this}SelfAbs(){return this.x=N(this.x),this.y=N(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}static MakeArray(t){return b2MakeArray(t,t=>new b2Vec2)}static AbsV(t,e){return e.x=N(t.x),e.y=N(t.y),e}static MinV(t,e,i){return i.x=b2Min(t.x,e.x),i.y=b2Min(t.y,e.y),i}static MaxV(t,e,i){return i.x=b2Max(t.x,e.x),i.y=b2Max(t.y,e.y),i}static ClampV(t,e,i,n){return n.x=b2Clamp(t.x,e.x,i.x),n.y=b2Clamp(t.y,e.y,i.y),n}static RotateV(t,e,i){const n=t.x,r=t.y,s=Math.cos(e),o=Math.sin(e);return i.x=s*n-o*r,i.y=o*n+s*r,i}static DotVV(t,e){return t.x*e.x+t.y*e.y}static CrossVV(t,e){return t.x*e.y-t.y*e.x}static CrossVS(t,e,i){const n=t.x;return i.x=e*t.y,i.y=-e*n,i}static CrossVOne(t,e){const i=t.x;return e.x=t.y,e.y=-i,e}static CrossSV(t,e,i){const n=e.x;return i.x=-t*e.y,i.y=t*n,i}static CrossOneV(t,e){const i=t.x;return e.x=-t.y,e.y=i,e}static AddVV(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}static SubVV(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}static MulSV(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}static MulVS(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}static AddVMulSV(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n}static SubVMulSV(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n}static AddVCrossSV(t,e,i,n){const r=i.x;return n.x=t.x-e*i.y,n.y=t.y+e*r,n}static MidVV(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}static ExtVV(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}static IsEqualToV(t,e){return t.x===e.x&&t.y===e.y}static DistanceVV(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}static DistanceSquaredVV(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}static NegV(t,e){return e.x=-t.x,e.y=-t.y,e}}b2Vec2.ZERO=new b2Vec2(0,0),b2Vec2.UNITX=new b2Vec2(1,0),b2Vec2.UNITY=new b2Vec2(0,1),b2Vec2.s_t0=new b2Vec2,b2Vec2.s_t1=new b2Vec2,b2Vec2.s_t2=new b2Vec2,b2Vec2.s_t3=new b2Vec2;const Y=new b2Vec2(0,0);class b2TypedVec2{constructor(...t){if(t[0]instanceof Float32Array){if(2!==t[0].length)throw new Error;this.data=t[0]}else{const e="number"==typeof t[0]?t[0]:0,i="number"==typeof t[1]?t[1]:0;this.data=new Float32Array([e,i])}}get x(){return this.data[0]}set x(t){this.data[0]=t}get y(){return this.data[1]}set y(t){this.data[1]=t}Clone(){return new b2TypedVec2(new Float32Array(this.data))}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return t instanceof b2TypedVec2?this.data.set(t.data):(this.x=t.x,this.y=t.y),this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,e){return this.x+=t,this.y+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,e){return this.x-=t,this.y-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SelfMulSub(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}LengthSquared(){const t=this.x,e=this.y;return t*t+e*e}Normalize(){const t=this.Length();if(t>=n){const e=1/t;this.x*=e,this.y*=e}return t}SelfNormalize(){const t=this.Length();if(t>=n){const e=1/t;this.x*=e,this.y*=e}return this}SelfRotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}SelfRotateCosSin(t,e){const i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const e=this.x;return this.x=t*this.y,this.y=-t*e,this}SelfCrossSV(t){const e=this.x;return this.x=-t*this.y,this.y=t*e,this}SelfMinV(t){return this.x=b2Min(this.x,t.x),this.y=b2Min(this.y,t.y),this}SelfMaxV(t){return this.x=b2Max(this.x,t.x),this.y=b2Max(this.y,t.y),this}SelfAbs(){return this.x=N(this.x),this.y=N(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}}class b2Vec3{constructor(...t){if(t[0]instanceof Float32Array){if(3!==t[0].length)throw new Error;this.data=t[0]}else{const e="number"==typeof t[0]?t[0]:0,i="number"==typeof t[1]?t[1]:0,n="number"==typeof t[2]?t[2]:0;this.data=new Float32Array([e,i,n])}}get x(){return this.data[0]}set x(t){this.data[0]=t}get y(){return this.data[1]}set y(t){this.data[1]=t}get z(){return this.data[2]}set z(t){this.data[2]=t}Clone(){return new b2Vec3(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}SetXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}SelfAddXYZ(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SelfSubXYZ(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}SelfMul(t){return this.x*=t,this.y*=t,this.z*=t,this}static DotV3V3(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static CrossV3V3(t,e,i){const n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,l=e.z;return i.x=r*l-s*a,i.y=s*o-n*l,i.z=n*a-r*o,i}}b2Vec3.ZERO=new b2Vec3(0,0,0),b2Vec3.s_t0=new b2Vec3;class b2Mat22{constructor(){this.ex=new b2Vec2(1,0),this.ey=new b2Vec2(0,1)}Clone(){return(new b2Mat22).Copy(this)}static FromVV(t,e){return(new b2Mat22).SetVV(t,e)}static FromSSSS(t,e,i,n){return(new b2Mat22).SetSSSS(t,e,i,n)}static FromAngle(t){return(new b2Mat22).SetAngle(t)}SetSSSS(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this}SetVV(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){const e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(t){const e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y;let s=e*r-i*n;return 0!==s&&(s=1/s),t.ex.x=s*r,t.ey.x=-s*i,t.ex.y=-s*n,t.ey.y=s*e,t}Solve(t,e,i){const n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y;let a=n*o-r*s;return 0!==a&&(a=1/a),i.x=a*(o*t-r*e),i.y=a*(n*e-s*t),i}SelfAbs(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}SelfInv(){return this.GetInverse(this),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}SelfSubM(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}static AbsM(t,e){const i=t.ex,n=t.ey;return e.ex.x=N(i.x),e.ex.y=N(i.y),e.ey.x=N(n.x),e.ey.y=N(n.y),e}static MulMV(t,e,i){const n=t.ex,r=t.ey,s=e.x,o=e.y;return i.x=n.x*s+r.x*o,i.y=n.y*s+r.y*o,i}static MulTMV(t,e,i){const n=t.ex,r=t.ey,s=e.x,o=e.y;return i.x=n.x*s+n.y*o,i.y=r.x*s+r.y*o,i}static AddMM(t,e,i){const n=t.ex,r=t.ey,s=e.ex,o=e.ey;return i.ex.x=n.x+s.x,i.ex.y=n.y+s.y,i.ey.x=r.x+o.x,i.ey.y=r.y+o.y,i}static MulMM(t,e,i){const n=t.ex.x,r=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,c=e.ey.x,h=e.ey.y;return i.ex.x=n*a+s*l,i.ex.y=r*a+o*l,i.ey.x=n*c+s*h,i.ey.y=r*c+o*h,i}static MulTMM(t,e,i){const n=t.ex.x,r=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,c=e.ey.x,h=e.ey.y;return i.ex.x=n*a+r*l,i.ex.y=s*a+o*l,i.ey.x=n*c+r*h,i.ey.y=s*c+o*h,i}}b2Mat22.IDENTITY=new b2Mat22;class b2Mat33{constructor(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new b2Vec3(this.data.subarray(0,3)),this.ey=new b2Vec3(this.data.subarray(3,6)),this.ez=new b2Vec3(this.data.subarray(6,9))}Clone(){return(new b2Mat33).Copy(this)}SetVVV(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}Solve33(t,e,i,n){const r=this.ex.x,s=this.ex.y,o=this.ex.z,a=this.ey.x,l=this.ey.y,c=this.ey.z,h=this.ez.x,u=this.ez.y,d=this.ez.z;let m=r*(l*d-c*u)+s*(c*h-a*d)+o*(a*u-l*h);return 0!==m&&(m=1/m),n.x=m*(t*(l*d-c*u)+e*(c*h-a*d)+i*(a*u-l*h)),n.y=m*(r*(e*d-i*u)+s*(i*h-t*d)+o*(t*u-e*h)),n.z=m*(r*(l*i-c*e)+s*(c*t-a*i)+o*(a*e-l*t)),n}Solve22(t,e,i){const n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y;let a=n*o-r*s;return 0!==a&&(a=1/a),i.x=a*(o*t-r*e),i.y=a*(n*e-s*t),i}GetInverse22(t){const e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y;let s=e*r-i*n;0!==s&&(s=1/s),t.ex.x=s*r,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*n,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=b2Vec3.DotV3V3(this.ex,b2Vec3.CrossV3V3(this.ey,this.ez,b2Vec3.s_t0));0!==e&&(e=1/e);const i=this.ex.x,n=this.ey.x,r=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(r*o-n*a),t.ex.z=e*(n*o-r*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-r*r),t.ey.z=e*(r*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-n*n)}static MulM33V3(t,e,i){const n=e.x,r=e.y,s=e.z;return i.x=t.ex.x*n+t.ey.x*r+t.ez.x*s,i.y=t.ex.y*n+t.ey.y*r+t.ez.y*s,i.z=t.ex.z*n+t.ey.z*r+t.ez.z*s,i}static MulM33XYZ(t,e,i,n,r){return r.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,r.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,r.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,r}static MulM33V2(t,e,i){const n=e.x,r=e.y;return i.x=t.ex.x*n+t.ey.x*r,i.y=t.ex.y*n+t.ey.y*r,i}static MulM33XY(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n}}b2Mat33.IDENTITY=new b2Mat33;class b2Rot{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Clone(){return(new b2Rot).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}SetAngle(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static MulRR(t,e,i){const n=t.c,r=t.s,s=e.c,o=e.s;return i.s=r*s+n*o,i.c=n*s-r*o,i}static MulTRR(t,e,i){const n=t.c,r=t.s,s=e.c,o=e.s;return i.s=n*o-r*s,i.c=n*s+r*o,i}static MulRV(t,e,i){const n=t.c,r=t.s,s=e.x,o=e.y;return i.x=n*s-r*o,i.y=r*s+n*o,i}static MulTRV(t,e,i){const n=t.c,r=t.s,s=e.x,o=e.y;return i.x=n*s+r*o,i.y=-r*s+n*o,i}}b2Rot.IDENTITY=new b2Rot;class b2Transform{constructor(){this.p=new b2Vec2,this.q=new b2Rot}Clone(){return(new b2Transform).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.SetAngle(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}static MulXV(t,e,i){const n=t.q.c,r=t.q.s,s=e.x,o=e.y;return i.x=n*s-r*o+t.p.x,i.y=r*s+n*o+t.p.y,i}static MulTXV(t,e,i){const n=t.q.c,r=t.q.s,s=e.x-t.p.x,o=e.y-t.p.y;return i.x=n*s+r*o,i.y=-r*s+n*o,i}static MulXX(t,e,i){return b2Rot.MulRR(t.q,e.q,i.q),b2Vec2.AddVV(b2Rot.MulRV(t.q,e.p,i.p),t.p,i.p),i}static MulTXX(t,e,i){return b2Rot.MulTRR(t.q,e.q,i.q),b2Rot.MulTRV(t.q,b2Vec2.SubVV(e.p,t.p,i.p),i.p),i}}b2Transform.IDENTITY=new b2Transform;class b2Sweep{constructor(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new b2Sweep).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){t.p.x=(1-e)*this.c0.x+e*this.c.x,t.p.y=(1-e)*this.c0.y+e*this.c.y;const i=(1-e)*this.a0+e*this.a;return t.q.SetAngle(i),t.p.SelfSub(b2Rot.MulRV(t.q,this.localCenter,b2Vec2.s_t0)),t}Advance(t){const e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}Normalize(){const t=O*Math.floor(this.a0/O);this.a0-=t,this.a-=t}}class b2Timer{constructor(){this.m_start=Date.now()}Reset(){return this.m_start=Date.now(),this}GetMilliseconds(){return Date.now()-this.m_start}}class b2DistanceProxy{constructor(){this.m_buffer=b2Vec2.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}SetVerticesRadius(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}GetSupport(t){let e=0,i=b2Vec2.DotVV(this.m_vertices[0],t);for(let n=1;n<this.m_count;++n){const r=b2Vec2.DotVV(this.m_vertices[n],t);r>i&&(e=n,i=r)}return e}GetSupportVertex(t){let e=0,i=b2Vec2.DotVV(this.m_vertices[0],t);for(let n=1;n<this.m_count;++n){const r=b2Vec2.DotVV(this.m_vertices[n],t);r>i&&(e=n,i=r)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}class b2SimplexCache{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}class b2DistanceInput{constructor(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.transformA=new b2Transform,this.transformB=new b2Transform,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}class b2DistanceOutput{constructor(){this.pointA=new b2Vec2,this.pointB=new b2Vec2,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}t.gjkCalls=0,t.gjkIters=0,t.gjkMaxIters=0;class b2SimplexVertex{constructor(){this.wA=new b2Vec2,this.wB=new b2Vec2,this.w=new b2Vec2,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class b2Simplex{constructor(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}ReadCache(t,e,i,r,s){this.m_count=t.count;const o=this.m_vertices;for(let n=0;n<this.m_count;++n){const a=o[n];a.indexA=t.indexA[n],a.indexB=t.indexB[n];const l=e.GetVertex(a.indexA),c=r.GetVertex(a.indexB);b2Transform.MulXV(i,l,a.wA),b2Transform.MulXV(s,c,a.wB),b2Vec2.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){const e=t.metric,i=this.GetMetric();(i<.5*e||2*e<i||i<n)&&(this.m_count=0)}if(0===this.m_count){const t=o[0];t.indexA=0,t.indexB=0;const n=e.GetVertex(0),a=r.GetVertex(0);b2Transform.MulXV(i,n,t.wA),b2Transform.MulXV(s,a,t.wB),b2Vec2.SubVV(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const e=this.m_vertices;for(let i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return b2Vec2.NegV(this.m_v1.w,t);case 2:{const e=b2Vec2.SubVV(this.m_v2.w,this.m_v1.w,t),i=b2Vec2.CrossVV(e,b2Vec2.NegV(this.m_v1.w,b2Vec2.s_t0));return i>0?b2Vec2.CrossOneV(e,t):b2Vec2.CrossVOne(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return b2Vec2.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return b2Vec2.CrossVV(b2Vec2.SubVV(this.m_v2.w,this.m_v1.w,b2Vec2.s_t0),b2Vec2.SubVV(this.m_v3.w,this.m_v1.w,b2Vec2.s_t1));default:return 0}}Solve2(){const t=this.m_v1.w,e=this.m_v2.w,i=b2Vec2.SubVV(e,t,b2Simplex.s_e12),n=-b2Vec2.DotVV(t,i);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);const r=b2Vec2.DotVV(e,i);if(r<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const s=1/(r+n);this.m_v1.a=r*s,this.m_v2.a=n*s,this.m_count=2}Solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,n=b2Vec2.SubVV(e,t,b2Simplex.s_e12),r=b2Vec2.DotVV(t,n),s=b2Vec2.DotVV(e,n),o=s,a=-r,l=b2Vec2.SubVV(i,t,b2Simplex.s_e13),c=b2Vec2.DotVV(t,l),h=b2Vec2.DotVV(i,l),u=h,d=-c,m=b2Vec2.SubVV(i,e,b2Simplex.s_e23),p=b2Vec2.DotVV(e,m),f=b2Vec2.DotVV(i,m),_=f,g=-p,b=b2Vec2.CrossVV(n,l),y=b*b2Vec2.CrossVV(e,i),x=b*b2Vec2.CrossVV(i,t),v=b*b2Vec2.CrossVV(t,e);if(a<=0&&d<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&v<=0){const t=1/(o+a);return this.m_v1.a=o*t,this.m_v2.a=a*t,void(this.m_count=2)}if(u>0&&d>0&&x<=0){const t=1/(u+d);return this.m_v1.a=u*t,this.m_v3.a=d*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&g<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(u<=0&&_<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(_>0&&g>0&&y<=0){const t=1/(_+g);return this.m_v2.a=_*t,this.m_v3.a=g*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const S=1/(y+x+v);this.m_v1.a=y*S,this.m_v2.a=x*S,this.m_v3.a=v*S,this.m_count=3}}b2Simplex.s_e12=new b2Vec2,b2Simplex.s_e13=new b2Vec2,b2Simplex.s_e23=new b2Vec2;const Z=new b2Simplex,K=[0,0,0],Q=[0,0,0],$=new b2Vec2,tt=new b2Vec2,et=new b2Vec2,it=new b2Vec2,nt=new b2Vec2;function b2Distance(e,i,s){++t.gjkCalls;const o=s.proxyA,a=s.proxyB,l=s.transformA,c=s.transformB,h=Z;h.ReadCache(i,o,l,a,c);const u=h.m_vertices,d=K,m=Q;let p=0,f=0;for(;f<20;){p=h.m_count;for(let t=0;t<p;++t)d[t]=u[t].indexA,m[t]=u[t].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)break;const e=h.GetSearchDirection(tt);if(e.LengthSquared()<r)break;const i=u[h.m_count];i.indexA=o.GetSupport(b2Rot.MulTRV(l.q,b2Vec2.NegV(e,b2Vec2.s_t0),it)),b2Transform.MulXV(l,o.GetVertex(i.indexA),i.wA),i.indexB=a.GetSupport(b2Rot.MulTRV(c.q,e,nt)),b2Transform.MulXV(c,a.GetVertex(i.indexB),i.wB),b2Vec2.SubVV(i.wB,i.wA,i.w),++f,++t.gjkIters;let n=!1;for(let t=0;t<p;++t)if(i.indexA===d[t]&&i.indexB===m[t]){n=!0;break}if(n)break;++h.m_count}if(t.gjkMaxIters=b2Max(t.gjkMaxIters,f),h.GetWitnessPoints(e.pointA,e.pointB),e.distance=b2Vec2.DistanceVV(e.pointA,e.pointB),e.iterations=f,h.WriteCache(i),s.useRadii){const t=o.m_radius,i=a.m_radius;if(e.distance>t+i&&e.distance>n){e.distance-=t+i;const n=b2Vec2.SubVV(e.pointB,e.pointA,et);n.Normalize(),e.pointA.SelfMulAdd(t,n),e.pointB.SelfMulSub(i,n)}else{const t=b2Vec2.MidVV(e.pointA,e.pointB,$);e.pointA.Copy(t),e.pointB.Copy(t),e.distance=0}}}const rt=new b2Vec2,st=new b2Simplex,ot=new b2Vec2,at=new b2Vec2,lt=new b2Vec2,ct=new b2Vec2,ht=new b2Vec2,ut=new b2Vec2;var dt,mt,pt;(dt=t.ContactFeatureType||(t.ContactFeatureType={}))[dt.e_vertex=0]="e_vertex",dt[dt.e_face=1]="e_face";class b2ContactFeature{constructor(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}get key(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key}set key(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(t){this._indexA=t,this._key_invalid=!0}get indexB(){return this._indexB}set indexB(t){this._indexB=t,this._key_invalid=!0}get typeA(){return this._typeA}set typeA(t){this._typeA=t,this._key_invalid=!0}get typeB(){return this._typeB}set typeB(t){this._typeB=t,this._key_invalid=!0}}class b2ContactID{constructor(){this.cf=new b2ContactFeature}Copy(t){return this.key=t.key,this}Clone(){return(new b2ContactID).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}class b2ManifoldPoint{constructor(){this.localPoint=new b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.id=new b2ContactID}static MakeArray(t){return b2MakeArray(t,t=>new b2ManifoldPoint)}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}(mt=t.ManifoldType||(t.ManifoldType={}))[mt.e_unknown=-1]="e_unknown",mt[mt.e_circles=0]="e_circles",mt[mt.e_faceA=1]="e_faceA",mt[mt.e_faceB=2]="e_faceB";class b2Manifold{constructor(){this.points=b2ManifoldPoint.MakeArray(l),this.localNormal=new b2Vec2,this.localPoint=new b2Vec2,this.type=t.ManifoldType.e_unknown,this.pointCount=0}Reset(){for(let t=0;t<l;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.ManifoldType.e_unknown,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<l;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new b2Manifold).Copy(this)}}class b2WorldManifold{constructor(){this.normal=new b2Vec2,this.points=b2Vec2.MakeArray(l),this.separations=b2MakeNumberArray(l)}Initialize(e,i,n,s,o){if(0!==e.pointCount)switch(e.type){case t.ManifoldType.e_circles:{this.normal.Set(1,0);const t=b2Transform.MulXV(i,e.localPoint,b2WorldManifold.Initialize_s_pointA),a=b2Transform.MulXV(s,e.points[0].localPoint,b2WorldManifold.Initialize_s_pointB);b2Vec2.DistanceSquaredVV(t,a)>r&&b2Vec2.SubVV(a,t,this.normal).SelfNormalize();const l=b2Vec2.AddVMulSV(t,n,this.normal,b2WorldManifold.Initialize_s_cA),c=b2Vec2.SubVMulSV(a,o,this.normal,b2WorldManifold.Initialize_s_cB);b2Vec2.MidVV(l,c,this.points[0]),this.separations[0]=b2Vec2.DotVV(b2Vec2.SubVV(c,l,b2Vec2.s_t0),this.normal);break}case t.ManifoldType.e_faceA:{b2Rot.MulRV(i.q,e.localNormal,this.normal);const t=b2Transform.MulXV(i,e.localPoint,b2WorldManifold.Initialize_s_planePoint);for(let i=0;i<e.pointCount;++i){const r=b2Transform.MulXV(s,e.points[i].localPoint,b2WorldManifold.Initialize_s_clipPoint),a=n-b2Vec2.DotVV(b2Vec2.SubVV(r,t,b2Vec2.s_t0),this.normal),l=b2Vec2.AddVMulSV(r,a,this.normal,b2WorldManifold.Initialize_s_cA),c=b2Vec2.SubVMulSV(r,o,this.normal,b2WorldManifold.Initialize_s_cB);b2Vec2.MidVV(l,c,this.points[i]),this.separations[i]=b2Vec2.DotVV(b2Vec2.SubVV(c,l,b2Vec2.s_t0),this.normal)}break}case t.ManifoldType.e_faceB:{b2Rot.MulRV(s.q,e.localNormal,this.normal);const t=b2Transform.MulXV(s,e.localPoint,b2WorldManifold.Initialize_s_planePoint);for(let r=0;r<e.pointCount;++r){const s=b2Transform.MulXV(i,e.points[r].localPoint,b2WorldManifold.Initialize_s_clipPoint),a=o-b2Vec2.DotVV(b2Vec2.SubVV(s,t,b2Vec2.s_t0),this.normal),l=b2Vec2.AddVMulSV(s,a,this.normal,b2WorldManifold.Initialize_s_cB),c=b2Vec2.SubVMulSV(s,n,this.normal,b2WorldManifold.Initialize_s_cA);b2Vec2.MidVV(c,l,this.points[r]),this.separations[r]=b2Vec2.DotVV(b2Vec2.SubVV(c,l,b2Vec2.s_t0),this.normal)}this.normal.SelfNeg();break}}}}b2WorldManifold.Initialize_s_pointA=new b2Vec2,b2WorldManifold.Initialize_s_pointB=new b2Vec2,b2WorldManifold.Initialize_s_cA=new b2Vec2,b2WorldManifold.Initialize_s_cB=new b2Vec2,b2WorldManifold.Initialize_s_planePoint=new b2Vec2,b2WorldManifold.Initialize_s_clipPoint=new b2Vec2,(pt=t.PointState||(t.PointState={}))[pt.b2_nullState=0]="b2_nullState",pt[pt.b2_addState=1]="b2_addState",pt[pt.b2_persistState=2]="b2_persistState",pt[pt.b2_removeState=3]="b2_removeState";class b2ClipVertex{constructor(){this.v=new b2Vec2,this.id=new b2ContactID}static MakeArray(t){return b2MakeArray(t,t=>new b2ClipVertex)}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}class b2RayCastInput{constructor(){this.p1=new b2Vec2,this.p2=new b2Vec2,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}class b2RayCastOutput{constructor(){this.normal=new b2Vec2,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}class b2AABB{constructor(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2,this.m_cache_center=new b2Vec2,this.m_cache_extent=new b2Vec2}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)}GetCenter(){return b2Vec2.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return b2Vec2.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){const t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)}Combine1(t){return this.lowerBound.x=b2Min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=b2Min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=b2Max(this.upperBound.x,t.upperBound.x),this.upperBound.y=b2Max(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=b2Min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=b2Min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=b2Max(t.upperBound.x,e.upperBound.x),this.upperBound.y=b2Max(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,i){return i.Combine2(t,e),i}Contains(t){let e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let r=-i,s=i;const o=e.p1.x,a=e.p1.y,l=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,h=N(l),u=N(c),d=t.normal;if(h<n){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else{const t=1/l;let e=(this.lowerBound.x-o)*t,i=(this.upperBound.x-o)*t,n=-1;if(e>i){const t=e;e=i,i=t,n=1}if(e>r&&(d.x=n,d.y=0,r=e),s=b2Min(s,i),r>s)return!1}if(u<n){if(a<this.lowerBound.y||this.upperBound.y<a)return!1}else{const t=1/c;let e=(this.lowerBound.y-a)*t,i=(this.upperBound.y-a)*t,n=-1;if(e>i){const t=e;e=i,i=t,n=1}if(e>r&&(d.x=0,d.y=n,r=e),s=b2Min(s,i),r>s)return!1}return!(r<0||e.maxFraction<r||(t.fraction=r,0))}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}}function b2TestOverlapAABB(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)}function b2ClipSegmentToLine(e,i,n,r,s){let o=0;const a=i[0],l=i[1],c=b2Vec2.DotVV(n,a.v)-r,h=b2Vec2.DotVV(n,l.v)-r;if(c<=0&&e[o++].Copy(a),h<=0&&e[o++].Copy(l),c*h<0){const i=c/(c-h),n=e[o].v;n.x=a.v.x+i*(l.v.x-a.v.x),n.y=a.v.y+i*(l.v.y-a.v.y);const r=e[o].id;r.cf.indexA=s,r.cf.indexB=a.id.cf.indexB,r.cf.typeA=t.ContactFeatureType.e_vertex,r.cf.typeB=t.ContactFeatureType.e_face,++o}return o}const ft=new b2DistanceInput,_t=new b2SimplexCache,gt=new b2DistanceOutput;function b2TestOverlapShape(t,e,i,r,s,o){const a=ft.Reset();a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,r),a.transformA.Copy(s),a.transformB.Copy(o),a.useRadii=!0;const l=_t.Reset();l.count=0;const c=gt.Reset();return b2Distance(c,l,a),c.distance<10*n}function verify(t){if(null===t)throw new Error;return t}class b2TreeNode{constructor(t=0){this.m_id=0,this.aabb=new b2AABB,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.moved=!1,this.m_id=t}get userData(){if(null===this._userData)throw new Error;return this._userData}set userData(t){if(null!==this._userData)throw new Error;this._userData=t}Reset(){this._userData=null}IsLeaf(){return null===this.child1}}class b2DynamicTree{constructor(){this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new b2GrowableStack(256)}Query(t,e){const i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const n=i.Pop();if(null!==n&&n.aabb.TestOverlap(t))if(n.IsLeaf()){const t=e(n);if(!t)return}else i.Push(n.child1),i.Push(n.child2)}}QueryPoint(t,e){const i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const n=i.Pop();if(null!==n&&n.aabb.TestContain(t))if(n.IsLeaf()){const t=e(n);if(!t)return}else i.Push(n.child1),i.Push(n.child2)}}RayCast(t,e){const i=t.p1,n=t.p2,r=b2Vec2.SubVV(n,i,b2DynamicTree.s_r);r.Normalize();const s=b2Vec2.CrossOneV(r,b2DynamicTree.s_v),o=b2Vec2.AbsV(s,b2DynamicTree.s_abs_v);let a=t.maxFraction;const l=b2DynamicTree.s_segmentAABB;let c=i.x+a*(n.x-i.x),h=i.y+a*(n.y-i.y);l.lowerBound.x=b2Min(i.x,c),l.lowerBound.y=b2Min(i.y,h),l.upperBound.x=b2Max(i.x,c),l.upperBound.y=b2Max(i.y,h);const u=this.m_stack.Reset();for(u.Push(this.m_root);u.GetCount()>0;){const r=u.Pop();if(null===r)continue;if(!b2TestOverlapAABB(r.aabb,l))continue;const d=r.aabb.GetCenter(),m=r.aabb.GetExtents(),p=N(b2Vec2.DotVV(s,b2Vec2.SubVV(i,d,b2Vec2.s_t0)))-b2Vec2.DotVV(o,m);if(!(p>0))if(r.IsLeaf()){const s=b2DynamicTree.s_subInput;s.p1.Copy(t.p1),s.p2.Copy(t.p2),s.maxFraction=a;const o=e(s,r);if(0===o)return;o>0&&(a=o,c=i.x+a*(n.x-i.x),h=i.y+a*(n.y-i.y),l.lowerBound.x=b2Min(i.x,c),l.lowerBound.y=b2Min(i.y,h),l.upperBound.x=b2Max(i.x,c),l.upperBound.y=b2Max(i.y,h))}else u.Push(r.child1),u.Push(r.child2)}}AllocateNode(){if(null!==this.m_freeList){const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}return new b2TreeNode(b2DynamicTree.s_node_id++)}FreeNode(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}CreateProxy(t,e){const i=this.AllocateNode(),n=c,r=c;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-r,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+r,i.userData=e,i.height=0,i.moved=!0,this.InsertLeaf(i),i}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,i){const n=b2DynamicTree.MoveProxy_s_fatAABB,r=c,s=c;n.lowerBound.x=e.lowerBound.x-r,n.lowerBound.y=e.lowerBound.y-s,n.upperBound.x=e.upperBound.x+r,n.upperBound.y=e.upperBound.y+s;const o=h*i.x,a=h*i.y;o<0?n.lowerBound.x+=o:n.upperBound.x+=o,a<0?n.lowerBound.y+=a:n.upperBound.y+=a;const l=t.aabb;if(l.Contains(e)){const t=b2DynamicTree.MoveProxy_s_hugeAABB;if(t.lowerBound.x=n.lowerBound.x-4*r,t.lowerBound.y=n.lowerBound.y-4*s,t.upperBound.x=n.upperBound.x+4*r,t.upperBound.y=n.upperBound.y+4*s,t.Contains(l))return!1}return this.RemoveLeaf(t),t.aabb.Copy(n),this.InsertLeaf(t),t.moved=!0,!0}InsertLeaf(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const e=t.aabb;let i=this.m_root;for(;!i.IsLeaf();){const t=verify(i.child1),n=verify(i.child2),r=i.aabb.GetPerimeter(),s=b2DynamicTree.s_combinedAABB;s.Combine2(i.aabb,e);const o=s.GetPerimeter(),a=2*o,l=2*(o-r);let c;const h=b2DynamicTree.s_aabb;let u,d,m;if(t.IsLeaf()?(h.Combine2(e,t.aabb),c=h.GetPerimeter()+l):(h.Combine2(e,t.aabb),u=t.aabb.GetPerimeter(),d=h.GetPerimeter(),c=d-u+l),n.IsLeaf()?(h.Combine2(e,n.aabb),m=h.GetPerimeter()+l):(h.Combine2(e,n.aabb),u=n.aabb.GetPerimeter(),d=h.GetPerimeter(),m=d-u+l),a<c&&a<m)break;i=c<m?t:n}const n=i.parent,r=this.AllocateNode();r.parent=n,r.aabb.Combine2(e,i.aabb),r.height=i.height+1,null!==n?(n.child1===i?n.child1=r:n.child2=r,r.child1=i,r.child2=t,i.parent=r,t.parent=r):(r.child1=i,r.child2=t,i.parent=r,t.parent=r,this.m_root=r);let s=t.parent;for(;null!==s;){const t=verify((s=this.Balance(s)).child1),e=verify(s.child2);s.height=1+b2Max(t.height,e.height),s.aabb.Combine2(t.aabb,e.aabb),s=s.parent}}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=verify(t.parent),i=e&&e.parent,n=verify(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=n:i.child2=n,n.parent=i,this.FreeNode(e);let t=i;for(;null!==t;){const e=verify((t=this.Balance(t)).child1),i=verify(t.child2);t.aabb.Combine2(e.aabb,i.aabb),t.height=1+b2Max(e.height,i.height),t=t.parent}}else this.m_root=n,n.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=verify(t.child1),i=verify(t.child2),n=i.height-e.height;if(n>1){const n=verify(i.child1),r=verify(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>r.height?(i.child2=n,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+b2Max(e.height,r.height),i.height=1+b2Max(t.height,n.height)):(i.child2=r,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+b2Max(e.height,n.height),i.height=1+b2Max(t.height,r.height)),i}if(n<-1){const n=verify(e.child1),r=verify(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,n.height>r.height?(e.child2=n,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+b2Max(i.height,r.height),e.height=1+b2Max(t.height,n.height)):(e.child2=r,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+b2Max(i.height,n.height),e.height=1+b2Max(t.height,r.height)),e}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}static GetAreaNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;let e=t.aabb.GetPerimeter();return e+=b2DynamicTree.GetAreaNode(t.child1),e+=b2DynamicTree.GetAreaNode(t.child2)}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root,e=t.aabb.GetPerimeter(),i=b2DynamicTree.GetAreaNode(this.m_root);return i/e}static ComputeHeightNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;const e=b2DynamicTree.ComputeHeightNode(t.child1),i=b2DynamicTree.ComputeHeightNode(t.child2);return 1+b2Max(e,i)}ComputeHeight(){const t=b2DynamicTree.ComputeHeightNode(this.m_root);return t}ValidateStructure(t){if(null===t)return;if(this.m_root,t.IsLeaf())return;const e=verify(t.child1),i=verify(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}ValidateMetrics(t){if(null===t)return;if(t.IsLeaf())return;const e=verify(t.child1),i=verify(t.child2),n=b2DynamicTree.s_aabb;n.Combine2(e.aabb,i.aabb),this.ValidateMetrics(e),this.ValidateMetrics(i)}Validate(){}static GetMaxBalanceNode(t,e){if(null===t)return e;if(t.height<=1)return e;const i=verify(t.child1),n=verify(t.child2),r=N(n.height-i.height);return b2Max(e,r)}GetMaxBalance(){const t=b2DynamicTree.GetMaxBalanceNode(this.m_root,0);return t}RebuildBottomUp(){this.Validate()}static ShiftOriginNode(t,e){if(null===t)return;if(t.height<=1)return;const i=t.child1,n=t.child2;b2DynamicTree.ShiftOriginNode(i,e),b2DynamicTree.ShiftOriginNode(n,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)}ShiftOrigin(t){b2DynamicTree.ShiftOriginNode(this.m_root,t)}}b2DynamicTree.s_r=new b2Vec2,b2DynamicTree.s_v=new b2Vec2,b2DynamicTree.s_abs_v=new b2Vec2,b2DynamicTree.s_segmentAABB=new b2AABB,b2DynamicTree.s_subInput=new b2RayCastInput,b2DynamicTree.s_combinedAABB=new b2AABB,b2DynamicTree.s_aabb=new b2AABB,b2DynamicTree.s_node_id=0,b2DynamicTree.MoveProxy_s_fatAABB=new b2AABB,b2DynamicTree.MoveProxy_s_hugeAABB=new b2AABB;class b2Pair{constructor(t,e){this.proxyA=t,this.proxyB=e}}class b2BroadPhase{constructor(){this.m_tree=new b2DynamicTree,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}CreateProxy(t,e){const i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,i){const n=this.m_tree.MoveProxy(t,e,i);n&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];if(null===e)continue;const i=e.aabb;this.m_tree.Query(i,t=>{if(t.m_id===e.m_id)return!0;const i=t.moved;if(i&&t.m_id>e.m_id)return!0;let n,r;if(t.m_id<e.m_id?(n=t,r=e):(n=e,r=t),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new b2Pair(n,r);else{const t=this.m_pairBuffer[this.m_pairCount];t.proxyA=n,t.proxyB=r}return++this.m_pairCount,!0})}for(let e=0;e<this.m_pairCount;++e){const i=this.m_pairBuffer[e],n=i.proxyA.userData,r=i.proxyB.userData;t(n,r)}for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];null!==e&&(e.moved=!1)}this.m_moveCount=0}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}class b2MassData{constructor(){this.mass=0,this.center=new b2Vec2(0,0),this.I=0}}var bt;(bt=t.ShapeType||(t.ShapeType={}))[bt.e_unknown=-1]="e_unknown",bt[bt.e_circleShape=0]="e_circleShape",bt[bt.e_edgeShape=1]="e_edgeShape",bt[bt.e_polygonShape=2]="e_polygonShape",bt[bt.e_chainShape=3]="e_chainShape",bt[bt.e_shapeTypeCount=4]="e_shapeTypeCount";class b2Shape{constructor(e,i){this.m_type=t.ShapeType.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=i}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}class b2EdgeShape extends b2Shape{constructor(){super(t.ShapeType.e_edgeShape,m),this.m_vertex1=new b2Vec2,this.m_vertex2=new b2Vec2,this.m_vertex0=new b2Vec2,this.m_vertex3=new b2Vec2,this.m_oneSided=!1}SetOneSided(t,e,i,n){return this.m_vertex0.Copy(t),this.m_vertex1.Copy(e),this.m_vertex2.Copy(i),this.m_vertex3.Copy(n),this.m_oneSided=!0,this}SetTwoSided(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_oneSided=!1,this}Clone(){return(new b2EdgeShape).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_oneSided=t.m_oneSided,this}GetChildCount(){return 1}TestPoint(t,e){return!1}ComputeDistance(t,e,i,n){const r=b2Transform.MulXV(t,this.m_vertex1,b2EdgeShape.ComputeDistance_s_v1),s=b2Transform.MulXV(t,this.m_vertex2,b2EdgeShape.ComputeDistance_s_v2),o=b2Vec2.SubVV(e,r,b2EdgeShape.ComputeDistance_s_d),a=b2Vec2.SubVV(s,r,b2EdgeShape.ComputeDistance_s_s),l=b2Vec2.DotVV(o,a);if(l>0){const t=b2Vec2.DotVV(a,a);l>t?b2Vec2.SubVV(e,s,o):o.SelfMulSub(l/t,a)}return i.Copy(o),i.Normalize()}RayCast(t,e,i,n){const r=b2Transform.MulTXV(i,e.p1,b2EdgeShape.RayCast_s_p1),s=b2Transform.MulTXV(i,e.p2,b2EdgeShape.RayCast_s_p2),o=b2Vec2.SubVV(s,r,b2EdgeShape.RayCast_s_d),a=this.m_vertex1,l=this.m_vertex2,c=b2Vec2.SubVV(l,a,b2EdgeShape.RayCast_s_e),h=t.normal.Set(c.y,-c.x).SelfNormalize(),u=b2Vec2.DotVV(h,b2Vec2.SubVV(a,r,b2Vec2.s_t0));if(this.m_oneSided&&u>0)return!1;const d=b2Vec2.DotVV(h,o);if(0===d)return!1;const m=u/d;if(m<0||e.maxFraction<m)return!1;const p=b2Vec2.AddVMulSV(r,m,o,b2EdgeShape.RayCast_s_q),f=b2Vec2.SubVV(l,a,b2EdgeShape.RayCast_s_r),_=b2Vec2.DotVV(f,f);if(0===_)return!1;const g=b2Vec2.DotVV(b2Vec2.SubVV(p,a,b2Vec2.s_t0),f)/_;return!(g<0||1<g||(t.fraction=m,b2Rot.MulRV(i.q,t.normal,t.normal),u>0&&t.normal.SelfNeg(),0))}ComputeAABB(t,e,i){const n=b2Transform.MulXV(e,this.m_vertex1,b2EdgeShape.ComputeAABB_s_v1),r=b2Transform.MulXV(e,this.m_vertex2,b2EdgeShape.ComputeAABB_s_v2);b2Vec2.MinV(n,r,t.lowerBound),b2Vec2.MaxV(n,r,t.upperBound);const s=this.m_radius;t.lowerBound.SelfSubXY(s,s),t.upperBound.SelfAddXY(s,s)}ComputeMass(t,e){t.mass=0,b2Vec2.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,n){return n.SetZero(),0}Dump(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_oneSided = %s;\n",this.m_oneSided)}}b2EdgeShape.ComputeDistance_s_v1=new b2Vec2,b2EdgeShape.ComputeDistance_s_v2=new b2Vec2,b2EdgeShape.ComputeDistance_s_d=new b2Vec2,b2EdgeShape.ComputeDistance_s_s=new b2Vec2,b2EdgeShape.RayCast_s_p1=new b2Vec2,b2EdgeShape.RayCast_s_p2=new b2Vec2,b2EdgeShape.RayCast_s_d=new b2Vec2,b2EdgeShape.RayCast_s_e=new b2Vec2,b2EdgeShape.RayCast_s_q=new b2Vec2,b2EdgeShape.RayCast_s_r=new b2Vec2,b2EdgeShape.ComputeAABB_s_v1=new b2Vec2,b2EdgeShape.ComputeAABB_s_v2=new b2Vec2;class b2ChainShape extends b2Shape{constructor(){super(t.ShapeType.e_chainShape,m),this.m_vertices=[],this.m_count=0,this.m_prevVertex=new b2Vec2,this.m_nextVertex=new b2Vec2}CreateLoop(...t){if("number"==typeof t[0][0]){const e=t[0];if(e.length%2!=0)throw new Error;return this._CreateLoop(t=>({x:e[2*t],y:e[2*t+1]}),e.length/2)}{const e=t[0],i=t[1]||e.length;return this._CreateLoop(t=>e[t],i)}}_CreateLoop(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=b2Vec2.MakeArray(this.m_count);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}CreateChain(...t){if("number"==typeof t[0][0]){const e=t[0],i=t[1],n=t[2];if(e.length%2!=0)throw new Error;return this._CreateChain(t=>({x:e[2*t],y:e[2*t+1]}),e.length/2,i,n)}{const e=t[0],i=t[1]||e.length,n=t[2],r=t[3];return this._CreateChain(t=>e[t],i,n,r)}}_CreateChain(t,e,i,n){this.m_count=e,this.m_vertices=b2Vec2.MakeArray(e);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_prevVertex.Copy(i),this.m_nextVertex.Copy(n),this}Clone(){return(new b2ChainShape).Copy(this)}Copy(t){return super.Copy(t),this._CreateChain(e=>t.m_vertices[e],t.m_count,t.m_prevVertex,t.m_nextVertex),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this}GetChildCount(){return this.m_count-1}GetChildEdge(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),t.m_oneSided=!0,e>0?t.m_vertex0.Copy(this.m_vertices[e-1]):t.m_vertex0.Copy(this.m_prevVertex),e<this.m_count-2?t.m_vertex3.Copy(this.m_vertices[e+2]):t.m_vertex3.Copy(this.m_nextVertex)}TestPoint(t,e){return!1}ComputeDistance(t,e,i,n){const r=b2ChainShape.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,n),r.ComputeDistance(t,e,i,0)}RayCast(t,e,i,n){const r=b2ChainShape.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[n]),r.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),r.RayCast(t,e,i,0)}ComputeAABB(t,e,i){const n=this.m_vertices[i],r=this.m_vertices[(i+1)%this.m_count],s=b2Transform.MulXV(e,n,b2ChainShape.ComputeAABB_s_v1),o=b2Transform.MulXV(e,r,b2ChainShape.ComputeAABB_s_v2),a=b2Vec2.MinV(s,o,b2ChainShape.ComputeAABB_s_lower),l=b2Vec2.MaxV(s,o,b2ChainShape.ComputeAABB_s_upper);t.lowerBound.x=a.x-this.m_radius,t.lowerBound.y=a.y-this.m_radius,t.upperBound.x=l.x+this.m_radius,t.upperBound.y=l.y+this.m_radius}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,n){return n.SetZero(),0}Dump(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(let e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y)}}b2ChainShape.ComputeDistance_s_edgeShape=new b2EdgeShape,b2ChainShape.RayCast_s_edgeShape=new b2EdgeShape,b2ChainShape.ComputeAABB_s_v1=new b2Vec2,b2ChainShape.ComputeAABB_s_v2=new b2Vec2,b2ChainShape.ComputeAABB_s_lower=new b2Vec2,b2ChainShape.ComputeAABB_s_upper=new b2Vec2;class b2CircleShape extends b2Shape{constructor(e=0){super(t.ShapeType.e_circleShape,e),this.m_p=new b2Vec2}Set(t,e=this.m_radius){return this.m_p.Copy(t),this.m_radius=e,this}Clone(){return(new b2CircleShape).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const i=b2Transform.MulXV(t,this.m_p,b2CircleShape.TestPoint_s_center),n=b2Vec2.SubVV(e,i,b2CircleShape.TestPoint_s_d);return b2Vec2.DotVV(n,n)<=b2Sq(this.m_radius)}ComputeDistance(t,e,i,n){const r=b2Transform.MulXV(t,this.m_p,b2CircleShape.ComputeDistance_s_center);return b2Vec2.SubVV(e,r,i),i.Normalize()-this.m_radius}RayCast(t,e,i,r){const s=b2Transform.MulXV(i,this.m_p,b2CircleShape.RayCast_s_position),o=b2Vec2.SubVV(e.p1,s,b2CircleShape.RayCast_s_s),a=b2Vec2.DotVV(o,o)-b2Sq(this.m_radius),l=b2Vec2.SubVV(e.p2,e.p1,b2CircleShape.RayCast_s_r),c=b2Vec2.DotVV(o,l),h=b2Vec2.DotVV(l,l),u=c*c-h*a;if(u<0||h<n)return!1;let d=-(c+z(u));return 0<=d&&d<=e.maxFraction*h&&(d/=h,t.fraction=d,b2Vec2.AddVMulSV(o,d,l,t.normal).SelfNormalize(),!0)}ComputeAABB(t,e,i){const n=b2Transform.MulXV(e,this.m_p,b2CircleShape.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}ComputeMass(t,e){const i=b2Sq(this.m_radius);t.mass=e*s*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+b2Vec2.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,r){const o=b2Transform.MulXV(i,this.m_p,new b2Vec2),a=-(b2Vec2.DotVV(t,o)-e);if(a<-this.m_radius+n)return 0;if(a>this.m_radius)return r.Copy(o),s*this.m_radius*this.m_radius;const l=this.m_radius*this.m_radius,c=a*a,h=l*(q(a/this.m_radius)+s/2)+a*z(l-c),u=-2/3*W(l-c,1.5)/h;return r.x=o.x+t.x*u,r.y=o.y+t.y*u,h}Dump(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}b2CircleShape.TestPoint_s_center=new b2Vec2,b2CircleShape.TestPoint_s_d=new b2Vec2,b2CircleShape.ComputeDistance_s_center=new b2Vec2,b2CircleShape.RayCast_s_position=new b2Vec2,b2CircleShape.RayCast_s_s=new b2Vec2,b2CircleShape.RayCast_s_r=new b2Vec2,b2CircleShape.ComputeAABB_s_p=new b2Vec2;const yt=new b2Vec2,xt=new b2Vec2;function b2CollideCircles(e,i,n,r,s){e.pointCount=0;const o=b2Transform.MulXV(n,i.m_p,yt),a=b2Transform.MulXV(s,r.m_p,xt),l=b2Vec2.DistanceSquaredVV(o,a),c=i.m_radius+r.m_radius;l>c*c||(e.type=t.ManifoldType.e_circles,e.localPoint.Copy(i.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0)}const vt=new b2Vec2,St=new b2Vec2,wt=new b2Vec2;function b2CollidePolygonAndCircle(e,r,s,o,a){e.pointCount=0;const l=b2Transform.MulXV(a,o.m_p,vt),c=b2Transform.MulTXV(s,l,St);let h=0,u=-i;const d=r.m_radius+o.m_radius,m=r.m_count,p=r.m_vertices,f=r.m_normals;for(let t=0;t<m;++t){const e=b2Vec2.DotVV(f[t],b2Vec2.SubVV(c,p[t],b2Vec2.s_t0));if(e>d)return;e>u&&(u=e,h=t)}const _=h,g=(_+1)%m,b=p[_],y=p[g];if(u<n)return e.pointCount=1,e.type=t.ManifoldType.e_faceA,e.localNormal.Copy(f[h]),b2Vec2.MidVV(b,y,e.localPoint),e.points[0].localPoint.Copy(o.m_p),void(e.points[0].id.key=0);const x=b2Vec2.DotVV(b2Vec2.SubVV(c,b,b2Vec2.s_t0),b2Vec2.SubVV(y,b,b2Vec2.s_t1)),v=b2Vec2.DotVV(b2Vec2.SubVV(c,y,b2Vec2.s_t0),b2Vec2.SubVV(b,y,b2Vec2.s_t1));if(x<=0){if(b2Vec2.DistanceSquaredVV(c,b)>d*d)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,b2Vec2.SubVV(c,b,e.localNormal).SelfNormalize(),e.localPoint.Copy(b),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else if(v<=0){if(b2Vec2.DistanceSquaredVV(c,y)>d*d)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,b2Vec2.SubVV(c,y,e.localNormal).SelfNormalize(),e.localPoint.Copy(y),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else{const i=b2Vec2.MidVV(b,y,wt),n=b2Vec2.DotVV(b2Vec2.SubVV(c,i,b2Vec2.s_t1),f[_]);if(n>d)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,e.localNormal.Copy(f[_]).SelfNormalize(),e.localPoint.Copy(i),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}}const Mt=new b2Vec2,At=new b2Vec2,Vt=new b2Vec2,Ct=new b2Vec2,Tt=new b2Vec2,Bt=new b2Vec2,Pt=new b2Vec2,Et=new b2ContactID;function b2CollideEdgeAndCircle(e,i,n,r,s){e.pointCount=0;const o=b2Transform.MulTXV(n,b2Transform.MulXV(s,r.m_p,b2Vec2.s_t0),Mt),a=i.m_vertex1,l=i.m_vertex2,c=b2Vec2.SubVV(l,a,At),h=Pt.Set(c.y,-c.x),u=b2Vec2.DotVV(h,b2Vec2.SubVV(o,a,b2Vec2.s_t0)),d=i.m_oneSided;if(d&&u<0)return;const m=b2Vec2.DotVV(c,b2Vec2.SubVV(l,o,b2Vec2.s_t0)),p=b2Vec2.DotVV(c,b2Vec2.SubVV(o,a,b2Vec2.s_t0)),f=i.m_radius+r.m_radius,_=Et;if(_.cf.indexB=0,_.cf.typeB=t.ContactFeatureType.e_vertex,p<=0){const n=a,s=b2Vec2.SubVV(o,n,Vt),l=b2Vec2.DotVV(s,s);if(l>f*f)return;if(i.m_oneSided){const t=i.m_vertex0,e=a,n=b2Vec2.SubVV(e,t,Ct),r=b2Vec2.DotVV(n,b2Vec2.SubVV(e,o,b2Vec2.s_t0));if(r>0)return}return _.cf.indexA=0,_.cf.typeA=t.ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(n),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(r.m_p)}if(m<=0){const n=l,s=b2Vec2.SubVV(o,n,Vt),a=b2Vec2.DotVV(s,s);if(a>f*f)return;if(i.m_oneSided){const t=i.m_vertex3,e=l,n=b2Vec2.SubVV(t,e,Tt),r=b2Vec2.DotVV(n,b2Vec2.SubVV(o,e,b2Vec2.s_t0));if(r>0)return}return _.cf.indexA=1,_.cf.typeA=t.ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(n),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(r.m_p)}const g=b2Vec2.DotVV(c,c),b=Bt;b.x=1/g*(m*a.x+p*l.x),b.y=1/g*(m*a.y+p*l.y);const y=b2Vec2.SubVV(o,b,Vt),x=b2Vec2.DotVV(y,y);x>f*f||(u<0&&h.Set(-h.x,-h.y),h.Normalize(),_.cf.indexA=0,_.cf.typeA=t.ContactFeatureType.e_face,e.pointCount=1,e.type=t.ManifoldType.e_faceA,e.localNormal.Copy(h),e.localPoint.Copy(a),e.points[0].id.Copy(_),e.points[0].localPoint.Copy(r.m_p))}var Lt;!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(Lt||(Lt={}));class b2EPAxis{constructor(){this.normal=new b2Vec2,this.type=Lt.e_unknown,this.index=0,this.separation=0}}const Rt=new b2EPAxis,It=[new b2Vec2,new b2Vec2],Dt=new b2EPAxis,Gt=new b2Vec2,Ft=new b2Transform,kt=new b2Vec2,Ot=new b2Vec2,Nt=new b2Vec2,Ut=new b2Vec2,zt=new b2Vec2,Wt=new b2Vec2,Ht=new b2Vec2,jt=new class b2TempPolygon{constructor(){this.vertices=[],this.normals=[],this.count=0}},Jt=new class b2ReferenceFace{constructor(){this.i1=0,this.i2=0,this.v1=new b2Vec2,this.v2=new b2Vec2,this.normal=new b2Vec2,this.sideNormal1=new b2Vec2,this.sideOffset1=0,this.sideNormal2=new b2Vec2,this.sideOffset2=0}},qt=[new b2ClipVertex,new b2ClipVertex],Xt=[new b2ClipVertex,new b2ClipVertex],Yt=[new b2ClipVertex,new b2ClipVertex];function b2CollideEdgeAndPolygon(e,i,n,r,s){e.pointCount=0;const o=b2Transform.MulTXX(n,s,Ft),a=b2Transform.MulXV(o,r.m_centroid,kt),c=i.m_vertex1,h=i.m_vertex2,u=b2Vec2.SubVV(h,c,Ot);u.Normalize();const d=Nt.Set(u.y,-u.x),m=b2Vec2.DotVV(d,b2Vec2.SubVV(a,c,b2Vec2.s_t0)),p=i.m_oneSided;if(p&&m<0)return;const f=jt;f.count=r.m_count;for(let t=0;t<r.m_count;++t)f.vertices.length<=t&&f.vertices.push(new b2Vec2),f.normals.length<=t&&f.normals.push(new b2Vec2),b2Transform.MulXV(o,r.m_vertices[t],f.vertices[t]),b2Rot.MulRV(o.q,r.m_normals[t],f.normals[t]);const _=r.m_radius+i.m_radius,g=function b2ComputeEdgeSeparation(t,e,i){const n=Rt;n.type=Lt.e_edgeA,n.index=-1,n.separation=-Number.MAX_VALUE,n.normal.SetZero();const r=It;r[0].Copy(i),r[1].Copy(i).SelfNeg();for(let i=0;i<2;++i){let s=Number.MAX_VALUE;for(let n=0;n<t.count;++n){const o=b2Vec2.DotVV(r[i],b2Vec2.SubVV(t.vertices[n],e,b2Vec2.s_t0));o<s&&(s=o)}s>n.separation&&(n.index=i,n.separation=s,n.normal.Copy(r[i]))}return n}(f,c,d);if(g.separation>_)return;const b=function b2ComputePolygonSeparation(t,e,i){const n=Dt;n.type=Lt.e_unknown,n.index=-1,n.separation=-Number.MAX_VALUE,n.normal.SetZero();for(let r=0;r<t.count;++r){const s=b2Vec2.NegV(t.normals[r],Gt),o=b2Vec2.DotVV(s,b2Vec2.SubVV(t.vertices[r],e,b2Vec2.s_t0)),a=b2Vec2.DotVV(s,b2Vec2.SubVV(t.vertices[r],i,b2Vec2.s_t0)),l=b2Min(o,a);l>n.separation&&(n.type=Lt.e_edgeB,n.index=r,n.separation=l,n.normal.Copy(s))}return n}(f,c,h);if(b.separation>_)return;let y;if(y=b.separation-_>.98*(g.separation-_)+.001?b:g,p){const t=b2Vec2.SubVV(c,i.m_vertex0,Ut);t.Normalize();const e=zt.Set(t.y,-t.x),n=b2Vec2.CrossVV(t,u)>=0,r=b2Vec2.SubVV(i.m_vertex3,h,Wt);r.Normalize();const s=Ht.Set(r.y,-r.x),o=b2Vec2.CrossVV(u,r)>=0,a=.1,l=b2Vec2.DotVV(y.normal,u)<=0;if(l)if(n){if(b2Vec2.CrossVV(y.normal,e)>a)return}else y=g;else if(o){if(b2Vec2.CrossVV(s,y.normal)>a)return}else y=g}const x=qt,v=Jt;if(y.type===Lt.e_edgeA){e.type=t.ManifoldType.e_faceA;let i=0,n=b2Vec2.DotVV(y.normal,f.normals[0]);for(let t=1;t<f.count;++t){const e=b2Vec2.DotVV(y.normal,f.normals[t]);e<n&&(n=e,i=t)}const r=i,s=r+1<f.count?r+1:0;x[0].v.Copy(f.vertices[r]),x[0].id.cf.indexA=0,x[0].id.cf.indexB=r,x[0].id.cf.typeA=t.ContactFeatureType.e_face,x[0].id.cf.typeB=t.ContactFeatureType.e_vertex,x[1].v.Copy(f.vertices[s]),x[1].id.cf.indexA=0,x[1].id.cf.indexB=s,x[1].id.cf.typeA=t.ContactFeatureType.e_face,x[1].id.cf.typeB=t.ContactFeatureType.e_vertex,v.i1=0,v.i2=1,v.v1.Copy(c),v.v2.Copy(h),v.normal.Copy(y.normal),v.sideNormal1.Copy(u).SelfNeg(),v.sideNormal2.Copy(u)}else e.type=t.ManifoldType.e_faceB,x[0].v.Copy(h),x[0].id.cf.indexA=1,x[0].id.cf.indexB=y.index,x[0].id.cf.typeA=t.ContactFeatureType.e_vertex,x[0].id.cf.typeB=t.ContactFeatureType.e_face,x[1].v.Copy(c),x[1].id.cf.indexA=0,x[1].id.cf.indexB=y.index,x[1].id.cf.typeA=t.ContactFeatureType.e_vertex,x[1].id.cf.typeB=t.ContactFeatureType.e_face,v.i1=y.index,v.i2=v.i1+1<f.count?v.i1+1:0,v.v1.Copy(f.vertices[v.i1]),v.v2.Copy(f.vertices[v.i2]),v.normal.Copy(f.normals[v.i1]),v.sideNormal1.Set(v.normal.y,-v.normal.x),v.sideNormal2.Copy(v.sideNormal1).SelfNeg();v.sideOffset1=b2Vec2.DotVV(v.sideNormal1,v.v1),v.sideOffset2=b2Vec2.DotVV(v.sideNormal2,v.v2);const S=Xt,w=Yt;let M;if((M=b2ClipSegmentToLine(S,x,v.sideNormal1,v.sideOffset1,v.i1))<l)return;if((M=b2ClipSegmentToLine(w,S,v.sideNormal2,v.sideOffset2,v.i2))<l)return;y.type===Lt.e_edgeA?(e.localNormal.Copy(v.normal),e.localPoint.Copy(v.v1)):(e.localNormal.Copy(r.m_normals[v.i1]),e.localPoint.Copy(r.m_vertices[v.i1]));let A=0;for(let t=0;t<l;++t){const i=b2Vec2.DotVV(v.normal,b2Vec2.SubVV(w[t].v,v.v1,b2Vec2.s_t0));if(i<=_){const i=e.points[A];y.type===Lt.e_edgeA?(b2Transform.MulTXV(o,w[t].v,i.localPoint),i.id.Copy(w[t].id)):(i.localPoint.Copy(w[t].v),i.id.cf.typeA=w[t].id.cf.typeB,i.id.cf.typeB=w[t].id.cf.typeA,i.id.cf.indexA=w[t].id.cf.indexB,i.id.cf.indexB=w[t].id.cf.indexA),++A}}e.pointCount=A}const Zt=new b2Transform,Kt=new b2Vec2,Qt=new b2Vec2;function b2FindMaxSeparation(t,e,n,r,s){const o=e.m_count,a=r.m_count,l=e.m_normals,c=e.m_vertices,h=r.m_vertices,u=b2Transform.MulTXX(s,n,Zt);let d=0,m=-i;for(let t=0;t<o;++t){const e=b2Rot.MulRV(u.q,l[t],Kt),n=b2Transform.MulXV(u,c[t],Qt);let r=i;for(let t=0;t<a;++t){const i=b2Vec2.DotVV(e,b2Vec2.SubVV(h[t],n,b2Vec2.s_t0));i<r&&(r=i)}r>m&&(m=r,d=t)}return t[0]=d,m}const $t=new b2Vec2,te=[new b2ClipVertex,new b2ClipVertex],ee=[new b2ClipVertex,new b2ClipVertex],ie=[new b2ClipVertex,new b2ClipVertex],ne=[0],re=[0],se=new b2Vec2,oe=new b2Vec2,ae=new b2Vec2,le=new b2Vec2,ce=new b2Vec2,he=new b2Vec2,ue=new b2Vec2,de=new b2Vec2;function b2CollidePolygons(e,n,r,s,o){e.pointCount=0;const a=n.m_radius+s.m_radius,c=ne;c[0]=0;const h=b2FindMaxSeparation(c,n,r,s,o);if(h>a)return;const d=re;d[0]=0;const m=b2FindMaxSeparation(d,s,o,n,r);if(m>a)return;let p,f,_,g,b=0,y=0;const x=.1*u;m>h+x?(p=s,f=n,_=o,g=r,b=d[0],e.type=t.ManifoldType.e_faceB,y=1):(p=n,f=s,_=r,g=o,b=c[0],e.type=t.ManifoldType.e_faceA,y=0);const v=te;!function b2FindIncidentEdge(e,n,r,s,o,a){const l=n.m_normals,c=o.m_count,h=o.m_vertices,u=o.m_normals,d=b2Rot.MulTRV(a.q,b2Rot.MulRV(r.q,l[s],b2Vec2.s_t0),$t);let m=0,p=i;for(let t=0;t<c;++t){const e=b2Vec2.DotVV(d,u[t]);e<p&&(p=e,m=t)}const f=m,_=f+1<c?f+1:0,g=e[0];b2Transform.MulXV(a,h[f],g.v);const b=g.id.cf;b.indexA=s,b.indexB=f,b.typeA=t.ContactFeatureType.e_face,b.typeB=t.ContactFeatureType.e_vertex;const y=e[1];b2Transform.MulXV(a,h[_],y.v);const x=y.id.cf;x.indexA=s,x.indexB=_,x.typeA=t.ContactFeatureType.e_face,x.typeB=t.ContactFeatureType.e_vertex}(v,p,_,b,f,g);const S=p.m_count,w=p.m_vertices,M=b,A=b+1<S?b+1:0,V=w[M],C=w[A],T=b2Vec2.SubVV(C,V,se);T.Normalize();const B=b2Vec2.CrossVOne(T,oe),P=b2Vec2.MidVV(V,C,ae),E=b2Rot.MulRV(_.q,T,ce),L=b2Vec2.CrossVOne(E,le),R=b2Transform.MulXV(_,V,ue),I=b2Transform.MulXV(_,C,de),D=b2Vec2.DotVV(L,R),G=-b2Vec2.DotVV(E,R)+a,F=b2Vec2.DotVV(E,I)+a,k=ee,O=ie;let N;const U=b2Vec2.NegV(E,he);if((N=b2ClipSegmentToLine(k,v,U,G,M))<2)return;if((N=b2ClipSegmentToLine(O,k,E,F,A))<2)return;e.localNormal.Copy(B),e.localPoint.Copy(P);let z=0;for(let t=0;t<l;++t){const i=O[t],n=b2Vec2.DotVV(L,i.v)-D;if(n<=a){const t=e.points[z];if(b2Transform.MulTXV(g,i.v,t.localPoint),t.id.Copy(i.id),y){const e=t.id.cf;t.id.cf.indexA=e.indexB,t.id.cf.indexB=e.indexA,t.id.cf.typeA=e.typeB,t.id.cf.typeB=e.typeA}++z}}e.pointCount=z}class b2PolygonShape extends b2Shape{constructor(){super(t.ShapeType.e_polygonShape,m),this.m_centroid=new b2Vec2(0,0),this.m_vertices=[],this.m_normals=[],this.m_count=0}Clone(){return(new b2PolygonShape).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=b2Vec2.MakeArray(this.m_count),this.m_normals=b2Vec2.MakeArray(this.m_count);for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(...t){if("number"==typeof t[0][0]){const e=t[0];if(e.length%2!=0)throw new Error;return this._Set(t=>({x:e[2*t],y:e[2*t+1]}),e.length/2)}{const e=t[0],i=t[1]||e.length;return this._Set(t=>e[t],i)}}_Set(t,e){if(e<3)return this.SetAsBox(1,1);let i=e;const n=[];for(let e=0;e<i;++e){const i=t(e);let r=!0;for(let t=0;t<n.length;++t)if(b2Vec2.DistanceSquaredVV(i,n[t])<.5*u*(.5*u)){r=!1;break}r&&n.push(i)}if((i=n.length)<3)return this.SetAsBox(1,1);let r=0,s=n[0].x;for(let t=1;t<i;++t){const e=n[t].x;(e>s||e===s&&n[t].y<n[r].y)&&(r=t,s=e)}const o=[];let a=0,l=r;for(;;){o[a]=l;let t=0;for(let e=1;e<i;++e){if(t===l){t=e;continue}const i=b2Vec2.SubVV(n[t],n[o[a]],b2PolygonShape.Set_s_r),r=b2Vec2.SubVV(n[e],n[o[a]],b2PolygonShape.Set_s_v),s=b2Vec2.CrossVV(i,r);s<0&&(t=e),0===s&&r.LengthSquared()>i.LengthSquared()&&(t=e)}if(++a,l=t,t===r)break}this.m_count=a,this.m_vertices=b2Vec2.MakeArray(this.m_count),this.m_normals=b2Vec2.MakeArray(this.m_count);for(let t=0;t<a;++t)this.m_vertices[t].Copy(n[o[t]]);for(let t=0;t<a;++t){const e=this.m_vertices[t],i=this.m_vertices[(t+1)%a],n=b2Vec2.SubVV(i,e,b2Vec2.s_t0);b2Vec2.CrossVOne(n,this.m_normals[t]).SelfNormalize()}return b2PolygonShape.ComputeCentroid(this.m_vertices,a,this.m_centroid),this}SetAsBox(t,e,i,n=0){if(this.m_count=4,this.m_vertices=b2Vec2.MakeArray(this.m_count),this.m_normals=b2Vec2.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);const t=new b2Transform;t.SetPosition(i),t.SetRotationAngle(n);for(let e=0;e<this.m_count;++e)b2Transform.MulXV(t,this.m_vertices[e],this.m_vertices[e]),b2Rot.MulRV(t.q,this.m_normals[e],this.m_normals[e])}return this}TestPoint(t,e){const i=b2Transform.MulTXV(t,e,b2PolygonShape.TestPoint_s_pLocal);for(let t=0;t<this.m_count;++t){const e=b2Vec2.DotVV(this.m_normals[t],b2Vec2.SubVV(i,this.m_vertices[t],b2Vec2.s_t0));if(e>0)return!1}return!0}ComputeDistance(t,e,n,r){const s=b2Transform.MulTXV(t,e,b2PolygonShape.ComputeDistance_s_pLocal);let o=-i;const a=b2PolygonShape.ComputeDistance_s_normalForMaxDistance.Copy(s);for(let t=0;t<this.m_count;++t){const e=b2Vec2.DotVV(this.m_normals[t],b2Vec2.SubVV(s,this.m_vertices[t],b2Vec2.s_t0));e>o&&(o=e,a.Copy(this.m_normals[t]))}if(o>0){const e=b2PolygonShape.ComputeDistance_s_minDistance.Copy(a);let i=o*o;for(let t=0;t<this.m_count;++t){const n=b2Vec2.SubVV(s,this.m_vertices[t],b2PolygonShape.ComputeDistance_s_distance),r=n.LengthSquared();i>r&&(e.Copy(n),i=r)}return b2Rot.MulRV(t.q,e,n),n.Normalize(),Math.sqrt(i)}return b2Rot.MulRV(t.q,a,n),o}RayCast(t,e,i,n){const r=b2Transform.MulTXV(i,e.p1,b2PolygonShape.RayCast_s_p1),s=b2Transform.MulTXV(i,e.p2,b2PolygonShape.RayCast_s_p2),o=b2Vec2.SubVV(s,r,b2PolygonShape.RayCast_s_d);let a=0,l=e.maxFraction,c=-1;for(let t=0;t<this.m_count;++t){const e=b2Vec2.DotVV(this.m_normals[t],b2Vec2.SubVV(this.m_vertices[t],r,b2Vec2.s_t0)),i=b2Vec2.DotVV(this.m_normals[t],o);if(0===i){if(e<0)return!1}else i<0&&e<a*i?(a=e/i,c=t):i>0&&e<l*i&&(l=e/i);if(l<a)return!1}return c>=0&&(t.fraction=a,b2Rot.MulRV(i.q,this.m_normals[c],t.normal),!0)}ComputeAABB(t,e,i){const n=b2Transform.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(n);for(let t=0;t<this.m_count;++t){const i=b2Transform.MulXV(e,this.m_vertices[t],b2PolygonShape.ComputeAABB_s_v);b2Vec2.MinV(i,n,n),b2Vec2.MaxV(i,r,r)}const s=this.m_radius;n.SelfSubXY(s,s),r.SelfAddXY(s,s)}ComputeMass(t,e){const i=b2PolygonShape.ComputeMass_s_center.SetZero();let n=0,r=0;const s=b2PolygonShape.ComputeMass_s_s.Copy(this.m_vertices[0]);for(let t=0;t<this.m_count;++t){const e=b2Vec2.SubVV(this.m_vertices[t],s,b2PolygonShape.ComputeMass_s_e1),o=b2Vec2.SubVV(this.m_vertices[(t+1)%this.m_count],s,b2PolygonShape.ComputeMass_s_e2),a=b2Vec2.CrossVV(e,o),l=.5*a;n+=l,i.SelfAdd(b2Vec2.MulSV(l*(1/3),b2Vec2.AddVV(e,o,b2Vec2.s_t0),b2Vec2.s_t1));const c=e.x,h=e.y,u=o.x,d=o.y,m=c*c+u*c+u*u,p=h*h+d*h+d*d;r+=1/3*.25*a*(m+p)}t.mass=e*n,i.SelfMul(1/n),b2Vec2.AddVV(i,s,t.center),t.I=e*r,t.I+=t.mass*(b2Vec2.DotVV(t.center,t.center)-b2Vec2.DotVV(i,i))}Validate(){for(let t=0;t<this.m_count;++t){const e=t,i=(t+1)%this.m_count,n=this.m_vertices[e],r=b2Vec2.SubVV(this.m_vertices[i],n,b2PolygonShape.Validate_s_e);for(let t=0;t<this.m_count;++t){if(t===e||t===i)continue;const s=b2Vec2.SubVV(this.m_vertices[t],n,b2PolygonShape.Validate_s_v),o=b2Vec2.CrossVV(r,s);if(o<0)return!1}}return!0}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,r){const s=b2Rot.MulTRV(i.q,t,b2PolygonShape.ComputeSubmergedArea_s_normalL),o=e-b2Vec2.DotVV(t,i.p),a=[];let l=0,c=-1,h=-1,u=!1;for(let t=0;t<this.m_count;++t){a[t]=b2Vec2.DotVV(s,this.m_vertices[t])-o;const e=a[t]<-n;t>0&&(e?u||(c=t-1,l++):u&&(h=t-1,l++)),u=e}switch(l){case 0:if(u){const t=b2PolygonShape.ComputeSubmergedArea_s_md;return this.ComputeMass(t,1),b2Transform.MulXV(i,t.center,r),t.mass}return 0;case 1:-1===c?c=this.m_count-1:h=this.m_count-1}const d=(c+1)%this.m_count,m=(h+1)%this.m_count,p=(0-a[c])/(a[d]-a[c]),f=(0-a[h])/(a[m]-a[h]),_=b2PolygonShape.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[c].x*(1-p)+this.m_vertices[d].x*p,this.m_vertices[c].y*(1-p)+this.m_vertices[d].y*p),g=b2PolygonShape.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[h].x*(1-f)+this.m_vertices[m].x*f,this.m_vertices[h].y*(1-f)+this.m_vertices[m].y*f);let b=0;const y=b2PolygonShape.ComputeSubmergedArea_s_center.SetZero();let x,v=this.m_vertices[d],S=d;for(;S!==m;){S=(S+1)%this.m_count,x=S===m?g:this.m_vertices[S];const t=.5*((v.x-_.x)*(x.y-_.y)-(v.y-_.y)*(x.x-_.x));b+=t,y.x+=t*(_.x+v.x+x.x)/3,y.y+=t*(_.y+v.y+x.y)/3,v=x}return y.SelfMul(1/b),b2Transform.MulXV(i,y,r),b}Dump(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(let e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}static ComputeCentroid(t,e,i){const n=i;n.SetZero();let r=0;const s=b2PolygonShape.ComputeCentroid_s_s.Copy(t[0]);for(let i=0;i<e;++i){const o=b2Vec2.SubVV(t[0],s,b2PolygonShape.ComputeCentroid_s_p1),a=b2Vec2.SubVV(t[i],s,b2PolygonShape.ComputeCentroid_s_p2),l=b2Vec2.SubVV(t[(i+1)%e],s,b2PolygonShape.ComputeCentroid_s_p3),c=b2Vec2.SubVV(a,o,b2PolygonShape.ComputeCentroid_s_e1),h=b2Vec2.SubVV(l,o,b2PolygonShape.ComputeCentroid_s_e2),u=b2Vec2.CrossVV(c,h),d=.5*u;r+=d,n.x+=d*(1/3)*(o.x+a.x+l.x),n.y+=d*(1/3)*(o.y+a.y+l.y)}return n.x=1/r*n.x+s.x,n.y=1/r*n.y+s.y,n}}b2PolygonShape.Set_s_r=new b2Vec2,b2PolygonShape.Set_s_v=new b2Vec2,b2PolygonShape.TestPoint_s_pLocal=new b2Vec2,b2PolygonShape.ComputeDistance_s_pLocal=new b2Vec2,b2PolygonShape.ComputeDistance_s_normalForMaxDistance=new b2Vec2,b2PolygonShape.ComputeDistance_s_minDistance=new b2Vec2,b2PolygonShape.ComputeDistance_s_distance=new b2Vec2,b2PolygonShape.RayCast_s_p1=new b2Vec2,b2PolygonShape.RayCast_s_p2=new b2Vec2,b2PolygonShape.RayCast_s_d=new b2Vec2,b2PolygonShape.ComputeAABB_s_v=new b2Vec2,b2PolygonShape.ComputeMass_s_center=new b2Vec2,b2PolygonShape.ComputeMass_s_s=new b2Vec2,b2PolygonShape.ComputeMass_s_e1=new b2Vec2,b2PolygonShape.ComputeMass_s_e2=new b2Vec2,b2PolygonShape.Validate_s_e=new b2Vec2,b2PolygonShape.Validate_s_v=new b2Vec2,b2PolygonShape.ComputeSubmergedArea_s_normalL=new b2Vec2,b2PolygonShape.ComputeSubmergedArea_s_md=new b2MassData,b2PolygonShape.ComputeSubmergedArea_s_intoVec=new b2Vec2,b2PolygonShape.ComputeSubmergedArea_s_outoVec=new b2Vec2,b2PolygonShape.ComputeSubmergedArea_s_center=new b2Vec2,b2PolygonShape.ComputeCentroid_s_s=new b2Vec2,b2PolygonShape.ComputeCentroid_s_p1=new b2Vec2,b2PolygonShape.ComputeCentroid_s_p2=new b2Vec2,b2PolygonShape.ComputeCentroid_s_p3=new b2Vec2,b2PolygonShape.ComputeCentroid_s_e1=new b2Vec2,b2PolygonShape.ComputeCentroid_s_e2=new b2Vec2,t.toiTime=0,t.toiMaxTime=0,t.toiCalls=0,t.toiIters=0,t.toiMaxIters=0,t.toiRootIters=0,t.toiMaxRootIters=0;const me=new b2Transform,pe=new b2Transform,fe=new b2Vec2,_e=new b2Vec2,ge=new b2Vec2,be=new b2Vec2,ye=new b2Vec2;class b2TOIInput{constructor(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep,this.tMax=0}}var xe,ve;(xe=t.TOIOutputState||(t.TOIOutputState={}))[xe.e_unknown=0]="e_unknown",xe[xe.e_failed=1]="e_failed",xe[xe.e_overlapped=2]="e_overlapped",xe[xe.e_touching=3]="e_touching",xe[xe.e_separated=4]="e_separated";class b2TOIOutput{constructor(){this.state=t.TOIOutputState.e_unknown,this.t=0}}(ve=t.SeparationFunctionType||(t.SeparationFunctionType={}))[ve.e_unknown=-1]="e_unknown",ve[ve.e_points=0]="e_points",ve[ve.e_faceA=1]="e_faceA",ve[ve.e_faceB=2]="e_faceB";class b2SeparationFunction{constructor(){this.m_sweepA=new b2Sweep,this.m_sweepB=new b2Sweep,this.m_type=t.SeparationFunctionType.e_unknown,this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2}Initialize(e,i,n,r,s,o){this.m_proxyA=i,this.m_proxyB=r;const a=e.count;this.m_sweepA.Copy(n),this.m_sweepB.Copy(s);const l=me,c=pe;if(this.m_sweepA.GetTransform(l,o),this.m_sweepB.GetTransform(c,o),1===a){this.m_type=t.SeparationFunctionType.e_points;const i=this.m_proxyA.GetVertex(e.indexA[0]),n=this.m_proxyB.GetVertex(e.indexB[0]),r=b2Transform.MulXV(l,i,fe),s=b2Transform.MulXV(c,n,_e);b2Vec2.SubVV(s,r,this.m_axis);const o=this.m_axis.Normalize();return this.m_localPoint.SetZero(),o}if(e.indexA[0]===e.indexA[1]){this.m_type=t.SeparationFunctionType.e_faceB;const i=this.m_proxyB.GetVertex(e.indexB[0]),n=this.m_proxyB.GetVertex(e.indexB[1]);b2Vec2.CrossVOne(b2Vec2.SubVV(n,i,b2Vec2.s_t0),this.m_axis).SelfNormalize();const r=b2Rot.MulRV(c.q,this.m_axis,ge);b2Vec2.MidVV(i,n,this.m_localPoint);const s=b2Transform.MulXV(c,this.m_localPoint,_e),o=this.m_proxyA.GetVertex(e.indexA[0]),a=b2Transform.MulXV(l,o,fe);let h=b2Vec2.DotVV(b2Vec2.SubVV(a,s,b2Vec2.s_t0),r);return h<0&&(this.m_axis.SelfNeg(),h=-h),h}{this.m_type=t.SeparationFunctionType.e_faceA;const i=this.m_proxyA.GetVertex(e.indexA[0]),n=this.m_proxyA.GetVertex(e.indexA[1]);b2Vec2.CrossVOne(b2Vec2.SubVV(n,i,b2Vec2.s_t0),this.m_axis).SelfNormalize();const r=b2Rot.MulRV(l.q,this.m_axis,ge);b2Vec2.MidVV(i,n,this.m_localPoint);const s=b2Transform.MulXV(l,this.m_localPoint,fe),o=this.m_proxyB.GetVertex(e.indexB[0]),a=b2Transform.MulXV(c,o,_e);let h=b2Vec2.DotVV(b2Vec2.SubVV(a,s,b2Vec2.s_t0),r);return h<0&&(this.m_axis.SelfNeg(),h=-h),h}}FindMinSeparation(e,i,n){const r=me,s=pe;switch(this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(s,n),this.m_type){case t.SeparationFunctionType.e_points:{const t=b2Rot.MulTRV(r.q,this.m_axis,be),n=b2Rot.MulTRV(s.q,b2Vec2.NegV(this.m_axis,b2Vec2.s_t0),ye);e[0]=this.m_proxyA.GetSupport(t),i[0]=this.m_proxyB.GetSupport(n);const o=this.m_proxyA.GetVertex(e[0]),a=this.m_proxyB.GetVertex(i[0]),l=b2Transform.MulXV(r,o,fe),c=b2Transform.MulXV(s,a,_e),h=b2Vec2.DotVV(b2Vec2.SubVV(c,l,b2Vec2.s_t0),this.m_axis);return h}case t.SeparationFunctionType.e_faceA:{const t=b2Rot.MulRV(r.q,this.m_axis,ge),n=b2Transform.MulXV(r,this.m_localPoint,fe),o=b2Rot.MulTRV(s.q,b2Vec2.NegV(t,b2Vec2.s_t0),ye);e[0]=-1,i[0]=this.m_proxyB.GetSupport(o);const a=this.m_proxyB.GetVertex(i[0]),l=b2Transform.MulXV(s,a,_e),c=b2Vec2.DotVV(b2Vec2.SubVV(l,n,b2Vec2.s_t0),t);return c}case t.SeparationFunctionType.e_faceB:{const t=b2Rot.MulRV(s.q,this.m_axis,ge),n=b2Transform.MulXV(s,this.m_localPoint,_e),o=b2Rot.MulTRV(r.q,b2Vec2.NegV(t,b2Vec2.s_t0),be);i[0]=-1,e[0]=this.m_proxyA.GetSupport(o);const a=this.m_proxyA.GetVertex(e[0]),l=b2Transform.MulXV(r,a,fe),c=b2Vec2.DotVV(b2Vec2.SubVV(l,n,b2Vec2.s_t0),t);return c}default:return e[0]=-1,i[0]=-1,0}}Evaluate(e,i,n){const r=me,s=pe;switch(this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(s,n),this.m_type){case t.SeparationFunctionType.e_points:{const t=this.m_proxyA.GetVertex(e),n=this.m_proxyB.GetVertex(i),o=b2Transform.MulXV(r,t,fe),a=b2Transform.MulXV(s,n,_e),l=b2Vec2.DotVV(b2Vec2.SubVV(a,o,b2Vec2.s_t0),this.m_axis);return l}case t.SeparationFunctionType.e_faceA:{const t=b2Rot.MulRV(r.q,this.m_axis,ge),e=b2Transform.MulXV(r,this.m_localPoint,fe),n=this.m_proxyB.GetVertex(i),o=b2Transform.MulXV(s,n,_e),a=b2Vec2.DotVV(b2Vec2.SubVV(o,e,b2Vec2.s_t0),t);return a}case t.SeparationFunctionType.e_faceB:{const t=b2Rot.MulRV(s.q,this.m_axis,ge),i=b2Transform.MulXV(s,this.m_localPoint,_e),n=this.m_proxyA.GetVertex(e),o=b2Transform.MulXV(r,n,fe),a=b2Vec2.DotVV(b2Vec2.SubVV(o,i,b2Vec2.s_t0),t);return a}default:return 0}}}const Se=new b2Timer,we=new b2SimplexCache,Me=new b2DistanceInput,Ae=new b2DistanceOutput,Ve=new b2SeparationFunction,Ce=[0],Te=[0],Be=new b2Sweep,Pe=new b2Sweep;function b2TimeOfImpact(e,i){const n=Se.Reset();++t.toiCalls,e.state=t.TOIOutputState.e_unknown,e.t=i.tMax;const r=i.proxyA,s=i.proxyB,o=b2Max(a,b2Max(r.m_count,s.m_count)),l=Be.Copy(i.sweepA),c=Pe.Copy(i.sweepB);l.Normalize(),c.Normalize();const h=i.tMax,d=r.m_radius+s.m_radius,m=b2Max(u,d-3*u),p=.25*u;let f=0,_=0;const g=we;g.count=0;const b=Me;for(b.proxyA.Copy(i.proxyA),b.proxyB.Copy(i.proxyB),b.useRadii=!1;;){const i=me,n=pe;l.GetTransform(i,f),c.GetTransform(n,f),b.transformA.Copy(i),b.transformB.Copy(n);const a=Ae;if(b2Distance(a,g,b),a.distance<=0){e.state=t.TOIOutputState.e_overlapped,e.t=0;break}if(a.distance<m+p){e.state=t.TOIOutputState.e_touching,e.t=f;break}const u=Ve;u.Initialize(g,r,l,s,c,f);let d=!1,y=h,x=0;for(;;){const i=Ce,n=Te;let r=u.FindMinSeparation(i,n,y);if(r>m+p){e.state=t.TOIOutputState.e_separated,e.t=h,d=!0;break}if(r>m-p){f=y;break}let s=u.Evaluate(i[0],n[0],f);if(s<m-p){e.state=t.TOIOutputState.e_failed,e.t=f,d=!0;break}if(s<=m+p){e.state=t.TOIOutputState.e_touching,e.t=f,d=!0;break}let a=0,l=f,c=y;for(;;){let e=0;e=1&a?l+(m-s)*(c-l)/(r-s):.5*(l+c),++a,++t.toiRootIters;const o=u.Evaluate(i[0],n[0],e);if(N(o-m)<p){y=e;break}if(o>m?(l=e,s=o):(c=e,r=o),50===a)break}if(t.toiMaxRootIters=b2Max(t.toiMaxRootIters,a),++x===o)break}if(++_,++t.toiIters,d)break;if(20===_){e.state=t.TOIOutputState.e_failed,e.t=f;break}}t.toiMaxIters=b2Max(t.toiMaxIters,_);const y=n.GetMilliseconds();t.toiMaxTime=b2Max(t.toiMaxTime,y),t.toiTime+=y}var Ee,Le,Re,Ie,De,Ge;(Ee=t.JointType||(t.JointType={}))[Ee.e_unknownJoint=0]="e_unknownJoint",Ee[Ee.e_revoluteJoint=1]="e_revoluteJoint",Ee[Ee.e_prismaticJoint=2]="e_prismaticJoint",Ee[Ee.e_distanceJoint=3]="e_distanceJoint",Ee[Ee.e_pulleyJoint=4]="e_pulleyJoint",Ee[Ee.e_mouseJoint=5]="e_mouseJoint",Ee[Ee.e_gearJoint=6]="e_gearJoint",Ee[Ee.e_wheelJoint=7]="e_wheelJoint",Ee[Ee.e_weldJoint=8]="e_weldJoint",Ee[Ee.e_frictionJoint=9]="e_frictionJoint",Ee[Ee.e_ropeJoint=10]="e_ropeJoint",Ee[Ee.e_motorJoint=11]="e_motorJoint",Ee[Ee.e_areaJoint=12]="e_areaJoint";class b2JointEdge{constructor(t){this._other=null,this.prev=null,this.next=null,this.joint=t}get other(){if(null===this._other)throw new Error;return this._other}set other(t){if(null!==this._other)throw new Error;this._other=t}Reset(){this._other=null,this.prev=null,this.next=null}}class b2JointDef{constructor(e){this.type=t.JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=e}}class b2Joint{constructor(e){this.m_type=t.JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new b2JointEdge(this),this.m_edgeB=new b2JointEdge(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=b2Maybe(e.collideConnected,!1),this.m_userData=b2Maybe(e.userData,null)}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}Dump(t){t("// Dump is not supported for this joint type.\n")}ShiftOrigin(t){}Draw(e){const i=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),r=i.p,s=n.p,o=this.GetAnchorA(b2Joint.Draw_s_p1),a=this.GetAnchorB(b2Joint.Draw_s_p2),l=b2Joint.Draw_s_color.SetRGB(.5,.8,.8);switch(this.m_type){case t.JointType.e_distanceJoint:e.DrawSegment(o,a,l);break;case t.JointType.e_pulleyJoint:{const t=this,i=t.GetGroundAnchorA(),n=t.GetGroundAnchorB();e.DrawSegment(i,o,l),e.DrawSegment(n,a,l),e.DrawSegment(i,n,l)}break;case t.JointType.e_mouseJoint:{const t=b2Joint.Draw_s_c;t.Set(0,1,0),e.DrawPoint(o,4,t),e.DrawPoint(a,4,t),t.Set(.8,.8,.8),e.DrawSegment(o,a,t)}break;default:e.DrawSegment(r,o,l),e.DrawSegment(o,a,l),e.DrawSegment(s,a,l)}}}b2Joint.Draw_s_p1=new b2Vec2,b2Joint.Draw_s_p2=new b2Vec2,b2Joint.Draw_s_color=new b2Color(.5,.8,.8),b2Joint.Draw_s_c=new b2Color;class b2DistanceJointDef extends b2JointDef{constructor(){super(t.JointType.e_distanceJoint),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.length=1,this.minLength=0,this.maxLength=i,this.stiffness=0,this.damping=0}Initialize(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=b2Max(b2Vec2.DistanceVV(i,n),u),this.minLength=this.length,this.maxLength=this.length}}class b2DistanceJoint extends b2Joint{constructor(t){super(t),this.m_stiffness=0,this.m_damping=0,this.m_bias=0,this.m_length=0,this.m_minLength=0,this.m_maxLength=0,this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_gamma=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new b2Vec2,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_currentLength=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_softMass=0,this.m_mass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_length=b2Max(b2Maybe(t.length,this.GetCurrentLength()),u),this.m_minLength=b2Max(b2Maybe(t.minLength,this.m_length),u),this.m_maxLength=b2Max(b2Maybe(t.maxLength,this.m_length),this.m_minLength),this.m_stiffness=b2Maybe(t.stiffness,0),this.m_damping=b2Maybe(t.damping,0)}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.x,e.y=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.y,e}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){return this.m_impulse=0,this.m_length=b2Max(u,t),this.m_length}GetLength(){return this.m_length}SetMinLength(t){return this.m_lowerImpulse=0,this.m_minLength=b2Clamp(t,u,this.m_maxLength),this.m_minLength}SetMaxLength(t){return this.m_upperImpulse=0,this.m_maxLength=b2Max(t,this.m_minLength),this.m_maxLength}GetCurrentLength(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,new b2Vec2),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,new b2Vec2);return b2Vec2.DistanceVV(t,e)}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.minLength = %.15f;\n",this.m_minLength),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),b2Rot.MulRV(c,this.m_lalcA,this.m_rA),b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),b2Rot.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.x=s.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=s.y+this.m_rB.y-e.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>u?this.m_u.SelfMul(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);const d=b2Vec2.CrossVV(this.m_rA,this.m_u),m=b2Vec2.CrossVV(this.m_rB,this.m_u);let p=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==p?1/p:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){const e=this.m_currentLength-this.m_length,i=this.m_damping,n=this.m_stiffness,r=t.step.dt;this.m_gamma=r*(i+r*n),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=e*r*n*this.m_gamma,p+=this.m_gamma,this.m_softMass=0!==p?1/p:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const e=b2Vec2.MulSV(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,b2DistanceJoint.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*b2Vec2.CrossVV(this.m_rA,e),a.SelfMulAdd(this.m_invMassB,e),l+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){const t=b2Vec2.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),s=b2Vec2.AddVCrossSV(n,r,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),o=b2Vec2.DotVV(this.m_u,b2Vec2.SubVV(s,t,b2Vec2.s_t0)),a=-this.m_softMass*(o+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;const l=b2Vec2.MulSV(a,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*b2Vec2.CrossVV(this.m_rA,l),n.SelfMulAdd(this.m_invMassB,l),r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,l)}{const s=this.m_currentLength-this.m_minLength,o=b2Max(0,s)*t.step.inv_dt,a=b2Vec2.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),l=b2Vec2.AddVCrossSV(n,r,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),c=b2Vec2.DotVV(this.m_u,b2Vec2.SubVV(l,a,b2Vec2.s_t0));let h=-this.m_mass*(c+o);const u=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(0,this.m_lowerImpulse+h),h=this.m_lowerImpulse-u;const d=b2Vec2.MulSV(h,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*b2Vec2.CrossVV(this.m_rA,d),n.SelfMulAdd(this.m_invMassB,d),r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,d)}{const s=this.m_maxLength-this.m_currentLength,o=b2Max(0,s)*t.step.inv_dt,a=b2Vec2.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),l=b2Vec2.AddVCrossSV(n,r,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),c=b2Vec2.DotVV(this.m_u,b2Vec2.SubVV(a,l,b2Vec2.s_t0));let h=-this.m_mass*(c+o);const u=this.m_upperImpulse;this.m_upperImpulse=b2Max(0,this.m_upperImpulse+h),h=this.m_upperImpulse-u;const d=b2Vec2.MulSV(-h,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*b2Vec2.CrossVV(this.m_rA,d),n.SelfMulAdd(this.m_invMassB,d),r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,d)}}else{const t=b2Vec2.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),s=b2Vec2.AddVCrossSV(n,r,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),o=b2Vec2.DotVV(this.m_u,b2Vec2.SubVV(s,t,b2Vec2.s_t0)),a=-this.m_mass*o;this.m_impulse+=a;const l=b2Vec2.MulSV(a,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*b2Vec2.CrossVV(this.m_rA,l),n.SelfMulAdd(this.m_invMassB,l),r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,l)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),a=b2Rot.MulRV(s,this.m_lalcA,this.m_rA),l=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),c=this.m_u;c.x=n.x+l.x-e.x-a.x,c.y=n.y+l.y-e.y-a.y;const h=this.m_u.Normalize();let d;if(this.m_minLength==this.m_maxLength)d=h-this.m_minLength;else if(h<this.m_minLength)d=h-this.m_minLength;else{if(!(this.m_maxLength<h))return!0;d=h-this.m_maxLength}const m=-this.m_mass*d,p=b2Vec2.MulSV(m,c,b2DistanceJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,p),i-=this.m_invIA*b2Vec2.CrossVV(a,p),n.SelfMulAdd(this.m_invMassB,p),r+=this.m_invIB*b2Vec2.CrossVV(l,p),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,N(d)<u}Draw(t){const e=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),r=b2Transform.MulXV(e,this.m_localAnchorA,b2DistanceJoint.Draw_s_pA),s=b2Transform.MulXV(n,this.m_localAnchorB,b2DistanceJoint.Draw_s_pB),o=b2Vec2.SubVV(s,r,b2DistanceJoint.Draw_s_axis);o.Normalize();const a=b2DistanceJoint.Draw_s_c1,l=b2DistanceJoint.Draw_s_c2,c=b2DistanceJoint.Draw_s_c3,h=b2DistanceJoint.Draw_s_c4;t.DrawSegment(r,s,h);const d=b2Vec2.AddVMulSV(r,this.m_length,o,b2DistanceJoint.Draw_s_pRest);if(t.DrawPoint(d,8,a),this.m_minLength!=this.m_maxLength){if(this.m_minLength>u){const e=b2Vec2.AddVMulSV(r,this.m_minLength,o,b2DistanceJoint.Draw_s_pMin);t.DrawPoint(e,4,l)}if(this.m_maxLength<i){const e=b2Vec2.AddVMulSV(r,this.m_maxLength,o,b2DistanceJoint.Draw_s_pMax);t.DrawPoint(e,4,c)}}}}b2DistanceJoint.InitVelocityConstraints_s_P=new b2Vec2,b2DistanceJoint.SolveVelocityConstraints_s_vpA=new b2Vec2,b2DistanceJoint.SolveVelocityConstraints_s_vpB=new b2Vec2,b2DistanceJoint.SolveVelocityConstraints_s_P=new b2Vec2,b2DistanceJoint.SolvePositionConstraints_s_P=new b2Vec2,b2DistanceJoint.Draw_s_pA=new b2Vec2,b2DistanceJoint.Draw_s_pB=new b2Vec2,b2DistanceJoint.Draw_s_axis=new b2Vec2,b2DistanceJoint.Draw_s_c1=new b2Color(.7,.7,.7),b2DistanceJoint.Draw_s_c2=new b2Color(.3,.9,.3),b2DistanceJoint.Draw_s_c3=new b2Color(.9,.3,.3),b2DistanceJoint.Draw_s_c4=new b2Color(.4,.4,.4),b2DistanceJoint.Draw_s_pRest=new b2Vec2,b2DistanceJoint.Draw_s_pMin=new b2Vec2,b2DistanceJoint.Draw_s_pMax=new b2Vec2;class b2AreaJoint extends b2Joint{constructor(t){super(t),this.m_stiffness=0,this.m_damping=0,this.m_impulse=0,this.m_targetArea=0,this.m_delta=new b2Vec2,this.m_bodies=t.bodies,this.m_stiffness=b2Maybe(t.stiffness,0),this.m_damping=b2Maybe(t.damping,0),this.m_targetLengths=b2MakeNumberArray(t.bodies.length),this.m_normals=b2Vec2.MakeArray(t.bodies.length),this.m_joints=[],this.m_deltas=b2Vec2.MakeArray(t.bodies.length);const e=new b2DistanceJointDef;e.stiffness=this.m_stiffness,e.damping=this.m_damping,this.m_targetArea=0;for(let t=0;t<this.m_bodies.length;++t){const i=this.m_bodies[t],n=this.m_bodies[(t+1)%this.m_bodies.length],r=i.GetWorldCenter(),s=n.GetWorldCenter();this.m_targetLengths[t]=b2Vec2.DistanceVV(r,s),this.m_targetArea+=b2Vec2.CrossVV(r,s),e.Initialize(i,n,r,s),this.m_joints[t]=i.GetWorld().CreateJoint(e)}this.m_targetArea*=.5}GetAnchorA(t){return t}GetAnchorB(t){return t}GetReactionForce(t,e){return e}GetReactionTorque(t){return 0}SetStiffness(t){this.m_stiffness=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetStiffness(t)}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDamping(t)}GetDamping(){return this.m_damping}Dump(t){t("Area joint dumping is not supported.\n")}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],r=t.positions[i.m_islandIndex].c,s=t.positions[n.m_islandIndex].c,o=this.m_deltas[e];b2Vec2.SubVV(s,r,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],n=t.velocities[i.m_islandIndex].v,r=this.m_deltas[e];n.x+=i.m_invMass*r.y*.5*this.m_impulse,n.y+=i.m_invMass*-r.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,i=0;for(let n=0;n<this.m_bodies.length;++n){const r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v,o=this.m_deltas[n];e+=o.LengthSquared()/r.GetMass(),i+=b2Vec2.CrossVV(s,o)}const n=-2*i/e;this.m_impulse+=n;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],r=t.velocities[i.m_islandIndex].v,s=this.m_deltas[e];r.x+=i.m_invMass*s.y*.5*n,r.y+=i.m_invMass*-s.x*.5*n}}SolvePositionConstraints(t){let e=0,i=0;for(let r=0;r<this.m_bodies.length;++r){const s=this.m_bodies[r],o=this.m_bodies[(r+1)%this.m_bodies.length],a=t.positions[s.m_islandIndex].c,l=t.positions[o.m_islandIndex].c,c=b2Vec2.SubVV(l,a,this.m_delta);let h=c.Length();h<n&&(h=1),this.m_normals[r].x=c.y/h,this.m_normals[r].y=-c.x/h,e+=h,i+=b2Vec2.CrossVV(a,l)}i*=.5;const r=this.m_targetArea-i,s=.5*r/e;let o=!0;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],n=t.positions[i.m_islandIndex].c,r=(e+1)%this.m_bodies.length,a=b2Vec2.AddVV(this.m_normals[e],this.m_normals[r],this.m_delta);a.SelfMul(s);const l=a.LengthSquared();l>b2Sq(_)&&a.SelfMul(_/z(l)),l>b2Sq(u)&&(o=!1),n.x+=a.x,n.y+=a.y}return o}}class b2Filter{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}Clone(){return(new b2Filter).Copy(this)}Copy(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}b2Filter.DEFAULT=new b2Filter;class b2FixtureDef{constructor(){this.userData=null,this.friction=.2,this.restitution=0,this.restitutionThreshold=1*o,this.density=0,this.isSensor=!1,this.filter=new b2Filter}}class b2FixtureProxy{constructor(t,e){this.aabb=new b2AABB,this.childIndex=0,this.fixture=t,this.childIndex=e,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),e),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}Reset(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}Touch(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}Synchronize(t,e){if(t===e)this.fixture.m_shape.ComputeAABB(this.aabb,t,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,b2Vec2.ZERO);else{const i=b2FixtureProxy.Synchronize_s_aabb1,n=b2FixtureProxy.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(i,t,this.childIndex),this.fixture.m_shape.ComputeAABB(n,e,this.childIndex),this.aabb.Combine2(i,n);const r=b2FixtureProxy.Synchronize_s_displacement;r.Copy(n.GetCenter()).SelfSub(i.GetCenter()),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r)}}}b2FixtureProxy.Synchronize_s_aabb1=new b2AABB,b2FixtureProxy.Synchronize_s_aabb2=new b2AABB,b2FixtureProxy.Synchronize_s_displacement=new b2Vec2;class b2Fixture{constructor(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=1*o,this.m_proxies=[],this.m_filter=new b2Filter,this.m_isSensor=!1,this.m_userData=null,this.m_body=t,this.m_shape=e.shape.Clone(),this.m_userData=b2Maybe(e.userData,null),this.m_friction=b2Maybe(e.friction,.2),this.m_restitution=b2Maybe(e.restitution,0),this.m_restitutionThreshold=b2Maybe(e.restitutionThreshold,0),this.m_filter.Copy(b2Maybe(e.filter,b2Filter.DEFAULT)),this.m_isSensor=b2Maybe(e.isSensor,!1),this.m_density=b2Maybe(e.density,0)}get m_proxyCount(){return this.m_proxies.length}Reset(){}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.Copy(t),this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){const e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}ComputeDistance(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}RayCast(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}GetMassData(t=new b2MassData){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetAABB(t){return this.m_proxies[t].aabb}Dump(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.restitutionThreshold = %.15f;\n",this.m_restitutionThreshold),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}CreateProxies(){if(0!==this.m_proxies.length)throw new Error;for(let t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new b2FixtureProxy(this,t)}DestroyProxies(){for(const t of this.m_proxies)t.Reset();this.m_proxies.length=0}TouchProxies(){for(const t of this.m_proxies)t.Touch()}SynchronizeProxies(t,e){for(const i of this.m_proxies)i.Synchronize(t,e)}}(Le=t.BodyType||(t.BodyType={}))[Le.b2_unknown=-1]="b2_unknown",Le[Le.b2_staticBody=0]="b2_staticBody",Le[Le.b2_kinematicBody=1]="b2_kinematicBody",Le[Le.b2_dynamicBody=2]="b2_dynamicBody";class b2Body{constructor(e,i){this.m_type=t.BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_enabledFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new b2Transform,this.m_xf0=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_angularVelocity=0,this.m_force=new b2Vec2,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=b2Maybe(e.bullet,!1),this.m_fixedRotationFlag=b2Maybe(e.fixedRotation,!1),this.m_autoSleepFlag=b2Maybe(e.allowSleep,!0),b2Maybe(e.awake,!1)&&b2Maybe(e.type,t.BodyType.b2_staticBody)!==t.BodyType.b2_staticBody&&(this.m_awakeFlag=!0),this.m_enabledFlag=b2Maybe(e.enabled,!0),this.m_world=i,this.m_xf.p.Copy(b2Maybe(e.position,b2Vec2.ZERO)),this.m_xf.q.SetAngle(b2Maybe(e.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(b2Maybe(e.linearVelocity,b2Vec2.ZERO)),this.m_angularVelocity=b2Maybe(e.angularVelocity,0),this.m_linearDamping=b2Maybe(e.linearDamping,0),this.m_angularDamping=b2Maybe(e.angularDamping,0),this.m_gravityScale=b2Maybe(e.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=b2Maybe(e.type,t.BodyType.b2_staticBody),this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}CreateFixture(t,e=0){return t instanceof b2Shape?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}CreateFixtureDef(t){if(this.m_world.IsLocked())throw new Error;const e=new b2Fixture(this,t);return this.m_enabledFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}CreateFixtureShapeDensity(t,e=0){const i=b2Body.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)}DestroyFixture(t){if(this.m_world.IsLocked())throw new Error;let e=this.m_fixtureList,i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}let n=this.m_contactList;for(;n;){const e=n.contact;n=n.next;const i=e.GetFixtureA(),r=e.GetFixtureB();t!==i&&t!==r||this.m_world.m_contactManager.Destroy(e)}this.m_enabledFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(let t=this.m_fixtureList;t;t=t.m_next)t.SynchronizeProxies(this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(t){this.SetTransformVec(t,this.GetAngle())}SetPositionXY(t,e){this.SetTransformXY(t,e,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(e){this.m_type!==t.BodyType.b2_staticBody&&(b2Vec2.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(e){this.m_type!==t.BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}ApplyForce(e,i,n=!0){this.m_type===t.BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x))}ApplyForceToCenter(e,i=!0){this.m_type===t.BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))}ApplyTorque(e,i=!0){this.m_type===t.BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))}ApplyLinearImpulse(e,i,n=!0){this.m_type===t.BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x)))}ApplyLinearImpulseToCenter(e,i=!0){this.m_type===t.BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))}ApplyAngularImpulse(e,i=!0){this.m_type===t.BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*b2Vec2.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*b2Vec2.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t.BodyType.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*b2Vec2.DotVV(e.center,e.center),this.m_invI=1/this.m_I);const i=b2Body.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,b2Vec2.SubVV(this.m_sweep.c,i,b2Vec2.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.BodyType.b2_staticBody||this.m_type===t.BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const e=b2Body.ResetMassData_s_localCenter.SetZero();for(let t=this.m_fixtureList;t;t=t.m_next){if(0===t.m_density)continue;const i=t.GetMassData(b2Body.ResetMassData_s_massData);this.m_mass+=i.mass,e.x+=i.center.x*i.mass,e.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*b2Vec2.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const i=b2Body.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),b2Transform.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,b2Vec2.SubVV(this.m_sweep.c,i,b2Vec2.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return b2Transform.MulXV(this.m_xf,t,e)}GetWorldVector(t,e){return b2Rot.MulRV(this.m_xf.q,t,e)}GetLocalPoint(t,e){return b2Transform.MulTXV(this.m_xf,t,e)}GetLocalVector(t,e){return b2Rot.MulTRV(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,b2Vec2.SubVV(t,this.m_sweep.c,b2Vec2.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type===e)return;this.m_type=e,this.ResetMassData(),this.m_type===t.BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let i=this.m_contactList;for(;i;){const t=i;i=i.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;for(let t=this.m_fixtureList;t;t=t.m_next)t.TouchProxies()}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(e){this.m_type!==t.BodyType.b2_staticBody&&(e?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsEnabled())if(this.m_enabledFlag=t,t){for(let t=this.m_fixtureList;t;t=t.m_next)t.CreateProxies();this.m_world.m_newContacts=!0}else{for(let t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxies();let t=this.m_contactList;for(;t;){const e=t;t=t.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}Dump(e){const i=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");let n="";switch(this.m_type){case t.BodyType.b2_staticBody:n="b2BodyType.b2_staticBody";break;case t.BodyType.b2_kinematicBody:n="b2BodyType.b2_kinematicBody";break;case t.BodyType.b2_dynamicBody:n="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",n),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_enabledFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(let t=this.m_fixtureList;t;t=t.m_next)e("  {\n"),t.Dump(e,i),e("  }\n");e("}\n")}SynchronizeFixtures(){if(this.m_awakeFlag){const t=b2Body.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),b2Rot.MulRV(t.q,this.m_sweep.localCenter,t.p),b2Vec2.SubVV(this.m_sweep.c0,t.p,t.p);for(let e=this.m_fixtureList;e;e=e.m_next)e.SynchronizeProxies(t,this.m_xf)}else for(let t=this.m_fixtureList;t;t=t.m_next)t.SynchronizeProxies(this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a),b2Rot.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),b2Vec2.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(e){return(this.m_type!==t.BodyType.b2_staticBody||e.m_type!==t.BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),b2Rot.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),b2Vec2.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}function b2MixFriction(t,e){return z(t*e)}function b2MixRestitution(t,e){return t>e?t:e}function b2MixRestitutionThreshold(t,e){return t<e?t:e}b2Body.CreateFixtureShapeDensity_s_def=new b2FixtureDef,b2Body.SetMassData_s_oldCenter=new b2Vec2,b2Body.ResetMassData_s_localCenter=new b2Vec2,b2Body.ResetMassData_s_oldCenter=new b2Vec2,b2Body.ResetMassData_s_massData=new b2MassData,b2Body.SynchronizeFixtures_s_xf1=new b2Transform;class b2ContactEdge{constructor(t){this._other=null,this.prev=null,this.next=null,this.contact=t}get other(){if(null===this._other)throw new Error;return this._other}set other(t){if(null!==this._other)throw new Error;this._other=t}Reset(){this._other=null,this.prev=null,this.next=null}}class b2Contact{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new b2ContactEdge(this),this.m_nodeB=new b2ContactEdge(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new b2Manifold,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_tangentSpeed=0,this.m_oldManifold=new b2Manifold}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.GetShapeA(),r=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=b2MixRestitutionThreshold(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=b2MixRestitutionThreshold(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let i=!1;const n=this.m_touchingFlag,r=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),o=r||s,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),c=a.GetTransform(),h=l.GetTransform();if(o){const t=this.GetShapeA(),e=this.GetShapeB();i=b2TestOverlapShape(t,this.m_indexA,e,this.m_indexB,c,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,c,h),i=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;const i=e.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const n=this.m_oldManifold.points[t];if(n.id.key===i.key){e.normalImpulse=n.normalImpulse,e.tangentImpulse=n.tangentImpulse;break}}}i!==n&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!n&&i&&t&&t.BeginContact(this),n&&!i&&t&&t.EndContact(this),!o&&i&&t&&t.PreSolve(this,this.m_oldManifold)}ComputeTOI(t,e){const i=b2Contact.ComputeTOI_s_input;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=u;const n=b2Contact.ComputeTOI_s_output;return b2TimeOfImpact(n,i),n.t}}b2Contact.ComputeTOI_s_input=new b2TOIInput,b2Contact.ComputeTOI_s_output=new b2TOIOutput;class b2ChainAndCircleContact extends b2Contact{static Create(){return new b2ChainAndCircleContact}static Destroy(t){}Evaluate(t,e,i){const n=b2ChainAndCircleContact.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),b2CollideEdgeAndCircle(t,n,e,this.GetShapeB(),i)}}b2ChainAndCircleContact.Evaluate_s_edge=new b2EdgeShape;class b2ChainAndPolygonContact extends b2Contact{static Create(){return new b2ChainAndPolygonContact}static Destroy(t){}Evaluate(t,e,i){const n=b2ChainAndPolygonContact.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),b2CollideEdgeAndPolygon(t,n,e,this.GetShapeB(),i)}}b2ChainAndPolygonContact.Evaluate_s_edge=new b2EdgeShape;class b2CircleContact extends b2Contact{static Create(){return new b2CircleContact}static Destroy(t){}Evaluate(t,e,i){b2CollideCircles(t,this.GetShapeA(),e,this.GetShapeB(),i)}}class b2PolygonContact extends b2Contact{static Create(){return new b2PolygonContact}static Destroy(t){}Evaluate(t,e,i){b2CollidePolygons(t,this.GetShapeA(),e,this.GetShapeB(),i)}}class b2PolygonAndCircleContact extends b2Contact{static Create(){return new b2PolygonAndCircleContact}static Destroy(t){}Evaluate(t,e,i){b2CollidePolygonAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)}}class b2EdgeAndCircleContact extends b2Contact{static Create(){return new b2EdgeAndCircleContact}static Destroy(t){}Evaluate(t,e,i){b2CollideEdgeAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)}}class b2EdgeAndPolygonContact extends b2Contact{static Create(){return new b2EdgeAndPolygonContact}static Destroy(t){}Evaluate(t,e,i){b2CollideEdgeAndPolygon(t,this.GetShapeA(),e,this.GetShapeB(),i)}}class b2ContactRegister{constructor(){this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1}}class b2ContactFactory{constructor(){this.m_registers=[],this.InitializeRegisters()}AddType(t,e,i,n){const r=[];function poolCreateFcn(){return r.pop()||t()}function poolDestroyFcn(t){r.push(t)}this.m_registers[i][n].pool=r,this.m_registers[i][n].createFcn=poolCreateFcn,this.m_registers[i][n].destroyFcn=poolDestroyFcn,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].pool=r,this.m_registers[n][i].createFcn=poolCreateFcn,this.m_registers[n][i].destroyFcn=poolDestroyFcn,this.m_registers[n][i].primary=!1)}InitializeRegisters(){for(let e=0;e<t.ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(let i=0;i<t.ShapeType.e_shapeTypeCount;i++)this.m_registers[e][i]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,t.ShapeType.e_circleShape,t.ShapeType.e_circleShape),this.AddType(b2PolygonAndCircleContact.Create,b2PolygonAndCircleContact.Destroy,t.ShapeType.e_polygonShape,t.ShapeType.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,t.ShapeType.e_polygonShape,t.ShapeType.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,t.ShapeType.e_edgeShape,t.ShapeType.e_circleShape),this.AddType(b2EdgeAndPolygonContact.Create,b2EdgeAndPolygonContact.Destroy,t.ShapeType.e_edgeShape,t.ShapeType.e_polygonShape),this.AddType(b2ChainAndCircleContact.Create,b2ChainAndCircleContact.Destroy,t.ShapeType.e_chainShape,t.ShapeType.e_circleShape),this.AddType(b2ChainAndPolygonContact.Create,b2ChainAndPolygonContact.Destroy,t.ShapeType.e_chainShape,t.ShapeType.e_polygonShape)}Create(t,e,i,n){const r=t.GetType(),s=i.GetType(),o=this.m_registers[r][s];if(o.createFcn){const r=o.createFcn();return o.primary?r.Reset(t,e,i,n):r.Reset(i,n,t,e),r}return null}Destroy(t){const e=t.m_fixtureA.GetType(),i=t.m_fixtureB.GetType(),n=this.m_registers[e][i];n.destroyFcn&&n.destroyFcn(t)}}class b2ContactFilter{ShouldCollide(e,i){const n=e.GetBody(),r=i.GetBody();if(r.GetType()===t.BodyType.b2_staticBody&&n.GetType()===t.BodyType.b2_staticBody)return!1;if(!r.ShouldCollideConnected(n))return!1;const s=e.GetFilterData(),o=i.GetFilterData();if(s.groupIndex===o.groupIndex&&0!==s.groupIndex)return s.groupIndex>0;const a=0!=(s.maskBits&o.categoryBits)&&0!=(s.categoryBits&o.maskBits);return a}ShouldCollideFixtureParticle(t,e,i){return!0}ShouldCollideParticleParticle(t,e,i){return!0}}b2ContactFilter.b2_defaultFilter=new b2ContactFilter;class b2ContactImpulse{constructor(){this.normalImpulses=b2MakeNumberArray(l),this.tangentImpulses=b2MakeNumberArray(l),this.count=0}}class b2ContactListener{BeginContact(t){}EndContact(t){}BeginContactFixtureParticle(t,e){}EndContactFixtureParticle(t,e){}BeginContactParticleParticle(t,e){}EndContactParticleParticle(t,e){}PreSolve(t,e){}PostSolve(t,e){}}b2ContactListener.b2_defaultListener=new b2ContactListener;class b2QueryCallback{ReportFixture(t){return!0}ReportParticle(t,e){return!1}ShouldQueryParticleSystem(t){return!0}}class b2RayCastCallback{ReportFixture(t,e,i,n){return n}ReportParticle(t,e,i,n,r){return 0}ShouldQueryParticleSystem(t){return!0}}class b2ContactManager{constructor(){this.m_broadPhase=new b2BroadPhase,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory}AddPair(t,e){let i=t.fixture,n=e.fixture,r=t.childIndex,s=e.childIndex,o=i.GetBody(),a=n.GetBody();if(o===a)return;let l=a.GetContactList();for(;l;){if(l.other===o){const t=l.contact.GetFixtureA(),e=l.contact.GetFixtureB(),o=l.contact.GetChildIndexA(),a=l.contact.GetChildIndexB();if(t===i&&e===n&&o===r&&a===s)return;if(t===n&&e===i&&o===s&&a===r)return}l=l.next}if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n))return;const c=this.m_contactFactory.Create(i,r,n,s);null!==c&&(i=c.GetFixtureA(),n=c.GetFixtureB(),r=c.GetChildIndexA(),s=c.GetChildIndexB(),o=i.m_body,a=n.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=c.m_nodeA),o.m_contactList=c.m_nodeA,c.m_nodeB.other=o,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,++this.m_contactCount)}FindNewContacts(){this.m_broadPhase.UpdatePairs((t,e)=>{this.AddPair(t,e)})}Destroy(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),r=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===r.m_contactList&&(r.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let e=this.m_contactList;for(;e;){const i=e.GetFixtureA(),n=e.GetFixtureB(),r=e.GetChildIndexA(),s=e.GetChildIndexB(),o=i.GetBody(),a=n.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n)){const t=e;e=t.m_next,this.Destroy(t);continue}e.m_filterFlag=!1}const l=o.IsAwake()&&o.m_type!==t.BodyType.b2_staticBody,c=a.IsAwake()&&a.m_type!==t.BodyType.b2_staticBody;if(!l&&!c){e=e.m_next;continue}const h=i.m_proxies[r].treeNode,u=n.m_proxies[s].treeNode,d=b2TestOverlapAABB(h.aabb,u.aabb);if(d)e.Update(this.m_contactListener),e=e.m_next;else{const t=e;e=t.m_next,this.Destroy(t)}}}}class b2Profile{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}class b2TimeStep{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}class b2Position{constructor(){this.c=new b2Vec2,this.a=0}static MakeArray(t){return b2MakeArray(t,t=>new b2Position)}}class b2Velocity{constructor(){this.v=new b2Vec2,this.w=0}static MakeArray(t){return b2MakeArray(t,t=>new b2Velocity)}}class b2SolverData{constructor(){this.step=new b2TimeStep}}t.blockSolve=!1;class b2VelocityConstraintPoint{constructor(){this.rA=new b2Vec2,this.rB=new b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}static MakeArray(t){return b2MakeArray(t,t=>new b2VelocityConstraintPoint)}}class b2ContactVelocityConstraint{constructor(){this.points=b2VelocityConstraintPoint.MakeArray(l),this.normal=new b2Vec2,this.tangent=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.threshold=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}static MakeArray(t){return b2MakeArray(t,t=>new b2ContactVelocityConstraint)}}class b2ContactPositionConstraint{constructor(){this.localPoints=b2Vec2.MakeArray(l),this.localNormal=new b2Vec2,this.localPoint=new b2Vec2,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new b2Vec2,this.localCenterB=new b2Vec2,this.invIA=0,this.invIB=0,this.type=t.ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}static MakeArray(t){return b2MakeArray(t,t=>new b2ContactPositionConstraint)}}class b2ContactSolverDef{constructor(){this.step=new b2TimeStep,this.count=0}}class b2PositionSolverManifold{constructor(){this.normal=new b2Vec2,this.point=new b2Vec2,this.separation=0}Initialize(e,i,n,r){const s=b2PositionSolverManifold.Initialize_s_pointA,o=b2PositionSolverManifold.Initialize_s_pointB,a=b2PositionSolverManifold.Initialize_s_planePoint,l=b2PositionSolverManifold.Initialize_s_clipPoint;switch(e.type){case t.ManifoldType.e_circles:b2Transform.MulXV(i,e.localPoint,s),b2Transform.MulXV(n,e.localPoints[0],o),b2Vec2.SubVV(o,s,this.normal).SelfNormalize(),b2Vec2.MidVV(s,o,this.point),this.separation=b2Vec2.DotVV(b2Vec2.SubVV(o,s,b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB;break;case t.ManifoldType.e_faceA:b2Rot.MulRV(i.q,e.localNormal,this.normal),b2Transform.MulXV(i,e.localPoint,a),b2Transform.MulXV(n,e.localPoints[r],l),this.separation=b2Vec2.DotVV(b2Vec2.SubVV(l,a,b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l);break;case t.ManifoldType.e_faceB:b2Rot.MulRV(n.q,e.localNormal,this.normal),b2Transform.MulXV(n,e.localPoint,a),b2Transform.MulXV(i,e.localPoints[r],l),this.separation=b2Vec2.DotVV(b2Vec2.SubVV(l,a,b2Vec2.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg()}}}b2PositionSolverManifold.Initialize_s_pointA=new b2Vec2,b2PositionSolverManifold.Initialize_s_pointB=new b2Vec2,b2PositionSolverManifold.Initialize_s_planePoint=new b2Vec2,b2PositionSolverManifold.Initialize_s_clipPoint=new b2Vec2;class b2ContactSolver{constructor(){this.m_step=new b2TimeStep,this.m_positionConstraints=b2ContactPositionConstraint.MakeArray(1024),this.m_velocityConstraints=b2ContactVelocityConstraint.MakeArray(1024),this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=b2Max(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new b2ContactPositionConstraint}if(this.m_velocityConstraints.length<this.m_count){const t=b2Max(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new b2ContactVelocityConstraint}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const e=this.m_contacts[t],i=e.m_fixtureA,n=e.m_fixtureB,r=i.GetShape(),s=n.GetShape(),o=r.m_radius,a=s.m_radius,l=i.GetBody(),c=n.GetBody(),h=e.GetManifold(),u=h.pointCount,d=this.m_velocityConstraints[t];d.friction=e.m_friction,d.restitution=e.m_restitution,d.threshold=e.m_restitutionThreshold,d.tangentSpeed=e.m_tangentSpeed,d.indexA=l.m_islandIndex,d.indexB=c.m_islandIndex,d.invMassA=l.m_invMass,d.invMassB=c.m_invMass,d.invIA=l.m_invI,d.invIB=c.m_invI,d.contactIndex=t,d.pointCount=u,d.K.SetZero(),d.normalMass.SetZero();const m=this.m_positionConstraints[t];m.indexA=l.m_islandIndex,m.indexB=c.m_islandIndex,m.invMassA=l.m_invMass,m.invMassB=c.m_invMass,m.localCenterA.Copy(l.m_sweep.localCenter),m.localCenterB.Copy(c.m_sweep.localCenter),m.invIA=l.m_invI,m.invIB=c.m_invI,m.localNormal.Copy(h.localNormal),m.localPoint.Copy(h.localPoint),m.pointCount=u,m.radiusA=o,m.radiusB=a,m.type=h.type;for(let t=0;t<u;++t){const e=h.points[t],i=d.points[t];this.m_step.warmStarting?(i.normalImpulse=this.m_step.dtRatio*e.normalImpulse,i.tangentImpulse=this.m_step.dtRatio*e.tangentImpulse):(i.normalImpulse=0,i.tangentImpulse=0),i.rA.SetZero(),i.rB.SetZero(),i.normalMass=0,i.tangentMass=0,i.velocityBias=0,m.localPoints[t].Copy(e.localPoint)}}return this}InitializeVelocityConstraints(){const e=b2ContactSolver.InitializeVelocityConstraints_s_xfA,i=b2ContactSolver.InitializeVelocityConstraints_s_xfB,n=b2ContactSolver.InitializeVelocityConstraints_s_worldManifold;for(let r=0;r<this.m_count;++r){const s=this.m_velocityConstraints[r],o=this.m_positionConstraints[r],a=o.radiusA,l=o.radiusB,c=this.m_contacts[s.contactIndex].GetManifold(),h=s.indexA,u=s.indexB,d=s.invMassA,m=s.invMassB,p=s.invIA,f=s.invIB,_=o.localCenterA,g=o.localCenterB,b=this.m_positions[h].c,y=this.m_positions[h].a,x=this.m_velocities[h].v,v=this.m_velocities[h].w,S=this.m_positions[u].c,w=this.m_positions[u].a,M=this.m_velocities[u].v,A=this.m_velocities[u].w;e.q.SetAngle(y),i.q.SetAngle(w),b2Vec2.SubVV(b,b2Rot.MulRV(e.q,_,b2Vec2.s_t0),e.p),b2Vec2.SubVV(S,b2Rot.MulRV(i.q,g,b2Vec2.s_t0),i.p),n.Initialize(c,e,a,i,l),s.normal.Copy(n.normal),b2Vec2.CrossVOne(s.normal,s.tangent);const V=s.pointCount;for(let t=0;t<V;++t){const e=s.points[t];b2Vec2.SubVV(n.points[t],b,e.rA),b2Vec2.SubVV(n.points[t],S,e.rB);const i=b2Vec2.CrossVV(e.rA,s.normal),r=b2Vec2.CrossVV(e.rB,s.normal),o=d+m+p*i*i+f*r*r;e.normalMass=o>0?1/o:0;const a=s.tangent,l=b2Vec2.CrossVV(e.rA,a),c=b2Vec2.CrossVV(e.rB,a),h=d+m+p*l*l+f*c*c;e.tangentMass=h>0?1/h:0,e.velocityBias=0;const u=b2Vec2.DotVV(s.normal,b2Vec2.SubVV(b2Vec2.AddVCrossSV(M,A,e.rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(x,v,e.rA,b2Vec2.s_t1),b2Vec2.s_t0));u<-s.threshold&&(e.velocityBias+=-s.restitution*u)}if(2===s.pointCount&&t.blockSolve){const t=s.points[0],e=s.points[1],i=b2Vec2.CrossVV(t.rA,s.normal),n=b2Vec2.CrossVV(t.rB,s.normal),r=b2Vec2.CrossVV(e.rA,s.normal),o=b2Vec2.CrossVV(e.rB,s.normal),a=d+m+p*i*i+f*n*n,l=d+m+p*r*r+f*o*o,c=d+m+p*i*r+f*n*o;a*a<1e3*(a*l-c*c)?(s.K.ex.Set(a,c),s.K.ey.Set(c,l),s.K.GetInverse(s.normalMass)):s.pointCount=1}}}WarmStart(){const t=b2ContactSolver.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],n=i.indexA,r=i.indexB,s=i.invMassA,o=i.invIA,a=i.invMassB,l=i.invIB,c=i.pointCount,h=this.m_velocities[n].v;let u=this.m_velocities[n].w;const d=this.m_velocities[r].v;let m=this.m_velocities[r].w;const p=i.normal,f=i.tangent;for(let e=0;e<c;++e){const n=i.points[e];b2Vec2.AddVV(b2Vec2.MulSV(n.normalImpulse,p,b2Vec2.s_t0),b2Vec2.MulSV(n.tangentImpulse,f,b2Vec2.s_t1),t),u-=o*b2Vec2.CrossVV(n.rA,t),h.SelfMulSub(s,t),m+=l*b2Vec2.CrossVV(n.rB,t),d.SelfMulAdd(a,t)}this.m_velocities[n].w=u,this.m_velocities[r].w=m}}SolveVelocityConstraints(){const e=b2ContactSolver.SolveVelocityConstraints_s_dv,i=b2ContactSolver.SolveVelocityConstraints_s_dv1,n=b2ContactSolver.SolveVelocityConstraints_s_dv2,r=b2ContactSolver.SolveVelocityConstraints_s_P,s=b2ContactSolver.SolveVelocityConstraints_s_a,o=b2ContactSolver.SolveVelocityConstraints_s_b,a=b2ContactSolver.SolveVelocityConstraints_s_x,l=b2ContactSolver.SolveVelocityConstraints_s_d,c=b2ContactSolver.SolveVelocityConstraints_s_P1,h=b2ContactSolver.SolveVelocityConstraints_s_P2,u=b2ContactSolver.SolveVelocityConstraints_s_P1P2;for(let d=0;d<this.m_count;++d){const m=this.m_velocityConstraints[d],p=m.indexA,f=m.indexB,_=m.invMassA,g=m.invIA,b=m.invMassB,y=m.invIB,x=m.pointCount,v=this.m_velocities[p].v;let S=this.m_velocities[p].w;const w=this.m_velocities[f].v;let M=this.m_velocities[f].w;const A=m.normal,V=m.tangent,C=m.friction;for(let t=0;t<x;++t){const i=m.points[t];b2Vec2.SubVV(b2Vec2.AddVCrossSV(w,M,i.rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(v,S,i.rA,b2Vec2.s_t1),e);const n=b2Vec2.DotVV(e,V)-m.tangentSpeed;let s=i.tangentMass*-n;const o=C*i.normalImpulse,a=b2Clamp(i.tangentImpulse+s,-o,o);s=a-i.tangentImpulse,i.tangentImpulse=a,b2Vec2.MulSV(s,V,r),v.SelfMulSub(_,r),S-=g*b2Vec2.CrossVV(i.rA,r),w.SelfMulAdd(b,r),M+=y*b2Vec2.CrossVV(i.rB,r)}if(1===m.pointCount||!1===t.blockSolve)for(let t=0;t<x;++t){const i=m.points[t];b2Vec2.SubVV(b2Vec2.AddVCrossSV(w,M,i.rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(v,S,i.rA,b2Vec2.s_t1),e);const n=b2Vec2.DotVV(e,A);let s=-i.normalMass*(n-i.velocityBias);const o=b2Max(i.normalImpulse+s,0);s=o-i.normalImpulse,i.normalImpulse=o,b2Vec2.MulSV(s,A,r),v.SelfMulSub(_,r),S-=g*b2Vec2.CrossVV(i.rA,r),w.SelfMulAdd(b,r),M+=y*b2Vec2.CrossVV(i.rB,r)}else{const t=m.points[0],e=m.points[1];s.Set(t.normalImpulse,e.normalImpulse),b2Vec2.SubVV(b2Vec2.AddVCrossSV(w,M,t.rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(v,S,t.rA,b2Vec2.s_t1),i),b2Vec2.SubVV(b2Vec2.AddVCrossSV(w,M,e.rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(v,S,e.rA,b2Vec2.s_t1),n);let r=b2Vec2.DotVV(i,A),d=b2Vec2.DotVV(n,A);for(o.x=r-t.velocityBias,o.y=d-e.velocityBias,o.SelfSub(b2Mat22.MulMV(m.K,s,b2Vec2.s_t0));;){if(b2Mat22.MulMV(m.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){b2Vec2.SubVV(a,s,l),b2Vec2.MulSV(l.x,A,c),b2Vec2.MulSV(l.y,A,h),b2Vec2.AddVV(c,h,u),v.SelfMulSub(_,u),S-=g*(b2Vec2.CrossVV(t.rA,c)+b2Vec2.CrossVV(e.rA,h)),w.SelfMulAdd(b,u),M+=y*(b2Vec2.CrossVV(t.rB,c)+b2Vec2.CrossVV(e.rB,h)),t.normalImpulse=a.x,e.normalImpulse=a.y;break}if(a.x=-t.normalMass*o.x,a.y=0,r=0,d=m.K.ex.y*a.x+o.y,a.x>=0&&d>=0){b2Vec2.SubVV(a,s,l),b2Vec2.MulSV(l.x,A,c),b2Vec2.MulSV(l.y,A,h),b2Vec2.AddVV(c,h,u),v.SelfMulSub(_,u),S-=g*(b2Vec2.CrossVV(t.rA,c)+b2Vec2.CrossVV(e.rA,h)),w.SelfMulAdd(b,u),M+=y*(b2Vec2.CrossVV(t.rB,c)+b2Vec2.CrossVV(e.rB,h)),t.normalImpulse=a.x,e.normalImpulse=a.y;break}if(a.x=0,a.y=-e.normalMass*o.y,r=m.K.ey.x*a.y+o.x,d=0,a.y>=0&&r>=0){b2Vec2.SubVV(a,s,l),b2Vec2.MulSV(l.x,A,c),b2Vec2.MulSV(l.y,A,h),b2Vec2.AddVV(c,h,u),v.SelfMulSub(_,u),S-=g*(b2Vec2.CrossVV(t.rA,c)+b2Vec2.CrossVV(e.rA,h)),w.SelfMulAdd(b,u),M+=y*(b2Vec2.CrossVV(t.rB,c)+b2Vec2.CrossVV(e.rB,h)),t.normalImpulse=a.x,e.normalImpulse=a.y;break}if(a.x=0,a.y=0,r=o.x,d=o.y,r>=0&&d>=0){b2Vec2.SubVV(a,s,l),b2Vec2.MulSV(l.x,A,c),b2Vec2.MulSV(l.y,A,h),b2Vec2.AddVV(c,h,u),v.SelfMulSub(_,u),S-=g*(b2Vec2.CrossVV(t.rA,c)+b2Vec2.CrossVV(e.rA,h)),w.SelfMulAdd(b,u),M+=y*(b2Vec2.CrossVV(t.rB,c)+b2Vec2.CrossVV(e.rB,h)),t.normalImpulse=a.x,e.normalImpulse=a.y;break}break}}this.m_velocities[p].w=S,this.m_velocities[f].w=M}}StoreImpulses(){for(let t=0;t<this.m_count;++t){const e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold();for(let t=0;t<e.pointCount;++t)i.points[t].normalImpulse=e.points[t].normalImpulse,i.points[t].tangentImpulse=e.points[t].tangentImpulse}}SolvePositionConstraints(){const t=b2ContactSolver.SolvePositionConstraints_s_xfA,e=b2ContactSolver.SolvePositionConstraints_s_xfB,i=b2ContactSolver.SolvePositionConstraints_s_psm,n=b2ContactSolver.SolvePositionConstraints_s_rA,r=b2ContactSolver.SolvePositionConstraints_s_rB,s=b2ContactSolver.SolvePositionConstraints_s_P;let o=0;for(let a=0;a<this.m_count;++a){const l=this.m_positionConstraints[a],c=l.indexA,h=l.indexB,d=l.localCenterA,m=l.invMassA,p=l.invIA,f=l.localCenterB,g=l.invMassB,b=l.invIB,y=l.pointCount,x=this.m_positions[c].c;let v=this.m_positions[c].a;const w=this.m_positions[h].c;let M=this.m_positions[h].a;for(let a=0;a<y;++a){t.q.SetAngle(v),e.q.SetAngle(M),b2Vec2.SubVV(x,b2Rot.MulRV(t.q,d,b2Vec2.s_t0),t.p),b2Vec2.SubVV(w,b2Rot.MulRV(e.q,f,b2Vec2.s_t0),e.p),i.Initialize(l,t,e,a);const c=i.normal,h=i.point,y=i.separation;b2Vec2.SubVV(h,x,n),b2Vec2.SubVV(h,w,r),o=b2Min(o,y);const A=b2Clamp(S*(y+u),-_,0),V=b2Vec2.CrossVV(n,c),C=b2Vec2.CrossVV(r,c),T=m+g+p*V*V+b*C*C,B=T>0?-A/T:0;b2Vec2.MulSV(B,c,s),x.SelfMulSub(m,s),v-=p*b2Vec2.CrossVV(n,s),w.SelfMulAdd(g,s),M+=b*b2Vec2.CrossVV(r,s)}this.m_positions[c].a=v,this.m_positions[h].a=M}return o>-3*u}SolveTOIPositionConstraints(t,e){const i=b2ContactSolver.SolveTOIPositionConstraints_s_xfA,n=b2ContactSolver.SolveTOIPositionConstraints_s_xfB,r=b2ContactSolver.SolveTOIPositionConstraints_s_psm,s=b2ContactSolver.SolveTOIPositionConstraints_s_rA,o=b2ContactSolver.SolveTOIPositionConstraints_s_rB,a=b2ContactSolver.SolveTOIPositionConstraints_s_P;let l=0;for(let c=0;c<this.m_count;++c){const h=this.m_positionConstraints[c],d=h.indexA,m=h.indexB,p=h.localCenterA,f=h.localCenterB,g=h.pointCount;let b=0,y=0;d!==t&&d!==e||(b=h.invMassA,y=h.invIA);let x=0,v=0;m!==t&&m!==e||(x=h.invMassB,v=h.invIB);const S=this.m_positions[d].c;let M=this.m_positions[d].a;const A=this.m_positions[m].c;let V=this.m_positions[m].a;for(let t=0;t<g;++t){i.q.SetAngle(M),n.q.SetAngle(V),b2Vec2.SubVV(S,b2Rot.MulRV(i.q,p,b2Vec2.s_t0),i.p),b2Vec2.SubVV(A,b2Rot.MulRV(n.q,f,b2Vec2.s_t0),n.p),r.Initialize(h,i,n,t);const e=r.normal,c=r.point,d=r.separation;b2Vec2.SubVV(c,S,s),b2Vec2.SubVV(c,A,o),l=b2Min(l,d);const m=b2Clamp(w*(d+u),-_,0),g=b2Vec2.CrossVV(s,e),C=b2Vec2.CrossVV(o,e),T=b+x+y*g*g+v*C*C,B=T>0?-m/T:0;b2Vec2.MulSV(B,e,a),S.SelfMulSub(b,a),M-=y*b2Vec2.CrossVV(s,a),A.SelfMulAdd(x,a),V+=v*b2Vec2.CrossVV(o,a)}this.m_positions[d].a=M,this.m_positions[m].a=V}return l>=-1.5*u}}b2ContactSolver.InitializeVelocityConstraints_s_xfA=new b2Transform,b2ContactSolver.InitializeVelocityConstraints_s_xfB=new b2Transform,b2ContactSolver.InitializeVelocityConstraints_s_worldManifold=new b2WorldManifold,b2ContactSolver.WarmStart_s_P=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_dv=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_dv1=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_dv2=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_P=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_a=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_b=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_x=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_d=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_P1=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_P2=new b2Vec2,b2ContactSolver.SolveVelocityConstraints_s_P1P2=new b2Vec2,b2ContactSolver.SolvePositionConstraints_s_xfA=new b2Transform,b2ContactSolver.SolvePositionConstraints_s_xfB=new b2Transform,b2ContactSolver.SolvePositionConstraints_s_psm=new b2PositionSolverManifold,b2ContactSolver.SolvePositionConstraints_s_rA=new b2Vec2,b2ContactSolver.SolvePositionConstraints_s_rB=new b2Vec2,b2ContactSolver.SolvePositionConstraints_s_P=new b2Vec2,b2ContactSolver.SolveTOIPositionConstraints_s_xfA=new b2Transform,b2ContactSolver.SolveTOIPositionConstraints_s_xfB=new b2Transform,b2ContactSolver.SolveTOIPositionConstraints_s_psm=new b2PositionSolverManifold,b2ContactSolver.SolveTOIPositionConstraints_s_rA=new b2Vec2,b2ContactSolver.SolveTOIPositionConstraints_s_rB=new b2Vec2,b2ContactSolver.SolveTOIPositionConstraints_s_P=new b2Vec2;class b2FrictionJoint extends b2Joint{constructor(t){super(t),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new b2Mat22,this.m_angularMass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_K=new b2Mat22,this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_linearImpulse.SetZero(),this.m_maxForce=b2Maybe(t.maxForce,0),this.m_maxTorque=b2Maybe(t.maxTorque,0),this.m_linearMass.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const c=b2Rot.MulRV(a,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const h=b2Rot.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_invMassA,d=this.m_invMassB,m=this.m_invIA,p=this.m_invIB,f=this.m_K;if(f.ex.x=u+d+m*c.y*c.y+p*h.y*h.y,f.ex.y=-m*c.x*c.y-p*h.x*h.y,f.ey.x=f.ex.y,f.ey.y=u+d+m*c.x*c.x+p*h.x*h.x,f.GetInverse(this.m_linearMass),this.m_angularMass=m+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;i.SelfMulSub(u,e),n-=m*(b2Vec2.CrossVV(this.m_rA,e)+this.m_angularImpulse),s.SelfMulAdd(d,e),o+=p*(b2Vec2.CrossVV(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=t.step.dt;{const t=r-i;let e=-this.m_angularMass*t;const n=this.m_angularImpulse,s=c*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+e,-s,s),e=this.m_angularImpulse-n,i-=a*e,r+=l*e}{const t=b2Vec2.SubVV(b2Vec2.AddVCrossSV(n,r,this.m_rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(e,i,this.m_rA,b2Vec2.s_t1),b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2),h=b2Mat22.MulMV(this.m_linearMass,t,b2FrictionJoint.SolveVelocityConstraints_s_impulseV).SelfNeg(),u=b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(h);const d=c*this.m_maxForce;this.m_linearImpulse.LengthSquared()>d*d&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(d)),b2Vec2.SubVV(this.m_linearImpulse,u,h),e.SelfMulSub(s,h),i-=a*b2Vec2.CrossVV(this.m_rA,h),n.SelfMulAdd(o,h),r+=l*b2Vec2.CrossVV(this.m_rB,h)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2=new b2Vec2,b2FrictionJoint.SolveVelocityConstraints_s_impulseV=new b2Vec2,b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV=new b2Vec2;class b2GearJoint extends b2Joint{constructor(e){let i,n;super(e),this.m_typeA=t.JointType.e_unknownJoint,this.m_typeB=t.JointType.e_unknownJoint,this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_localAnchorC=new b2Vec2,this.m_localAnchorD=new b2Vec2,this.m_localAxisC=new b2Vec2,this.m_localAxisD=new b2Vec2,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new b2Vec2,this.m_lcB=new b2Vec2,this.m_lcC=new b2Vec2,this.m_lcD=new b2Vec2,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new b2Vec2,this.m_JvBD=new b2Vec2,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_qC=new b2Rot,this.m_qD=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_lalcC=new b2Vec2,this.m_lalcD=new b2Vec2,this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const r=this.m_bodyA.m_xf,s=this.m_bodyA.m_sweep.a,o=this.m_bodyC.m_xf,a=this.m_bodyC.m_sweep.a;if(this.m_typeA===t.JointType.e_revoluteJoint){const t=e.joint1;this.m_localAnchorC.Copy(t.m_localAnchorA),this.m_localAnchorA.Copy(t.m_localAnchorB),this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC.SetZero(),i=s-a-this.m_referenceAngleA}else{const t=e.joint1;this.m_localAnchorC.Copy(t.m_localAnchorA),this.m_localAnchorA.Copy(t.m_localAnchorB),this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC.Copy(t.m_localXAxisA);const n=this.m_localAnchorC,s=b2Rot.MulTRV(o.q,b2Vec2.AddVV(b2Rot.MulRV(r.q,this.m_localAnchorA,b2Vec2.s_t0),b2Vec2.SubVV(r.p,o.p,b2Vec2.s_t1),b2Vec2.s_t0),b2Vec2.s_t0);i=b2Vec2.DotVV(b2Vec2.SubVV(s,n,b2Vec2.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const l=this.m_bodyB.m_xf,c=this.m_bodyB.m_sweep.a,h=this.m_bodyD.m_xf,u=this.m_bodyD.m_sweep.a;if(this.m_typeB===t.JointType.e_revoluteJoint){const t=e.joint2;this.m_localAnchorD.Copy(t.m_localAnchorA),this.m_localAnchorB.Copy(t.m_localAnchorB),this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD.SetZero(),n=c-u-this.m_referenceAngleB}else{const t=e.joint2;this.m_localAnchorD.Copy(t.m_localAnchorA),this.m_localAnchorB.Copy(t.m_localAnchorB),this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD.Copy(t.m_localXAxisA);const i=this.m_localAnchorD,r=b2Rot.MulTRV(h.q,b2Vec2.AddVV(b2Rot.MulRV(l.q,this.m_localAnchorB,b2Vec2.s_t0),b2Vec2.SubVV(l.p,h.p,b2Vec2.s_t1),b2Vec2.s_t0),b2Vec2.s_t0);n=b2Vec2.DotVV(b2Vec2.SubVV(r,i,b2Vec2.s_t0),this.m_localAxisD)}this.m_ratio=b2Maybe(e.ratio,1),this.m_constant=i+this.m_ratio*n,this.m_impulse=0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v;let r=e.velocities[this.m_indexA].w;const s=e.positions[this.m_indexB].a,o=e.velocities[this.m_indexB].v;let a=e.velocities[this.m_indexB].w;const l=e.positions[this.m_indexC].a,c=e.velocities[this.m_indexC].v;let h=e.velocities[this.m_indexC].w;const u=e.positions[this.m_indexD].a,d=e.velocities[this.m_indexD].v;let m=e.velocities[this.m_indexD].w;const p=this.m_qA.SetAngle(i),f=this.m_qB.SetAngle(s),_=this.m_qC.SetAngle(l),g=this.m_qD.SetAngle(u);if(this.m_mass=0,this.m_typeA===t.JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=b2Rot.MulRV(_,this.m_localAxisC,b2GearJoint.InitVelocityConstraints_s_u);b2Vec2.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);const e=b2Rot.MulRV(_,this.m_lalcC,b2GearJoint.InitVelocityConstraints_s_rC);b2Vec2.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);const i=b2Rot.MulRV(p,this.m_lalcA,b2GearJoint.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(t),this.m_JwC=b2Vec2.CrossVV(e,t),this.m_JwA=b2Vec2.CrossVV(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=b2Rot.MulRV(g,this.m_localAxisD,b2GearJoint.InitVelocityConstraints_s_u);b2Vec2.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);const e=b2Rot.MulRV(g,this.m_lalcD,b2GearJoint.InitVelocityConstraints_s_rD);b2Vec2.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);const i=b2Rot.MulRV(f,this.m_lalcB,b2GearJoint.InitVelocityConstraints_s_rB);b2Vec2.MulSV(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*b2Vec2.CrossVV(e,t),this.m_JwB=this.m_ratio*b2Vec2.CrossVV(i,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),r+=this.m_iA*this.m_impulse*this.m_JwA,o.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,c.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,d.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),m-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=r,e.velocities[this.m_indexB].w=a,e.velocities[this.m_indexC].w=h,e.velocities[this.m_indexD].w=m}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=t.velocities[this.m_indexC].v;let o=t.velocities[this.m_indexC].w;const a=t.velocities[this.m_indexD].v;let l=t.velocities[this.m_indexD].w,c=b2Vec2.DotVV(this.m_JvAC,b2Vec2.SubVV(e,s,b2Vec2.s_t0))+b2Vec2.DotVV(this.m_JvBD,b2Vec2.SubVV(n,a,b2Vec2.s_t0));c+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*r-this.m_JwD*l);const h=-this.m_mass*c;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,n.SelfMulAdd(this.m_mB*h,this.m_JvBD),r+=this.m_iB*h*this.m_JwB,s.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,a.SelfMulSub(this.m_mD*h,this.m_JvBD),l-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=l}SolvePositionConstraints(e){const i=e.positions[this.m_indexA].c;let n=e.positions[this.m_indexA].a;const r=e.positions[this.m_indexB].c;let s=e.positions[this.m_indexB].a;const o=e.positions[this.m_indexC].c;let a=e.positions[this.m_indexC].a;const l=e.positions[this.m_indexD].c;let c=e.positions[this.m_indexD].a;const h=this.m_qA.SetAngle(n),d=this.m_qB.SetAngle(s),m=this.m_qC.SetAngle(a),p=this.m_qD.SetAngle(c);let f,_;const g=this.m_JvAC,b=this.m_JvBD;let y,x,v,S,w=0;if(this.m_typeA===t.JointType.e_revoluteJoint)g.SetZero(),y=1,v=1,w+=this.m_iA+this.m_iC,f=n-a-this.m_referenceAngleA;else{const t=b2Rot.MulRV(m,this.m_localAxisC,b2GearJoint.SolvePositionConstraints_s_u),e=b2Rot.MulRV(m,this.m_lalcC,b2GearJoint.SolvePositionConstraints_s_rC),n=b2Rot.MulRV(h,this.m_lalcA,b2GearJoint.SolvePositionConstraints_s_rA);g.Copy(t),v=b2Vec2.CrossVV(e,t),y=b2Vec2.CrossVV(n,t),w+=this.m_mC+this.m_mA+this.m_iC*v*v+this.m_iA*y*y;const r=this.m_lalcC,s=b2Rot.MulTRV(m,b2Vec2.AddVV(n,b2Vec2.SubVV(i,o,b2Vec2.s_t0),b2Vec2.s_t0),b2Vec2.s_t0);f=b2Vec2.DotVV(b2Vec2.SubVV(s,r,b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB===t.JointType.e_revoluteJoint)b.SetZero(),x=this.m_ratio,S=this.m_ratio,w+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),_=s-c-this.m_referenceAngleB;else{const t=b2Rot.MulRV(p,this.m_localAxisD,b2GearJoint.SolvePositionConstraints_s_u),e=b2Rot.MulRV(p,this.m_lalcD,b2GearJoint.SolvePositionConstraints_s_rD),i=b2Rot.MulRV(d,this.m_lalcB,b2GearJoint.SolvePositionConstraints_s_rB);b2Vec2.MulSV(this.m_ratio,t,b),S=this.m_ratio*b2Vec2.CrossVV(e,t),x=this.m_ratio*b2Vec2.CrossVV(i,t),w+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*S*S+this.m_iB*x*x;const n=this.m_lalcD,s=b2Rot.MulTRV(p,b2Vec2.AddVV(i,b2Vec2.SubVV(r,l,b2Vec2.s_t0),b2Vec2.s_t0),b2Vec2.s_t0);_=b2Vec2.DotVV(b2Vec2.SubVV(s,n,b2Vec2.s_t0),this.m_localAxisD)}const M=f+this.m_ratio*_-this.m_constant;let A=0;return w>0&&(A=-M/w),i.SelfMulAdd(this.m_mA*A,g),n+=this.m_iA*A*y,r.SelfMulAdd(this.m_mB*A,b),s+=this.m_iB*A*x,o.SelfMulSub(this.m_mC*A,g),a-=this.m_iC*A*v,l.SelfMulSub(this.m_mD*A,b),c-=this.m_iD*A*S,e.positions[this.m_indexA].a=n,e.positions[this.m_indexB].a=s,e.positions[this.m_indexC].a=a,e.positions[this.m_indexD].a=c,0<u}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return b2Vec2.MulSV(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,r=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",r),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}b2GearJoint.InitVelocityConstraints_s_u=new b2Vec2,b2GearJoint.InitVelocityConstraints_s_rA=new b2Vec2,b2GearJoint.InitVelocityConstraints_s_rB=new b2Vec2,b2GearJoint.InitVelocityConstraints_s_rC=new b2Vec2,b2GearJoint.InitVelocityConstraints_s_rD=new b2Vec2,b2GearJoint.SolvePositionConstraints_s_u=new b2Vec2,b2GearJoint.SolvePositionConstraints_s_rA=new b2Vec2,b2GearJoint.SolvePositionConstraints_s_rB=new b2Vec2,b2GearJoint.SolvePositionConstraints_s_rC=new b2Vec2,b2GearJoint.SolvePositionConstraints_s_rD=new b2Vec2;class b2Island{constructor(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=b2Position.MakeArray(1024),this.m_velocities=b2Velocity.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}Initialize(t,e,i,n){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=n,this.m_positions.length<t){const e=b2Max(2*this.m_positions.length,t);for(;this.m_positions.length<e;)this.m_positions[this.m_positions.length]=new b2Position}if(this.m_velocities.length<t){const e=b2Max(2*this.m_velocities.length,t);for(;this.m_velocities.length<e;)this.m_velocities[this.m_velocities.length]=new b2Velocity}}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(e,n,r,s){const o=b2Island.s_timer.Reset(),a=n.dt;for(let e=0;e<this.m_bodyCount;++e){const i=this.m_bodies[e];this.m_positions[e].c.Copy(i.m_sweep.c);const n=i.m_sweep.a,s=this.m_velocities[e].v.Copy(i.m_linearVelocity);let o=i.m_angularVelocity;i.m_sweep.c0.Copy(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_type===t.BodyType.b2_dynamicBody&&(s.x+=a*i.m_invMass*(i.m_gravityScale*i.m_mass*r.x+i.m_force.x),s.y+=a*i.m_invMass*(i.m_gravityScale*i.m_mass*r.y+i.m_force.y),o+=a*i.m_invI*i.m_torque,s.SelfMul(1/(1+a*i.m_linearDamping)),o*=1/(1+a*i.m_angularDamping)),this.m_positions[e].a=n,this.m_velocities[e].w=o}o.Reset();const l=b2Island.s_solverData;l.step.Copy(n),l.positions=this.m_positions,l.velocities=this.m_velocities;const c=b2Island.s_contactSolverDef;c.step.Copy(n),c.contacts=this.m_contacts,c.count=this.m_contactCount,c.positions=this.m_positions,c.velocities=this.m_velocities;const h=b2Island.s_contactSolver.Initialize(c);h.InitializeVelocityConstraints(),n.warmStarting&&h.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(l);e.solveInit=o.GetMilliseconds(),o.Reset();for(let t=0;t<n.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(l);h.SolveVelocityConstraints()}h.StoreImpulses(),e.solveVelocity=o.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const n=this.m_velocities[t].v;let r=this.m_velocities[t].w;const s=b2Vec2.MulSV(a,n,b2Island.s_translation);if(b2Vec2.DotVV(s,s)>y){const t=b/s.Length();n.SelfMul(t)}const o=a*r;if(o*o>v){const t=x/N(o);r*=t}e.x+=a*n.x,e.y+=a*n.y,i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r}o.Reset();let u=!1;for(let t=0;t<n.positionIterations;++t){const t=h.SolvePositionConstraints();let e=!0;for(let t=0;t<this.m_jointCount;++t){const i=this.m_joints[t].SolvePositionConstraints(l);e=e&&i}if(t&&e){u=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.m_sweep.c.Copy(this.m_positions[t].c),e.m_sweep.a=this.m_positions[t].a,e.m_linearVelocity.Copy(this.m_velocities[t].v),e.m_angularVelocity=this.m_velocities[t].w,e.SynchronizeTransform()}if(e.solvePosition=o.GetMilliseconds(),this.Report(h.m_velocityConstraints),s){let e=i;const n=I*I,r=D*D;for(let i=0;i<this.m_bodyCount;++i){const s=this.m_bodies[i];s.GetType()!==t.BodyType.b2_staticBody&&(!s.m_autoSleepFlag||s.m_angularVelocity*s.m_angularVelocity>r||b2Vec2.DotVV(s.m_linearVelocity,s.m_linearVelocity)>n?(s.m_sleepTime=0,e=0):(s.m_sleepTime+=a,e=b2Min(e,s.m_sleepTime)))}if(e>=R&&u)for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.SetAwake(!1)}}}SolveTOI(t,e,i){for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c),this.m_positions[t].a=e.m_sweep.a,this.m_velocities[t].v.Copy(e.m_linearVelocity),this.m_velocities[t].w=e.m_angularVelocity}const n=b2Island.s_contactSolverDef;n.contacts=this.m_contacts,n.count=this.m_contactCount,n.step.Copy(t),n.positions=this.m_positions,n.velocities=this.m_velocities;const r=b2Island.s_contactSolver.Initialize(n);for(let n=0;n<t.positionIterations;++n){const t=r.SolveTOIPositionConstraints(e,i);if(t)break}this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(let e=0;e<t.velocityIterations;++e)r.SolveVelocityConstraints();const s=t.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const n=this.m_velocities[t].v;let r=this.m_velocities[t].w;const o=b2Vec2.MulSV(s,n,b2Island.s_translation);if(b2Vec2.DotVV(o,o)>y){const t=b/o.Length();n.SelfMul(t)}const a=s*r;if(a*a>v){const t=x/N(a);r*=t}e.SelfMulAdd(s,n),i+=s*r,this.m_positions[t].a=i,this.m_velocities[t].w=r;const l=this.m_bodies[t];l.m_sweep.c.Copy(e),l.m_sweep.a=i,l.m_linearVelocity.Copy(n),l.m_angularVelocity=r,l.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){if(null!==this.m_listener)for(let e=0;e<this.m_contactCount;++e){const i=this.m_contacts[e];if(!i)continue;const n=t[e],r=b2Island.s_impulse;r.count=n.pointCount;for(let t=0;t<n.pointCount;++t)r.normalImpulses[t]=n.points[t].normalImpulse,r.tangentImpulses[t]=n.points[t].tangentImpulse;this.m_listener.PostSolve(i,r)}}}b2Island.s_timer=new b2Timer,b2Island.s_solverData=new b2SolverData,b2Island.s_contactSolverDef=new b2ContactSolverDef,b2Island.s_contactSolver=new b2ContactSolver,b2Island.s_translation=new b2Vec2,b2Island.s_impulse=new b2ContactImpulse;class b2MotorJoint extends b2Joint{constructor(t){super(t),this.m_linearOffset=new b2Vec2,this.m_angularOffset=0,this.m_linearImpulse=new b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_linearError=new b2Vec2,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new b2Mat22,this.m_angularMass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_K=new b2Mat22,this.m_linearOffset.Copy(b2Maybe(t.linearOffset,b2Vec2.ZERO)),this.m_linearImpulse.SetZero(),this.m_maxForce=b2Maybe(t.maxForce,0),this.m_maxTorque=b2Maybe(t.maxTorque,0),this.m_correctionFactor=b2Maybe(t.correctionFactor,.3)}GetAnchorA(t){const e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}GetAnchorB(t){const e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}GetReactionForce(t,e){return b2Vec2.MulSV(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){b2Vec2.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o),u=b2Rot.MulRV(c,b2Vec2.SubVV(this.m_linearOffset,this.m_localCenterA,b2Vec2.s_t0),this.m_rA),d=b2Rot.MulRV(h,b2Vec2.NegV(this.m_localCenterB,b2Vec2.s_t0),this.m_rB),m=this.m_invMassA,p=this.m_invMassB,f=this.m_invIA,_=this.m_invIB,g=this.m_K;if(g.ex.x=m+p+f*u.y*u.y+_*d.y*d.y,g.ex.y=-f*u.x*u.y-_*d.x*d.y,g.ey.x=g.ex.y,g.ey.y=m+p+f*u.x*u.x+_*d.x*d.x,g.GetInverse(this.m_linearMass),this.m_angularMass=f+_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),b2Vec2.SubVV(b2Vec2.AddVV(s,d,b2Vec2.s_t0),b2Vec2.AddVV(e,u,b2Vec2.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;n.SelfMulSub(m,e),r-=f*(b2Vec2.CrossVV(u,e)+this.m_angularImpulse),a.SelfMulAdd(p,e),l+=_*(b2Vec2.CrossVV(d,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=t.step.dt,h=t.step.inv_dt;{const t=r-i+h*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const n=this.m_angularImpulse,s=c*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+e,-s,s),e=this.m_angularImpulse-n,i-=a*e,r+=l*e}{const t=this.m_rA,u=this.m_rB,d=b2Vec2.AddVV(b2Vec2.SubVV(b2Vec2.AddVV(n,b2Vec2.CrossSV(r,u,b2Vec2.s_t0),b2Vec2.s_t0),b2Vec2.AddVV(e,b2Vec2.CrossSV(i,t,b2Vec2.s_t1),b2Vec2.s_t1),b2Vec2.s_t2),b2Vec2.MulSV(h*this.m_correctionFactor,this.m_linearError,b2Vec2.s_t3),b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2),m=b2Mat22.MulMV(this.m_linearMass,d,b2MotorJoint.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),p=b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(m);const f=c*this.m_maxForce;this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),b2Vec2.SubVV(this.m_linearImpulse,p,m),e.SelfMulSub(s,m),i-=a*b2Vec2.CrossVV(t,m),n.SelfMulAdd(o,m),r+=l*b2Vec2.CrossVV(u,m)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2=new b2Vec2,b2MotorJoint.SolveVelocityConstraints_s_impulse_v2=new b2Vec2,b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2=new b2Vec2;class b2MouseJoint extends b2Joint{constructor(t){super(t),this.m_localAnchorB=new b2Vec2,this.m_targetA=new b2Vec2,this.m_stiffness=0,this.m_damping=0,this.m_beta=0,this.m_impulse=new b2Vec2,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new b2Mat22,this.m_C=new b2Vec2,this.m_qB=new b2Rot,this.m_lalcB=new b2Vec2,this.m_K=new b2Mat22,this.m_targetA.Copy(b2Maybe(t.target,b2Vec2.ZERO)),b2Transform.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=b2Maybe(t.maxForce,0),this.m_impulse.SetZero(),this.m_stiffness=b2Maybe(t.stiffness,0),this.m_damping=b2Maybe(t.damping,0),this.m_beta=0,this.m_gamma=0}SetTarget(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const o=this.m_qB.SetAngle(i),a=this.m_bodyB.GetMass(),l=2*s*this.m_stiffness,c=2*a*this.m_damping*l,h=a*(l*l),u=t.step.dt;this.m_gamma=u*(c+u*h),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*h*this.m_gamma,b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),b2Rot.MulRV(o,this.m_lalcB,this.m_rB);const d=this.m_K;d.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,d.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,d.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let i=t.velocities[this.m_indexB].w;const n=b2Vec2.AddVCrossSV(e,i,this.m_rB,b2MouseJoint.SolveVelocityConstraints_s_Cdot),r=b2Mat22.MulMV(this.m_mass,b2Vec2.AddVV(n,b2Vec2.AddVV(this.m_C,b2Vec2.MulSV(this.m_gamma,this.m_impulse,b2Vec2.s_t0),b2Vec2.s_t0),b2Vec2.s_t0).SelfNeg(),b2MouseJoint.SolveVelocityConstraints_s_impulse),s=b2MouseJoint.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);const o=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>o*o&&this.m_impulse.SelfMul(o/this.m_impulse.Length()),b2Vec2.SubVV(this.m_impulse,s,r),e.SelfMulAdd(this.m_invMassB,r),i+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=i}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return b2Vec2.MulSV(t,this.m_impulse,e)}GetReactionTorque(t){return 0}Dump(t){t("Mouse joint dumping is not supported.\n")}ShiftOrigin(t){this.m_targetA.SelfSub(t)}}b2MouseJoint.SolveVelocityConstraints_s_Cdot=new b2Vec2,b2MouseJoint.SolveVelocityConstraints_s_impulse=new b2Vec2,b2MouseJoint.SolveVelocityConstraints_s_oldImpulse=new b2Vec2;class b2PrismaticJoint extends b2Joint{constructor(t){super(t),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_localXAxisA=new b2Vec2,this.m_localYAxisA=new b2Vec2,this.m_referenceAngle=0,this.m_impulse=new b2Vec2(0,0),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new b2Vec2(0,0),this.m_perp=new b2Vec2(0,0),this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new b2Mat22,this.m_K3=new b2Mat33,this.m_K2=new b2Mat22,this.m_translation=0,this.m_axialMass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_localXAxisA.Copy(b2Maybe(t.localAxisA,new b2Vec2(1,0))).SelfNormalize(),b2Vec2.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=b2Maybe(t.referenceAngle,0),this.m_lowerTranslation=b2Maybe(t.lowerTranslation,0),this.m_upperTranslation=b2Maybe(t.upperTranslation,0),this.m_maxMotorForce=b2Maybe(t.maxMotorForce,0),this.m_motorSpeed=b2Maybe(t.motorSpeed,0),this.m_enableLimit=b2Maybe(t.enableLimit,!1),this.m_enableMotor=b2Maybe(t.enableMotor,!1)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const u=b2Rot.MulRV(c,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=b2Rot.MulRV(h,this.m_lalcB,this.m_rB),m=b2Vec2.AddVV(b2Vec2.SubVV(s,e,b2Vec2.s_t0),b2Vec2.SubVV(d,u,b2Vec2.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_d),p=this.m_invMassA,f=this.m_invMassB,_=this.m_invIA,g=this.m_invIB;if(b2Rot.MulRV(c,this.m_localXAxisA,this.m_axis),this.m_a1=b2Vec2.CrossVV(b2Vec2.AddVV(m,u,b2Vec2.s_t0),this.m_axis),this.m_a2=b2Vec2.CrossVV(d,this.m_axis),this.m_axialMass=p+f+_*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),b2Rot.MulRV(c,this.m_localYAxisA,this.m_perp),this.m_s1=b2Vec2.CrossVV(b2Vec2.AddVV(m,u,b2Vec2.s_t0),this.m_perp),this.m_s2=b2Vec2.CrossVV(d,this.m_perp),this.m_K.ex.x=p+f+_*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.ex.y=_*this.m_s1+g*this.m_s2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=_+g,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_enableLimit?this.m_translation=b2Vec2.DotVV(this.m_axis,m):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const e=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,i=b2Vec2.AddVV(b2Vec2.MulSV(this.m_impulse.x,this.m_perp,b2Vec2.s_t0),b2Vec2.MulSV(e,this.m_axis,b2Vec2.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_P),s=this.m_impulse.x*this.m_s1+this.m_impulse.y+e*this.m_a1,o=this.m_impulse.x*this.m_s2+this.m_impulse.y+e*this.m_a2;n.SelfMulSub(p,i),r-=_*s,a.SelfMulAdd(f,i),l+=g*o}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor){const c=b2Vec2.DotVV(this.m_axis,b2Vec2.SubVV(n,e,b2Vec2.s_t0))+this.m_a2*r-this.m_a1*i;let h=this.m_axialMass*(this.m_motorSpeed-c);const u=this.m_motorImpulse,d=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+h,-d,d),h=this.m_motorImpulse-u;const m=b2Vec2.MulSV(h,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),p=h*this.m_a1,f=h*this.m_a2;e.SelfMulSub(s,m),i-=a*p,n.SelfMulAdd(o,m),r+=l*f}if(this.m_enableLimit){{const c=this.m_translation-this.m_lowerTranslation,h=b2Vec2.DotVV(this.m_axis,b2Vec2.SubVV(n,e,b2Vec2.s_t0))+this.m_a2*r-this.m_a1*i;let u=-this.m_axialMass*(h+b2Max(c,0)*t.step.inv_dt);const d=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+u,0),u=this.m_lowerImpulse-d;const m=b2Vec2.MulSV(u,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),p=u*this.m_a1,f=u*this.m_a2;e.SelfMulSub(s,m),i-=a*p,n.SelfMulAdd(o,m),r+=l*f}{const c=this.m_upperTranslation-this.m_translation,h=b2Vec2.DotVV(this.m_axis,b2Vec2.SubVV(e,n,b2Vec2.s_t0))+this.m_a1*i-this.m_a2*r;let u=-this.m_axialMass*(h+b2Max(c,0)*t.step.inv_dt);const d=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+u,0),u=this.m_upperImpulse-d;const m=b2Vec2.MulSV(u,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),p=u*this.m_a1,f=u*this.m_a2;e.SelfMulAdd(s,m),i+=a*p,n.SelfMulSub(o,m),r-=l*f}}{const t=b2Vec2.DotVV(this.m_perp,b2Vec2.SubVV(n,e,b2Vec2.s_t0))+this.m_s2*r-this.m_s1*i,c=r-i,h=this.m_K.Solve(-t,-c,b2PrismaticJoint.SolveVelocityConstraints_s_df);this.m_impulse.SelfAdd(h);const u=b2Vec2.MulSV(h.x,this.m_perp,b2PrismaticJoint.SolveVelocityConstraints_s_P),d=h.x*this.m_s1+h.y,m=h.x*this.m_s2+h.y;e.SelfMulSub(s,u),i-=a*d,n.SelfMulAdd(o,u),r+=l*m}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,m=b2Rot.MulRV(s,this.m_lalcA,this.m_rA),p=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),f=b2Vec2.SubVV(b2Vec2.AddVV(n,p,b2Vec2.s_t0),b2Vec2.AddVV(e,m,b2Vec2.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_d),_=b2Rot.MulRV(s,this.m_localXAxisA,this.m_axis),g=b2Vec2.CrossVV(b2Vec2.AddVV(f,m,b2Vec2.s_t0),_),b=b2Vec2.CrossVV(p,_),y=b2Rot.MulRV(s,this.m_localYAxisA,this.m_perp),x=b2Vec2.CrossVV(b2Vec2.AddVV(f,m,b2Vec2.s_t0),y),v=b2Vec2.CrossVV(p,y);let S=b2PrismaticJoint.SolvePositionConstraints_s_impulse;const w=b2Vec2.DotVV(y,f),M=r-i-this.m_referenceAngle;let A=N(w);const V=N(M);let C=!1,T=0;if(this.m_enableLimit){const t=b2Vec2.DotVV(_,f);N(this.m_upperTranslation-this.m_lowerTranslation)<2*u?(T=t,A=b2Max(A,N(t)),C=!0):t<=this.m_lowerTranslation?(T=b2Min(t-this.m_lowerTranslation,0),A=b2Max(A,this.m_lowerTranslation-t),C=!0):t>=this.m_upperTranslation&&(T=b2Max(t-this.m_upperTranslation,0),A=b2Max(A,t-this.m_upperTranslation),C=!0)}if(C){const t=a+l+c*x*x+h*v*v,e=c*x+h*v,i=c*x*g+h*v*b;let n=c+h;0===n&&(n=1);const r=c*g+h*b,s=a+l+c*g*g+h*b*b,o=this.m_K3;o.ex.SetXYZ(t,e,i),o.ey.SetXYZ(e,n,r),o.ez.SetXYZ(i,r,s),S=o.Solve33(-w,-M,-T,S)}else{const t=a+l+c*x*x+h*v*v,e=c*x+h*v;let i=c+h;0===i&&(i=1);const n=this.m_K2;n.ex.Set(t,e),n.ey.Set(e,i);const r=n.Solve(-w,-M,b2PrismaticJoint.SolvePositionConstraints_s_impulse1);S.x=r.x,S.y=r.y,S.z=0}const B=b2Vec2.AddVV(b2Vec2.MulSV(S.x,y,b2Vec2.s_t0),b2Vec2.MulSV(S.z,_,b2Vec2.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_P),P=S.x*x+S.y+S.z*g,E=S.x*v+S.y+S.z*b;return e.SelfMulSub(a,B),i-=c*P,n.SelfMulAdd(l,B),r+=h*E,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,A<=u&&V<=d}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.x),e.y=t*(this.m_impulse.y*this.m_perp.y+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.y),e}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PrismaticJoint.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PrismaticJoint.GetJointTranslation_s_pB),i=b2Vec2.SubVV(e,t,b2PrismaticJoint.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,b2PrismaticJoint.GetJointTranslation_s_axis),r=b2Vec2.DotVV(i,n);return r}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;b2Vec2.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=b2Rot.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const n=b2Rot.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=b2Vec2.AddVV(t.m_sweep.c,i,b2Vec2.s_t0),s=b2Vec2.AddVV(e.m_sweep.c,n,b2Vec2.s_t1),o=b2Vec2.SubVV(s,r,b2Vec2.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity,d=b2Vec2.DotVV(o,b2Vec2.CrossSV(h,a,b2Vec2.s_t0))+b2Vec2.DotVV(a,b2Vec2.SubVV(b2Vec2.AddVCrossSV(c,u,n,b2Vec2.s_t0),b2Vec2.AddVCrossSV(l,h,i,b2Vec2.s_t1),b2Vec2.s_t0));return d}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(t){const e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),n=b2Transform.MulXV(e,this.m_localAnchorA,b2PrismaticJoint.Draw_s_pA),r=b2Transform.MulXV(i,this.m_localAnchorB,b2PrismaticJoint.Draw_s_pB),s=b2Rot.MulRV(e.q,this.m_localXAxisA,b2PrismaticJoint.Draw_s_axis),o=b2PrismaticJoint.Draw_s_c1,a=b2PrismaticJoint.Draw_s_c2,l=b2PrismaticJoint.Draw_s_c3,c=b2PrismaticJoint.Draw_s_c4,h=b2PrismaticJoint.Draw_s_c5;if(t.DrawSegment(n,r,h),this.m_enableLimit){const i=b2Vec2.AddVMulSV(n,this.m_lowerTranslation,s,b2PrismaticJoint.Draw_s_lower),r=b2Vec2.AddVMulSV(n,this.m_upperTranslation,s,b2PrismaticJoint.Draw_s_upper),c=b2Rot.MulRV(e.q,this.m_localYAxisA,b2PrismaticJoint.Draw_s_perp);t.DrawSegment(i,r,o),t.DrawSegment(b2Vec2.AddVMulSV(i,-.5,c,b2Vec2.s_t0),b2Vec2.AddVMulSV(i,.5,c,b2Vec2.s_t1),a),t.DrawSegment(b2Vec2.AddVMulSV(r,-.5,c,b2Vec2.s_t0),b2Vec2.AddVMulSV(r,.5,c,b2Vec2.s_t1),l)}else t.DrawSegment(b2Vec2.AddVMulSV(n,-1,s,b2Vec2.s_t0),b2Vec2.AddVMulSV(n,1,s,b2Vec2.s_t1),o);t.DrawPoint(n,5,o),t.DrawPoint(r,5,c)}}b2PrismaticJoint.InitVelocityConstraints_s_d=new b2Vec2,b2PrismaticJoint.InitVelocityConstraints_s_P=new b2Vec2,b2PrismaticJoint.SolveVelocityConstraints_s_P=new b2Vec2,b2PrismaticJoint.SolveVelocityConstraints_s_df=new b2Vec2,b2PrismaticJoint.SolvePositionConstraints_s_d=new b2Vec2,b2PrismaticJoint.SolvePositionConstraints_s_impulse=new b2Vec3,b2PrismaticJoint.SolvePositionConstraints_s_impulse1=new b2Vec2,b2PrismaticJoint.SolvePositionConstraints_s_P=new b2Vec2,b2PrismaticJoint.GetJointTranslation_s_pA=new b2Vec2,b2PrismaticJoint.GetJointTranslation_s_pB=new b2Vec2,b2PrismaticJoint.GetJointTranslation_s_d=new b2Vec2,b2PrismaticJoint.GetJointTranslation_s_axis=new b2Vec2,b2PrismaticJoint.Draw_s_pA=new b2Vec2,b2PrismaticJoint.Draw_s_pB=new b2Vec2,b2PrismaticJoint.Draw_s_axis=new b2Vec2,b2PrismaticJoint.Draw_s_c1=new b2Color(.7,.7,.7),b2PrismaticJoint.Draw_s_c2=new b2Color(.3,.9,.3),b2PrismaticJoint.Draw_s_c3=new b2Color(.9,.3,.3),b2PrismaticJoint.Draw_s_c4=new b2Color(.3,.3,.9),b2PrismaticJoint.Draw_s_c5=new b2Color(.4,.4,.4),b2PrismaticJoint.Draw_s_lower=new b2Vec2,b2PrismaticJoint.Draw_s_upper=new b2Vec2,b2PrismaticJoint.Draw_s_perp=new b2Vec2;class b2PulleyJoint extends b2Joint{constructor(t){super(t),this.m_groundAnchorA=new b2Vec2,this.m_groundAnchorB=new b2Vec2,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new b2Vec2,this.m_uB=new b2Vec2,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_groundAnchorA.Copy(b2Maybe(t.groundAnchorA,new b2Vec2(-1,1))),this.m_groundAnchorB.Copy(b2Maybe(t.groundAnchorB,new b2Vec2(1,0))),this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,new b2Vec2(-1,0))),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,new b2Vec2(1,0))),this.m_lengthA=b2Maybe(t.lengthA,0),this.m_lengthB=b2Maybe(t.lengthB,0),this.m_ratio=b2Maybe(t.ratio,1),this.m_constant=b2Maybe(t.lengthA,0)+this.m_ratio*b2Maybe(t.lengthB,0),this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),b2Rot.MulRV(c,this.m_lalcA,this.m_rA),b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),b2Rot.MulRV(h,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(s).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);const d=this.m_uA.Length(),m=this.m_uB.Length();d>10*u?this.m_uA.SelfMul(1/d):this.m_uA.SetZero(),m>10*u?this.m_uB.SelfMul(1/m):this.m_uB.SetZero();const p=b2Vec2.CrossVV(this.m_rA,this.m_uA),f=b2Vec2.CrossVV(this.m_rB,this.m_uB),_=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=_+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=b2Vec2.MulSV(-this.m_impulse,this.m_uA,b2PulleyJoint.InitVelocityConstraints_s_PA),i=b2Vec2.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,b2PulleyJoint.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*b2Vec2.CrossVV(this.m_rA,e),a.SelfMulAdd(this.m_invMassB,i),l+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,i)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=b2Vec2.AddVCrossSV(e,i,this.m_rA,b2PulleyJoint.SolveVelocityConstraints_s_vpA),o=b2Vec2.AddVCrossSV(n,r,this.m_rB,b2PulleyJoint.SolveVelocityConstraints_s_vpB),a=-b2Vec2.DotVV(this.m_uA,s)-this.m_ratio*b2Vec2.DotVV(this.m_uB,o),l=-this.m_mass*a;this.m_impulse+=l;const c=b2Vec2.MulSV(-l,this.m_uA,b2PulleyJoint.SolveVelocityConstraints_s_PA),h=b2Vec2.MulSV(-this.m_ratio*l,this.m_uB,b2PulleyJoint.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,c),i+=this.m_invIA*b2Vec2.CrossVV(this.m_rA,c),n.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*b2Vec2.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=b2Rot.MulRV(s,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const l=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),c=this.m_uA.Copy(e).SelfAdd(a).SelfSub(this.m_groundAnchorA),h=this.m_uB.Copy(n).SelfAdd(l).SelfSub(this.m_groundAnchorB),d=c.Length(),m=h.Length();d>10*u?c.SelfMul(1/d):c.SetZero(),m>10*u?h.SelfMul(1/m):h.SetZero();const p=b2Vec2.CrossVV(a,c),f=b2Vec2.CrossVV(l,h),_=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*f*f;let b=_+this.m_ratio*this.m_ratio*g;b>0&&(b=1/b);const y=this.m_constant-d-this.m_ratio*m,x=N(y),v=-b*y,S=b2Vec2.MulSV(-v,c,b2PulleyJoint.SolvePositionConstraints_s_PA),w=b2Vec2.MulSV(-this.m_ratio*v,h,b2PulleyJoint.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,S),i+=this.m_invIA*b2Vec2.CrossVV(a,S),n.SelfMulAdd(this.m_invMassB,w),r+=this.m_invIB*b2Vec2.CrossVV(l,w),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,x<u}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PulleyJoint.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return b2Vec2.DistanceVV(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PulleyJoint.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return b2Vec2.DistanceVV(t,e)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}b2PulleyJoint.InitVelocityConstraints_s_PA=new b2Vec2,b2PulleyJoint.InitVelocityConstraints_s_PB=new b2Vec2,b2PulleyJoint.SolveVelocityConstraints_s_vpA=new b2Vec2,b2PulleyJoint.SolveVelocityConstraints_s_vpB=new b2Vec2,b2PulleyJoint.SolveVelocityConstraints_s_PA=new b2Vec2,b2PulleyJoint.SolveVelocityConstraints_s_PB=new b2Vec2,b2PulleyJoint.SolvePositionConstraints_s_PA=new b2Vec2,b2PulleyJoint.SolvePositionConstraints_s_PB=new b2Vec2,b2PulleyJoint.GetCurrentLengthA_s_p=new b2Vec2,b2PulleyJoint.GetCurrentLengthB_s_p=new b2Vec2;class b2RevoluteJoint extends b2Joint{constructor(t){super(t),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec2,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_K=new b2Mat22,this.m_angle=0,this.m_axialMass=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_referenceAngle=b2Maybe(t.referenceAngle,0),this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=b2Maybe(t.lowerAngle,0),this.m_upperAngle=b2Maybe(t.upperAngle,0),this.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),this.m_motorSpeed=b2Maybe(t.motorSpeed,0),this.m_enableLimit=b2Maybe(t.enableLimit,!1),this.m_enableMotor=b2Maybe(t.enableMotor,!1)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),b2Rot.MulRV(a,this.m_lalcA,this.m_rA),b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),b2Rot.MulRV(l,this.m_lalcB,this.m_rB);const c=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,d=this.m_invIB;let m;if(this.m_K.ex.x=c+h+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*d,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*d,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=c+h+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*d,this.m_axialMass=u+d,this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,m=!1):m=!0,this.m_angle=r-e-this.m_referenceAngle,(!1===this.m_enableLimit||m)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(!1===this.m_enableMotor||m)&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const e=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,r=b2RevoluteJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(c,r),n-=u*(b2Vec2.CrossVV(this.m_rA,r)+e),s.SelfMulAdd(h,r),o+=d*(b2Vec2.CrossVV(this.m_rB,r)+e)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,c=a+l===0;if(this.m_enableMotor&&!c){const e=r-i-this.m_motorSpeed;let n=-this.m_axialMass*e;const s=this.m_motorImpulse,o=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+n,-o,o),n=this.m_motorImpulse-s,i-=a*n,r+=l*n}if(this.m_enableLimit&&!c){{const e=this.m_angle-this.m_lowerAngle,n=r-i;let s=-this.m_axialMass*(n+b2Max(e,0)*t.step.inv_dt);const o=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+s,0),s=this.m_lowerImpulse-o,i-=a*s,r+=l*s}{const e=this.m_upperAngle-this.m_angle,n=i-r;let s=-this.m_axialMass*(n+b2Max(e,0)*t.step.inv_dt);const o=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+s,0),s=this.m_upperImpulse-o,i+=a*s,r-=l*s}}{const t=b2Vec2.SubVV(b2Vec2.AddVCrossSV(n,r,this.m_rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(e,i,this.m_rA,b2Vec2.s_t1),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2),c=this.m_K.Solve(-t.x,-t.y,b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=c.x,this.m_impulse.y+=c.y,e.SelfMulSub(s,c),i-=a*b2Vec2.CrossVV(this.m_rA,c),n.SelfMulAdd(o,c),r+=l*b2Vec2.CrossVV(this.m_rB,c)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r);let a=0,l=0;const c=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!c){const t=r-i-this.m_referenceAngle;let e=0;N(this.m_upperAngle-this.m_lowerAngle)<2*d?e=b2Clamp(t-this.m_lowerAngle,-g,g):t<=this.m_lowerAngle?e=b2Clamp(t-this.m_lowerAngle+d,-g,0):t>=this.m_upperAngle&&(e=b2Clamp(t-this.m_upperAngle-d,0,g));const n=-this.m_axialMass*e;i-=this.m_invIA*n,r+=this.m_invIB*n,a=N(e)}{s.SetAngle(i),o.SetAngle(r),b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const t=b2Rot.MulRV(s,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const a=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),c=b2Vec2.SubVV(b2Vec2.AddVV(n,a,b2Vec2.s_t0),b2Vec2.AddVV(e,t,b2Vec2.s_t1),b2RevoluteJoint.SolvePositionConstraints_s_C_v2);l=c.Length();const h=this.m_invMassA,u=this.m_invMassB,d=this.m_invIA,m=this.m_invIB,p=this.m_K;p.ex.x=h+u+d*t.y*t.y+m*a.y*a.y,p.ex.y=-d*t.x*t.y-m*a.x*a.y,p.ey.x=p.ex.y,p.ey.y=h+u+d*t.x*t.x+m*a.x*a.x;const f=p.Solve(c.x,c.y,b2RevoluteJoint.SolvePositionConstraints_s_impulse).SelfNeg();e.SelfMulSub(h,f),i-=d*b2Vec2.CrossVV(t,f),n.SelfMulAdd(u,f),r+=m*b2Vec2.CrossVV(a,f)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,l<=u&&a<=d}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*(this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(t){const e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),n=b2Transform.MulXV(e,this.m_localAnchorA,b2RevoluteJoint.Draw_s_pA),r=b2Transform.MulXV(i,this.m_localAnchorB,b2RevoluteJoint.Draw_s_pB),s=b2RevoluteJoint.Draw_s_c1,o=b2RevoluteJoint.Draw_s_c2,a=b2RevoluteJoint.Draw_s_c3,l=b2RevoluteJoint.Draw_s_c4,c=b2RevoluteJoint.Draw_s_c5;t.DrawPoint(n,5,l),t.DrawPoint(r,5,c);const h=this.m_bodyA.GetAngle(),u=this.m_bodyB.GetAngle(),d=u-h-this.m_referenceAngle,m=.5,p=b2RevoluteJoint.Draw_s_r.Set(m*Math.cos(d),m*Math.sin(d));if(t.DrawSegment(r,b2Vec2.AddVV(r,p,b2Vec2.s_t0),s),t.DrawCircle(r,m,s),this.m_enableLimit){const e=b2RevoluteJoint.Draw_s_rlo.Set(m*Math.cos(this.m_lowerAngle),m*Math.sin(this.m_lowerAngle)),i=b2RevoluteJoint.Draw_s_rhi.Set(m*Math.cos(this.m_upperAngle),m*Math.sin(this.m_upperAngle));t.DrawSegment(r,b2Vec2.AddVV(r,e,b2Vec2.s_t0),o),t.DrawSegment(r,b2Vec2.AddVV(r,i,b2Vec2.s_t0),a)}const f=b2RevoluteJoint.Draw_s_color_;t.DrawSegment(e.p,n,f),t.DrawSegment(n,r,f),t.DrawSegment(i.p,r,f)}}b2RevoluteJoint.InitVelocityConstraints_s_P=new b2Vec2,b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2=new b2Vec2,b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2=new b2Vec2,b2RevoluteJoint.SolvePositionConstraints_s_C_v2=new b2Vec2,b2RevoluteJoint.SolvePositionConstraints_s_impulse=new b2Vec2,b2RevoluteJoint.Draw_s_pA=new b2Vec2,b2RevoluteJoint.Draw_s_pB=new b2Vec2,b2RevoluteJoint.Draw_s_c1=new b2Color(.7,.7,.7),b2RevoluteJoint.Draw_s_c2=new b2Color(.3,.9,.3),b2RevoluteJoint.Draw_s_c3=new b2Color(.9,.3,.3),b2RevoluteJoint.Draw_s_c4=new b2Color(.3,.3,.9),b2RevoluteJoint.Draw_s_c5=new b2Color(.4,.4,.4),b2RevoluteJoint.Draw_s_color_=new b2Color(.5,.8,.8),b2RevoluteJoint.Draw_s_r=new b2Vec2,b2RevoluteJoint.Draw_s_rlo=new b2Vec2,b2RevoluteJoint.Draw_s_rhi=new b2Vec2;class b2WeldJoint extends b2Joint{constructor(t){super(t),this.m_stiffness=0,this.m_damping=0,this.m_bias=0,this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new b2Vec3(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new b2Mat33,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_K=new b2Mat33,this.m_stiffness=b2Maybe(t.stiffness,0),this.m_damping=b2Maybe(t.damping,0),this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_referenceAngle=b2Maybe(t.referenceAngle,0),this.m_impulse.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),b2Rot.MulRV(a,this.m_lalcA,this.m_rA),b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),b2Rot.MulRV(l,this.m_lalcB,this.m_rB);const c=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,d=this.m_invIB,m=this.m_K;if(m.ex.x=c+h+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*d,m.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*d,m.ez.x=-this.m_rA.y*u-this.m_rB.y*d,m.ex.y=m.ey.x,m.ey.y=c+h+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*d,m.ez.y=this.m_rA.x*u+this.m_rB.x*d,m.ex.z=m.ez.x,m.ey.z=m.ez.y,m.ez.z=u+d,this.m_stiffness>0){m.GetInverse22(this.m_mass);let i=u+d;const n=r-e-this.m_referenceAngle,s=this.m_damping,o=this.m_stiffness,a=t.step.dt;this.m_gamma=a*(s+a*o),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=n*a*o*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else m.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);const e=b2WeldJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(c,e),n-=u*(b2Vec2.CrossVV(this.m_rA,e)+this.m_impulse.z),s.SelfMulAdd(h,e),o+=d*(b2Vec2.CrossVV(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_stiffness>0){const t=r-i,c=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=a*c,r+=l*c;const h=b2Vec2.SubVV(b2Vec2.AddVCrossSV(n,r,this.m_rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(e,i,this.m_rA,b2Vec2.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),u=b2Mat33.MulM33XY(this.m_mass,h.x,h.y,b2WeldJoint.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=u.x,this.m_impulse.y+=u.y;const d=u;e.SelfMulSub(s,d),i-=a*b2Vec2.CrossVV(this.m_rA,d),n.SelfMulAdd(o,d),r+=l*b2Vec2.CrossVV(this.m_rB,d)}else{const t=b2Vec2.SubVV(b2Vec2.AddVCrossSV(n,r,this.m_rB,b2Vec2.s_t0),b2Vec2.AddVCrossSV(e,i,this.m_rA,b2Vec2.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),c=r-i,h=b2Mat33.MulM33XYZ(this.m_mass,t.x,t.y,c,b2WeldJoint.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(h);const u=b2WeldJoint.SolveVelocityConstraints_s_P.Set(h.x,h.y);e.SelfMulSub(s,u),i-=a*(b2Vec2.CrossVV(this.m_rA,u)+h.z),n.SelfMulAdd(o,u),r+=l*(b2Vec2.CrossVV(this.m_rB,u)+h.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=b2Rot.MulRV(s,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const p=b2Rot.MulRV(o,this.m_lalcB,this.m_rB);let f,_;const g=this.m_K;if(g.ex.x=a+l+m.y*m.y*c+p.y*p.y*h,g.ey.x=-m.y*m.x*c-p.y*p.x*h,g.ez.x=-m.y*c-p.y*h,g.ex.y=g.ey.x,g.ey.y=a+l+m.x*m.x*c+p.x*p.x*h,g.ez.y=m.x*c+p.x*h,g.ex.z=g.ez.x,g.ey.z=g.ez.y,g.ez.z=c+h,this.m_stiffness>0){const t=b2Vec2.SubVV(b2Vec2.AddVV(n,p,b2Vec2.s_t0),b2Vec2.AddVV(e,m,b2Vec2.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1);f=t.Length(),_=0;const s=g.Solve22(t.x,t.y,b2WeldJoint.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(a,s),i-=c*b2Vec2.CrossVV(m,s),n.SelfMulAdd(l,s),r+=h*b2Vec2.CrossVV(p,s)}else{const t=b2Vec2.SubVV(b2Vec2.AddVV(n,p,b2Vec2.s_t0),b2Vec2.AddVV(e,m,b2Vec2.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1),s=r-i-this.m_referenceAngle;f=t.Length(),_=N(s);const o=g.Solve33(t.x,t.y,s,b2WeldJoint.SolvePositionConstraints_s_impulse).SelfNeg(),u=b2WeldJoint.SolvePositionConstraints_s_P.Set(o.x,o.y);e.SelfMulSub(a,u),i-=c*(b2Vec2.CrossVV(this.m_rA,u)+o.z),n.SelfMulAdd(l,u),r+=h*(b2Vec2.CrossVV(this.m_rB,u)+o.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,f<=u&&_<=d}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}b2WeldJoint.InitVelocityConstraints_s_P=new b2Vec2,b2WeldJoint.SolveVelocityConstraints_s_Cdot1=new b2Vec2,b2WeldJoint.SolveVelocityConstraints_s_impulse1=new b2Vec2,b2WeldJoint.SolveVelocityConstraints_s_impulse=new b2Vec3,b2WeldJoint.SolveVelocityConstraints_s_P=new b2Vec2,b2WeldJoint.SolvePositionConstraints_s_C1=new b2Vec2,b2WeldJoint.SolvePositionConstraints_s_P=new b2Vec2,b2WeldJoint.SolvePositionConstraints_s_impulse=new b2Vec3;class b2WheelJoint extends b2Joint{constructor(t){super(t),this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_localXAxisA=new b2Vec2,this.m_localYAxisA=new b2Vec2,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_translation=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_stiffness=0,this.m_damping=0,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new b2Vec2,this.m_ay=new b2Vec2,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new b2Rot,this.m_qB=new b2Rot,this.m_lalcA=new b2Vec2,this.m_lalcB=new b2Vec2,this.m_rA=new b2Vec2,this.m_rB=new b2Vec2,this.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,b2Vec2.ZERO)),this.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,b2Vec2.ZERO)),this.m_localXAxisA.Copy(b2Maybe(t.localAxisA,b2Vec2.UNITX)),b2Vec2.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_lowerTranslation=b2Maybe(t.lowerTranslation,0),this.m_upperTranslation=b2Maybe(t.upperTranslation,0),this.m_enableLimit=b2Maybe(t.enableLimit,!1),this.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),this.m_motorSpeed=b2Maybe(t.motorSpeed,0),this.m_enableMotor=b2Maybe(t.enableMotor,!1),this.m_ax.SetZero(),this.m_ay.SetZero(),this.m_stiffness=b2Maybe(t.stiffness,0),this.m_damping=b2Maybe(t.damping,0)}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(t){this.m_stiffness=t}GetSpringFrequencyHz(){return this.m_stiffness}SetSpringDampingRatio(t){this.m_damping=t}GetSpringDampingRatio(){return this.m_damping}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,a=t.velocities[this.m_indexA].v;let l=t.velocities[this.m_indexA].w;const c=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v;let d=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(o),p=this.m_qB.SetAngle(h);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const f=b2Rot.MulRV(m,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const _=b2Rot.MulRV(p,this.m_lalcB,this.m_rB),g=b2Vec2.SubVV(b2Vec2.AddVV(c,_,b2Vec2.s_t0),b2Vec2.AddVV(s,f,b2Vec2.s_t1),b2WheelJoint.InitVelocityConstraints_s_d);b2Rot.MulRV(m,this.m_localYAxisA,this.m_ay),this.m_sAy=b2Vec2.CrossVV(b2Vec2.AddVV(g,f,b2Vec2.s_t0),this.m_ay),this.m_sBy=b2Vec2.CrossVV(_,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),b2Rot.MulRV(m,this.m_localXAxisA,this.m_ax),this.m_sAx=b2Vec2.CrossVV(b2Vec2.AddVV(g,f,b2Vec2.s_t0),this.m_ax),this.m_sBx=b2Vec2.CrossVV(_,this.m_ax);const b=e+i+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(this.m_axialMass=b>0?1/b:0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&b>0){this.m_springMass=1/b;const e=b2Vec2.DotVV(g,this.m_ax),i=t.step.dt;this.m_gamma=i*(this.m_damping+i*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*i*this.m_stiffness*this.m_gamma,this.m_springMass=b+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=b2Vec2.DotVV(this.m_ax,g):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=n+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const e=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,i=b2Vec2.AddVV(b2Vec2.MulSV(this.m_impulse,this.m_ay,b2Vec2.s_t0),b2Vec2.MulSV(e,this.m_ax,b2Vec2.s_t1),b2WheelJoint.InitVelocityConstraints_s_P),n=this.m_impulse*this.m_sAy+e*this.m_sAx+this.m_motorImpulse,r=this.m_impulse*this.m_sBy+e*this.m_sBx+this.m_motorImpulse;a.SelfMulSub(this.m_invMassA,i),l-=this.m_invIA*n,u.SelfMulAdd(this.m_invMassB,i),d+=this.m_invIB*r}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=d}SolveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=t.velocities[this.m_indexA].v;let o=t.velocities[this.m_indexA].w;const a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;{const t=b2Vec2.DotVV(this.m_ax,b2Vec2.SubVV(a,s,b2Vec2.s_t0))+this.m_sBx*l-this.m_sAx*o,c=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;const h=b2Vec2.MulSV(c,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),u=c*this.m_sAx,d=c*this.m_sBx;s.SelfMulSub(e,h),o-=n*u,a.SelfMulAdd(i,h),l+=r*d}{const e=l-o-this.m_motorSpeed;let i=-this.m_motorMass*e;const s=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+i,-a,a),i=this.m_motorImpulse-s,o-=n*i,l+=r*i}if(this.m_enableLimit){{const c=this.m_translation-this.m_lowerTranslation,h=b2Vec2.DotVV(this.m_ax,b2Vec2.SubVV(a,s,b2Vec2.s_t0))+this.m_sBx*l-this.m_sAx*o;let u=-this.m_axialMass*(h+b2Max(c,0)*t.step.inv_dt);const d=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+u,0),u=this.m_lowerImpulse-d;const m=b2Vec2.MulSV(u,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),p=u*this.m_sAx,f=u*this.m_sBx;s.SelfMulSub(e,m),o-=n*p,a.SelfMulAdd(i,m),l+=r*f}{const c=this.m_upperTranslation-this.m_translation,h=b2Vec2.DotVV(this.m_ax,b2Vec2.SubVV(s,a,b2Vec2.s_t0))+this.m_sAx*o-this.m_sBx*l;let u=-this.m_axialMass*(h+b2Max(c,0)*t.step.inv_dt);const d=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+u,0),u=this.m_upperImpulse-d;const m=b2Vec2.MulSV(u,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),p=u*this.m_sAx,f=u*this.m_sBx;s.SelfMulAdd(e,m),o+=n*p,a.SelfMulSub(i,m),l-=r*f}}{const t=b2Vec2.DotVV(this.m_ay,b2Vec2.SubVV(a,s,b2Vec2.s_t0))+this.m_sBy*l-this.m_sAy*o,c=-this.m_mass*t;this.m_impulse+=c;const h=b2Vec2.MulSV(c,this.m_ay,b2WheelJoint.SolveVelocityConstraints_s_P),u=c*this.m_sAy,d=c*this.m_sBy;s.SelfMulSub(e,h),o-=n*u,a.SelfMulAdd(i,h),l+=r*d}t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=l}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a,s=0;if(this.m_enableLimit){const t=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=b2Rot.MulRV(t,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const l=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),c=b2Vec2.AddVV(b2Vec2.SubVV(n,e,b2Vec2.s_t0),b2Vec2.SubVV(l,a,b2Vec2.s_t1),b2WheelJoint.SolvePositionConstraints_s_d),h=b2Rot.MulRV(t,this.m_localXAxisA,this.m_ax),d=b2Vec2.CrossVV(b2Vec2.AddVV(c,a,b2Vec2.s_t0),this.m_ax),m=b2Vec2.CrossVV(l,this.m_ax);let p=0;const f=b2Vec2.DotVV(h,c);if(N(this.m_upperTranslation-this.m_lowerTranslation)<2*u?p=f:f<=this.m_lowerTranslation?p=b2Min(f-this.m_lowerTranslation,0):f>=this.m_upperTranslation&&(p=b2Max(f-this.m_upperTranslation,0)),0!==p){const t=this.m_invMassA+this.m_invMassB+this.m_invIA*d*d+this.m_invIB*m*m;let o=0;0!==t&&(o=-p/t);const a=b2Vec2.MulSV(o,h,b2WheelJoint.SolvePositionConstraints_s_P),l=o*d,c=o*m;e.SelfMulSub(this.m_invMassA,a),i-=this.m_invIA*l,n.SelfMulAdd(this.m_invMassB,a),r+=this.m_invIB*c,s=N(p)}}{const t=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r);b2Vec2.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=b2Rot.MulRV(t,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const l=b2Rot.MulRV(o,this.m_lalcB,this.m_rB),c=b2Vec2.AddVV(b2Vec2.SubVV(n,e,b2Vec2.s_t0),b2Vec2.SubVV(l,a,b2Vec2.s_t1),b2WheelJoint.SolvePositionConstraints_s_d),h=b2Rot.MulRV(t,this.m_localYAxisA,this.m_ay),u=b2Vec2.CrossVV(b2Vec2.AddVV(c,a,b2Vec2.s_t0),h),d=b2Vec2.CrossVV(l,h),m=b2Vec2.DotVV(c,h),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let f=0;0!==p&&(f=-m/p);const _=b2Vec2.MulSV(f,h,b2WheelJoint.SolvePositionConstraints_s_P),g=f*u,b=f*d;e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*g,n.SelfMulAdd(this.m_invMassB,_),r+=this.m_invIB*b,s=b2Max(s,N(m))}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,s<=u}GetDefinition(t){return t}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointLinearSpeed(){return this.GetPrismaticJointSpeed()}GetJointAngle(){return this.GetRevoluteJointAngle()}GetJointAngularSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new b2Vec2),n=e.GetWorldPoint(this.m_localAnchorB,new b2Vec2),r=b2Vec2.SubVV(n,i,new b2Vec2),s=t.GetWorldVector(this.m_localXAxisA,new b2Vec2),o=b2Vec2.DotVV(r,s);return o}GetPrismaticJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;b2Vec2.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=b2Rot.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);b2Vec2.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const n=b2Rot.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=b2Vec2.AddVV(t.m_sweep.c,i,b2Vec2.s_t0),s=b2Vec2.AddVV(e.m_sweep.c,n,b2Vec2.s_t1),o=b2Vec2.SubVV(s,r,b2Vec2.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new b2Vec2),l=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity,d=b2Vec2.DotVV(o,b2Vec2.CrossSV(h,a,b2Vec2.s_t0))+b2Vec2.DotVV(a,b2Vec2.SubVV(b2Vec2.AddVCrossSV(c,u,n,b2Vec2.s_t0),b2Vec2.AddVCrossSV(l,h,i,b2Vec2.s_t1),b2Vec2.s_t0));return d}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){const t=this.m_bodyA.m_angularVelocity,e=this.m_bodyB.m_angularVelocity;return e-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMotorTorque(t){return t*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(t){const e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),n=b2Transform.MulXV(e,this.m_localAnchorA,b2WheelJoint.Draw_s_pA),r=b2Transform.MulXV(i,this.m_localAnchorB,b2WheelJoint.Draw_s_pB),s=b2Rot.MulRV(e.q,this.m_localXAxisA,b2WheelJoint.Draw_s_axis),o=b2WheelJoint.Draw_s_c1,a=b2WheelJoint.Draw_s_c2,l=b2WheelJoint.Draw_s_c3,c=b2WheelJoint.Draw_s_c4,h=b2WheelJoint.Draw_s_c5;if(t.DrawSegment(n,r,h),this.m_enableLimit){const i=b2Vec2.AddVMulSV(n,this.m_lowerTranslation,s,b2WheelJoint.Draw_s_lower),r=b2Vec2.AddVMulSV(n,this.m_upperTranslation,s,b2WheelJoint.Draw_s_upper),c=b2Rot.MulRV(e.q,this.m_localYAxisA,b2WheelJoint.Draw_s_perp);t.DrawSegment(i,r,o),t.DrawSegment(b2Vec2.AddVMulSV(i,-.5,c,b2Vec2.s_t0),b2Vec2.AddVMulSV(i,.5,c,b2Vec2.s_t1),a),t.DrawSegment(b2Vec2.AddVMulSV(r,-.5,c,b2Vec2.s_t0),b2Vec2.AddVMulSV(r,.5,c,b2Vec2.s_t1),l)}else t.DrawSegment(b2Vec2.AddVMulSV(n,-1,s,b2Vec2.s_t0),b2Vec2.AddVMulSV(n,1,s,b2Vec2.s_t1),o);t.DrawPoint(n,5,o),t.DrawPoint(r,5,c)}}b2WheelJoint.InitVelocityConstraints_s_d=new b2Vec2,b2WheelJoint.InitVelocityConstraints_s_P=new b2Vec2,b2WheelJoint.SolveVelocityConstraints_s_P=new b2Vec2,b2WheelJoint.SolvePositionConstraints_s_d=new b2Vec2,b2WheelJoint.SolvePositionConstraints_s_P=new b2Vec2,b2WheelJoint.Draw_s_pA=new b2Vec2,b2WheelJoint.Draw_s_pB=new b2Vec2,b2WheelJoint.Draw_s_axis=new b2Vec2,b2WheelJoint.Draw_s_c1=new b2Color(.7,.7,.7),b2WheelJoint.Draw_s_c2=new b2Color(.3,.9,.3),b2WheelJoint.Draw_s_c3=new b2Color(.9,.3,.3),b2WheelJoint.Draw_s_c4=new b2Color(.3,.3,.9),b2WheelJoint.Draw_s_c5=new b2Color(.4,.4,.4),b2WheelJoint.Draw_s_lower=new b2Vec2,b2WheelJoint.Draw_s_upper=new b2Vec2,b2WheelJoint.Draw_s_perp=new b2Vec2,(Re=t.ParticleFlag||(t.ParticleFlag={}))[Re.b2_waterParticle=0]="b2_waterParticle",Re[Re.b2_zombieParticle=2]="b2_zombieParticle",Re[Re.b2_wallParticle=4]="b2_wallParticle",Re[Re.b2_springParticle=8]="b2_springParticle",Re[Re.b2_elasticParticle=16]="b2_elasticParticle",Re[Re.b2_viscousParticle=32]="b2_viscousParticle",Re[Re.b2_powderParticle=64]="b2_powderParticle",Re[Re.b2_tensileParticle=128]="b2_tensileParticle",Re[Re.b2_colorMixingParticle=256]="b2_colorMixingParticle",Re[Re.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Re[Re.b2_barrierParticle=1024]="b2_barrierParticle",Re[Re.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Re[Re.b2_reactiveParticle=4096]="b2_reactiveParticle",Re[Re.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Re[Re.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Re[Re.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Re[Re.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Re[Re.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";class b2ParticleDef{constructor(){this.flags=0,this.position=new b2Vec2,this.velocity=new b2Vec2,this.color=new b2Color(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null}}function b2CalculateParticleIterations(t,e,i){const n=Math.ceil(Math.sqrt(t/(.01*e))*i);return b2Clamp(n,1,8)}class b2ParticleHandle{constructor(){this.m_index=M}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}}(Ie=t.ParticleGroupFlag||(t.ParticleGroupFlag={}))[Ie.b2_solidParticleGroup=1]="b2_solidParticleGroup",Ie[Ie.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Ie[Ie.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Ie[Ie.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Ie[Ie.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Ie[Ie.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";class b2ParticleGroupDef{constructor(){this.flags=0,this.groupFlags=0,this.position=new b2Vec2,this.angle=0,this.linearVelocity=new b2Vec2,this.angularVelocity=0,this.color=new b2Color,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null}}class b2ParticleGroup{constructor(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new b2Vec2,this.m_linearVelocity=new b2Vec2,this.m_angularVelocity=0,this.m_transform=new b2Transform,this.m_userData=null,this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){if(!this.m_system.m_flagsBuffer.data)throw new Error;let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(e){e|=this.m_groupFlags&t.ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,e)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){const i=b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),b2Vec2.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,b2Vec2.SubVV(t,this.m_center,i),e)}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){if(this.m_system.m_world.IsLocked())throw new Error;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;const t=new b2Vec2,e=new b2Vec2;if(this.m_timestamp!==this.m_system.m_timestamp){const i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[t]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[t]);if(this.m_mass>0){const t=1/this.m_mass;this.m_center.SelfMul(t),this.m_linearVelocity.SelfMul(t)}this.m_inertia=0,this.m_angularVelocity=0;for(let n=this.m_firstIndex;n<this.m_lastIndex;n++)b2Vec2.SubVV(this.m_system.m_positionBuffer.data[n],this.m_center,t),b2Vec2.SubVV(this.m_system.m_velocityBuffer.data[n],this.m_linearVelocity,e),this.m_inertia+=i*b2Vec2.DotVV(t,t),this.m_angularVelocity+=i*b2Vec2.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0=new b2Vec2;class b2StackQueue{constructor(t){this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,t)}get m_capacity(){return this.m_buffer.length}Push(t){if(this.m_back>=this.m_capacity){for(let t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_buffer[this.m_front]=null,this.m_front++}Empty(){return this.m_front===this.m_back}Front(){const t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}class b2VoronoiDiagram{constructor(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=b2MakeArray(t,t=>new b2VoronoiDiagram_Generator),this.m_generatorCapacity=t}AddGenerator(t,e,i){const n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i}Generate(t,e){const n=1/t,r=new b2Vec2(+i,+i),s=new b2Vec2(-i,-i);let o=0;for(let t=0;t<this.m_generatorCount;t++){const e=this.m_generatorBuffer[t];e.necessary&&(b2Vec2.MinV(r,e.center,r),b2Vec2.MaxV(s,e.center,s),++o)}if(0===o)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,s.x+=e,s.y+=e,this.m_countX=1+Math.floor(n*(s.x-r.x)),this.m_countY=1+Math.floor(n*(s.y-r.y)),this.m_diagram=[];const a=new b2StackQueue(4*this.m_countX*this.m_countY);for(let t=0;t<this.m_generatorCount;t++){const e=this.m_generatorBuffer[t];e.center.SelfSub(r).SelfMul(n);const i=Math.floor(e.center.x),s=Math.floor(e.center.y);i>=0&&s>=0&&i<this.m_countX&&s<this.m_countY&&a.Push(new b2VoronoiDiagram_Task(i,s,i+s*this.m_countX,e))}for(;!a.Empty();){const t=a.Front(),e=t.m_x,i=t.m_y,n=t.m_i,r=t.m_generator;a.Pop(),this.m_diagram[n]||(this.m_diagram[n]=r,e>0&&a.Push(new b2VoronoiDiagram_Task(e-1,i,n-1,r)),i>0&&a.Push(new b2VoronoiDiagram_Task(e,i-1,n-this.m_countX,r)),e<this.m_countX-1&&a.Push(new b2VoronoiDiagram_Task(e+1,i,n+1,r)),i<this.m_countY-1&&a.Push(new b2VoronoiDiagram_Task(e,i+1,n+this.m_countX,r)))}for(let t=0;t<this.m_countY;t++)for(let e=0;e<this.m_countX-1;e++){const i=e+t*this.m_countX,n=this.m_diagram[i],r=this.m_diagram[i+1];n!==r&&(a.Push(new b2VoronoiDiagram_Task(e,t,i,r)),a.Push(new b2VoronoiDiagram_Task(e+1,t,i+1,n)))}for(let t=0;t<this.m_countY-1;t++)for(let e=0;e<this.m_countX;e++){const i=e+t*this.m_countX,n=this.m_diagram[i],r=this.m_diagram[i+this.m_countX];n!==r&&(a.Push(new b2VoronoiDiagram_Task(e,t,i,r)),a.Push(new b2VoronoiDiagram_Task(e,t+1,i+this.m_countX,n)))}for(;!a.Empty();){const t=a.Front(),e=t.m_x,i=t.m_y,n=t.m_i,r=t.m_generator;a.Pop();const s=this.m_diagram[n],o=r;if(s!==o){const t=s.center.x-e,r=s.center.y-i,l=o.center.x-e,c=o.center.y-i,h=t*t+r*r,u=l*l+c*c;h>u&&(this.m_diagram[n]=o,e>0&&a.Push(new b2VoronoiDiagram_Task(e-1,i,n-1,o)),i>0&&a.Push(new b2VoronoiDiagram_Task(e,i-1,n-this.m_countX,o)),e<this.m_countX-1&&a.Push(new b2VoronoiDiagram_Task(e+1,i,n+1,o)),i<this.m_countY-1&&a.Push(new b2VoronoiDiagram_Task(e,i+1,n+this.m_countX,o)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let i=0;i<this.m_countX-1;i++){const n=i+e*this.m_countX,r=this.m_diagram[n],s=this.m_diagram[n+1],o=this.m_diagram[n+this.m_countX],a=this.m_diagram[n+1+this.m_countX];s!==o&&(r!==s&&r!==o&&(r.necessary||s.necessary||o.necessary)&&t(r.tag,s.tag,o.tag),a!==s&&a!==o&&(r.necessary||s.necessary||o.necessary)&&t(s.tag,a.tag,o.tag))}}}class b2VoronoiDiagram_Generator{constructor(){this.center=new b2Vec2,this.tag=0,this.necessary=!1}}class b2VoronoiDiagram_Task{constructor(t,e,i,n){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=n}}function std_iter_swap(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function default_compare(t,e){return t<e}function std_sort(t,e=0,i=t.length-e,n=default_compare){let r=e;const s=[];let o=0;for(;;){for(;r+1<i;i++){const e=t[r+Math.floor(Math.random()*(i-r))];s[o++]=i;for(let s=r-1;;){for(;n(t[++s],e););for(;n(e,t[--i]););if(s>=i)break;std_iter_swap(t,s,i)}}if(0===o)break;r=i,i=s[--o]}return t}function std_stable_sort(t,e=0,i=t.length-e,n=default_compare){return std_sort(t,e,i,n)}function std_remove_if(t,e,i=t.length){let n=0;for(let r=0;r<i;++r)e(t[r])||(r!==n?std_iter_swap(t,n++,r):++n);return n}function std_lower_bound(t,e,i,n,r){let s=i-e;for(;s>0;){const i=Math.floor(s/2);let o=e+i;r(t[o],n)?(e=++o,s-=i+1):s=i}return e}function std_upper_bound(t,e,i,n,r){let s=i-e;for(;s>0;){const i=Math.floor(s/2);let o=e+i;r(n,t[o])?s=i:(e=++o,s-=i+1)}return e}function std_rotate(t,e,i,n){let r=i;for(;e!==r;)std_iter_swap(t,e++,r++),r===n?r=i:e===i&&(i=r)}class b2GrowableBuffer{constructor(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){const t=this.capacity?2*this.capacity:E;this.Reserve(t)}Free(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){this.count=std_remove_if(this.data,t,this.count)}Unique(t){this.count=function std_unique(t,e,i,n){if(e===i)return i;let r=e;for(;++e!==i;)n(t[r],t[e])||std_iter_swap(t,++r,e);return++r}(this.data,0,this.count,t)}}class b2FixtureParticleQueryCallback extends b2QueryCallback{constructor(t){super(),this.m_system=t}ShouldQueryParticleSystem(t){return!1}ReportFixture(t){if(t.IsSensor())return!0;const e=t.GetShape(),i=e.GetChildCount();for(let e=0;e<i;e++){const i=t.GetAABB(e),n=this.m_system.GetInsideBoundsEnumerator(i);let r;for(;(r=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,e,r)}return!0}ReportParticle(t,e){return!1}ReportFixtureAndParticle(t,e,i){}}class b2ParticleContact{constructor(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new b2Vec2,this.flags=0}SetIndices(t,e){this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&N(this.weight-t.weight)<.01&&b2Vec2.DistanceSquaredVV(this.normal,t.normal)<1e-4}}class b2ParticleBodyContact{constructor(){this.index=0,this.weight=0,this.normal=new b2Vec2,this.mass=0}}class b2ParticlePair{constructor(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0}}class b2ParticleTriad{constructor(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new b2Vec2(0,0),this.pb=new b2Vec2(0,0),this.pc=new b2Vec2(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0}}class b2ParticleSystemDef{constructor(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return(new b2ParticleSystemDef).Copy(this)}}class b2ParticleSystem{constructor(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_flagsBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_positionBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_velocityBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_bodyContactCountBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_stuckParticleBuffer=new b2GrowableBuffer(()=>0),this.m_proxyBuffer=new b2GrowableBuffer(()=>new b2ParticleSystem_Proxy),this.m_contactBuffer=new b2GrowableBuffer(()=>new b2ParticleContact),this.m_bodyContactBuffer=new b2GrowableBuffer(()=>new b2ParticleBodyContact),this.m_pairBuffer=new b2GrowableBuffer(()=>new b2ParticlePair),this.m_triadBuffer=new b2GrowableBuffer(()=>new b2ParticleTriad),this.m_expirationTimeBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new b2ParticleSystem_UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new b2ParticleSystemDef,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(t,e){return(e+b2ParticleSystem.yOffset>>>0<<b2ParticleSystem.yShift)+(b2ParticleSystem.xScale*t+b2ParticleSystem.xOffset>>>0)>>>0}static computeRelativeTag(t,e,i){return t+(i<<b2ParticleSystem.yShift)+(e<<b2ParticleSystem.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){const t=this.m_count?2*this.m_count:E;this.ReallocateInternalAllocatedBuffers(t)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return M;this.DestroyOldestParticle(0,!1),this.SolveZombie()}const e=this.m_count++;this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new b2Vec2).Copy(b2Maybe(t.position,b2Vec2.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new b2Vec2).Copy(b2Maybe(t.velocity,b2Vec2.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new b2Vec2).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);const i=(new b2Color).Copy(b2Maybe(t.color,b2Color.ZERO));!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new b2Color).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);const n=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],r=b2Maybe(t.lifetime,0),s=r>0;(this.m_expirationTimeBuffer.data||s)&&(this.SetParticleLifetime(e,s?r:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[e]=e),n.index=e;const o=b2Maybe(t.group,null);return this.m_groupBuffer[e]=o,o&&(o.m_firstIndex<o.m_lastIndex?(this.RotateBuffer(o.m_firstIndex,o.m_lastIndex,e),o.m_lastIndex=e+1):(o.m_firstIndex=e,o.m_lastIndex=e+1)),this.SetParticleFlags(e,b2Maybe(t.flags,0)),e}GetParticleHandleFromIndex(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||((e=new b2ParticleHandle).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(e,i=!1){let n=t.ParticleFlag.b2_zombieParticle;i&&(n|=t.ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(e,this.m_flagsBuffer.data[e]|n)}DestroyOldestParticle(t,e=!1){const i=this.GetParticleCount(),n=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],r=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[n]>0?n:r,e)}DestroyParticlesInShape(t,e,i=!1){const n=b2ParticleSystem.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;const r=new b2ParticleSystem_DestroyParticlesInShapeCallback(this,t,e,i),s=n;return t.ComputeAABB(s,e,0),this.m_world.QueryAABB(r,s),r.Destroyed()}CreateParticleGroup(t){const e=b2ParticleSystem.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;const i=e;i.SetPositionAngle(b2Maybe(t.position,b2Vec2.ZERO),b2Maybe(t.angle,0));const n=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,b2Maybe(t.shapeCount,t.shapes.length),t,i),t.positionData){const e=b2Maybe(t.particleCount,t.positionData.length);for(let n=0;n<e;n++){const e=t.positionData[n];this.CreateParticleForGroup(t,i,e)}}const r=this.m_count;let s=new b2ParticleGroup(this);s.m_firstIndex=n,s.m_lastIndex=r,s.m_strength=b2Maybe(t.strength,1),s.m_userData=t.userData,s.m_transform.Copy(i),s.m_prev=null,s.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=s),this.m_groupList=s,++this.m_groupCount;for(let t=n;t<r;t++)this.m_groupBuffer[t]=s;this.SetGroupFlags(s,b2Maybe(t.groupFlags,0));const o=new b2ParticleSystem_ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,r,o),t.group&&(this.JoinParticleGroups(t.group,s),s=t.group),s}JoinParticleGroups(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);const i=new b2ParticleSystem_JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(let i=e.m_firstIndex;i<e.m_lastIndex;i++)this.m_groupBuffer[i]=t;const n=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,n),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);const e=t.GetParticleCount(),i=b2MakeArray(e,t=>new b2ParticleSystem_ParticleListNode);b2ParticleSystem.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);const n=b2ParticleSystem.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,n),this.CreateParticleGroupsFromParticleList(t,i,n),this.UpdatePairsAndTriadsWithParticleList(t,i)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(e,i){const n=this.m_flagsBuffer.data[e];n&~i&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&i&&(i&t.ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),i&t.ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=i),this.m_flagsBuffer.data[e]=i}GetParticleFlags(t){return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}SetPositionBuffer(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;const e=t.length/2,i=new Array(e);for(let n=0;n<e;++n)i[n]=new b2TypedVec2(t.subarray(2*n,2*n+2));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)}SetVelocityBuffer(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;const e=t.length/2,i=new Array(e);for(let n=0;n<e;++n)i[n]=new b2TypedVec2(t.subarray(2*n,2*n+2));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}SetColorBuffer(t){if(t instanceof Float32Array){if(t.length%4!=0)throw new Error;const e=t.length/4,i=new Array(e);for(let n=0;n<e;++n)i[n]=new b2TypedColor(t.subarray(4*n,4*n+4));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)}SetUserDataBuffer(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){const t=b2ParticleSystem.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data;let i=0;for(let n=0;n<this.m_contactBuffer.count;n++){const r=this.m_contactBuffer.data[n],s=r.indexA,o=r.indexB,a=r.normal,l=b2Vec2.SubVV(e[o],e[s],t),c=b2Vec2.DotVV(l,a);c<0&&(i+=c*c)}return.5*this.GetParticleMass()*i}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){const i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i){const t=this.GetParticleCount();for(let e=0;e<t;++e)this.m_indexByExpirationTimeBuffer.data[e]=e}const n=e/this.m_def.lifetimeGranularity,r=n>0?this.GetQuantizedTimeElapsed()+n:n;r!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=r,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,i){const n=this.m_velocityBuffer.data,r=e-t,s=r*this.GetParticleMass(),o=(new b2Vec2).Copy(i).SelfMul(1/s);for(let i=t;i<e;i++)n[i].SelfAdd(o)}static IsSignificantForce(t){return 0!==t.x||0!==t.y}ParticleApplyForce(t,e){b2ParticleSystem.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))}ApplyForce(t,e,i){const n=(new b2Vec2).Copy(i).SelfMul(1/(e-t));if(b2ParticleSystem.IsSignificantForce(n)){this.PrepareForceBuffer();for(let i=t;i<e;i++)this.m_forceBuffer[i].SelfAdd(n)}}GetNext(){return this.m_next}QueryAABB(t,e){if(0===this.m_proxyBuffer.count)return;const i=this.m_proxyBuffer.count,n=std_lower_bound(this.m_proxyBuffer.data,0,i,b2ParticleSystem.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),b2ParticleSystem_Proxy.CompareProxyTag),r=std_upper_bound(this.m_proxyBuffer.data,n,i,b2ParticleSystem.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),b2ParticleSystem_Proxy.CompareTagProxy),s=this.m_positionBuffer.data;for(let i=n;i<r;++i){const n=this.m_proxyBuffer.data[i],r=n.index,o=s[r];if(e.lowerBound.x<o.x&&o.x<e.upperBound.x&&e.lowerBound.y<o.y&&o.y<e.upperBound.y&&!t.ReportParticle(this,r))break}}QueryShapeAABB(t,e,i,n=0){const r=b2ParticleSystem.QueryShapeAABB_s_aabb,s=r;e.ComputeAABB(s,i,n),this.QueryAABB(t,s)}QueryPointAABB(t,e,i=u){const n=b2ParticleSystem.QueryPointAABB_s_aabb,r=n;r.lowerBound.Set(e.x-i,e.y-i),r.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,r)}RayCast(t,e,i){const n=b2ParticleSystem.RayCast_s_aabb,r=b2ParticleSystem.RayCast_s_p,s=b2ParticleSystem.RayCast_s_v,o=b2ParticleSystem.RayCast_s_n,a=b2ParticleSystem.RayCast_s_point;if(0===this.m_proxyBuffer.count)return;const l=this.m_positionBuffer.data,c=n;b2Vec2.MinV(e,i,c.lowerBound),b2Vec2.MaxV(e,i,c.upperBound);let h=1;const u=b2Vec2.SubVV(i,e,s),d=b2Vec2.DotVV(u,u),m=this.GetInsideBoundsEnumerator(c);let p;for(;(p=m.GetNext())>=0;){const i=b2Vec2.SubVV(e,l[p],r),n=b2Vec2.DotVV(i,u),s=b2Vec2.DotVV(i,i),c=n*n-d*(s-this.m_squaredDiameter);if(c>=0){const r=z(c);let s=(-n-r)/d;if(s>h)continue;if(s<0&&((s=(-n+r)/d)<0||s>h))continue;const l=b2Vec2.AddVMulSV(i,s,u,o);l.Normalize();const m=t.ReportParticle(this,p,b2Vec2.AddVMulSV(e,s,u,a),l,s);if((h=b2Min(h,m))<=0)break}}}ComputeAABB(t){const e=this.GetParticleCount();t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i;const n=this.m_positionBuffer.data;for(let i=0;i<e;i++){const e=n[i];b2Vec2.MinV(t.lowerBound,e,t.lowerBound),b2Vec2.MaxV(t.upperBound,e,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}FreeBuffer(t,e){null!==t&&(t.length=0)}FreeUserOverridableBuffer(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(t,e,i){if(i<=e)throw new Error;const n=t?t.slice():[];return n.length=i,n}ReallocateBuffer5(t,e,i,n,r){if(n<=i)throw new Error;if(e&&!(n<=e))throw new Error;return r&&!t||e||(t=this.ReallocateBuffer3(t,i,n)),t}ReallocateBuffer4(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)}RequestBuffer(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(E),(t=[]).length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function LimitCapacity(t,e){return e&&t>e?e:t}if(t=LimitCapacity(t,this.m_def.maxCount),t=LimitCapacity(t,this.m_flagsBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_positionBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_velocityBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_colorBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);const e=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,e),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,e),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,e),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,i){const n=new b2ParticleDef;n.flags=b2Maybe(t.flags,0),b2Transform.MulXV(e,i,n.position),b2Vec2.AddVV(b2Maybe(t.linearVelocity,b2Vec2.ZERO),b2Vec2.CrossSV(b2Maybe(t.angularVelocity,0),b2Vec2.SubVV(n.position,b2Maybe(t.position,b2Vec2.ZERO),b2Vec2.s_t0),b2Vec2.s_t0),n.velocity),n.color.Copy(b2Maybe(t.color,b2Color.ZERO)),n.lifetime=b2Maybe(t.lifetime,0),n.userData=t.userData,this.CreateParticle(n)}CreateParticlesStrokeShapeForGroup(e,i,n){const r=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge,s=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d,o=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p;let a=b2Maybe(i.stride,0);0===a&&(a=this.GetParticleStride());let l=0;const c=e.GetChildCount();for(let h=0;h<c;h++){let c=null;e.GetType()===t.ShapeType.e_edgeShape?c=e:(c=r,e.GetChildEdge(c,h));const u=b2Vec2.SubVV(c.m_vertex2,c.m_vertex1,s),d=u.Length();for(;l<d;){const t=b2Vec2.AddVMulSV(c.m_vertex1,l/d,u,o);this.CreateParticleForGroup(i,n,t),l+=a}l-=d}}CreateParticlesFillShapeForGroup(t,e,i){const n=b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb,r=b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p;let s=b2Maybe(e.stride,0);0===s&&(s=this.GetParticleStride());const o=b2Transform.IDENTITY,a=n;t.ComputeAABB(a,o,0);for(let n=Math.floor(a.lowerBound.y/s)*s;n<a.upperBound.y;n+=s)for(let l=Math.floor(a.lowerBound.x/s)*s;l<a.upperBound.x;l+=s){const s=r.Set(l,n);t.TestPoint(o,s)&&this.CreateParticleForGroup(e,i,s)}}CreateParticlesWithShapeForGroup(e,i,n){switch(e.GetType()){case t.ShapeType.e_edgeShape:case t.ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(e,i,n);break;case t.ShapeType.e_polygonShape:case t.ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(e,i,n)}}CreateParticlesWithShapesForGroup(t,e,i,n){const r=new b2ParticleSystem_CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(r,i,n)}CloneParticle(t,e){const i=new b2ParticleDef;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;const n=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){const e=this.m_handleIndexBuffer.data[t];e&&e.SetIndex(n),this.m_handleIndexBuffer.data[n]=e,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[n].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[n]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[n]=this.m_expirationTimeBuffer.data[t]),n}DestroyParticlesInGroup(t,e=!1){for(let i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}DestroyParticleGroup(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(e,i){return 0!=(e&(t.ParticleFlag.b2_wallParticle|t.ParticleFlag.b2_springParticle|t.ParticleFlag.b2_elasticParticle))||null!==i&&0!=(i.GetGroupFlags()&t.ParticleGroupFlag.b2_rigidParticleGroup)}UpdatePairsAndTriads(e,i,n){const r=b2ParticleSystem.UpdatePairsAndTriads_s_dab,s=b2ParticleSystem.UpdatePairsAndTriads_s_dbc,o=b2ParticleSystem.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data;let l=0;for(let t=e;t<i;t++)l|=this.m_flagsBuffer.data[t];if(l&b2ParticleSystem.k_pairFlags)for(let r=0;r<this.m_contactBuffer.count;r++){const s=this.m_contactBuffer.data[r],o=s.indexA,l=s.indexB,c=this.m_flagsBuffer.data[o],h=this.m_flagsBuffer.data[l],u=this.m_groupBuffer[o],d=this.m_groupBuffer[l];if(o>=e&&o<i&&l>=e&&l<i&&!((c|h)&t.ParticleFlag.b2_zombieParticle)&&(c|h)&b2ParticleSystem.k_pairFlags&&(n.IsNecessary(o)||n.IsNecessary(l))&&b2ParticleSystem.ParticleCanBeConnected(c,u)&&b2ParticleSystem.ParticleCanBeConnected(h,d)&&n.ShouldCreatePair(o,l)){const t=this.m_pairBuffer.data[this.m_pairBuffer.Append()];t.indexA=o,t.indexB=l,t.flags=s.flags,t.strength=b2Min(u?u.m_strength:1,d?d.m_strength:1),t.distance=b2Vec2.DistanceVV(a[o],a[l])}std_stable_sort(this.m_pairBuffer.data,0,this.m_pairBuffer.count,b2ParticleSystem.ComparePairIndices),this.m_pairBuffer.Unique(b2ParticleSystem.MatchPairIndices)}if(l&b2ParticleSystem.k_triadFlags){const l=new b2VoronoiDiagram(i-e);for(let r=e;r<i;r++){const e=this.m_flagsBuffer.data[r],i=this.m_groupBuffer[r];e&t.ParticleFlag.b2_zombieParticle||!b2ParticleSystem.ParticleCanBeConnected(e,i)||l.AddGenerator(a[r],r,n.IsNecessary(r))}const c=this.GetParticleStride();l.Generate(c/2,2*c);const h=this,u=(t,e,i)=>{const l=h.m_flagsBuffer.data[t],c=h.m_flagsBuffer.data[e],u=h.m_flagsBuffer.data[i];if((l|c|u)&b2ParticleSystem.k_triadFlags&&n.ShouldCreateTriad(t,e,i)){const n=a[t],d=a[e],m=a[i],p=b2Vec2.SubVV(n,d,r),f=b2Vec2.SubVV(d,m,s),_=b2Vec2.SubVV(m,n,o),g=P*h.m_squaredDiameter;if(b2Vec2.DotVV(p,p)>g||b2Vec2.DotVV(f,f)>g||b2Vec2.DotVV(_,_)>g)return;const b=h.m_groupBuffer[t],y=h.m_groupBuffer[e],x=h.m_groupBuffer[i],v=h.m_triadBuffer.data[h.m_triadBuffer.Append()];v.indexA=t,v.indexB=e,v.indexC=i,v.flags=l|c|u,v.strength=b2Min(b2Min(b?b.m_strength:1,y?y.m_strength:1),x?x.m_strength:1);const S=(n.x+d.x+m.x)/3,w=(n.y+d.y+m.y)/3;v.pa.x=n.x-S,v.pa.y=n.y-w,v.pb.x=d.x-S,v.pb.y=d.y-w,v.pc.x=m.x-S,v.pc.y=m.y-w,v.ka=-b2Vec2.DotVV(_,p),v.kb=-b2Vec2.DotVV(p,f),v.kc=-b2Vec2.DotVV(f,_),v.s=b2Vec2.CrossVV(n,d)+b2Vec2.CrossVV(d,m)+b2Vec2.CrossVV(m,n)}};l.GetNodes(u),std_stable_sort(this.m_triadBuffer.data,0,this.m_triadBuffer.count,b2ParticleSystem.CompareTriadIndices),this.m_triadBuffer.Unique(b2ParticleSystem.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){const e=new b2ParticleSystem_ReactiveFilter(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,e);for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~t.ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.ParticleFlag.b2_reactiveParticle}static ComparePairIndices(t,e){const i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){const i=t.indexA-e.indexA;if(0!==i)return i<0;const n=t.indexB-e.indexB;return 0!==n?n<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){const i=t.GetBufferIndex(),n=t.GetParticleCount();for(let t=0;t<n;t++){const n=e[t];n.list=n,n.next=null,n.count=1,n.index=t+i}}MergeParticleListsInContact(t,e){const i=t.GetBufferIndex();for(let n=0;n<this.m_contactBuffer.count;n++){const r=this.m_contactBuffer.data[n],s=r.indexA,o=r.indexB;if(!t.ContainsParticle(s)||!t.ContainsParticle(o))continue;let a=e[s-i].list,l=e[o-i].list;if(a!==l){if(a.count<l.count){const t=a;a=l,l=t}b2ParticleSystem.MergeParticleLists(a,l)}}}static MergeParticleLists(t,e){for(let i=e;;){i.list=t;const e=i.next;if(!e){i.next=t.next;break}i=e}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){const i=t.GetParticleCount();let n=e[0];for(let t=0;t<i;t++){const i=e[t];n.count<i.count&&(n=i)}return n}MergeZombieParticleListNodes(e,i,n){const r=e.GetParticleCount();for(let e=0;e<r;e++){const r=i[e];r!==n&&this.m_flagsBuffer.data[r.index]&t.ParticleFlag.b2_zombieParticle&&b2ParticleSystem.MergeParticleListAndNode(n,r)}}static MergeParticleListAndNode(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}CreateParticleGroupsFromParticleList(e,i,n){const r=e.GetParticleCount(),s=new b2ParticleGroupDef;s.groupFlags=e.GetGroupFlags(),s.userData=e.GetUserData();for(let e=0;e<r;e++){const r=i[e];if(!r.count||r===n)continue;const o=this.CreateParticleGroup(s);for(let e=r;e;e=e.next){const i=e.index,n=this.CloneParticle(i,o);this.m_flagsBuffer.data[i]|=t.ParticleFlag.b2_zombieParticle,e.index=n}}}UpdatePairsAndTriadsWithParticleList(t,e){const i=t.GetBufferIndex();for(let n=0;n<this.m_pairBuffer.count;n++){const r=this.m_pairBuffer.data[n],s=r.indexA,o=r.indexB;t.ContainsParticle(s)&&(r.indexA=e[s-i].index),t.ContainsParticle(o)&&(r.indexB=e[o-i].index)}for(let n=0;n<this.m_triadBuffer.count;n++){const r=this.m_triadBuffer.data[n],s=r.indexA,o=r.indexB,a=r.indexC;t.ContainsParticle(s)&&(r.indexA=e[s-i].index),t.ContainsParticle(o)&&(r.indexB=e[o-i].index),t.ContainsParticle(a)&&(r.indexC=e[a-i].index)}}ComputeDepth(){const e=[];let n=0;for(let i=0;i<this.m_contactBuffer.count;i++){const r=this.m_contactBuffer.data[i],s=r.indexA,o=r.indexB,a=this.m_groupBuffer[s],l=this.m_groupBuffer[o];a&&a===l&&a.m_groupFlags&t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(e[n++]=r)}const r=[];let s=0;for(let e=this.m_groupList;e;e=e.GetNext())if(e.m_groupFlags&t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){r[s++]=e,this.SetGroupFlags(e,e.m_groupFlags&~t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(let t=e.m_firstIndex;t<e.m_lastIndex;t++)this.m_accumulationBuffer[t]=0}for(let t=0;t<n;t++){const i=e[t],n=i.indexA,r=i.indexB,s=i.weight;this.m_accumulationBuffer[n]+=s,this.m_accumulationBuffer[r]+=s}for(let t=0;t<s;t++){const e=r[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++){const e=this.m_accumulationBuffer[t];this.m_depthBuffer[t]=e<.8?0:i}}const o=z(this.m_count)>>0;for(let t=0;t<o;t++){let t=!1;for(let i=0;i<n;i++){const n=e[i],r=n.indexA,s=n.indexB,o=1-n.weight,a=this.m_depthBuffer[r],l=this.m_depthBuffer[s],c=l+o,h=a+o;a>c&&(this.m_depthBuffer[r]=c,t=!0),l>h&&(this.m_depthBuffer[s]=h,t=!0)}if(!t)break}for(let t=0;t<s;t++){const e=r[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++)this.m_depthBuffer[t]<i?this.m_depthBuffer[t]*=this.m_particleDiameter:this.m_depthBuffer[t]=0}}GetInsideBoundsEnumerator(t){const e=b2ParticleSystem.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=b2ParticleSystem.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),n=this.m_proxyBuffer.count,r=std_lower_bound(this.m_proxyBuffer.data,0,n,e,b2ParticleSystem_Proxy.CompareProxyTag),s=std_upper_bound(this.m_proxyBuffer.data,0,n,i,b2ParticleSystem_Proxy.CompareTagProxy);return new b2ParticleSystem_InsideBoundsEnumerator(this,e,i,r,s)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e,i){const n=this.m_flagsBuffer.data,r=this.m_positionBuffer.data,s=b2Vec2.SubVV(r[e],r[t],b2ParticleSystem.AddContact_s_d),o=b2Vec2.DotVV(s,s);if(0<o&&o<this.m_squaredDiameter){const i=b2InvSqrt(o),r=this.m_contactBuffer.data[this.m_contactBuffer.Append()];r.indexA=t,r.indexB=e,r.flags=n[t]|n[e],r.weight=1-o*i*this.m_inverseDiameter,r.normal.x=i*s.x,r.normal.y=i*s.y}}FindContacts_Reference(t){const e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let t=0,i=0;t<e;t++){const n=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0);for(let i=t+1;i<e&&!(n<this.m_proxyBuffer.data[i].tag);i++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[i].index,this.m_contactBuffer);const r=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);for(;i<e&&!(r<=this.m_proxyBuffer.data[i].tag);i++);const s=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1);for(let n=i;n<e&&!(s<this.m_proxyBuffer.data[n].tag);n++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[n].index,this.m_contactBuffer)}}FindContacts(t){this.FindContacts_Reference(t)}UpdateProxies_Reference(t){const e=this.m_positionBuffer.data,i=this.m_inverseDiameter;for(let t=0;t<this.m_proxyBuffer.count;++t){const n=this.m_proxyBuffer.data[t],r=n.index,s=e[r];n.tag=b2ParticleSystem.computeTag(i*s.x,i*s.y)}}UpdateProxies(t){this.UpdateProxies_Reference(t)}SortProxies(t){std_sort(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,b2ParticleSystem_Proxy.CompareProxyProxy)}FilterContacts(e){const i=this.GetParticleContactFilter();if(null===i)return;const n=this;this.m_contactBuffer.RemoveIf(e=>0!=(e.flags&t.ParticleFlag.b2_particleContactFilterParticle)&&!i.ShouldCollideParticleParticle(n,e.indexA,e.indexB))}NotifyContactListenerPreContact(t){const e=this.GetParticleContactListener();if(null!==e)throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){const e=this.GetParticleContactListener();if(null!==e){for(let t=0;t<this.m_contactBuffer.count;++t){const i=this.m_contactBuffer.data[t];e.BeginContactParticleParticle(this,i)}throw new Error}}static b2ParticleContactIsZombie(e){return(e.flags&t.ParticleFlag.b2_zombieParticle)===t.ParticleFlag.b2_zombieParticle}UpdateContacts(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);const e=new b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(b2ParticleSystem.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){const e=this.GetFixtureContactListener();if(null!==e)throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){const e=this.GetFixtureContactListener();if(null!==e){for(let t=0;t<this.m_bodyContactBuffer.count;t++){const i=this.m_bodyContactBuffer.data[t];e.BeginContactFixtureParticle(this,i)}throw new Error}}UpdateBodyContacts(){const t=b2ParticleSystem.UpdateBodyContacts_s_aabb,e=new b2ParticleSystem_FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){const t=this.GetParticleCount();for(let e=0;e<t;e++)this.m_bodyContactCountBuffer.data[e]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[e]+1&&(this.m_consecutiveContactStepsBuffer.data[e]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);const i=t;this.ComputeAABB(i),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new b2ParticleSystem_UpdateBodyContactsCallback(this));const n=this.UpdateBodyContacts_callback;n.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(n,i),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}Solve(e){const i=b2ParticleSystem.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),this.m_allParticleFlags&t.ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;const n=i.Copy(e);n.dt/=e.particleIterations,n.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(n),this.m_allParticleFlags&t.ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(n),this.m_allParticleFlags&t.ParticleFlag.b2_powderParticle&&this.SolvePowder(n),this.m_allParticleFlags&t.ParticleFlag.b2_tensileParticle&&this.SolveTensile(n),this.m_allGroupFlags&t.ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(n),this.m_allParticleFlags&t.ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(n),this.m_allParticleFlags&t.ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(n),this.SolvePressure(n),this.SolveDamping(n),this.m_allParticleFlags&b2ParticleSystem.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.ParticleFlag.b2_elasticParticle&&this.SolveElastic(n),this.m_allParticleFlags&t.ParticleFlag.b2_springParticle&&this.SolveSpring(n),this.LimitVelocity(n),this.m_allGroupFlags&t.ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.ParticleFlag.b2_barrierParticle&&this.SolveBarrier(n),this.SolveCollision(n),this.m_allGroupFlags&t.ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(n),this.m_allParticleFlags&t.ParticleFlag.b2_wallParticle&&this.SolveWall();for(let t=0;t<this.m_count;t++)this.m_positionBuffer.data[t].SelfMulAdd(n.dt,this.m_velocityBuffer.data[t])}}SolveCollision(t){const e=b2ParticleSystem.SolveCollision_s_aabb,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=e;s.lowerBound.x=+i,s.lowerBound.y=+i,s.upperBound.x=-i,s.upperBound.y=-i;for(let e=0;e<this.m_count;e++){const i=r[e],o=n[e],a=o.x+t.dt*i.x,l=o.y+t.dt*i.y;s.lowerBound.x=b2Min(s.lowerBound.x,b2Min(o.x,a)),s.lowerBound.y=b2Min(s.lowerBound.y,b2Min(o.y,l)),s.upperBound.x=b2Max(s.upperBound.x,b2Max(o.x,a)),s.upperBound.y=b2Max(s.upperBound.y,b2Max(o.y,l))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new b2ParticleSystem_SolveCollisionCallback(this,t));const o=this.SolveCollision_callback;o.m_step=t,this.m_world.QueryAABB(o,s)}LimitVelocity(t){const e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t);for(let t=0;t<this.m_count;t++){const n=e[t],r=b2Vec2.DotVV(n,n);r>i&&n.SelfMul(z(i/r))}}SolveGravity(t){const e=b2ParticleSystem.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,n=b2Vec2.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let t=0;t<this.m_count;t++)i[t].SelfAdd(n)}SolveBarrier(e){const i=b2ParticleSystem.SolveBarrier_s_aabb,n=b2ParticleSystem.SolveBarrier_s_va,r=b2ParticleSystem.SolveBarrier_s_vb,s=b2ParticleSystem.SolveBarrier_s_pba,o=b2ParticleSystem.SolveBarrier_s_vba,a=b2ParticleSystem.SolveBarrier_s_vc,l=b2ParticleSystem.SolveBarrier_s_pca,c=b2ParticleSystem.SolveBarrier_s_vca,h=b2ParticleSystem.SolveBarrier_s_qba,u=b2ParticleSystem.SolveBarrier_s_qca,d=b2ParticleSystem.SolveBarrier_s_dv,m=b2ParticleSystem.SolveBarrier_s_f,p=this.m_positionBuffer.data,f=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++){const e=this.m_flagsBuffer.data[t];0!=(e&b2ParticleSystem.k_barrierWallFlags)&&f[t].SetZero()}const _=L*e.dt,g=this.GetParticleMass();for(let b=0;b<this.m_pairBuffer.count;b++){const y=this.m_pairBuffer.data[b];if(y.flags&t.ParticleFlag.b2_barrierParticle){const t=y.indexA,b=y.indexB,x=p[t],v=p[b],S=i;b2Vec2.MinV(x,v,S.lowerBound),b2Vec2.MaxV(x,v,S.upperBound);const w=this.m_groupBuffer[t],M=this.m_groupBuffer[b],A=this.GetLinearVelocity(w,t,x,n),V=this.GetLinearVelocity(M,b,v,r),C=b2Vec2.SubVV(v,x,s),T=b2Vec2.SubVV(V,A,o),B=this.GetInsideBoundsEnumerator(S);let P;for(;(P=B.GetNext())>=0;){const t=p[P],i=this.m_groupBuffer[P];if(w!==i&&M!==i){const n=this.GetLinearVelocity(i,P,t,a),r=b2Vec2.SubVV(t,x,l),s=b2Vec2.SubVV(n,A,c),o=b2Vec2.CrossVV(T,s),p=b2Vec2.CrossVV(C,s)-b2Vec2.CrossVV(r,T),b=b2Vec2.CrossVV(C,r);let y,v;const S=h,w=u;if(0===o){if(0===p)continue;if(!((v=-b/p)>=0&&v<_))continue;if(b2Vec2.AddVMulSV(C,v,T,S),b2Vec2.AddVMulSV(r,v,s,w),!((y=b2Vec2.DotVV(S,w)/b2Vec2.DotVV(S,S))>=0&&y<=1))continue}else{const t=p*p-4*b*o;if(t<0)continue;const e=z(t);let i=(-p-e)/(2*o),n=(-p+e)/(2*o);if(i>n){const t=i;i=n,n=t}if(v=i,b2Vec2.AddVMulSV(C,v,T,S),b2Vec2.AddVMulSV(r,v,s,w),y=b2Vec2.DotVV(S,w)/b2Vec2.DotVV(S,S),!(v>=0&&v<_&&y>=0&&y<=1)){if(!((v=n)>=0&&v<_))continue;if(b2Vec2.AddVMulSV(C,v,T,S),b2Vec2.AddVMulSV(r,v,s,w),!((y=b2Vec2.DotVV(S,w)/b2Vec2.DotVV(S,S))>=0&&y<=1))continue}}const M=d;M.x=A.x+y*T.x-n.x,M.y=A.y+y*T.y-n.y;const V=b2Vec2.MulSV(g,M,m);if(i&&this.IsRigidGroup(i)){const e=i.GetMass(),n=i.GetInertia();e>0&&i.m_linearVelocity.SelfMulAdd(1/e,V),n>0&&(i.m_angularVelocity+=b2Vec2.CrossVV(b2Vec2.SubVV(t,i.GetCenter(),b2Vec2.s_t0),V)/n)}else f[P].SelfAdd(M);this.ParticleApplyForce(P,V.SelfMul(-e.inv_dt))}}}}}SolveStaticPressure(e){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);const i=this.GetCriticalPressure(e),n=this.m_def.staticPressureStrength*i,r=C*i,s=this.m_def.staticPressureRelaxation;for(let e=0;e<this.m_def.staticPressureIterations;e++){for(let t=0;t<this.m_count;t++)this.m_accumulationBuffer[t]=0;for(let e=0;e<this.m_contactBuffer.count;e++){const i=this.m_contactBuffer.data[e];if(i.flags&t.ParticleFlag.b2_staticPressureParticle){const t=i.indexA,e=i.indexB,n=i.weight;this.m_accumulationBuffer[t]+=n*this.m_staticPressureBuffer[e],this.m_accumulationBuffer[e]+=n*this.m_staticPressureBuffer[t]}}for(let e=0;e<this.m_count;e++){const i=this.m_weightBuffer[e];if(this.m_flagsBuffer.data[e]&t.ParticleFlag.b2_staticPressureParticle){const t=this.m_accumulationBuffer[e],o=(t+n*(i-V))/(i+s);this.m_staticPressureBuffer[e]=b2Clamp(o,0,r)}else this.m_staticPressureBuffer[e]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t],i=e.index,n=e.weight;this.m_weightBuffer[i]+=n}for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t],i=e.indexA,n=e.indexB,r=e.weight;this.m_weightBuffer[i]+=r,this.m_weightBuffer[n]+=r}}SolvePressure(e){const i=b2ParticleSystem.SolvePressure_s_f,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.GetCriticalPressure(e),o=this.m_def.pressureStrength*s,a=C*s;for(let t=0;t<this.m_count;t++){const e=this.m_weightBuffer[t],i=o*b2Max(0,e-V);this.m_accumulationBuffer[t]=b2Min(i,a)}if(this.m_allParticleFlags&b2ParticleSystem.k_noPressureFlags)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&b2ParticleSystem.k_noPressureFlags&&(this.m_accumulationBuffer[t]=0);if(this.m_allParticleFlags&t.ParticleFlag.b2_staticPressureParticle)for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&t.ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[e]+=this.m_staticPressureBuffer[e]);const l=e.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t],s=e.index,a=e.body,h=e.weight,u=e.mass,d=e.normal,m=n[s],p=this.m_accumulationBuffer[s]+o*h,f=b2Vec2.MulSV(l*h*u*p,d,i);r[s].SelfMulSub(c,f),a.ApplyLinearImpulse(f,m,!0)}for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t],n=e.indexA,s=e.indexB,o=e.weight,a=e.normal,c=this.m_accumulationBuffer[n]+this.m_accumulationBuffer[s],h=b2Vec2.MulSV(l*o*c,a,i);r[n].SelfSub(h),r[s].SelfAdd(h)}}SolveDamping(t){const e=b2ParticleSystem.SolveDamping_s_v,i=b2ParticleSystem.SolveDamping_s_f,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.dampingStrength,o=1/this.GetCriticalVelocity(t),a=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const l=this.m_bodyContactBuffer.data[t],c=l.index,h=l.body,u=l.weight,d=l.mass,m=l.normal,p=n[c],f=b2Vec2.SubVV(h.GetLinearVelocityFromWorldPoint(p,b2Vec2.s_t0),r[c],e),_=b2Vec2.DotVV(f,m);if(_<0){const t=b2Max(s*u,b2Min(-o*_,.5)),e=b2Vec2.MulSV(t*d*_,m,i);r[c].SelfMulAdd(a,e),h.ApplyLinearImpulse(e.SelfNeg(),p,!0)}}for(let t=0;t<this.m_contactBuffer.count;t++){const n=this.m_contactBuffer.data[t],a=n.indexA,l=n.indexB,c=n.weight,h=n.normal,u=b2Vec2.SubVV(r[l],r[a],e),d=b2Vec2.DotVV(u,h);if(d<0){const t=b2Max(s*c,b2Min(-o*d,.5)),e=b2Vec2.MulSV(t*d,h,i);r[a].SelfAdd(e),r[l].SelfSub(e)}}}SolveRigidDamping(){const t=b2ParticleSystem.SolveRigidDamping_s_t0,e=b2ParticleSystem.SolveRigidDamping_s_t1,i=b2ParticleSystem.SolveRigidDamping_s_p,n=b2ParticleSystem.SolveRigidDamping_s_v,r=[0],s=[0],o=[0],a=[0],l=[0],c=[0],h=this.m_positionBuffer.data,u=this.m_def.dampingStrength;for(let i=0;i<this.m_bodyContactBuffer.count;i++){const d=this.m_bodyContactBuffer.data[i],m=d.index,p=this.m_groupBuffer[m];if(p&&this.IsRigidGroup(p)){const i=d.body,f=d.normal,_=d.weight,g=h[m],b=b2Vec2.SubVV(i.GetLinearVelocityFromWorldPoint(g,t),p.GetLinearVelocityFromWorldPoint(g,e),n),y=b2Vec2.DotVV(b,f);if(y<0){this.InitDampingParameterWithRigidGroupOrParticle(r,s,o,!0,p,m,g,f),this.InitDampingParameter(a,l,c,i.GetMass(),i.GetInertia()-i.GetMass()*i.GetLocalCenter().LengthSquared(),i.GetWorldCenter(),g,f);const t=u*b2Min(_,1)*this.ComputeDampingImpulse(r[0],s[0],o[0],a[0],l[0],c[0],y);this.ApplyDamping(r[0],s[0],o[0],!0,p,m,t,f),i.ApplyLinearImpulse(b2Vec2.MulSV(-t,f,b2Vec2.s_t0),g,!0)}}}for(let d=0;d<this.m_contactBuffer.count;d++){const m=this.m_contactBuffer.data[d],p=m.indexA,f=m.indexB,_=m.normal,g=m.weight,b=this.m_groupBuffer[p],y=this.m_groupBuffer[f],x=this.IsRigidGroup(b),v=this.IsRigidGroup(y);if(b!==y&&(x||v)){const d=b2Vec2.MidVV(h[p],h[f],i),m=b2Vec2.SubVV(this.GetLinearVelocity(y,f,d,t),this.GetLinearVelocity(b,p,d,e),n),S=b2Vec2.DotVV(m,_);if(S<0){this.InitDampingParameterWithRigidGroupOrParticle(r,s,o,x,b,p,d,_),this.InitDampingParameterWithRigidGroupOrParticle(a,l,c,v,y,f,d,_);const t=u*g*this.ComputeDampingImpulse(r[0],s[0],o[0],a[0],l[0],c[0],S);this.ApplyDamping(r[0],s[0],o[0],x,b,p,t,_),this.ApplyDamping(a[0],l[0],c[0],v,y,f,-t,_)}}}}SolveExtraDamping(){const t=b2ParticleSystem.SolveExtraDamping_s_v,e=b2ParticleSystem.SolveExtraDamping_s_f,i=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,r=this.GetParticleInvMass();for(let s=0;s<this.m_bodyContactBuffer.count;s++){const o=this.m_bodyContactBuffer.data[s],a=o.index;if(this.m_flagsBuffer.data[a]&b2ParticleSystem.k_extraDampingFlags){const s=o.body,l=o.mass,c=o.normal,h=n[a],u=b2Vec2.SubVV(s.GetLinearVelocityFromWorldPoint(h,b2Vec2.s_t0),i[a],t),d=b2Vec2.DotVV(u,c);if(d<0){const t=b2Vec2.MulSV(.5*l*d,c,e);i[a].SelfMulAdd(r,t),s.ApplyLinearImpulse(t.SelfNeg(),h,!0)}}}}SolveWall(){const e=this.m_velocityBuffer.data;for(let i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&t.ParticleFlag.b2_wallParticle&&e[i].SetZero()}SolveRigid(e){const i=b2ParticleSystem.SolveRigid_s_position,n=b2ParticleSystem.SolveRigid_s_rotation,r=b2ParticleSystem.SolveRigid_s_transform,s=b2ParticleSystem.SolveRigid_s_velocityTransform,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&t.ParticleGroupFlag.b2_rigidParticleGroup){l.UpdateStatistics();const t=n;t.SetAngle(e.dt*l.m_angularVelocity);const c=b2Vec2.AddVV(l.m_center,b2Vec2.SubVV(b2Vec2.MulSV(e.dt,l.m_linearVelocity,b2Vec2.s_t0),b2Rot.MulRV(t,l.m_center,b2Vec2.s_t1),b2Vec2.s_t0),i),h=r;h.SetPositionRotation(c,t),b2Transform.MulXX(h,l.m_transform,l.m_transform);const u=s;u.p.x=e.inv_dt*h.p.x,u.p.y=e.inv_dt*h.p.y,u.q.s=e.inv_dt*h.q.s,u.q.c=e.inv_dt*(h.q.c-1);for(let t=l.m_firstIndex;t<l.m_lastIndex;t++)b2Transform.MulXV(u,o[t],a[t])}}SolveElastic(e){const i=b2ParticleSystem.SolveElastic_s_pa,n=b2ParticleSystem.SolveElastic_s_pb,r=b2ParticleSystem.SolveElastic_s_pc,s=b2ParticleSystem.SolveElastic_s_r,o=b2ParticleSystem.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,c=e.inv_dt*this.m_def.elasticStrength;for(let h=0;h<this.m_triadBuffer.count;h++){const u=this.m_triadBuffer.data[h];if(u.flags&t.ParticleFlag.b2_elasticParticle){const t=u.indexA,h=u.indexB,d=u.indexC,m=u.pa,p=u.pb,f=u.pc,_=i.Copy(a[t]),g=n.Copy(a[h]),b=r.Copy(a[d]),y=l[t],x=l[h],v=l[d];_.SelfMulAdd(e.dt,y),g.SelfMulAdd(e.dt,x),b.SelfMulAdd(e.dt,v);const S=(_.x+g.x+b.x)/3,w=(_.y+g.y+b.y)/3;_.x-=S,_.y-=w,g.x-=S,g.y-=w,b.x-=S,b.y-=w;const M=s;M.s=b2Vec2.CrossVV(m,_)+b2Vec2.CrossVV(p,g)+b2Vec2.CrossVV(f,b),M.c=b2Vec2.DotVV(m,_)+b2Vec2.DotVV(p,g)+b2Vec2.DotVV(f,b);const A=M.s*M.s+M.c*M.c;let V=b2InvSqrt(A);isFinite(V)||(V=198177537e11),M.s*=V,M.c*=V;const C=c*u.strength;b2Rot.MulRV(M,m,o),b2Vec2.SubVV(o,_,o),b2Vec2.MulSV(C,o,o),y.SelfAdd(o),b2Rot.MulRV(M,p,o),b2Vec2.SubVV(o,g,o),b2Vec2.MulSV(C,o,o),x.SelfAdd(o),b2Rot.MulRV(M,f,o),b2Vec2.SubVV(o,b,o),b2Vec2.MulSV(C,o,o),v.SelfAdd(o)}}}SolveSpring(e){const i=b2ParticleSystem.SolveSpring_s_pa,n=b2ParticleSystem.SolveSpring_s_pb,r=b2ParticleSystem.SolveSpring_s_d,s=b2ParticleSystem.SolveSpring_s_f,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.springStrength;for(let c=0;c<this.m_pairBuffer.count;c++){const h=this.m_pairBuffer.data[c];if(h.flags&t.ParticleFlag.b2_springParticle){const t=h.indexA,c=h.indexB,u=i.Copy(o[t]),d=n.Copy(o[c]),m=a[t],p=a[c];u.SelfMulAdd(e.dt,m),d.SelfMulAdd(e.dt,p);const f=b2Vec2.SubVV(d,u,r),_=h.distance,g=f.Length(),b=l*h.strength,y=b2Vec2.MulSV(b*(_-g)/g,f,s);m.SelfSub(y),p.SelfAdd(y)}}}SolveTensile(e){const i=b2ParticleSystem.SolveTensile_s_weightedNormal,n=b2ParticleSystem.SolveTensile_s_s,r=b2ParticleSystem.SolveTensile_s_f,s=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++)this.m_accumulation2Buffer[t]=new b2Vec2,this.m_accumulation2Buffer[t].SetZero();for(let e=0;e<this.m_contactBuffer.count;e++){const n=this.m_contactBuffer.data[e];if(n.flags&t.ParticleFlag.b2_tensileParticle){const t=n.indexA,e=n.indexB,r=n.weight,s=n.normal,o=b2Vec2.MulSV((1-r)*r,s,i);this.m_accumulation2Buffer[t].SelfSub(o),this.m_accumulation2Buffer[e].SelfAdd(o)}}const o=this.GetCriticalVelocity(e),a=this.m_def.surfaceTensionPressureStrength*o,l=this.m_def.surfaceTensionNormalStrength*o,c=T*o;for(let e=0;e<this.m_contactBuffer.count;e++){const i=this.m_contactBuffer.data[e];if(i.flags&t.ParticleFlag.b2_tensileParticle){const t=i.indexA,e=i.indexB,o=i.weight,h=i.normal,u=this.m_weightBuffer[t]+this.m_weightBuffer[e],d=b2Vec2.SubVV(this.m_accumulation2Buffer[e],this.m_accumulation2Buffer[t],n),m=b2Min(a*(u-2)+l*b2Vec2.DotVV(d,h),c)*o,p=b2Vec2.MulSV(m,h,r);s[t].SelfSub(p),s[e].SelfAdd(p)}}}SolveViscous(){const e=b2ParticleSystem.SolveViscous_s_v,i=b2ParticleSystem.SolveViscous_s_f,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.viscousStrength,o=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){const l=this.m_bodyContactBuffer.data[a],c=l.index;if(this.m_flagsBuffer.data[c]&t.ParticleFlag.b2_viscousParticle){const t=l.body,a=l.weight,h=l.mass,u=n[c],d=b2Vec2.SubVV(t.GetLinearVelocityFromWorldPoint(u,b2Vec2.s_t0),r[c],e),m=b2Vec2.MulSV(s*h*a,d,i);r[c].SelfMulAdd(o,m),t.ApplyLinearImpulse(m.SelfNeg(),u,!0)}}for(let n=0;n<this.m_contactBuffer.count;n++){const o=this.m_contactBuffer.data[n];if(o.flags&t.ParticleFlag.b2_viscousParticle){const t=o.indexA,n=o.indexB,a=o.weight,l=b2Vec2.SubVV(r[n],r[t],e),c=b2Vec2.MulSV(s*a,l,i);r[t].SelfAdd(c),r[n].SelfSub(c)}}}SolveRepulsive(e){const i=b2ParticleSystem.SolveRepulsive_s_f,n=this.m_velocityBuffer.data,r=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e);for(let e=0;e<this.m_contactBuffer.count;e++){const s=this.m_contactBuffer.data[e];if(s.flags&t.ParticleFlag.b2_repulsiveParticle){const t=s.indexA,e=s.indexB;if(this.m_groupBuffer[t]!==this.m_groupBuffer[e]){const o=s.weight,a=s.normal,l=b2Vec2.MulSV(r*o,a,i);n[t].SelfSub(l),n[e].SelfAdd(l)}}}}SolvePowder(e){const i=b2ParticleSystem.SolvePowder_s_f,n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,s=this.m_def.powderStrength*this.GetCriticalVelocity(e),o=1-A,a=this.GetParticleInvMass();for(let e=0;e<this.m_bodyContactBuffer.count;e++){const l=this.m_bodyContactBuffer.data[e],c=l.index;if(this.m_flagsBuffer.data[c]&t.ParticleFlag.b2_powderParticle){const t=l.weight;if(t>o){const e=l.body,h=l.mass,u=n[c],d=l.normal,m=b2Vec2.MulSV(s*h*(t-o),d,i);r[c].SelfMulSub(a,m),e.ApplyLinearImpulse(m,u,!0)}}}for(let e=0;e<this.m_contactBuffer.count;e++){const n=this.m_contactBuffer.data[e];if(n.flags&t.ParticleFlag.b2_powderParticle){const t=n.weight;if(t>o){const e=n.indexA,a=n.indexB,l=n.normal,c=b2Vec2.MulSV(s*(t-o),l,i);r[e].SelfSub(c),r[a].SelfAdd(c)}}}}SolveSolid(t){const e=b2ParticleSystem.SolveSolid_s_f,i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);const n=t.inv_dt*this.m_def.ejectionStrength;for(let t=0;t<this.m_contactBuffer.count;t++){const r=this.m_contactBuffer.data[t],s=r.indexA,o=r.indexB;if(this.m_groupBuffer[s]!==this.m_groupBuffer[o]){const t=r.weight,a=r.normal,l=this.m_depthBuffer[s]+this.m_depthBuffer[o],c=b2Vec2.MulSV(n*l*t,a,e);i[s].SelfSub(c),i[o].SelfAdd(c)}}}SolveForce(t){const e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass();for(let t=0;t<this.m_count;t++)e[t].SelfMulAdd(i,this.m_forceBuffer[t]);this.m_hasForce=!1}SolveColorMixing(){const e=.5*this.m_def.colorMixingStrength;if(e)for(let i=0;i<this.m_contactBuffer.count;i++){const n=this.m_contactBuffer.data[i],r=n.indexA,s=n.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[s]&t.ParticleFlag.b2_colorMixingParticle){const t=this.m_colorBuffer.data[r],i=this.m_colorBuffer.data[s];b2Color.MixColors(t,i,e)}}}SolveZombie(){let e=0;const i=[];for(let t=0;t<this.m_count;t++)i[t]=M;let n=0;for(let r=0;r<this.m_count;r++){const s=this.m_flagsBuffer.data[r];if(s&t.ParticleFlag.b2_zombieParticle){const e=this.m_world.m_destructionListener;if(s&t.ParticleFlag.b2_destructionListenerParticle&&e&&e.SayGoodbyeParticle(this,r),this.m_handleIndexBuffer.data){const t=this.m_handleIndexBuffer.data[r];t&&(t.SetIndex(M),this.m_handleIndexBuffer.data[r]=null)}i[r]=M}else{if(i[r]=e,r!==e){if(this.m_handleIndexBuffer.data){const t=this.m_handleIndexBuffer.data[r];t&&t.SetIndex(e),this.m_handleIndexBuffer.data[e]=t}this.m_flagsBuffer.data[e]=this.m_flagsBuffer.data[r],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[r]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[r]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[r]),this.m_positionBuffer.data[e].Copy(this.m_positionBuffer.data[r]),this.m_velocityBuffer.data[e].Copy(this.m_velocityBuffer.data[r]),this.m_groupBuffer[e]=this.m_groupBuffer[r],this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[r]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[r]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[r]),this.m_colorBuffer.data&&this.m_colorBuffer.data[e].Copy(this.m_colorBuffer.data[r]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[e]=this.m_userDataBuffer.data[r]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[r])}e++,n|=s}}const r={IsProxyInvalid:t=>t.index<0,IsContactInvalid:t=>t.indexA<0||t.indexB<0,IsBodyContactInvalid:t=>t.index<0,IsPairInvalid:t=>t.indexA<0||t.indexB<0,IsTriadInvalid:t=>t.indexA<0||t.indexB<0||t.indexC<0};for(let t=0;t<this.m_proxyBuffer.count;t++){const e=this.m_proxyBuffer.data[t];e.index=i[e.index]}this.m_proxyBuffer.RemoveIf(r.IsProxyInvalid);for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t];e.indexA=i[e.indexA],e.indexB=i[e.indexB]}this.m_contactBuffer.RemoveIf(r.IsContactInvalid);for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t];e.index=i[e.index]}this.m_bodyContactBuffer.RemoveIf(r.IsBodyContactInvalid);for(let t=0;t<this.m_pairBuffer.count;t++){const e=this.m_pairBuffer.data[t];e.indexA=i[e.indexA],e.indexB=i[e.indexB]}this.m_pairBuffer.RemoveIf(r.IsPairInvalid);for(let t=0;t<this.m_triadBuffer.count;t++){const e=this.m_triadBuffer.data[t];e.indexA=i[e.indexA],e.indexB=i[e.indexB],e.indexC=i[e.indexC]}if(this.m_triadBuffer.RemoveIf(r.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data){let t=0;for(let e=0;e<this.m_count;e++){const n=i[this.m_indexByExpirationTimeBuffer.data[e]];n!==M&&(this.m_indexByExpirationTimeBuffer.data[t++]=n)}}for(let n=this.m_groupList;n;n=n.GetNext()){let r=e,s=0,o=!1;for(let t=n.m_firstIndex;t<n.m_lastIndex;t++){const e=i[t];e>=0?(r=b2Min(r,e),s=b2Max(s,e+1)):o=!0}r<s?(n.m_firstIndex=r,n.m_lastIndex=s,o&&n.m_groupFlags&t.ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(n,n.m_groupFlags|t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(n.m_firstIndex=0,n.m_lastIndex=0,n.m_groupFlags&t.ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(n,n.m_groupFlags|t.ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=e,this.m_allParticleFlags=n,this.m_needsUpdateAllParticleFlags=!1;for(let e=this.m_groupList;e;){const i=e.GetNext();e.m_groupFlags&t.ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(e),e=i}}SolveLifetimes(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);const e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,n=this.m_indexByExpirationTimeBuffer.data,r=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){const t=(t,e)=>{const n=i[t],r=i[e],s=n<=0,o=r<=0;return s===o?n>r:s};std_sort(n,0,r,t),this.m_expirationTimeBufferRequiresSorting=!1}for(let t=r-1;t>=0;--t){const r=n[t],s=i[r];if(e<s||s<=0)break;this.DestroyParticle(r)}}RotateBuffer(t,e,i){if(t!==e&&e!==i){if(std_rotate(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&std_rotate(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&std_rotate(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&std_rotate(this.m_consecutiveContactStepsBuffer.data,t,e,i),std_rotate(this.m_positionBuffer.data,t,e,i),std_rotate(this.m_velocityBuffer.data,t,e,i),std_rotate(this.m_groupBuffer,t,e,i),this.m_hasForce&&std_rotate(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&std_rotate(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&std_rotate(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&std_rotate(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&std_rotate(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){std_rotate(this.m_handleIndexBuffer.data,t,e,i);for(let e=t;e<i;++e){const t=this.m_handleIndexBuffer.data[e];t&&t.SetIndex(newIndices(t.GetIndex()))}}if(this.m_expirationTimeBuffer.data){std_rotate(this.m_expirationTimeBuffer.data,t,e,i);const n=this.GetParticleCount(),r=this.m_indexByExpirationTimeBuffer.data;for(let t=0;t<n;++t)r[t]=newIndices(r[t])}for(let t=0;t<this.m_proxyBuffer.count;t++){const e=this.m_proxyBuffer.data[t];e.index=newIndices(e.index)}for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB)}for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t];e.index=newIndices(e.index)}for(let t=0;t<this.m_pairBuffer.count;t++){const e=this.m_pairBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB)}for(let t=0;t<this.m_triadBuffer.count;t++){const e=this.m_triadBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB),e.indexC=newIndices(e.indexC)}for(let t=this.m_groupList;t;t=t.GetNext())t.m_firstIndex=newIndices(t.m_firstIndex),t.m_lastIndex=newIndices(t.m_lastIndex-1)+1}function newIndices(n){return n<t?n:n<e?n+i-e:n<i?n+t-e:n}}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){const e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return A*this.m_particleDiameter}GetParticleMass(){const t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){const t=this.m_inverseDiameter*(1/A);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&t.ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&t.ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&t.ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&t.ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(t,e){t.data=e,t.userSuppliedCapacity=e.length}SetGroupFlags(e,i){const n=e.m_groupFlags;(n^i)&t.ParticleGroupFlag.b2_solidParticleGroup&&(i|=t.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),n&~i&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&i&&(i&t.ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=i),e.m_groupFlags=i}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}RemoveSpuriousBodyContacts(){std_sort(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,b2ParticleSystem.BodyContactCompare);const t=b2ParticleSystem.RemoveSpuriousBodyContacts_s_n,e=b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos,i=b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal,n=this;let r=-1,s=0;this.m_bodyContactBuffer.count=std_remove_if(this.m_bodyContactBuffer.data,o=>{if(o.index!==r&&(s=0,r=o.index),s++>3)return!0;const a=t.Copy(o.normal);a.SelfMul(n.m_particleDiameter*(1-o.weight));const l=b2Vec2.AddVV(n.m_positionBuffer.data[o.index],a,e);if(!o.fixture.TestPoint(l)){const t=o.fixture.GetShape().GetChildCount();for(let e=0;e<t;e++){const t=i,n=o.fixture.ComputeDistance(l,t,e);if(n<u)return!1}return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==M}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(e){return!(e&t.ParticleFlag.b2_wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(e){return null!==e&&0!=(e.m_groupFlags&t.ParticleGroupFlag.b2_rigidParticleGroup)}GetLinearVelocity(t,e,i,n){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,n):n.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,i,n,r,s,o,a){t[0]=n>0?1/n:0,e[0]=r>0?1/r:0,i[0]=b2Vec2.CrossVV(b2Vec2.SubVV(o,s,b2Vec2.s_t0),a)}InitDampingParameterWithRigidGroupOrParticle(e,i,n,r,s,o,a,l){if(s&&r)this.InitDampingParameter(e,i,n,s.GetMass(),s.GetInertia(),s.GetCenter(),a,l);else{const r=this.m_flagsBuffer.data[o];this.InitDampingParameter(e,i,n,r&t.ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,l)}}ComputeDampingImpulse(t,e,i,n,r,s,o){const a=t+e*i*i+n+r*s*s;return a>0?o/a:0}ApplyDamping(t,e,i,n,r,s,o,a){r&&n?(r.m_linearVelocity.SelfMulAdd(o*t,a),r.m_angularVelocity+=o*i*e):this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}}b2ParticleSystem.xTruncBits=12,b2ParticleSystem.yTruncBits=12,b2ParticleSystem.tagBits=32,b2ParticleSystem.yOffset=1<<b2ParticleSystem.yTruncBits-1,b2ParticleSystem.yShift=b2ParticleSystem.tagBits-b2ParticleSystem.yTruncBits,b2ParticleSystem.xShift=b2ParticleSystem.tagBits-b2ParticleSystem.yTruncBits-b2ParticleSystem.xTruncBits,b2ParticleSystem.xScale=1<<b2ParticleSystem.xShift,b2ParticleSystem.xOffset=b2ParticleSystem.xScale*(1<<b2ParticleSystem.xTruncBits-1),b2ParticleSystem.yMask=(1<<b2ParticleSystem.yTruncBits)-1<<b2ParticleSystem.yShift,b2ParticleSystem.xMask=~b2ParticleSystem.yMask,b2ParticleSystem.DestroyParticlesInShape_s_aabb=new b2AABB,b2ParticleSystem.CreateParticleGroup_s_transform=new b2Transform,b2ParticleSystem.ComputeCollisionEnergy_s_v=new b2Vec2,b2ParticleSystem.QueryShapeAABB_s_aabb=new b2AABB,b2ParticleSystem.QueryPointAABB_s_aabb=new b2AABB,b2ParticleSystem.RayCast_s_aabb=new b2AABB,b2ParticleSystem.RayCast_s_p=new b2Vec2,b2ParticleSystem.RayCast_s_v=new b2Vec2,b2ParticleSystem.RayCast_s_n=new b2Vec2,b2ParticleSystem.RayCast_s_point=new b2Vec2,b2ParticleSystem.k_pairFlags=t.ParticleFlag.b2_springParticle,b2ParticleSystem.k_triadFlags=t.ParticleFlag.b2_elasticParticle,b2ParticleSystem.k_noPressureFlags=t.ParticleFlag.b2_powderParticle|t.ParticleFlag.b2_tensileParticle,b2ParticleSystem.k_extraDampingFlags=t.ParticleFlag.b2_staticPressureParticle,b2ParticleSystem.k_barrierWallFlags=t.ParticleFlag.b2_barrierParticle|t.ParticleFlag.b2_wallParticle,b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge=new b2EdgeShape,b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d=new b2Vec2,b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p=new b2Vec2,b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb=new b2AABB,b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p=new b2Vec2,b2ParticleSystem.UpdatePairsAndTriads_s_dab=new b2Vec2,b2ParticleSystem.UpdatePairsAndTriads_s_dbc=new b2Vec2,b2ParticleSystem.UpdatePairsAndTriads_s_dca=new b2Vec2,b2ParticleSystem.AddContact_s_d=new b2Vec2,b2ParticleSystem.UpdateBodyContacts_s_aabb=new b2AABB,b2ParticleSystem.Solve_s_subStep=new b2TimeStep,b2ParticleSystem.SolveCollision_s_aabb=new b2AABB,b2ParticleSystem.SolveGravity_s_gravity=new b2Vec2,b2ParticleSystem.SolveBarrier_s_aabb=new b2AABB,b2ParticleSystem.SolveBarrier_s_va=new b2Vec2,b2ParticleSystem.SolveBarrier_s_vb=new b2Vec2,b2ParticleSystem.SolveBarrier_s_pba=new b2Vec2,b2ParticleSystem.SolveBarrier_s_vba=new b2Vec2,b2ParticleSystem.SolveBarrier_s_vc=new b2Vec2,b2ParticleSystem.SolveBarrier_s_pca=new b2Vec2,b2ParticleSystem.SolveBarrier_s_vca=new b2Vec2,b2ParticleSystem.SolveBarrier_s_qba=new b2Vec2,b2ParticleSystem.SolveBarrier_s_qca=new b2Vec2,b2ParticleSystem.SolveBarrier_s_dv=new b2Vec2,b2ParticleSystem.SolveBarrier_s_f=new b2Vec2,b2ParticleSystem.SolvePressure_s_f=new b2Vec2,b2ParticleSystem.SolveDamping_s_v=new b2Vec2,b2ParticleSystem.SolveDamping_s_f=new b2Vec2,b2ParticleSystem.SolveRigidDamping_s_t0=new b2Vec2,b2ParticleSystem.SolveRigidDamping_s_t1=new b2Vec2,b2ParticleSystem.SolveRigidDamping_s_p=new b2Vec2,b2ParticleSystem.SolveRigidDamping_s_v=new b2Vec2,b2ParticleSystem.SolveExtraDamping_s_v=new b2Vec2,b2ParticleSystem.SolveExtraDamping_s_f=new b2Vec2,b2ParticleSystem.SolveRigid_s_position=new b2Vec2,b2ParticleSystem.SolveRigid_s_rotation=new b2Rot,b2ParticleSystem.SolveRigid_s_transform=new b2Transform,b2ParticleSystem.SolveRigid_s_velocityTransform=new b2Transform,b2ParticleSystem.SolveElastic_s_pa=new b2Vec2,b2ParticleSystem.SolveElastic_s_pb=new b2Vec2,b2ParticleSystem.SolveElastic_s_pc=new b2Vec2,b2ParticleSystem.SolveElastic_s_r=new b2Rot,b2ParticleSystem.SolveElastic_s_t0=new b2Vec2,b2ParticleSystem.SolveSpring_s_pa=new b2Vec2,b2ParticleSystem.SolveSpring_s_pb=new b2Vec2,b2ParticleSystem.SolveSpring_s_d=new b2Vec2,b2ParticleSystem.SolveSpring_s_f=new b2Vec2,b2ParticleSystem.SolveTensile_s_weightedNormal=new b2Vec2,b2ParticleSystem.SolveTensile_s_s=new b2Vec2,b2ParticleSystem.SolveTensile_s_f=new b2Vec2,b2ParticleSystem.SolveViscous_s_v=new b2Vec2,b2ParticleSystem.SolveViscous_s_f=new b2Vec2,b2ParticleSystem.SolveRepulsive_s_f=new b2Vec2,b2ParticleSystem.SolvePowder_s_f=new b2Vec2,b2ParticleSystem.SolveSolid_s_f=new b2Vec2,b2ParticleSystem.RemoveSpuriousBodyContacts_s_n=new b2Vec2,b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos=new b2Vec2,b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal=new b2Vec2;class b2ParticleSystem_UserOverridableBuffer{constructor(){this._data=null,this.userSuppliedCapacity=0}get data(){return this._data}set data(t){this._data=t}}class b2ParticleSystem_Proxy{constructor(){this.index=M,this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}}class b2ParticleSystem_InsideBoundsEnumerator{constructor(t,e,i,n,r){this.m_system=t,this.m_xLower=(e&b2ParticleSystem.xMask)>>>0,this.m_xUpper=(i&b2ParticleSystem.xMask)>>>0,this.m_yLower=(e&b2ParticleSystem.yMask)>>>0,this.m_yUpper=(i&b2ParticleSystem.yMask)>>>0,this.m_first=n,this.m_last=r}GetNext(){for(;this.m_first<this.m_last;){const t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&b2ParticleSystem.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return M}}class b2ParticleSystem_ParticleListNode{constructor(){this.next=null,this.count=0,this.index=0}}class b2ParticleSystem_FixedSetAllocator{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}}class b2ParticleSystem_FixtureParticleSet extends b2ParticleSystem_FixedSetAllocator{Initialize(t,e){}Find(t){return M}}class b2ParticlePairSet extends b2ParticleSystem_FixedSetAllocator{Initialize(t,e){}Find(t){return M}}class b2ParticleSystem_ConnectionFilter{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,i){return!0}}class b2ParticleSystem_DestroyParticlesInShapeCallback extends b2QueryCallback{constructor(t,e,i,n){super(),this.m_callDestructionListener=!1,this.m_destroyed=0,this.m_system=t,this.m_shape=e,this.m_xf=i,this.m_callDestructionListener=n,this.m_destroyed=0}ReportFixture(t){return!1}ReportParticle(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}Destroyed(){return this.m_destroyed}}class b2ParticleSystem_JoinParticleGroupsFilter extends b2ParticleSystem_ConnectionFilter{constructor(t){super(),this.m_threshold=0,this.m_threshold=t}ShouldCreatePair(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}ShouldCreateTriad(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}class b2ParticleSystem_CompositeShape extends b2Shape{constructor(e,i=e.length){super(t.ShapeType.e_unknown,0),this.m_shapeCount=0,this.m_shapes=e,this.m_shapeCount=i}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(t,e){for(let i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}ComputeDistance(t,e,i,n){return 0}RayCast(t,e,i,n){return!1}ComputeAABB(t,e,n){const r=new b2AABB;t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i;for(let i=0;i<this.m_shapeCount;i++){const n=this.m_shapes[i].GetChildCount();for(let s=0;s<n;s++){const n=r;this.m_shapes[i].ComputeAABB(n,e,s),t.Combine1(n)}}}ComputeMass(t,e){}SetupDistanceProxy(t,e){}ComputeSubmergedArea(t,e,i,n){return 0}Dump(t){}}class b2ParticleSystem_ReactiveFilter extends b2ParticleSystem_ConnectionFilter{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(e){return 0!=(this.m_flagsBuffer.data[e]&t.ParticleFlag.b2_reactiveParticle)}}class b2ParticleSystem_UpdateBodyContactsCallback extends b2FixtureParticleQueryCallback{constructor(t,e=null){super(t),this.m_contactFilter=null,this.m_contactFilter=e}ShouldCollideFixtureParticle(e,i,n){if(this.m_contactFilter){const i=this.m_system.GetFlagsBuffer();if(i[n]&t.ParticleFlag.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,n)}return!0}ReportFixtureAndParticle(e,i,n){const r=b2ParticleSystem_UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,s=b2ParticleSystem_UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp,o=this.m_system.m_positionBuffer.data[n],a=r,l=e.ComputeDistance(o,a,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,n)){const i=e.GetBody(),r=i.GetWorldCenter(),c=i.GetMass(),h=i.GetInertia()-c*i.GetLocalCenter().LengthSquared(),u=c>0?1/c:0,d=h>0?1/h:0,m=this.m_system.m_flagsBuffer.data[n]&t.ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),p=b2Vec2.SubVV(o,r,s),f=b2Vec2.CrossVV(p,a),_=m+u+d*f*f,g=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];g.index=n,g.body=i,g.fixture=e,g.weight=1-l*this.m_system.m_inverseDiameter,g.normal.Copy(a.SelfNeg()),g.mass=_>0?1/_:0,this.m_system.DetectStuckParticle(n)}}}b2ParticleSystem_UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n=new b2Vec2,b2ParticleSystem_UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp=new b2Vec2;class b2ParticleSystem_SolveCollisionCallback extends b2FixtureParticleQueryCallback{constructor(t,e){super(t),this.m_step=e}ReportFixtureAndParticle(e,i,n){const r=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_p1,s=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_output,o=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_input,a=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_p,l=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_v,c=b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_f,h=e.GetBody(),d=this.m_system.m_positionBuffer.data[n],m=this.m_system.m_velocityBuffer.data[n],p=s,f=o;if(0===this.m_system.m_iterationIndex){const i=b2Transform.MulTXV(h.m_xf0,d,r);e.GetShape().GetType()===t.ShapeType.e_circleShape&&(i.SelfSub(h.GetLocalCenter()),b2Rot.MulRV(h.m_xf0.q,i,i),b2Rot.MulTRV(h.m_xf.q,i,i),i.SelfAdd(h.GetLocalCenter())),b2Transform.MulXV(h.m_xf,i,f.p1)}else f.p1.Copy(d);if(b2Vec2.AddVMulSV(d,this.m_step.dt,m,f.p2),f.maxFraction=1,e.RayCast(p,f,i)){const t=p.normal,e=a;e.x=(1-p.fraction)*f.p1.x+p.fraction*f.p2.x+u*t.x,e.y=(1-p.fraction)*f.p1.y+p.fraction*f.p2.y+u*t.y;const i=l;i.x=this.m_step.inv_dt*(e.x-d.x),i.y=this.m_step.inv_dt*(e.y-d.y),this.m_system.m_velocityBuffer.data[n].Copy(i);const r=c;r.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(m.x-i.x),r.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(m.y-i.y),this.m_system.ParticleApplyForce(n,r)}}ReportParticle(t,e){return!1}}b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_p1=new b2Vec2,b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_output=new b2RayCastOutput,b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_input=new b2RayCastInput,b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_p=new b2Vec2,b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_v=new b2Vec2,b2ParticleSystem_SolveCollisionCallback.ReportFixtureAndParticle_s_f=new b2Vec2;class b2World{constructor(t){this.m_contactManager=new b2ContactManager,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_newContacts=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new b2Profile,this.m_island=new b2Island,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}SetDestructionListener(t){this.m_destructionListener=t}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t}SetDebugDraw(t){this.m_debugDraw=t}CreateBody(t={}){if(this.IsLocked())throw new Error;const e=new b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){if(this.IsLocked())throw new Error;let e=t.m_jointList;for(;e;){const i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;let i=t.m_controllerList;for(;i;){const e=i;i=i.nextController,e.controller.RemoveBody(t)}let n=t.m_contactList;for(;n;){const t=n;n=n.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;let r=t.m_fixtureList;for(;r;){const e=r;r=r.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(e),e.DestroyProxies(),e.Reset(),t.m_fixtureList=r,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static _Joint_Create(e){switch(e.type){case t.JointType.e_distanceJoint:return new b2DistanceJoint(e);case t.JointType.e_mouseJoint:return new b2MouseJoint(e);case t.JointType.e_prismaticJoint:return new b2PrismaticJoint(e);case t.JointType.e_revoluteJoint:return new b2RevoluteJoint(e);case t.JointType.e_pulleyJoint:return new b2PulleyJoint(e);case t.JointType.e_gearJoint:return new b2GearJoint(e);case t.JointType.e_wheelJoint:return new b2WheelJoint(e);case t.JointType.e_weldJoint:return new b2WeldJoint(e);case t.JointType.e_frictionJoint:return new b2FrictionJoint(e);case t.JointType.e_motorJoint:return new b2MotorJoint(e);case t.JointType.e_areaJoint:return new b2AreaJoint(e)}throw new Error}static _Joint_Destroy(t){}CreateJoint(t){if(this.IsLocked())throw new Error;const e=b2World._Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const i=e.m_bodyA,n=e.m_bodyB,r=e.m_collideConnected;if(!r){let t=n.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}return e}DestroyJoint(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const e=t.m_bodyA,i=t.m_bodyB,n=t.m_collideConnected;if(e.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.Reset(),t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.Reset(),b2World._Joint_Destroy(t),--this.m_jointCount,!n){let t=i.GetContactList();for(;t;)t.other===e&&t.contact.FlagForFiltering(),t=t.next}}CreateParticleSystem(t){if(this.IsLocked())throw new Error;const e=new b2ParticleSystem(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}DestroyParticleSystem(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}CalculateReasonableParticleIterations(t){return null===this.m_particleSystemList?1:b2CalculateParticleIterations(this.m_gravity.Length(),function GetSmallestRadius(t){let e=i;for(let i=t.GetParticleSystemList();null!==i;i=i.m_next)e=b2Min(e,i.GetRadius());return e}(this),t)}Step(t,e,i,n=this.CalculateReasonableParticleIterations(t)){const r=b2World.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;const s=b2World.Step_s_step;s.dt=t,s.velocityIterations=e,s.positionIterations=i,s.particleIterations=n,s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting;const o=b2World.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=o.GetMilliseconds(),this.m_stepComplete&&s.dt>0){const t=b2World.Step_s_timer.Reset();for(let t=this.m_particleSystemList;t;t=t.m_next)t.Solve(s);this.Solve(s),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){const t=b2World.Step_s_timer.Reset();this.SolveTOI(s),this.m_profile.solveTOI=t.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}DrawParticleSystem(t){if(null===this.m_debugDraw)return;const e=t.GetParticleCount();if(e){const i=t.GetRadius(),n=t.GetPositionBuffer();if(t.m_colorBuffer.data){const r=t.GetColorBuffer();this.m_debugDraw.DrawParticles(n,i,r,e)}else this.m_debugDraw.DrawParticles(n,i,null,e)}}DebugDraw(){if(null===this.m_debugDraw)return;const e=this.m_debugDraw.GetFlags(),i=b2World.DebugDraw_s_color.SetRGB(0,0,0);if(e&t.DrawFlags.e_shapeBit)for(let e=this.m_bodyList;e;e=e.m_next){const n=e.m_xf;this.m_debugDraw.PushTransform(n);for(let n=e.GetFixtureList();n;n=n.m_next)e.GetType()===t.BodyType.b2_dynamicBody&&0===e.m_mass?this.DrawShape(n,new b2Color(1,0,0)):e.IsEnabled()?e.GetType()===t.BodyType.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(n,i)):e.GetType()===t.BodyType.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(n,i)):e.IsAwake()?(i.SetRGB(.9,.7,.7),this.DrawShape(n,i)):(i.SetRGB(.6,.6,.6),this.DrawShape(n,i)):(i.SetRGB(.5,.5,.3),this.DrawShape(n,i));this.m_debugDraw.PopTransform(n)}if(e&t.DrawFlags.e_particleBit)for(let t=this.m_particleSystemList;t;t=t.m_next)this.DrawParticleSystem(t);if(e&t.DrawFlags.e_jointBit)for(let t=this.m_jointList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&t.DrawFlags.e_pairBit){i.SetRGB(.3,.9,.9);for(let t=this.m_contactManager.m_contactList;t;t=t.m_next){const e=t.GetFixtureA(),n=t.GetFixtureB(),r=t.GetChildIndexA(),s=t.GetChildIndexB(),o=e.GetAABB(r).GetCenter(),a=n.GetAABB(s).GetCenter();this.m_debugDraw.DrawSegment(o,a,i)}}if(e&t.DrawFlags.e_aabbBit){i.SetRGB(.9,.3,.9);const t=b2World.DebugDraw_s_vs;for(let e=this.m_bodyList;e;e=e.m_next)if(e.IsEnabled())for(let n=e.GetFixtureList();n;n=n.m_next)for(let e=0;e<n.m_proxyCount;++e){const r=n.m_proxies[e],s=r.treeNode.aabb;t[0].Set(s.lowerBound.x,s.lowerBound.y),t[1].Set(s.upperBound.x,s.lowerBound.y),t[2].Set(s.upperBound.x,s.upperBound.y),t[3].Set(s.lowerBound.x,s.upperBound.y),this.m_debugDraw.DrawPolygon(t,4,i)}}if(e&t.DrawFlags.e_centerOfMassBit)for(let t=this.m_bodyList;t;t=t.m_next){const e=b2World.DebugDraw_s_xf;e.q.Copy(t.m_xf.q),e.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(e)}if(e&t.DrawFlags.e_controllerBit)for(let t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw)}QueryAABB(...t){t[0]instanceof b2QueryCallback?this._QueryAABB(t[0],t[1]):this._QueryAABB(null,t[0],t[1])}_QueryAABB(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,e=>{const n=e.userData,r=n.fixture;return t?t.ReportFixture(r):!i||i(r)}),t instanceof b2QueryCallback)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryAABB(t,e)}QueryAllAABB(t,e=[]){return this.QueryAABB(t,t=>(e.push(t),!0)),e}QueryPointAABB(...t){t[0]instanceof b2QueryCallback?this._QueryPointAABB(t[0],t[1]):this._QueryPointAABB(null,t[0],t[1])}_QueryPointAABB(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,e=>{const n=e.userData,r=n.fixture;return t?t.ReportFixture(r):!i||i(r)}),t instanceof b2QueryCallback)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(t,t=>(e.push(t),!0)),e}QueryFixtureShape(...t){t[0]instanceof b2QueryCallback?this._QueryFixtureShape(t[0],t[1],t[2],t[3]):this._QueryFixtureShape(null,t[0],t[1],t[2],t[3])}_QueryFixtureShape(t,e,i,n,r){const s=b2World.QueryFixtureShape_s_aabb;if(e.ComputeAABB(s,n,i),this.m_contactManager.m_broadPhase.Query(s,s=>{const o=s.userData,a=o.fixture;if(b2TestOverlapShape(e,i,a.GetShape(),o.childIndex,n,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(r)return r(a)}return!0}),t instanceof b2QueryCallback)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,s)}QueryAllFixtureShape(t,e,i,n=[]){return this.QueryFixtureShape(t,e,i,t=>(n.push(t),!0)),n}QueryFixturePoint(...t){t[0]instanceof b2QueryCallback?this._QueryFixturePoint(t[0],t[1]):this._QueryFixturePoint(null,t[0],t[1])}_QueryFixturePoint(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,n=>{const r=n.userData,s=r.fixture;if(s.TestPoint(e)){if(t)return t.ReportFixture(s);if(i)return i(s)}return!0}),t)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(t,t=>(e.push(t),!0)),e}RayCast(...t){t[0]instanceof b2RayCastCallback?this._RayCast(t[0],t[1],t[2]):this._RayCast(null,t[0],t[1],t[2])}_RayCast(t,e,i,n){const r=b2World.RayCast_s_input;if(r.maxFraction=1,r.p1.Copy(e),r.p2.Copy(i),this.m_contactManager.m_broadPhase.RayCast(r,(r,s)=>{const o=s.userData,a=o.fixture,l=o.childIndex,c=b2World.RayCast_s_output,h=a.RayCast(c,r,l);if(h){const r=c.fraction,s=b2World.RayCast_s_point;if(s.Set((1-r)*e.x+r*i.x,(1-r)*e.y+r*i.y),t)return t.ReportFixture(a,s,c.normal,r);if(n)return n(a,s,c.normal,r)}return r.maxFraction}),t)for(let n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.RayCast(t,e,i)}RayCastOne(t,e){let i=null,n=1;return this.RayCast(t,e,(t,e,r,s)=>(s<n&&(n=s,i=t),n)),i}RayCastAll(t,e,i=[]){return this.RayCast(t,e,(t,e,n,r)=>(i.push(t),1)),i}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t,e=!0){if(!b2Vec2.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){if(this.IsLocked())throw new Error;for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(e){if(this.m_locked)return;e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");let i=0;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandIndex=i,t.Dump(e),++i;i=0;for(let t=this.m_jointList;t;t=t.m_next)t.m_index=i,++i;for(let i=this.m_jointList;i;i=i.m_next)i.m_type!==t.JointType.e_gearJoint&&(e("{\n"),i.Dump(e),e("}\n"));for(let i=this.m_jointList;i;i=i.m_next)i.m_type===t.JointType.e_gearJoint&&(e("{\n"),i.Dump(e),e("}\n"))}DrawShape(e,i){if(null===this.m_debugDraw)return;const n=e.GetShape();switch(n.m_type){case t.ShapeType.e_circleShape:{const t=n,e=t.m_p,r=t.m_radius,s=b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(e,r,s,i);break}case t.ShapeType.e_edgeShape:{const t=n,e=t.m_vertex1,r=t.m_vertex2;this.m_debugDraw.DrawSegment(e,r,i),!1===t.m_oneSided&&(this.m_debugDraw.DrawPoint(e,4,i),this.m_debugDraw.DrawPoint(r,4,i));break}case t.ShapeType.e_chainShape:{const t=n,e=t.m_count,r=t.m_vertices;let s=r[0];for(let t=1;t<e;++t){const e=r[t];this.m_debugDraw.DrawSegment(s,e,i),s=e}break}case t.ShapeType.e_polygonShape:{const t=n,e=t.m_count,r=t.m_vertices;this.m_debugDraw.DrawSolidPolygon(r,e,i);break}}}Solve(e){for(let t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(let t=this.m_controllerList;t;t=t.m_next)t.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const n=this.s_stack;for(let r=this.m_bodyList;r;r=r.m_next){if(r.m_islandFlag)continue;if(!r.IsAwake()||!r.IsEnabled())continue;if(r.GetType()===t.BodyType.b2_staticBody)continue;i.Clear();let s=0;for(n[s++]=r,r.m_islandFlag=!0;s>0;){const e=n[--s];if(!e)throw new Error;if(i.AddBody(e),e.GetType()!==t.BodyType.b2_staticBody){e.m_awakeFlag=!0;for(let t=e.m_contactList;t;t=t.next){const e=t.contact;if(e.m_islandFlag)continue;if(!e.IsEnabled()||!e.IsTouching())continue;const r=e.m_fixtureA.m_isSensor,o=e.m_fixtureB.m_isSensor;if(r||o)continue;i.AddContact(e),e.m_islandFlag=!0;const a=t.other;a.m_islandFlag||(n[s++]=a,a.m_islandFlag=!0)}for(let t=e.m_jointList;t;t=t.next){if(t.joint.m_islandFlag)continue;const e=t.other;e.IsEnabled()&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,e.m_islandFlag||(n[s++]=e,e.m_islandFlag=!0))}}}const o=new b2Profile;i.Solve(o,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=o.solveInit,this.m_profile.solveVelocity+=o.solveVelocity,this.m_profile.solvePosition+=o.solvePosition;for(let e=0;e<i.m_bodyCount;++e){const n=i.m_bodies[e];n.GetType()===t.BodyType.b2_staticBody&&(n.m_islandFlag=!1)}}for(let t=0;t<n.length&&n[t];++t)n[t]=null;const r=new b2Timer;for(let e=this.m_bodyList;e;e=e.m_next)e.m_islandFlag&&e.GetType()!==t.BodyType.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=r.GetMilliseconds()}SolveTOI(e){const i=this.m_island;if(i.Initialize(2*f,f,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let r=null,s=1;for(let e=this.m_contactManager.m_contactList;e;e=e.m_next){if(!e.IsEnabled())continue;if(e.m_toiCount>p)continue;let i=1;if(e.m_toiFlag)i=e.m_toi;else{const n=e.GetFixtureA(),r=e.GetFixtureB();if(n.IsSensor()||r.IsSensor())continue;const s=n.GetBody(),o=r.GetBody(),a=s.m_type,l=o.m_type,c=s.IsAwake()&&a!==t.BodyType.b2_staticBody,h=o.IsAwake()&&l!==t.BodyType.b2_staticBody;if(!c&&!h)continue;const u=s.IsBullet()||a!==t.BodyType.b2_dynamicBody,d=o.IsBullet()||l!==t.BodyType.b2_dynamicBody;if(!u&&!d)continue;let m=s.m_sweep.alpha0;s.m_sweep.alpha0<o.m_sweep.alpha0?(m=o.m_sweep.alpha0,s.m_sweep.Advance(m)):o.m_sweep.alpha0<s.m_sweep.alpha0&&(m=s.m_sweep.alpha0,o.m_sweep.Advance(m));const p=e.GetChildIndexA(),f=e.GetChildIndexB(),_=b2World.SolveTOI_s_toi_input;_.proxyA.SetShape(n.GetShape(),p),_.proxyB.SetShape(r.GetShape(),f),_.sweepA.Copy(s.m_sweep),_.sweepB.Copy(o.m_sweep),_.tMax=1;const g=b2World.SolveTOI_s_toi_output;b2TimeOfImpact(g,_);const b=g.t;i=g.state===t.TOIOutputState.e_touching?b2Min(m+(1-m)*b,1):1,e.m_toi=i,e.m_toiFlag=!0}i<s&&(r=e,s=i)}if(null===r||1-10*n<s){this.m_stepComplete=!0;break}const o=r.GetFixtureA(),a=r.GetFixtureB(),l=o.GetBody(),c=a.GetBody(),h=b2World.SolveTOI_s_backup1.Copy(l.m_sweep),u=b2World.SolveTOI_s_backup2.Copy(c.m_sweep);if(l.Advance(s),c.Advance(s),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,!r.IsEnabled()||!r.IsTouching()){r.SetEnabled(!1),l.m_sweep.Copy(h),c.m_sweep.Copy(u),l.SynchronizeTransform(),c.SynchronizeTransform();continue}l.SetAwake(!0),c.SetAwake(!0),i.Clear(),i.AddBody(l),i.AddBody(c),i.AddContact(r),l.m_islandFlag=!0,c.m_islandFlag=!0,r.m_islandFlag=!0;for(let e=0;e<2;++e){const n=0===e?l:c;if(n.m_type===t.BodyType.b2_dynamicBody)for(let e=n.m_contactList;e&&i.m_bodyCount!==i.m_bodyCapacity&&i.m_contactCount!==i.m_contactCapacity;e=e.next){const r=e.contact;if(r.m_islandFlag)continue;const o=e.other;if(o.m_type===t.BodyType.b2_dynamicBody&&!n.IsBullet()&&!o.IsBullet())continue;const a=r.m_fixtureA.m_isSensor,l=r.m_fixtureB.m_isSensor;if(a||l)continue;const c=b2World.SolveTOI_s_backup.Copy(o.m_sweep);o.m_islandFlag||o.Advance(s),r.Update(this.m_contactManager.m_contactListener),r.IsEnabled()&&r.IsTouching()?(r.m_islandFlag=!0,i.AddContact(r),o.m_islandFlag||(o.m_islandFlag=!0,o.m_type!==t.BodyType.b2_staticBody&&o.SetAwake(!0),i.AddBody(o))):(o.m_sweep.Copy(c),o.SynchronizeTransform())}}const d=b2World.SolveTOI_s_subStep;d.dt=(1-s)*e.dt,d.inv_dt=1/d.dt,d.dtRatio=1,d.positionIterations=20,d.velocityIterations=e.velocityIterations,d.particleIterations=e.particleIterations,d.warmStarting=!1,i.SolveTOI(d,l.m_islandIndex,c.m_islandIndex);for(let e=0;e<i.m_bodyCount;++e){const n=i.m_bodies[e];if(n.m_islandFlag=!1,n.m_type===t.BodyType.b2_dynamicBody){n.SynchronizeFixtures();for(let t=n.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}AddController(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}RemoveController(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}b2World.Step_s_step=new b2TimeStep,b2World.Step_s_stepTimer=new b2Timer,b2World.Step_s_timer=new b2Timer,b2World.DebugDraw_s_color=new b2Color(0,0,0),b2World.DebugDraw_s_vs=b2Vec2.MakeArray(4),b2World.DebugDraw_s_xf=new b2Transform,b2World.QueryFixtureShape_s_aabb=new b2AABB,b2World.RayCast_s_input=new b2RayCastInput,b2World.RayCast_s_output=new b2RayCastOutput,b2World.RayCast_s_point=new b2Vec2,b2World.SolveTOI_s_subStep=new b2TimeStep,b2World.SolveTOI_s_backup=new b2Sweep,b2World.SolveTOI_s_backup1=new b2Sweep,b2World.SolveTOI_s_backup2=new b2Sweep,b2World.SolveTOI_s_toi_input=new b2TOIInput,b2World.SolveTOI_s_toi_output=new b2TOIOutput,(Ge=t.StretchingModel||(t.StretchingModel={}))[Ge.b2_pbdStretchingModel=0]="b2_pbdStretchingModel",Ge[Ge.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel",(De=t.BendingModel||(t.BendingModel={}))[De.b2_springAngleBendingModel=0]="b2_springAngleBendingModel",De[De.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel",De[De.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel",De[De.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel",De[De.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel",De[De.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel";class b2RopeTuning{constructor(){this.stretchingModel=t.StretchingModel.b2_pbdStretchingModel,this.bendingModel=t.BendingModel.b2_pbdAngleBendingModel,this.damping=0,this.stretchStiffness=1,this.stretchHertz=0,this.stretchDamping=0,this.bendStiffness=.5,this.bendHertz=1,this.bendDamping=0,this.isometric=!1,this.fixedEffectiveMass=!1,this.warmStart=!1}Copy(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}}class b2RopeStretch{constructor(){this.i1=0,this.i2=0,this.invMass1=0,this.invMass2=0,this.L=0,this.lambda=0,this.spring=0,this.damper=0}}class b2RopeBend{constructor(){this.i1=0,this.i2=0,this.i3=0,this.invMass1=0,this.invMass2=0,this.invMass3=0,this.invEffectiveMass=0,this.lambda=0,this.L1=0,this.L2=0,this.alpha1=0,this.alpha2=0,this.spring=0,this.damper=0}}class b2ControllerEdge{constructor(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e}}class b2Controller{constructor(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(t){const e=new b2ControllerEdge(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}RemoveBody(t){if(this.m_bodyCount<=0)throw new Error;let e=this.m_bodyList;for(;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}class b2ConstantAccelController extends b2Controller{constructor(){super(...arguments),this.A=new b2Vec2(0,0)}Step(t){const e=b2Vec2.MulSV(t.dt,this.A,b2ConstantAccelController.Step_s_dtA);for(let t=this.m_bodyList;t;t=t.nextBody){const i=t.body;i.IsAwake()&&i.SetLinearVelocity(b2Vec2.AddVV(i.GetLinearVelocity(),e,b2Vec2.s_t0))}}Draw(t){}}b2ConstantAccelController.Step_s_dtA=new b2Vec2;class b2GravityController extends b2Controller{constructor(){super(...arguments),this.G=1,this.invSqr=!0}Step(t){if(this.invSqr)for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body,i=e.GetWorldCenter(),r=e.GetMass();for(let s=this.m_bodyList;s&&s!==t;s=s.nextBody){const t=s.body,o=t.GetWorldCenter(),a=t.GetMass(),l=o.x-i.x,c=o.y-i.y,h=l*l+c*c;if(h<n)continue;const u=b2GravityController.Step_s_f.Set(l,c);u.SelfMul(this.G/h/z(h)*r*a),e.IsAwake()&&e.ApplyForce(u,i),t.IsAwake()&&t.ApplyForce(u.SelfMul(-1),o)}}else for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body,i=e.GetWorldCenter(),r=e.GetMass();for(let s=this.m_bodyList;s&&s!==t;s=s.nextBody){const t=s.body,o=t.GetWorldCenter(),a=t.GetMass(),l=o.x-i.x,c=o.y-i.y,h=l*l+c*c;if(h<n)continue;const u=b2GravityController.Step_s_f.Set(l,c);u.SelfMul(this.G/h*r*a),e.IsAwake()&&e.ApplyForce(u,i),t.IsAwake()&&t.ApplyForce(u.SelfMul(-1),o)}}}Draw(t){}}b2GravityController.Step_s_f=new b2Vec2;class b2TensorDampingController extends b2Controller{constructor(){super(...arguments),this.T=new b2Mat22,this.maxTimestep=0}Step(t){let e=t.dt;if(!(e<=n)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(let t=this.m_bodyList;t;t=t.nextBody){const i=t.body;if(!i.IsAwake())continue;const n=i.GetWorldVector(b2Mat22.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity(),b2Vec2.s_t0),b2Vec2.s_t1),b2TensorDampingController.Step_s_damping);i.SetLinearVelocity(b2Vec2.AddVV(i.GetLinearVelocity(),b2Vec2.MulSV(e,n,b2Vec2.s_t0),b2Vec2.s_t1))}}}Draw(t){}SetAxisAligned(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/b2Max(t,e):0}}b2TensorDampingController.Step_s_damping=new b2Vec2;const Fe=t.BodyType.b2_staticBody,ke=t.BodyType.b2_kinematicBody,Oe=t.BodyType.b2_dynamicBody,Ne=t.BendingModel.b2_springAngleBendingModel,Ue=t.BendingModel.b2_pbdAngleBendingModel,ze=t.BendingModel.b2_xpbdAngleBendingModel,We=t.BendingModel.b2_pbdDistanceBendingModel,He=t.BendingModel.b2_pbdHeightBendingModel,je=t.BendingModel.b2_pbdTriangleBendingModel,Je=t.StretchingModel.b2_pbdStretchingModel,qe=t.StretchingModel.b2_xpbdStretchingModel;t.AABB=b2AABB,t.Abs=N,t.Acos=J,t.Alloc=function b2Alloc(t){return null},t.AngularStiffness=function b2AngularStiffness(t,e,i,n,r){const o=n.GetInertia(),a=r.GetInertia();let l;l=o>0&&a>0?o*a/(o+a):o>0?o:a;const c=2*s*e;t.stiffness=l*c*c,t.damping=2*l*i*c},t.AreaJoint=b2AreaJoint,t.AreaJointDef=class b2AreaJointDef extends b2JointDef{constructor(){super(t.JointType.e_areaJoint),this.bodies=[],this.stiffness=0,this.damping=0}AddBody(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}},t.Asin=q,t.Assert=function b2Assert(t,...e){if(!t)throw new Error(...e)},t.Atan2=X,t.BlockAllocator=class b2BlockAllocator{},t.Body=b2Body,t.BodyDef=class b2BodyDef{constructor(){this.type=t.BodyType.b2_staticBody,this.position=new b2Vec2(0,0),this.angle=0,this.linearVelocity=new b2Vec2(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.enabled=!0,this.userData=null,this.gravityScale=1}},t.BroadPhase=b2BroadPhase,t.BuoyancyController=class b2BuoyancyController extends b2Controller{constructor(){super(...arguments),this.normal=new b2Vec2(0,1),this.offset=0,this.density=0,this.velocity=new b2Vec2(0,0),this.linearDrag=0,this.angularDrag=0,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=new b2Vec2(0,0)}Step(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body;if(!e.IsAwake())continue;const i=new b2Vec2,r=new b2Vec2;let s=0,o=0;for(let t=e.GetFixtureList();t;t=t.m_next){const n=new b2Vec2,a=t.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),n);s+=a,i.x+=a*n.x,i.y+=a*n.y;let l=0;l=this.useDensity?t.GetDensity():1,o+=a*l,r.x+=a*n.x*l,r.y+=a*n.y*l}if(i.x/=s,i.y/=s,r.x/=o,r.y/=o,s<n)continue;const a=this.gravity.Clone().SelfNeg();a.SelfMul(this.density*s),e.ApplyForce(a,r);const l=e.GetLinearVelocityFromWorldPoint(i,new b2Vec2);l.SelfSub(this.velocity),l.SelfMul(-this.linearDrag*s),e.ApplyForce(l,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag)}}}Draw(t){const e=100,i=new b2Vec2,n=new b2Vec2;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,n.x=this.normal.x*this.offset-this.normal.y*e,n.y=this.normal.y*this.offset+this.normal.x*e;const r=new b2Color(0,0,.8);t.DrawSegment(i,n,r)}},t.CalculateParticleIterations=b2CalculateParticleIterations,t.ChainAndCircleContact=b2ChainAndCircleContact,t.ChainAndPolygonContact=b2ChainAndPolygonContact,t.ChainShape=b2ChainShape,t.CircleContact=b2CircleContact,t.CircleShape=b2CircleShape,t.Clamp=b2Clamp,t.ClipSegmentToLine=b2ClipSegmentToLine,t.ClipVertex=b2ClipVertex,t.CollideCircles=b2CollideCircles,t.CollideEdgeAndCircle=b2CollideEdgeAndCircle,t.CollideEdgeAndPolygon=b2CollideEdgeAndPolygon,t.CollidePolygonAndCircle=b2CollidePolygonAndCircle,t.CollidePolygons=b2CollidePolygons,t.Color=b2Color,t.ConstantAccelController=b2ConstantAccelController,t.ConstantForceController=class b2ConstantForceController extends b2Controller{constructor(){super(...arguments),this.F=new b2Vec2(0,0)}Step(t){for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}}Draw(t){}},t.Contact=b2Contact,t.ContactEdge=b2ContactEdge,t.ContactFactory=b2ContactFactory,t.ContactFeature=b2ContactFeature,t.ContactFilter=b2ContactFilter,t.ContactID=b2ContactID,t.ContactImpulse=b2ContactImpulse,t.ContactListener=b2ContactListener,t.ContactManager=b2ContactManager,t.ContactPositionConstraint=b2ContactPositionConstraint,t.ContactRegister=b2ContactRegister,t.ContactSolver=b2ContactSolver,t.ContactSolverDef=b2ContactSolverDef,t.ContactVelocityConstraint=b2ContactVelocityConstraint,t.Controller=b2Controller,t.ControllerEdge=b2ControllerEdge,t.Cos=H,t.Counter=class b2Counter{constructor(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}GetCount(){return this.m_count}GetMinCount(){return this.m_min_count}GetMaxCount(){return this.m_max_count}ResetCount(){const t=this.m_count;return this.m_count=0,t}ResetMinCount(){this.m_min_count=0}ResetMaxCount(){this.m_max_count=0}Increment(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}Decrement(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}},t.DegToRad=function b2DegToRad(t){return t*F},t.DestructionListener=class b2DestructionListener{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){}SayGoodbyeParticle(t,e){}},t.Distance=b2Distance,t.DistanceInput=b2DistanceInput,t.DistanceJoint=b2DistanceJoint,t.DistanceJointDef=b2DistanceJointDef,t.DistanceOutput=b2DistanceOutput,t.DistanceProxy=b2DistanceProxy,t.Draw=class b2Draw{constructor(){this.m_drawFlags=0}SetFlags(t){this.m_drawFlags=t}GetFlags(){return this.m_drawFlags}AppendFlags(t){this.m_drawFlags|=t}ClearFlags(t){this.m_drawFlags&=~t}},t.DynamicTree=b2DynamicTree,t.EdgeAndCircleContact=b2EdgeAndCircleContact,t.EdgeAndPolygonContact=b2EdgeAndPolygonContact,t.EdgeShape=b2EdgeShape,t.Filter=b2Filter,t.Fixture=b2Fixture,t.FixtureDef=b2FixtureDef,t.FixtureParticleQueryCallback=b2FixtureParticleQueryCallback,t.FixtureProxy=b2FixtureProxy,t.Free=function b2Free(t){},t.FrictionJoint=b2FrictionJoint,t.FrictionJointDef=class b2FrictionJointDef extends b2JointDef{constructor(){super(t.JointType.e_frictionJoint),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.maxForce=0,this.maxTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}},t.GearJoint=b2GearJoint,t.GearJointDef=class b2GearJointDef extends b2JointDef{constructor(){super(t.JointType.e_gearJoint),this.ratio=1}},t.GetPointStates=function b2GetPointStates(e,i,n,r){let s;for(s=0;s<n.pointCount;++s){const i=n.points[s].id,o=i.key;e[s]=t.PointState.b2_removeState;for(let i=0,n=r.pointCount;i<n;++i)if(r.points[i].id.key===o){e[s]=t.PointState.b2_persistState;break}}for(;s<l;++s)e[s]=t.PointState.b2_nullState;for(s=0;s<r.pointCount;++s){const e=r.points[s].id,o=e.key;i[s]=t.PointState.b2_addState;for(let e=0,r=n.pointCount;e<r;++e)if(n.points[e].id.key===o){i[s]=t.PointState.b2_persistState;break}}for(;s<l;++s)i[s]=t.PointState.b2_nullState},t.GravityController=b2GravityController,t.GrowableBuffer=b2GrowableBuffer,t.GrowableStack=b2GrowableStack,t.InvSqrt=b2InvSqrt,t.IsPowerOfTwo=function b2IsPowerOfTwo(t){return t>0&&0==(t&t-1)},t.IsValid=U,t.Island=b2Island,t.Jacobian=class b2Jacobian{constructor(){this.linear=new b2Vec2,this.angularA=0,this.angularB=0}SetZero(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}Set(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}},t.Joint=b2Joint,t.JointDef=b2JointDef,t.JointEdge=b2JointEdge,t.LinearStiffness=function b2LinearStiffness(t,e,i,n,r){const o=n.GetMass(),a=r.GetMass();let l;l=o>0&&a>0?o*a/(o+a):o>0?o:a;const c=2*s*e;t.stiffness=l*c*c,t.damping=2*l*i*c},t.Log=function b2Log(t,...e){},t.MakeArray=b2MakeArray,t.MakeNullArray=function b2MakeNullArray(t){const e=new Array(t);for(let i=0;i<t;++i)e[i]=null;return e},t.MakeNumberArray=b2MakeNumberArray,t.Manifold=b2Manifold,t.ManifoldPoint=b2ManifoldPoint,t.MassData=b2MassData,t.Mat22=b2Mat22,t.Mat33=b2Mat33,t.Max=b2Max,t.Maybe=b2Maybe,t.Min=b2Min,t.MixFriction=b2MixFriction,t.MixRestitution=b2MixRestitution,t.MixRestitutionThreshold=b2MixRestitutionThreshold,t.MotorJoint=b2MotorJoint,t.MotorJointDef=class b2MotorJointDef extends b2JointDef{constructor(){super(t.JointType.e_motorJoint),this.linearOffset=new b2Vec2(0,0),this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);const i=this.bodyA.GetAngle(),n=this.bodyB.GetAngle();this.angularOffset=n-i}},t.MouseJoint=b2MouseJoint,t.MouseJointDef=class b2MouseJointDef extends b2JointDef{constructor(){super(t.JointType.e_mouseJoint),this.target=new b2Vec2,this.maxForce=0,this.stiffness=5,this.damping=.7}},t.NextPowerOfTwo=function b2NextPowerOfTwo(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)},t.Pair=b2Pair,t.ParseInt=function b2ParseInt(t){return parseInt(t,10)},t.ParseUInt=function b2ParseUInt(t){return Math.abs(parseInt(t,10))},t.ParticleBodyContact=b2ParticleBodyContact,t.ParticleContact=b2ParticleContact,t.ParticleDef=b2ParticleDef,t.ParticleGroup=b2ParticleGroup,t.ParticleGroupDef=b2ParticleGroupDef,t.ParticleHandle=b2ParticleHandle,t.ParticlePair=b2ParticlePair,t.ParticlePairSet=b2ParticlePairSet,t.ParticleSystem=b2ParticleSystem,t.ParticleSystemDef=b2ParticleSystemDef,t.ParticleSystem_CompositeShape=b2ParticleSystem_CompositeShape,t.ParticleSystem_ConnectionFilter=b2ParticleSystem_ConnectionFilter,t.ParticleSystem_DestroyParticlesInShapeCallback=b2ParticleSystem_DestroyParticlesInShapeCallback,t.ParticleSystem_FixedSetAllocator=b2ParticleSystem_FixedSetAllocator,t.ParticleSystem_FixtureParticle=class b2ParticleSystem_FixtureParticle{constructor(t,e){this.second=M,this.first=t,this.second=e}},t.ParticleSystem_FixtureParticleSet=b2ParticleSystem_FixtureParticleSet,t.ParticleSystem_InsideBoundsEnumerator=b2ParticleSystem_InsideBoundsEnumerator,t.ParticleSystem_JoinParticleGroupsFilter=b2ParticleSystem_JoinParticleGroupsFilter,t.ParticleSystem_ParticleListNode=b2ParticleSystem_ParticleListNode,t.ParticleSystem_ParticlePair=class b2ParticleSystem_ParticlePair{constructor(t,e){this.first=M,this.second=M,this.first=t,this.second=e}},t.ParticleSystem_Proxy=b2ParticleSystem_Proxy,t.ParticleSystem_ReactiveFilter=b2ParticleSystem_ReactiveFilter,t.ParticleSystem_SolveCollisionCallback=b2ParticleSystem_SolveCollisionCallback,t.ParticleSystem_UpdateBodyContactsCallback=b2ParticleSystem_UpdateBodyContactsCallback,t.ParticleSystem_UserOverridableBuffer=b2ParticleSystem_UserOverridableBuffer,t.ParticleTriad=b2ParticleTriad,t.PolygonAndCircleContact=b2PolygonAndCircleContact,t.PolygonContact=b2PolygonContact,t.PolygonShape=b2PolygonShape,t.Position=b2Position,t.PositionSolverManifold=b2PositionSolverManifold,t.Pow=W,t.PrismaticJoint=b2PrismaticJoint,t.PrismaticJointDef=class b2PrismaticJointDef extends b2JointDef{constructor(){super(t.JointType.e_prismaticJoint),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0}Initialize(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.Profile=b2Profile,t.PulleyJoint=b2PulleyJoint,t.PulleyJointDef=class b2PulleyJointDef extends b2JointDef{constructor(){super(t.JointType.e_pulleyJoint),this.groundAnchorA=new b2Vec2(-1,1),this.groundAnchorB=new b2Vec2(1,1),this.localAnchorA=new b2Vec2(-1,0),this.localAnchorB=new b2Vec2(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,e,i,n,r,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=b2Vec2.DistanceVV(r,i),this.lengthB=b2Vec2.DistanceVV(s,n),this.ratio=o}},t.QueryCallback=b2QueryCallback,t.RadToDeg=function b2RadToDeg(t){return t*k},t.Random=function b2Random(){return 2*Math.random()-1},t.RandomRange=function b2RandomRange(t,e){return(e-t)*Math.random()+t},t.RayCastCallback=b2RayCastCallback,t.RayCastInput=b2RayCastInput,t.RayCastOutput=b2RayCastOutput,t.RevoluteJoint=b2RevoluteJoint,t.RevoluteJointDef=class b2RevoluteJointDef extends b2JointDef{constructor(){super(t.JointType.e_revoluteJoint),this.localAnchorA=new b2Vec2(0,0),this.localAnchorB=new b2Vec2(0,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.Rope=class b2Rope{constructor(){this.m_position=new b2Vec2,this.m_count=0,this.m_stretchCount=0,this.m_bendCount=0,this.m_stretchConstraints=[],this.m_bendConstraints=[],this.m_bindPositions=[],this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_invMasses=[],this.m_gravity=new b2Vec2,this.m_tuning=new b2RopeTuning}Create(t){function make_array(t,e,i){for(let n=0;n<e;++n)t[n]=i(n)}this.m_position.Copy(t.position),this.m_count=t.count,make_array(this.m_bindPositions,this.m_count,()=>new b2Vec2),make_array(this.m_ps,this.m_count,()=>new b2Vec2),make_array(this.m_p0s,this.m_count,()=>new b2Vec2),make_array(this.m_vs,this.m_count,()=>new b2Vec2),make_array(this.m_invMasses,this.m_count,()=>0);for(let e=0;e<this.m_count;++e){this.m_bindPositions[e].Copy(t.vertices[e]),this.m_ps[e].Copy(t.vertices[e]).SelfAdd(this.m_position),this.m_p0s[e].Copy(t.vertices[e]).SelfAdd(this.m_position),this.m_vs[e].SetZero();const i=t.masses[e];this.m_invMasses[e]=i>0?1/i:0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,make_array(this.m_stretchConstraints,this.m_stretchCount,()=>new b2RopeStretch),make_array(this.m_bendConstraints,this.m_bendCount,()=>new b2RopeBend);for(let t=0;t<this.m_stretchCount;++t){const e=this.m_stretchConstraints[t],i=this.m_ps[t],n=this.m_ps[t+1];e.i1=t,e.i2=t+1,e.L=b2Vec2.DistanceVV(i,n),e.invMass1=this.m_invMasses[t],e.invMass2=this.m_invMasses[t+1],e.lambda=0,e.damper=0,e.spring=0}for(let t=0;t<this.m_bendCount;++t){const e=this.m_bendConstraints[t],i=this.m_ps[t],n=this.m_ps[t+1],r=this.m_ps[t+2];e.i1=t,e.i2=t+1,e.i3=t+2,e.invMass1=this.m_invMasses[t],e.invMass2=this.m_invMasses[t+1],e.invMass3=this.m_invMasses[t+2],e.invEffectiveMass=0,e.L1=b2Vec2.DistanceVV(i,n),e.L2=b2Vec2.DistanceVV(n,r),e.lambda=0;const s=b2Vec2.SubVV(n,i,new b2Vec2),o=b2Vec2.SubVV(r,n,new b2Vec2),a=s.LengthSquared(),l=o.LengthSquared();if(a*l==0)continue;const c=(new b2Vec2).Copy(s).SelfSkew().SelfMul(-1/a),h=(new b2Vec2).Copy(o).SelfSkew().SelfMul(1/l),u=c.Clone().SelfNeg(),d=c.Clone().SelfSub(h),m=h.Clone();e.invEffectiveMass=e.invMass1*b2Vec2.DotVV(u,u)+e.invMass2*b2Vec2.DotVV(d,d)+e.invMass3*b2Vec2.DotVV(m,m);const p=b2Vec2.SubVV(r,i,new b2Vec2),f=p.LengthSquared();0!==f&&(e.alpha1=b2Vec2.DotVV(o,p)/f,e.alpha2=b2Vec2.DotVV(s,p)/f)}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}SetTuning(t){this.m_tuning.Copy(t);const e=2*s*this.m_tuning.bendHertz;for(let t=0;t<this.m_bendCount;++t){const i=this.m_bendConstraints[t],n=i.L1*i.L1,r=i.L2*i.L2;if(n*r==0){i.spring=0,i.damper=0;continue}const s=1/i.L1+1/i.L2,o=i.invMass1/n+i.invMass2*s*s+i.invMass3/r;if(0===o){i.spring=0,i.damper=0;continue}const a=1/o;i.spring=a*e*e,i.damper=2*a*this.m_tuning.bendDamping*e}const i=2*s*this.m_tuning.stretchHertz;for(let t=0;t<this.m_stretchCount;++t){const e=this.m_stretchConstraints[t],n=e.invMass1+e.invMass2;if(0===n)continue;const r=1/n;e.spring=r*i*i,e.damper=2*r*this.m_tuning.stretchDamping*i}}Step(e,i,n){if(0===e)return;const r=1/e,s=Math.exp(-e*this.m_tuning.damping);for(let t=0;t<this.m_count;++t)this.m_invMasses[t]>0?(this.m_vs[t].x*=s,this.m_vs[t].y*=s,this.m_vs[t].x+=e*this.m_gravity.x,this.m_vs[t].y+=e*this.m_gravity.y):(this.m_vs[t].x=r*(this.m_bindPositions[t].x+n.x-this.m_p0s[t].x),this.m_vs[t].y=r*(this.m_bindPositions[t].y+n.y-this.m_p0s[t].y));this.m_tuning.bendingModel===t.BendingModel.b2_springAngleBendingModel&&this.ApplyBendForces(e);for(let t=0;t<this.m_bendCount;++t)this.m_bendConstraints[t].lambda=0;for(let t=0;t<this.m_stretchCount;++t)this.m_stretchConstraints[t].lambda=0;for(let t=0;t<this.m_count;++t)this.m_ps[t].x+=e*this.m_vs[t].x,this.m_ps[t].y+=e*this.m_vs[t].y;for(let n=0;n<i;++n)this.m_tuning.bendingModel===t.BendingModel.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===t.BendingModel.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(e):this.m_tuning.bendingModel===t.BendingModel.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===t.BendingModel.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===t.BendingModel.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===t.StretchingModel.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===t.StretchingModel.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(e);for(let t=0;t<this.m_count;++t)this.m_vs[t].x=r*(this.m_ps[t].x-this.m_p0s[t].x),this.m_vs[t].y=r*(this.m_ps[t].y-this.m_p0s[t].y),this.m_p0s[t].Copy(this.m_ps[t])}Reset(t){this.m_position.Copy(t);for(let t=0;t<this.m_count;++t)this.m_ps[t].x=this.m_bindPositions[t].x+this.m_position.x,this.m_ps[t].y=this.m_bindPositions[t].y+this.m_position.y,this.m_p0s[t].x=this.m_bindPositions[t].x+this.m_position.x,this.m_p0s[t].y=this.m_bindPositions[t].y+this.m_position.y,this.m_vs[t].SetZero();for(let t=0;t<this.m_bendCount;++t)this.m_bendConstraints[t].lambda=0;for(let t=0;t<this.m_stretchCount;++t)this.m_stretchConstraints[t].lambda=0}Draw(t){const e=new b2Color(.4,.5,.7),i=new b2Color(.1,.8,.1),n=new b2Color(.7,.2,.4);for(let r=0;r<this.m_count-1;++r){t.DrawSegment(this.m_ps[r],this.m_ps[r+1],e);const s=this.m_invMasses[r]>0?n:i;t.DrawPoint(this.m_ps[r],5,s)}const r=this.m_invMasses[this.m_count-1]>0?n:i;t.DrawPoint(this.m_ps[this.m_count-1],5,r)}SolveStretch_PBD(){const t=this.m_tuning.stretchStiffness;for(let e=0;e<this.m_stretchCount;++e){const i=this.m_stretchConstraints[e],n=this.m_ps[i.i1].Clone(),r=this.m_ps[i.i2].Clone(),s=r.Clone().SelfSub(n),o=s.Normalize(),a=i.invMass1+i.invMass2;if(0===a)continue;const l=i.invMass1/a,c=i.invMass2/a;n.x-=t*l*(i.L-o)*s.x,n.y-=t*l*(i.L-o)*s.y,r.x+=t*c*(i.L-o)*s.x,r.y+=t*c*(i.L-o)*s.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r)}}SolveStretch_XPBD(t){for(let e=0;e<this.m_stretchCount;++e){const i=this.m_stretchConstraints[e],n=this.m_ps[i.i1].Clone(),r=this.m_ps[i.i2].Clone(),s=n.Clone().SelfSub(this.m_p0s[i.i1]),o=r.Clone().SelfSub(this.m_p0s[i.i2]),a=r.Clone().SelfSub(n),l=a.Normalize(),c=a.Clone().SelfNeg(),h=a,u=i.invMass1+i.invMass2;if(0===u)continue;const d=1/(i.spring*t*t),m=t*t*i.damper,p=d*m/t,f=l-i.L,_=b2Vec2.DotVV(c,s)+b2Vec2.DotVV(h,o),g=f+d*i.lambda+p*_,b=(1+p)*u+d,y=-g/b;n.x+=i.invMass1*y*c.x,n.y+=i.invMass1*y*c.y,r.x+=i.invMass2*y*h.x,r.y+=i.invMass2*y*h.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r),i.lambda+=y}}SolveBend_PBD_Angle(){const t=this.m_tuning.bendStiffness;for(let e=0;e<this.m_bendCount;++e){const i=this.m_bendConstraints[e],n=this.m_ps[i.i1],r=this.m_ps[i.i2],s=this.m_ps[i.i3],o=r.Clone().SelfSub(n),a=s.Clone().SelfSub(r),l=b2Vec2.CrossVV(o,a),c=b2Vec2.DotVV(o,a),h=X(l,c);let u=0,d=0;if(this.m_tuning.isometric?(u=i.L1*i.L1,d=i.L2*i.L2):(u=o.LengthSquared(),d=a.LengthSquared()),u*d==0)continue;const m=(new b2Vec2).Copy(o).SelfSkew().SelfMul(-1/u),p=(new b2Vec2).Copy(a).SelfSkew().SelfMul(1/d),f=m.Clone().SelfNeg(),_=m.Clone().SelfSub(p),g=p;let b=0;0===(b=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*b2Vec2.DotVV(f,f)+i.invMass2*b2Vec2.DotVV(_,_)+i.invMass3*b2Vec2.DotVV(g,g))&&(b=i.invEffectiveMass);const y=-t*h/b;n.x+=i.invMass1*y*f.x,n.y+=i.invMass1*y*f.y,r.x+=i.invMass2*y*_.x,r.y+=i.invMass2*y*_.y,s.x+=i.invMass3*y*g.x,s.y+=i.invMass3*y*g.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r),this.m_ps[i.i3].Copy(s)}}SolveBend_XPBD_Angle(t){for(let e=0;e<this.m_bendCount;++e){const i=this.m_bendConstraints[e],n=this.m_ps[i.i1],r=this.m_ps[i.i2],s=this.m_ps[i.i3],o=n.Clone().SelfSub(this.m_p0s[i.i1]),a=r.Clone().SelfSub(this.m_p0s[i.i2]),l=s.Clone().SelfSub(this.m_p0s[i.i3]),c=r.Clone().SelfSub(n),h=s.Clone().SelfSub(r);let u,d;if(this.m_tuning.isometric?(u=i.L1*i.L1,d=i.L2*i.L2):(u=c.LengthSquared(),d=h.LengthSquared()),u*d==0)continue;const m=b2Vec2.CrossVV(c,h),p=b2Vec2.DotVV(c,h),f=X(m,p),_=(new b2Vec2).Copy(c).SelfSkew().SelfMul(-1/u),g=(new b2Vec2).Copy(h).SelfSkew().SelfMul(1/d),b=_.Clone().SelfNeg(),y=_.Clone().SelfSub(g),x=g;let v;if(0===(v=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*b2Vec2.DotVV(b,b)+i.invMass2*b2Vec2.DotVV(y,y)+i.invMass3*b2Vec2.DotVV(x,x)))continue;const S=1/(i.spring*t*t),w=t*t*i.damper,M=S*w/t,A=f,V=b2Vec2.DotVV(b,o)+b2Vec2.DotVV(y,a)+b2Vec2.DotVV(x,l),C=A+S*i.lambda+M*V,T=(1+M)*v+S,B=-C/T;n.x+=i.invMass1*B*b.x,n.y+=i.invMass1*B*b.y,r.x+=i.invMass2*B*y.x,r.y+=i.invMass2*B*y.y,s.x+=i.invMass3*B*x.x,s.y+=i.invMass3*B*x.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r),this.m_ps[i.i3].Copy(s),i.lambda+=B}}SolveBend_PBD_Distance(){const t=this.m_tuning.bendStiffness;for(let e=0;e<this.m_bendCount;++e){const i=this.m_bendConstraints[e],n=i.i1,r=i.i3,s=this.m_ps[n].Clone(),o=this.m_ps[r].Clone(),a=o.Clone().SelfSub(s),l=a.Normalize(),c=i.invMass1+i.invMass3;if(0===c)continue;const h=i.invMass1/c,u=i.invMass3/c;s.x-=t*h*(i.L1+i.L2-l)*a.x,s.y-=t*h*(i.L1+i.L2-l)*a.y,o.x+=t*u*(i.L1+i.L2-l)*a.x,o.y+=t*u*(i.L1+i.L2-l)*a.y,this.m_ps[n].Copy(s),this.m_ps[r].Copy(o)}}SolveBend_PBD_Height(){const t=this.m_tuning.bendStiffness;for(let e=0;e<this.m_bendCount;++e){const i=this.m_bendConstraints[e],n=this.m_ps[i.i1].Clone(),r=this.m_ps[i.i2].Clone(),s=this.m_ps[i.i3].Clone(),o=new b2Vec2;o.x=i.alpha1*n.x+i.alpha2*s.x-r.x,o.y=i.alpha1*n.y+i.alpha2*s.y-r.y;const a=o.Length();if(0===a)continue;const l=o.Clone().SelfMul(1/a),c=l.Clone().SelfMul(i.alpha1),h=l.Clone().SelfNeg(),u=l.Clone().SelfMul(i.alpha2),d=i.invMass1*i.alpha1*i.alpha1+i.invMass2+i.invMass3*i.alpha2*i.alpha2;if(0===d)continue;const m=a,p=1/d,f=-t*p*m;n.x+=i.invMass1*f*c.x,n.y+=i.invMass1*f*c.y,r.x+=i.invMass2*f*h.x,r.y+=i.invMass2*f*h.y,s.x+=i.invMass3*f*u.x,s.y+=i.invMass3*f*u.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r),this.m_ps[i.i3].Copy(s)}}SolveBend_PBD_Triangle(){const t=this.m_tuning.bendStiffness;for(let e=0;e<this.m_bendCount;++e){const i=this.m_bendConstraints[e],n=this.m_ps[i.i1].Clone(),r=this.m_ps[i.i2].Clone(),s=this.m_ps[i.i3].Clone(),o=i.invMass1,a=i.invMass2,l=i.invMass3,c=o+l+2*a,h=t/c,u=new b2Vec2;u.x=r.x-1/3*(n.x+r.x+s.x),u.y=r.y-1/3*(n.y+r.y+s.y);const d=new b2Vec2;d.x=2*o*h*u.x,d.y=2*o*h*u.y;const m=new b2Vec2;m.x=-4*a*h*u.x,m.y=-4*a*h*u.y;const p=new b2Vec2;p.x=2*l*h*u.x,p.y=2*l*h*u.y,n.SelfAdd(d),r.SelfAdd(m),s.SelfAdd(p),this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(r),this.m_ps[i.i3].Copy(s)}}ApplyBendForces(t){const e=2*s*this.m_tuning.bendHertz;for(let i=0;i<this.m_bendCount;++i){const n=this.m_bendConstraints[i],r=this.m_ps[n.i1].Clone(),s=this.m_ps[n.i2].Clone(),o=this.m_ps[n.i3].Clone(),a=this.m_vs[n.i1],l=this.m_vs[n.i2],c=this.m_vs[n.i3],h=r.Clone().SelfSub(r),u=o.Clone().SelfSub(s);let d,m;if(this.m_tuning.isometric?(d=n.L1*n.L1,m=n.L2*n.L2):(d=h.LengthSquared(),m=u.LengthSquared()),d*m==0)continue;const p=b2Vec2.CrossVV(h,u),f=b2Vec2.DotVV(h,u),_=X(p,f),g=(new b2Vec2).Copy(h).SelfSkew().SelfMul(-1/d),b=(new b2Vec2).Copy(u).SelfSkew().SelfMul(1/m),y=g.Clone().SelfNeg(),x=g.Clone().SelfSub(b),v=b;let S=0;if(0===(S=this.m_tuning.fixedEffectiveMass?n.invEffectiveMass:n.invMass1*b2Vec2.DotVV(y,y)+n.invMass2*b2Vec2.DotVV(x,x)+n.invMass3*b2Vec2.DotVV(v,v)))continue;const w=1/S,M=w*e*e,A=2*w*this.m_tuning.bendDamping*e,V=_,C=b2Vec2.DotVV(y,a)+b2Vec2.DotVV(x,l)+b2Vec2.DotVV(v,c),T=-t*(M*V+A*C);this.m_vs[n.i1].x+=n.invMass1*T*y.x,this.m_vs[n.i1].y+=n.invMass1*T*y.y,this.m_vs[n.i2].x+=n.invMass2*T*x.x,this.m_vs[n.i2].y+=n.invMass2*T*x.y,this.m_vs[n.i3].x+=n.invMass3*T*v.x,this.m_vs[n.i3].y+=n.invMass3*T*v.y}}},t.RopeDef=class b2RopeDef{constructor(){this.position=new b2Vec2,this.vertices=[],this.count=0,this.masses=[],this.gravity=new b2Vec2,this.tuning=new b2RopeTuning}},t.RopeTuning=b2RopeTuning,t.Rot=b2Rot,t.SeparationFunction=b2SeparationFunction,t.Shape=b2Shape,t.ShapeCast=function b2ShapeCast(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();const i=e.proxyA,n=e.proxyB,r=b2Max(i.m_radius,m),s=b2Max(n.m_radius,m),o=r+s,a=e.transformA,l=e.transformB,c=e.translationB,h=rt.Set(0,0);let d=0;const p=st;p.m_count=0;const f=p.m_vertices;let _=i.GetSupport(b2Rot.MulTRV(a.q,b2Vec2.NegV(c,b2Vec2.s_t1),b2Vec2.s_t0)),g=b2Transform.MulXV(a,i.GetVertex(_),ot),b=n.GetSupport(b2Rot.MulTRV(l.q,c,b2Vec2.s_t0)),y=b2Transform.MulXV(l,n.GetVertex(b),at);const x=b2Vec2.SubVV(g,y,lt),v=b2Max(m,o-m),S=.5*u;let w=0;for(;w<20&&x.Length()-v>S;){t.iterations+=1,_=i.GetSupport(b2Rot.MulTRV(a.q,b2Vec2.NegV(x,b2Vec2.s_t1),b2Vec2.s_t0)),g=b2Transform.MulXV(a,i.GetVertex(_),ot),b=n.GetSupport(b2Rot.MulTRV(l.q,x,b2Vec2.s_t0)),y=b2Transform.MulXV(l,n.GetVertex(b),at);const e=b2Vec2.SubVV(g,y,ct);x.Normalize();const r=b2Vec2.DotVV(x,e),s=b2Vec2.DotVV(x,c);if(r-v>d*s){if(s<=0)return!1;if((d=(r-v)/s)>1)return!1;h.Copy(x).SelfNeg(),p.m_count=0}const o=f[p.m_count];switch(o.indexA=b,o.wA.Copy(y).SelfMulAdd(d,c),o.indexB=_,o.wB.Copy(g),o.w.Copy(o.wB).SelfSub(o.wA),o.a=1,p.m_count+=1,p.m_count){case 1:break;case 2:p.Solve2();break;case 3:p.Solve3()}if(3===p.m_count)return!1;p.GetClosestPoint(x),++w}if(0===w)return!1;const M=ht,A=ut;return p.GetWitnessPoints(M,A),x.LengthSquared()>0&&(h.Copy(x).SelfNeg(),h.Normalize()),t.normal.Copy(h),t.lambda=d,t.iterations=w,!0},t.ShapeCastInput=class b2ShapeCastInput{constructor(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.transformA=new b2Transform,this.transformB=new b2Transform,this.translationB=new b2Vec2}},t.ShapeCastOutput=class b2ShapeCastOutput{constructor(){this.point=new b2Vec2,this.normal=new b2Vec2,this.lambda=0,this.iterations=0}},t.Simplex=b2Simplex,t.SimplexCache=b2SimplexCache,t.SimplexVertex=b2SimplexVertex,t.Sin=j,t.SolverData=b2SolverData,t.Sq=b2Sq,t.Sqrt=z,t.StackAllocator=class b2StackAllocator{},t.StackQueue=b2StackQueue,t.Swap=function b2Swap(t,e){const i=t[0];t[0]=e[0],e[0]=i},t.Sweep=b2Sweep,t.TOIInput=b2TOIInput,t.TOIOutput=b2TOIOutput,t.TensorDampingController=b2TensorDampingController,t.TestOverlapAABB=b2TestOverlapAABB,t.TestOverlapShape=b2TestOverlapShape,t.TimeOfImpact=b2TimeOfImpact,t.TimeStep=b2TimeStep,t.Timer=b2Timer,t.Transform=b2Transform,t.TreeNode=b2TreeNode,t.Vec2=b2Vec2,t.Vec2_zero=Y,t.Vec3=b2Vec3,t.Velocity=b2Velocity,t.VelocityConstraintPoint=b2VelocityConstraintPoint,t.Version=b2Version,t.VoronoiDiagram=b2VoronoiDiagram,t.VoronoiDiagram_Generator=b2VoronoiDiagram_Generator,t.VoronoiDiagram_Task=b2VoronoiDiagram_Task,t.WeldJoint=b2WeldJoint,t.WeldJointDef=class b2WeldJointDef extends b2JointDef{constructor(){super(t.JointType.e_weldJoint),this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.referenceAngle=0,this.stiffness=0,this.damping=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.WheelJoint=b2WheelJoint,t.WheelJointDef=class b2WheelJointDef extends b2JointDef{constructor(){super(t.JointType.e_wheelJoint),this.localAnchorA=new b2Vec2(0,0),this.localAnchorB=new b2Vec2(0,0),this.localAxisA=new b2Vec2(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.stiffness=0,this.damping=0}Initialize(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)}},t.World=b2World,t.WorldManifold=b2WorldManifold,t._180_over_pi=k,t._pi_over_180=F,t.aabbExtension=c,t.aabbMultiplier=h,t.angularSleepTolerance=D,t.angularSlop=d,t.barrierCollisionTime=L,t.baumgarte=S,t.branch="master",t.commit="9ebbbcd960ad424e03e5de6e66a40764c16f51bc",t.dynamicBody=Oe,t.epsilon=n,t.epsilon_sq=r,t.get_g_blockSolve=function get_g_blockSolve(){return t.blockSolve},t.gjk_reset=function b2_gjk_reset(){t.gjkCalls=0,t.gjkIters=0,t.gjkMaxIters=0},t.invalidParticleIndex=M,t.kinematicBody=ke,t.lengthUnitsPerMeter=o,t.linearSleepTolerance=I,t.linearSlop=u,t.maxAngularCorrection=g,t.maxFloat=i,t.maxLinearCorrection=_,t.maxManifoldPoints=l,t.maxParticleForce=T,t.maxParticleIndex=2147483647,t.maxParticlePressure=C,t.maxPolygonVertices=a,t.maxRotation=x,t.maxRotationSquared=v,t.maxSubSteps=p,t.maxTOIContacts=f,t.maxTranslation=b,t.maxTranslationSquared=y,t.maxTriadDistance=B,t.maxTriadDistanceSquared=P,t.minParticleSystemBufferCapacity=E,t.minParticleWeight=V,t.minPulleyLength=2,t.particleStride=A,t.pbdAngleBendingModel=Ue,t.pbdDistanceBendingModel=We,t.pbdHeightBendingModel=He,t.pbdStretchingModel=Je,t.pbdTriangleBendingModel=je,t.pi=s,t.polygonRadius=m,t.set_g_blockSolve=function set_g_blockSolve(e){t.blockSolve=e},t.springAngleBendingModel=Ne,t.staticBody=Fe,t.timeToSleep=R,t.toiBaumgarte=w,t.toi_reset=function b2_toi_reset(){t.toiTime=0,t.toiMaxTime=0,t.toiCalls=0,t.toiIters=0,t.toiMaxIters=0,t.toiRootIters=0,t.toiMaxRootIters=0},t.two_pi=O,t.version=G,t.xpbdAngleBendingModel=ze,t.xpbdStretchingModel=qe,Object.defineProperty(t,"__esModule",{value:!0})}(e)},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.d(e,"a",function(){return GLTFLoader});var n=i(0);class GLTFLoader extends n.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new GLTFMaterialsClearcoatExtension(t)}),this.register(function(t){return new GLTFTextureBasisUExtension(t)}),this.register(function(t){return new GLTFTextureWebPExtension(t)}),this.register(function(t){return new GLTFMaterialsTransmissionExtension(t)}),this.register(function(t){return new GLTFMaterialsVolumeExtension(t)}),this.register(function(t){return new GLTFMaterialsIorExtension(t)}),this.register(function(t){return new GLTFMaterialsSpecularExtension(t)}),this.register(function(t){return new GLTFLightsExtension(t)}),this.register(function(t){return new GLTFMeshoptCompression(t)})}load(t,e,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){r?r(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},l=new n.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(i){try{s.parse(i,o,function(i){e(i),s.manager.itemEnd(t)},a)}catch(t){a(t)}},i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,o){let a;const l={},c={};if("string"==typeof t)a=t;else{if(n.LoaderUtils.decodeText(new Uint8Array(t,0,4))===s){try{l[r.KHR_BINARY_GLTF]=new GLTFBinaryExtension(t)}catch(t){return void(o&&o(t))}a=l[r.KHR_BINARY_GLTF].content}else a=n.LoaderUtils.decodeText(new Uint8Array(t))}const h=JSON.parse(a);if(void 0===h.asset||h.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=new GLTFParser(h,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](u);c[e.name]=e,l[e.name]=!0}if(h.extensionsUsed)for(let t=0;t<h.extensionsUsed.length;++t){const e=h.extensionsUsed[t],i=h.extensionsRequired||[];switch(e){case r.KHR_MATERIALS_UNLIT:l[e]=new GLTFMaterialsUnlitExtension;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[e]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case r.KHR_DRACO_MESH_COMPRESSION:l[e]=new GLTFDracoMeshCompressionExtension(h,this.dracoLoader);break;case r.KHR_TEXTURE_TRANSFORM:l[e]=new GLTFTextureTransformExtension;break;case r.KHR_MESH_QUANTIZATION:l[e]=new GLTFMeshQuantizationExtension;break;default:i.indexOf(e)>=0&&void 0===c[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}u.setExtensions(l),u.setPlugins(c),u.parse(i,o)}}function GLTFRegistry(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class GLTFLightsExtension{constructor(t){this.parser=t,this.name=r.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let r=e.cache.get(i);if(r)return r;const s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let a;const l=new n.Color(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":(a=new n.DirectionalLight(l)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new n.PointLight(l)).distance=c;break;case"spot":(a=new n.SpotLight(l)).distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+t),r=Promise.resolve(a),e.cache.add(i,r),r}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(t){return i._getNodeRef(e.cache,r,t)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=r.KHR_MATERIALS_UNLIT}getMaterialType(){return n.MeshBasicMaterial}extendParams(t,e,i){const r=[];t.color=new n.Color(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(r)}}class GLTFMaterialsClearcoatExtension{constructor(t){this.parser=t,this.name=r.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new n.Vector2(t,t)}return Promise.all(s)}}class GLTFMaterialsTransmissionExtension{constructor(t){this.parser=t,this.name=r.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(i.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class GLTFMaterialsVolumeExtension{constructor(t){this.parser=t,this.name=r.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return e.attenuationTint=new n.Color(a[0],a[1],a[2]),Promise.all(s)}}class GLTFMaterialsIorExtension{constructor(t){this.parser=t,this.name=r.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(t){this.parser=t,this.name=r.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularTint=new n.Color(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(e,"specularTintMap",o.specularColorTexture).then(function(t){t.encoding=n.sRGBEncoding})),Promise.all(s)}}class GLTFTextureBasisUExtension{constructor(t){this.parser=t,this.name=r.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],s=i.images[r.source],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,o)}}class GLTFTextureWebPExtension{constructor(t){this.parser=t,this.name=r.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,r=n.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=n.images[s.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then(function(r){if(r)return i.loadTextureImage(t,o,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(t){this.name=r.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,r.ready]).then(function(e){const i=t.byteOffset||0,n=t.byteLength||0,s=t.count,o=t.byteStride,a=new ArrayBuffer(s*o),l=new Uint8Array(e[0],i,n);return r.decodeGltfBuffer(new Uint8Array(a),s,o,l,t.mode,t.filter),a})}return null}}const s="glTF",o=12,a={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(t){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,o);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-o,l=new DataView(t,o);let c=0;for(;c<i;){const e=l.getUint32(c,!0);c+=4;const i=l.getUint32(c,!0);if(c+=4,i===a.JSON){const i=new Uint8Array(t,o+c,e);this.content=n.LoaderUtils.decodeText(i)}else if(i===a.BIN){const i=o+c;this.body=t.slice(i,i+e)}c+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const t in s){const e=p[t]||t.toLowerCase();o[e]=s[t]}for(const e in t.attributes){const n=p[e]||e.toLowerCase();if(void 0!==s[e]){const r=i.accessors[t.attributes[e]],s=h[r.componentType];l[n]=s,a[n]=!0===r.normalized}}return e.getDependency("bufferView",r).then(function(t){return new Promise(function(e){n.decodeDracoFile(t,function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)},o,l)})})}}class GLTFTextureTransformExtension{constructor(){this.name=r.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale?t:(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t)}}class GLTFMeshStandardSGMaterial extends n.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new n.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class GLTFMaterialsPbrSpecularGlossinessExtension{constructor(){this.name=r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return GLTFMeshStandardSGMaterial}extendParams(t,e,i){const r=e.extensions[this.name];t.color=new n.Color(1,1,1),t.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const e=r.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==r.diffuseTexture&&s.push(i.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new n.Color(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new n.Color(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const e=r.specularGlossinessTexture;s.push(i.assignTexture(t,"glossinessMap",e)),s.push(i.assignTexture(t,"specularMap",e))}return Promise.all(s)}createMaterial(t){const e=new GLTFMeshStandardSGMaterial(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=n.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class GLTFMeshQuantizationExtension{constructor(){this.name=r.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends n.Interpolant{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[r+t];return e}}GLTFCubicSplineInterpolant.prototype.beforeStart_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.afterEnd_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.interpolate_=function(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=n-e,h=(i-e)/c,u=h*h,d=u*h,m=t*l,p=m-l,f=-2*d+3*u,_=d-u,g=1-f,b=_-u+h;for(let t=0;t!==o;t++){const e=s[p+t+o],i=s[p+t+a]*c,n=s[m+t+o],l=s[m+t]*c;r[t]=g*e+b*i+f*n+_*l}return r};const l=new n.Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(t,e,i,n){const r=super.interpolate_(t,e,i,n);return l.fromArray(r).normalize().toArray(r),r}}const c={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},h={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipmapNearestFilter,9985:n.LinearMipmapNearestFilter,9986:n.NearestMipmapLinearFilter,9987:n.LinearMipmapLinearFilter},d={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},p={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},f={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_={CUBICSPLINE:void 0,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},g={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t)}function addUnknownExtensionsToUserData(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function assignExtrasToUserData(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function updateMorphTargets(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(t){const e=t.extensions&&t.extensions[r.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+createAttributesKey(e.attributes):t.indices+":"+createAttributesKey(t.attributes)+":"+t.mode}function createAttributesKey(t){let e="";const i=Object.keys(t).sort();for(let n=0,r=i.length;n<r;n++)e+=i[n]+":"+t[i[n]]+";";return e}function getNormalizedComponentScale(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class GLTFParser{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new n.ImageBitmapLoader(this.options.manager):this.textureLoader=new n.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(e){const s={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};addUnknownExtensionsToUserData(r,s,n),assignExtrasToUserData(s,n),Promise.all(i._invokeAll(function(t){return t.afterRoot&&t.afterRoot(s)})).then(function(){t(s)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),r=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())r(n,e.children[i])};return r(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const r=t(e[n]);r&&i.push(r)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case"texture":n=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case"skin":n=this.loadSkin(e);break;case"animation":n=this.loadAnimation(e);break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map(function(e,n){return i.getDependency(t,n)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(t,r){i.load(resolveURL(e.uri,n.path),t,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)})}loadAccessor(t){const e=this,i=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(t){const s=t[0],o=m[r.type],a=h[r.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,u=r.byteOffset||0,d=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;let f,_;if(d&&d!==c){const t=Math.floor(u/d),i="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+t+":"+r.count;let c=e.cache.get(i);c||(f=new a(s,t*d,r.count*d/l),c=new n.InterleavedBuffer(f,d/l),e.cache.add(i,c)),_=new n.InterleavedBufferAttribute(c,o,u%d/l,p)}else f=null===s?new a(r.count*o):new a(s,u,r.count*o),_=new n.BufferAttribute(f,o,p);if(void 0!==r.sparse){const e=m.SCALAR,i=h[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,u=new i(t[1],l,r.sparse.count*e),d=new a(t[2],c,r.sparse.count*o);null!==s&&(_=new n.BufferAttribute(_.array.slice(),_.itemSize,_.normalized));for(let t=0,e=u.length;t<e;t++){const e=u[t];if(_.setX(e,d[t*o]),o>=2&&_.setY(e,d[t*o+1]),o>=3&&_.setZ(e,d[t*o+2]),o>=4&&_.setW(e,d[t*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _})}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t],r=e.images[n.source];let s=this.textureLoader;if(r.uri){const t=i.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,r,s)}loadTextureImage(t,e,i){const r=this,s=this.json,o=this.options,a=s.textures[t],l=(e.uri||e.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let h=e.uri||"",m=!1;if(void 0!==e.bufferView)h=r.getDependency("bufferView",e.bufferView).then(function(t){m=!0;const i=new Blob([t],{type:e.mimeType});return h=c.createObjectURL(i)});else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const p=Promise.resolve(h).then(function(t){return new Promise(function(e,r){let s=e;!0===i.isImageBitmapLoader&&(s=function(t){const i=new n.Texture(t);i.needsUpdate=!0,e(i)}),i.load(resolveURL(t,o.path),s,void 0,r)})}).then(function(e){!0===m&&c.revokeObjectURL(h),e.flipY=!1,a.name&&(e.name=a.name);const i=(s.samplers||{})[a.sampler]||{};return e.magFilter=u[i.magFilter]||n.LinearFilter,e.minFilter=u[i.minFilter]||n.LinearMipmapLinearFilter,e.wrapS=d[i.wrapS]||n.RepeatWrapping,e.wrapT=d[i.wrapT]||n.RepeatWrapping,r.associations.set(e,{textures:t}),e}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[l]=p,p}assignTexture(t,e,i){const n=this;return this.getDependency("texture",i.index).then(function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),n.extensions[r.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(s);s=n.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),n.associations.set(s,e)}}return t[e]=s,s})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const r=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,o=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new n.PointsMaterial,n.Material.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new n.LineBasicMaterial,n.Material.prototype.copy.call(e,i),e.color.copy(i.color),this.cache.add(t,e)),i=e}if(r||s||o){let t="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),r&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),o&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),o&&(e.flatShading=!0),r&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}i.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=i}getMaterialType(){return n.MeshStandardMaterial}loadMaterial(t){const e=this,i=this.json,s=this.extensions,o=i.materials[t];let a;const l={},c=o.extensions||{},h=[];if(c[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=t.getMaterialType(),h.push(t.extendParams(l,o,e))}else if(c[r.KHR_MATERIALS_UNLIT]){const t=s[r.KHR_MATERIALS_UNLIT];a=t.getMaterialType(),h.push(t.extendParams(l,o,e))}else{const i=o.pbrMetallicRoughness||{};if(l.color=new n.Color(1,1,1),l.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;l.color.fromArray(t),l.opacity=t[3]}void 0!==i.baseColorTexture&&h.push(e.assignTexture(l,"map",i.baseColorTexture)),l.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,l.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(h.push(e.assignTexture(l,"metalnessMap",i.metallicRoughnessTexture)),h.push(e.assignTexture(l,"roughnessMap",i.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),h.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,l)})))}!0===o.doubleSided&&(l.side=n.DoubleSide);const u=o.alphaMode||g.OPAQUE;if(u===g.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.format=n.RGBFormat,l.transparent=!1,u===g.MASK&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&a!==n.MeshBasicMaterial&&(h.push(e.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new n.Vector2(1,1),void 0!==o.normalTexture.scale)){const t=o.normalTexture.scale;l.normalScale.set(t,t)}return void 0!==o.occlusionTexture&&a!==n.MeshBasicMaterial&&(h.push(e.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&a!==n.MeshBasicMaterial&&(l.emissive=(new n.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&a!==n.MeshBasicMaterial&&h.push(e.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(h).then(function(){let i;return i=a===GLTFMeshStandardSGMaterial?s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new a(l),o.name&&(i.name=o.name),i.map&&(i.map.encoding=n.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=n.sRGBEncoding),assignExtrasToUserData(i,o),e.associations.set(i,{materials:t}),o.extensions&&addUnknownExtensionsToUserData(s,i,o),i})}createUniqueName(t){const e=n.PropertyBinding.sanitizeNodeName(t||"");let i=e;for(let t=1;this.nodeNamesUsed[i];++t)i=e+"_"+t;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function createDracoPrimitive(t){return i[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then(function(i){return addPrimitiveAttributes(i,t,e)})}const o=[];for(let i=0,a=t.length;i<a;i++){const a=t[i],l=createPrimitiveKey(a),c=s[l];if(c)o.push(c.promise);else{let t;t=a.extensions&&a.extensions[r.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(a):addPrimitiveAttributes(new n.BufferGeometry,a,e),s[l]={primitive:a,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(t){const e=this,i=this.json,r=this.extensions,s=i.meshes[t],o=s.primitives,a=[];for(let t=0,e=o.length;t<e;t++){const e=void 0===o[t].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new n.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[t].material);a.push(e)}var l;return a.push(e.loadGeometries(o)),Promise.all(a).then(function(i){const a=i.slice(0,i.length-1),l=i[i.length-1],h=[];for(let i=0,u=l.length;i<u;i++){const u=l[i],d=o[i];let m;const p=a[i];if(d.mode===c.TRIANGLES||d.mode===c.TRIANGLE_STRIP||d.mode===c.TRIANGLE_FAN||void 0===d.mode)!0!==(m=!0===s.isSkinnedMesh?new n.SkinnedMesh(u,p):new n.Mesh(u,p)).isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),d.mode===c.TRIANGLE_STRIP?m.geometry=toTrianglesDrawMode(m.geometry,n.TriangleStripDrawMode):d.mode===c.TRIANGLE_FAN&&(m.geometry=toTrianglesDrawMode(m.geometry,n.TriangleFanDrawMode));else if(d.mode===c.LINES)m=new n.LineSegments(u,p);else if(d.mode===c.LINE_STRIP)m=new n.Line(u,p);else if(d.mode===c.LINE_LOOP)m=new n.LineLoop(u,p);else{if(d.mode!==c.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);m=new n.Points(u,p)}Object.keys(m.geometry.morphAttributes).length>0&&updateMorphTargets(m,s),m.name=e.createUniqueName(s.name||"mesh_"+t),assignExtrasToUserData(m,s),d.extensions&&addUnknownExtensionsToUserData(r,m,d),e.assignFinalMaterial(m),h.push(m)}for(let i=0,n=h.length;i<n;i++)e.associations.set(h[i],{meshes:t,primitives:i});if(1===h.length)return h[0];const u=new n.Group;e.associations.set(u,{meshes:t});for(let t=0,e=h.length;t<e;t++)u.add(h[t]);return u})}loadCamera(t){let e;const i=this.json.cameras[t],r=i[i.type];if(r)return"perspective"===i.type?e=new n.PerspectiveCamera(n.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(e=new n.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),assignExtrasToUserData(e,i),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],i={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return i.inverseBindMatrices=t,i})}loadAnimation(t){const e=this.json.animations[t],i=[],r=[],s=[],o=[],a=[];for(let t=0,n=e.channels.length;t<n;t++){const n=e.channels[t],l=e.samplers[n.sampler],c=n.target,h=void 0!==c.node?c.node:c.id,u=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;i.push(this.getDependency("node",h)),r.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",d)),o.push(l),a.push(c)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a)]).then(function(i){const r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=[];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=s[t],h=o[t],u=a[t],d=l[t];if(void 0===e)continue;let m;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,f[d.path]){case f.weights:m=n.NumberKeyframeTrack;break;case f.rotation:m=n.QuaternionKeyframeTrack;break;case f.position:case f.scale:default:m=n.VectorKeyframeTrack}const p=e.name?e.name:e.uuid,g=void 0!==u.interpolation?_[u.interpolation]:n.InterpolateLinear,b=[];f[d.path]===f.weights?e.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name?t.name:t.uuid)}):b.push(p);let y=h.array;if(h.normalized){const t=getNormalizedComponentScale(y.constructor),e=new Float32Array(y.length);for(let i=0,n=y.length;i<n;i++)e[i]=y[i]*t;y=e}for(let t=0,e=b.length;t<e;t++){const e=new m(b[t]+"."+f[d.path],i.array,y,g);"CUBICSPLINE"===u.interpolation&&(e.createInterpolant=function InterpolantFactoryMethodGLTFCubicSpline(t){return new(this instanceof n.QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(e)}}const h=e.name?e.name:"animation_"+t;return new n.AnimationClip(h,void 0,c)})}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then(function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse(function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]}),e})}loadNode(t){const e=this.json,i=this.extensions,r=this,s=e.nodes[t],o=s.name?r.createUniqueName(s.name):"";return function(){const e=[],i=r._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(t)});return i&&e.push(i),void 0!==s.camera&&e.push(r.getDependency("camera",s.camera).then(function(t){return r._getNodeRef(r.cameraCache,s.camera,t)})),r._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(t){e.push(t)}),Promise.all(e)}().then(function(e){let a;if((a=!0===s.isBone?new n.Bone:e.length>1?new n.Group:1===e.length?e[0]:new n.Object3D)!==e[0])for(let t=0,i=e.length;t<i;t++)a.add(e[t]);if(s.name&&(a.userData.name=s.name,a.name=o),assignExtrasToUserData(a,s),s.extensions&&addUnknownExtensionsToUserData(i,a,s),void 0!==s.matrix){const t=new n.Matrix4;t.fromArray(s.matrix),a.applyMatrix4(t)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=t,a})}loadScene(t){const e=this.json,i=this.extensions,r=this.json.scenes[t],s=this,o=new n.Group;r.name&&(o.name=s.createUniqueName(r.name)),assignExtrasToUserData(o,r),r.extensions&&addUnknownExtensionsToUserData(i,o,r);const a=r.nodes||[],l=[];for(let t=0,i=a.length;t<i;t++)l.push(buildNodeHierarchy(a[t],o,e,s));return Promise.all(l).then(function(){return s.associations=(t=>{const e=new Map;for(const[t,i]of s.associations)(t instanceof n.Material||t instanceof n.Texture)&&e.set(t,i);return t.traverse(t=>{const i=s.associations.get(t);null!=i&&e.set(t,i)}),e})(o),o})}}function buildNodeHierarchy(t,e,i,r){const s=i.nodes[t];return r.getDependency("node",t).then(function(t){if(void 0===s.skin)return t;let e;return r.getDependency("skin",s.skin).then(function(t){const i=[];for(let n=0,s=(e=t).joints.length;n<s;n++)i.push(r.getDependency("node",e.joints[n]));return Promise.all(i)}).then(function(i){return t.traverse(function(t){if(!t.isMesh)return;const r=[],s=[];for(let t=0,o=i.length;t<o;t++){const o=i[t];if(o){r.push(o);const i=new n.Matrix4;void 0!==e.inverseBindMatrices&&i.fromArray(e.inverseBindMatrices.array,16*t),s.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new n.Skeleton(r,s),t.matrixWorld)}),t})}).then(function(t){e.add(t);const n=[];if(s.children){const e=s.children;for(let s=0,o=e.length;s<o;s++){const o=e[s];n.push(buildNodeHierarchy(o,t,i,r))}}return Promise.all(n)})}function addPrimitiveAttributes(t,e,i){const r=e.attributes,s=[];function assignAttributeAccessor(e,n){return i.getDependency("accessor",e).then(function(e){t.setAttribute(n,e)})}for(const e in r){const i=p[e]||e.toLowerCase();i in t.attributes||s.push(assignAttributeAccessor(r[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then(function(e){t.setIndex(e)});s.push(n)}return assignExtrasToUserData(t,e),function computeBounds(t,e,i){const r=e.attributes,s=new n.Box3;if(void 0===r.POSITION)return;{const t=i.json.accessors[r.POSITION],e=t.min,o=t.max;if(void 0===e||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new n.Vector3(e[0],e[1],e[2]),new n.Vector3(o[0],o[1],o[2])),t.normalized){const e=getNormalizedComponentScale(h[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const o=e.targets;if(void 0!==o){const t=new n.Vector3,e=new n.Vector3;for(let n=0,r=o.length;n<r;n++){const r=o[n];if(void 0!==r.POSITION){const n=i.json.accessors[r.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const t=getNormalizedComponentScale(h[n.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const a=new n.Sphere;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=a}(t,e,i),Promise.all(s).then(function(){return void 0!==e.targets?function addMorphTargets(t,e,i){let n=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(r=!0),n&&r)break}if(!n&&!r)return Promise.resolve(t);const s=[],o=[];for(let a=0,l=e.length;a<l;a++){const l=e[a];if(n){const e=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION):t.attributes.position;s.push(e)}if(r){const e=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL):t.attributes.normal;o.push(e)}}return Promise.all([Promise.all(s),Promise.all(o)]).then(function(e){const i=e[0],s=e[1];return n&&(t.morphAttributes.position=i),r&&(t.morphAttributes.normal=s),t.morphTargetsRelative=!0,t})}(t,e.targets,i):t})}function toTrianglesDrawMode(t,e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const r=i.count-2,s=[];if(e===n.TriangleFanDrawMode)for(let t=1;t<=r;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<r;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o}},,,,function(t,e,i){"use strict";var n=i(48),r=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=Duplex;var s=i(44);s.inherits=i(34);var o=i(74),a=i(67);s.inherits(Duplex,o);for(var l=r(a.prototype),c=0;c<l.length;c++){var h=l[c];Duplex.prototype[h]||(Duplex.prototype[h]=a.prototype[h])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||n.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),Duplex.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},,,,function(t,e){"function"==typeof Object.create?t.exports=function inherits(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function inherits(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){var i,n,r=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(i===setTimeout)return setTimeout(t,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){i=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){n=defaultClearTimeout}}();var s,o=[],a=!1,l=-1;function cleanUpNextTick(){a&&s&&(a=!1,s.length?o=s.concat(o):l=-1,o.length&&drainQueue())}function drainQueue(){if(!a){var t=runTimeout(cleanUpNextTick);a=!0;for(var e=o.length;e;){for(s=o,o=[];++l<e;)s&&s[l].run();l=-1,e=o.length}s=null,a=!1,function runClearTimeout(t){if(n===clearTimeout)return clearTimeout(t);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];o.push(new Item(t,e)),1!==o.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=noop,r.addListener=noop,r.once=noop,r.off=noop,r.removeListener=noop,r.removeAllListeners=noop,r.emit=noop,r.prependListener=noop,r.prependOnceListener=noop,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},,,,,,,function(t,e,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,s=r&&"function"==typeof r.apply?r.apply:function ReflectApply(t,e,i){return Function.prototype.apply.call(t,e,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var a=10;function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,e,i,n){var r,s,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),o=s[e]),void 0===o)o=s[e]=i,++t._eventsCount;else if("function"==typeof o?o=s[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=$getMaxListeners(t))>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(a)}return t}function _onceWrap(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=function onceWrapper(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,t))}.bind(n);return r.listener=i,n.wrapFn=r,r}function _listeners(t,e,i){var n=t._events;if(void 0===n)return[];var r=n[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function unwrapListeners(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):arrayClone(r,r.length)}function listenerCount(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function arrayClone(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[t];if(void 0===l)return!1;if("function"==typeof l)s(l,this,e);else{var c=l.length,h=arrayClone(l,c);for(i=0;i<c;++i)s(h[i],this,e)}return!0},EventEmitter.prototype.addListener=function addListener(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function once(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function removeListener(t,e){var i,n,r,s,o;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){o=i[s].listener,r=s;break}if(r<0)return this;0===r?i.shift():function spliceOne(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,s=Object.keys(i);for(n=0;n<s.length;++n)"removeListener"!==(r=s[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?n(this._events):[]}},function(t,e,i){(function(t){function objectToString(t){return Object.prototype.toString.call(t)}e.isArray=function isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString(t)},e.isBoolean=function isBoolean(t){return"boolean"==typeof t},e.isNull=function isNull(t){return null===t},e.isNullOrUndefined=function isNullOrUndefined(t){return null==t},e.isNumber=function isNumber(t){return"number"==typeof t},e.isString=function isString(t){return"string"==typeof t},e.isSymbol=function isSymbol(t){return"symbol"==typeof t},e.isUndefined=function isUndefined(t){return void 0===t},e.isRegExp=function isRegExp(t){return"[object RegExp]"===objectToString(t)},e.isObject=function isObject(t){return"object"==typeof t&&null!==t},e.isDate=function isDate(t){return"[object Date]"===objectToString(t)},e.isError=function isError(t){return"[object Error]"===objectToString(t)||t instanceof Error},e.isFunction=function isFunction(t){return"function"==typeof t},e.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,i(77).Buffer)},,,,function(t,e,i){"use strict";(function(e){void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function nextTick(t,i,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function afterTickOne(){t.call(null,i)});case 3:return e.nextTick(function afterTickTwo(){t.call(null,i,n)});case 4:return e.nextTick(function afterTickThree(){t.call(null,i,n,r)});default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return e.nextTick(function afterTick(){t.apply(null,s)})}}}:t.exports=e}).call(this,i(36))},function(t,e,i){var n=i(77),r=n.Buffer;function copyProps(t,e){for(var i in t)e[i]=t[i]}function SafeBuffer(t,e,i){return r(t,e,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(copyProps(n,e),e.Buffer=SafeBuffer),copyProps(r,SafeBuffer),SafeBuffer.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,i)},SafeBuffer.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=r(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},,,,,,,,,,,,,,,,,function(t,e,i){(e=t.exports=i(74)).Stream=e,e.Readable=e,e.Writable=i(67),e.Duplex=i(30),e.Transform=i(80),e.PassThrough=i(149)},function(t,e,i){"use strict";(function(e,n,r){var s=i(48);function CorkedRequest(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,e,i){var n=t.entry;t.entry=null;for(;n;){var r=n.callback;e.pendingcb--,r(i),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=Writable;var o,a=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:s.nextTick;Writable.WritableState=WritableState;var l=i(44);l.inherits=i(34);var c={deprecate:i(148)},h=i(76),u=i(49).Buffer,d=r.Uint8Array||function(){};var m,p=i(78);function nop(){}function WritableState(t,e){o=o||i(30),t=t||{};var n=e instanceof o;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,l=t.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(l||0===l)?l:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===t.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,e){var i=t._writableState,n=i.sync,r=i.writecb;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function onwriteError(t,e,i,n,r){--e.pendingcb,i?(s.nextTick(r,n),s.nextTick(finishMaybe,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(r(n),t._writableState.errorEmitted=!0,t.emit("error",n),finishMaybe(t,e))}(t,i,n,e,r);else{var o=needFinish(i);o||i.corked||i.bufferProcessing||!i.bufferedRequest||clearBuffer(t,i),n?a(afterWrite,t,i,o,r):afterWrite(t,i,o,r)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(o=o||i(30),!(m.call(Writable,this)||this instanceof o))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function doWrite(t,e,i,n,r,s,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,i?t._writev(r,e.onwrite):t._write(r,s,e.onwrite),e.sync=!1}function afterWrite(t,e,i,n){i||function onwriteDrain(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),finishMaybe(t,e)}function clearBuffer(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,r=new Array(n),s=e.corkedRequestsFree;s.entry=i;for(var o=0,a=!0;i;)r[o]=i,i.isBuf||(a=!1),i=i.next,o+=1;r.allBuffers=a,doWrite(t,e,!0,e.length,r,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new CorkedRequest(e),e.bufferedRequestCount=0}else{for(;i;){var l=i.chunk,c=i.encoding,h=i.callback;if(doWrite(t,e,!1,e.objectMode?1:l.length,l,c,h),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,e){t._final(function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),finishMaybe(t,e)})}function finishMaybe(t,e){var i=needFinish(e);return i&&(!function prefinish(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,s.nextTick(callFinal,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}l.inherits(Writable,h),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(m=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(t){return!!m.call(this,t)||this===Writable&&(t&&t._writableState instanceof WritableState)}})):m=function(t){return t instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,e,i){var n=this._writableState,r=!1,o=!n.objectMode&&function _isUint8Array(t){return u.isBuffer(t)||t instanceof d}(t);return o&&!u.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return u.from(t)}(t)),"function"==typeof e&&(i=e,e=null),o?e="buffer":e||(e=n.defaultEncoding),"function"!=typeof i&&(i=nop),n.ended?function writeAfterEnd(t,e){var i=new Error("write after end");t.emit("error",i),s.nextTick(e,i)}(this,i):(o||function validChunk(t,e,i,n){var r=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),s.nextTick(n,o),r=!1),r}(this,n,t,i))&&(n.pendingcb++,r=function writeOrBuffer(t,e,i,n,r,s){if(!i){var o=function decodeChunk(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=u.from(e,i));return e}(e,n,r);n!==o&&(i=!0,r="buffer",n=o)}var a=e.objectMode?1:n.length;e.length+=a;var l=e.length<e.highWaterMark;l||(e.needDrain=!0);if(e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else doWrite(t,e,!1,a,n,r,s);return l}(this,n,o,t,e,i)),r},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,e,i){var n=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function endWritable(t,e,i){e.ending=!0,finishMaybe(t,e),i&&(e.finished?s.nextTick(i):t.once("finish",i));e.ended=!0,t.writable=!1}(this,n,i)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=p.destroy,Writable.prototype._undestroy=p.undestroy,Writable.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,i(36),i(146).setImmediate,i(35))},,,,,,function(t,e,i){t.exports=Stream;var n=i(43).EventEmitter;function Stream(){n.call(this)}i(34)(Stream,n),Stream.Readable=i(66),Stream.Writable=i(150),Stream.Duplex=i(151),Stream.Transform=i(152),Stream.PassThrough=i(153),Stream.Stream=Stream,Stream.prototype.pipe=function(t,e){var i=this;function ondata(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function ondrain(){i.readable&&i.resume&&i.resume()}i.on("data",ondata),t.on("drain",ondrain),t._isStdio||e&&!1===e.end||(i.on("end",onend),i.on("close",onclose));var r=!1;function onend(){r||(r=!0,t.end())}function onclose(){r||(r=!0,"function"==typeof t.destroy&&t.destroy())}function onerror(t){if(cleanup(),0===n.listenerCount(this,"error"))throw t}function cleanup(){i.removeListener("data",ondata),t.removeListener("drain",ondrain),i.removeListener("end",onend),i.removeListener("close",onclose),i.removeListener("error",onerror),t.removeListener("error",onerror),i.removeListener("end",cleanup),i.removeListener("close",cleanup),t.removeListener("close",cleanup)}return i.on("error",onerror),t.on("error",onerror),i.on("end",cleanup),i.on("close",cleanup),t.on("close",cleanup),t.emit("pipe",i),t}},function(t,e,i){"use strict";(function(e,n){var r=i(48);t.exports=Readable;var s,o=i(75);Readable.ReadableState=ReadableState;i(43).EventEmitter;var a=function(t,e){return t.listeners(e).length},l=i(76),c=i(49).Buffer,h=e.Uint8Array||function(){};var u=i(44);u.inherits=i(34);var d=i(143),m=void 0;m=d&&d.debuglog?d.debuglog("stream"):function(){};var p,f=i(144),_=i(78);u.inherits(Readable,l);var g=["error","close","destroy","pause","resume"];function ReadableState(t,e){t=t||{};var n=e instanceof(s=s||i(30));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,o=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=i(79).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function Readable(t){if(s=s||i(30),!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function readableAddChunk(t,e,i,n,r){var s,o=t._readableState;null===e?(o.reading=!1,function onEofChunk(t,e){if(e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,emitReadable(t)}(t,o)):(r||(s=function chunkInvalid(t,e){var i;(function _isUint8Array(t){return c.isBuffer(t)||t instanceof h})(e)||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));return i}(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function _uint8ArrayToBuffer(t){return c.from(t)}(e)),n?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):addChunk(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!i?(e=o.decoder.write(e),o.objectMode||0!==e.length?addChunk(t,o,e,!1):maybeReadMore(t,o)):addChunk(t,o,e,!1))):n||(o.reading=!1));return function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(o)}function addChunk(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&emitReadable(t)),maybeReadMore(t,e)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=_.destroy,Readable.prototype._undestroy=_.undestroy,Readable.prototype._destroy=function(t,e){this.push(null),e(t)},Readable.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=c.from(t,e),e=""),i=!0),readableAddChunk(this,t,e,!1,i)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return p||(p=i(79).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var b=8388608;function howMuchToRead(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function computeNewHighWaterMark(t){return t>=b?t=b:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function emitReadable(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(m("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){m("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(maybeReadMore_,t,e))}function maybeReadMore_(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(m("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function nReadingNextTick(t){m("readable nexttick read 0"),t.read(0)}function resume_(t,e){e.reading||(m("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),flow(t),e.flowing&&!e.reading&&t.read(0)}function flow(t){var e=t._readableState;for(m("flow",e.flowing);e.flowing&&null!==t.read(););}function fromList(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function fromListPartial(t,e,i){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():i?function copyFromBufferString(t,e){var i=e.head,n=1,r=i.data;t-=r.length;for(;i=i.next;){var s=i.data,o=t>s.length?s.length:t;if(o===s.length?r+=s:r+=s.slice(0,t),0===(t-=o)){o===s.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=s.slice(o));break}++n}return e.length-=n,r}(t,e):function copyFromBuffer(t,e){var i=c.allocUnsafe(t),n=e.head,r=1;n.data.copy(i),t-=n.data.length;for(;n=n.next;){var s=n.data,o=t>s.length?s.length:t;if(s.copy(i,i.length-t,0,o),0===(t-=o)){o===s.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=s.slice(o));break}++r}return e.length-=r,i}(t,e);return n}(t,e.buffer,e.decoder),i);var i}function endReadable(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(endReadableNT,e,t))}function endReadableNT(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function indexOf(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}Readable.prototype.read=function(t){m("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return m("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,e))&&e.ended)return 0===e.length&&endReadable(this),null;var n,r=e.needReadable;return m("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&m("length less than watermark",r=!0),e.ended||e.reading?m("reading or ended",r=!1):r&&(m("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=howMuchToRead(i,e))),null===(n=t>0?fromList(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&endReadable(this)),null!==n&&this.emit("data",n),n},Readable.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(t,e){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,m("pipe count=%d opts=%j",s.pipesCount,e);var l=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?onend:unpipe;function onunpipe(e,n){m("onunpipe"),e===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,function cleanup(){m("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",c),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),i.removeListener("end",onend),i.removeListener("end",unpipe),i.removeListener("data",ondata),h=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||c()}())}function onend(){m("onend"),t.end()}s.endEmitted?r.nextTick(l):i.once("end",l),t.on("unpipe",onunpipe);var c=function pipeOnDrain(t){return function(){var e=t._readableState;m("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,flow(t))}}(i);t.on("drain",c);var h=!1;var u=!1;function ondata(e){m("ondata"),u=!1,!1!==t.write(e)||u||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==indexOf(s.pipes,t))&&!h&&(m("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,u=!0),i.pause())}function onerror(e){m("onerror",e),unpipe(),t.removeListener("error",onerror),0===a(t,"error")&&t.emit("error",e)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){m("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){m("unpipe"),i.unpipe(t)}return i.on("data",ondata),function prependListener(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",i),s.flowing||(m("pipe resume"),i.resume()),t},Readable.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<r;s++)n[s].emit("unpipe",this,i);return this}var o=indexOf(e.pipes,t);return-1===o?this:(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)},Readable.prototype.on=function(t,e){var i=l.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&emitReadable(this):r.nextTick(nReadingNextTick,this))}return i},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(m("resume"),t.flowing=!0,function resume(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(resume_,t,e))}(this,t)),this},Readable.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var r in t.on("end",function(){if(m("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(r){(m("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r)||(i.objectMode||r&&r.length)&&(e.push(r)||(n=!0,t.pause()))}),t)void 0===this[r]&&"function"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var s=0;s<g.length;s++)t.on(g[s],this.emit.bind(this,g[s]));return this._read=function(e){m("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,i(35),i(36))},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){t.exports=i(43).EventEmitter},function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=i(141),r=i(142),s=i(75);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,i){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,i)}function from(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function fromArrayBuffer(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e);return t}(t,e,i,n):"string"==typeof e?function fromString(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!Buffer.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(e,i),r=(t=createBuffer(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function fromObject(t,e){if(Buffer.isBuffer(e)){var i=0|checked(e.length);return 0===(t=createBuffer(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function isnan(t){return t!=t}(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&s(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function fromArrayLike(t,e){var i=e.length<0?0:0|checked(e.length);t=createBuffer(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function swap(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function bidirectionalIndexOf(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=Buffer.from(e,n)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,i,n,r);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):arrayIndexOf(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,i,n,r){var s,o=1,a=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,i/=2}function read(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var c=-1;for(s=i;s<a;s++)if(read(t,s)===read(e,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*o}else-1!==c&&(s-=s-c),c=-1}else for(i+l>a&&(i=a-l),s=i;s>=0;s--){for(var h=!0,u=0;u<l;u++)if(read(t,s+u)!==read(e,u)){h=!1;break}if(h)return s}return-1}function hexWrite(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[i+o]=a}return o}function utf8Write(t,e,i,n){return blitBuffer(utf8ToBytes(e,t.length-i),t,i,n)}function asciiWrite(t,e,i,n){return blitBuffer(function asciiToBytes(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function latin1Write(t,e,i,n){return asciiWrite(t,e,i,n)}function base64Write(t,e,i,n){return blitBuffer(base64ToBytes(e),t,i,n)}function ucs2Write(t,e,i,n){return blitBuffer(function utf16leToBytes(t,e){for(var i,n,r,s=[],o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),n=i>>8,r=i%256,s.push(r),s.push(n);return s}(e,t.length-i),t,i,n)}function base64Slice(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function utf8Slice(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var s,a,l,c,h=t[r],u=null,d=h>239?4:h>223?3:h>191?2:1;if(r+d<=i)switch(d){case 1:h<128&&(u=h);break;case 2:128==(192&(s=t[r+1]))&&(c=(31&h)<<6|63&s)>127&&(u=c);break;case 3:s=t[r+1],a=t[r+2],128==(192&s)&&128==(192&a)&&(c=(15&h)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=t[r+1],a=t[r+2],l=t[r+3],128==(192&s)&&128==(192&a)&&128==(192&l)&&(c=(15&h)<<18|(63&s)<<12|(63&a)<<6|63&l)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),r+=d}return function decodeCodePointsArray(t){var e=t.length;if(e<=o)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=o));return i}(n)}e.Buffer=Buffer,e.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,i){return from(null,t,e,i)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,i){return function alloc(t,e,i,n){return assertSize(e),e<=0?createBuffer(t,e):void 0!==i?"string"==typeof n?createBuffer(t,e).fill(i,n):createBuffer(t,e).fill(i):createBuffer(t,e)}(null,t,e,i)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=Buffer.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!Buffer.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):function slowToString(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,i);case"utf8":case"utf-8":return utf8Slice(this,e,i);case"ascii":return asciiSlice(this,e,i);case"latin1":case"binary":return latin1Slice(this,e,i);case"base64":return base64Slice(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,e,i,n,r){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var s=(r>>>=0)-(n>>>=0),o=(i>>>=0)-(e>>>=0),a=Math.min(s,o),l=this.slice(n,r),c=t.slice(e,i),h=0;h<a;++h)if(l[h]!==c[h]){s=l[h],o=c[h];break}return s<o?-1:o<s?1:0},Buffer.prototype.includes=function includes(t,e,i){return-1!==this.indexOf(t,e,i)},Buffer.prototype.indexOf=function indexOf(t,e,i){return bidirectionalIndexOf(this,t,e,i,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,e,i){return bidirectionalIndexOf(this,t,e,i,!1)},Buffer.prototype.write=function write(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return hexWrite(this,t,e,i);case"utf8":case"utf-8":return utf8Write(this,t,e,i);case"ascii":return asciiWrite(this,t,e,i);case"latin1":case"binary":return latin1Write(this,t,e,i);case"base64":return base64Write(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var o=4096;function asciiSlice(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function latin1Slice(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function hexSlice(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",s=e;s<i;++s)r+=toHex(t[s]);return r}function utf16leSlice(t,e,i){for(var n=t.slice(e,i),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function checkOffset(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,i,n,r,s){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,s=Math.min(t.length-i,2);r<s;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function objectWriteUInt32(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,s=Math.min(t.length-i,4);r<s;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function checkIEEE754(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function writeFloat(t,e,i,n,s){return s||checkIEEE754(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function writeDouble(t,e,i,n,s){return s||checkIEEE754(t,0,i,8),r.write(t,e,i,n,52,8),i+8}Buffer.prototype.slice=function slice(t,e){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=Buffer.prototype;else{var r=e-t;i=new Buffer(r,void 0);for(var s=0;s<r;++s)i[s]=this[s+t]}return i},Buffer.prototype.readUIntLE=function readUIntLE(t,e,i){t|=0,e|=0,i||checkOffset(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n},Buffer.prototype.readUIntBE=function readUIntBE(t,e,i){t|=0,e|=0,i||checkOffset(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},Buffer.prototype.readUInt8=function readUInt8(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,e,i){t|=0,e|=0,i||checkOffset(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function readIntBE(t,e,i){t|=0,e|=0,i||checkOffset(t,e,this.length);for(var n=e,r=1,s=this[t+--n];n>0&&(r*=256);)s+=this[t+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},Buffer.prototype.readInt8=function readInt8(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,e){e||checkOffset(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},Buffer.prototype.readInt16BE=function readInt16BE(t,e){e||checkOffset(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},Buffer.prototype.readInt32LE=function readInt32LE(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,e){return e||checkOffset(t,4,this.length),r.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,e){return e||checkOffset(t,4,this.length),r.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,e){return e||checkOffset(t,8,this.length),r.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,e){return e||checkOffset(t,8,this.length),r.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,e,i,n){(t=+t,e|=0,i|=0,n)||checkInt(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,s=0;for(this[e]=255&t;++s<i&&(r*=256);)this[e+s]=t/r&255;return e+i},Buffer.prototype.writeUIntBE=function writeUIntBE(t,e,i,n){(t=+t,e|=0,i|=0,n)||checkInt(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+i},Buffer.prototype.writeUInt8=function writeUInt8(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function writeIntLE(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);checkInt(this,t,e,i,r-1,-r)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},Buffer.prototype.writeIntBE=function writeIntBE(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);checkInt(this,t,e,i,r-1,-r)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},Buffer.prototype.writeInt8=function writeInt8(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,e,i){return t=+t,e|=0,i||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,e,i){return writeFloat(this,t,e,!0,i)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,e,i){return writeFloat(this,t,e,!1,i)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,e,i){return writeDouble(this,t,e,!0,i)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,e,i){return writeDouble(this,t,e,!1,i)},Buffer.prototype.copy=function copy(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,s=n-i;if(this===t&&i<e&&e<n)for(r=s-1;r>=0;--r)t[r+e]=this[r+i];else if(s<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),e);return s},Buffer.prototype.fill=function fill(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=e;s<i;++s)this[s]=t;else{var o=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,n).toString()),a=o.length;for(s=0;s<i-e;++s)this[s+e]=o[s%a]}return this};var a=/[^+\/0-9A-Za-z-_]/g;function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var i;e=e||1/0;for(var n=t.length,r=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function base64ToBytes(t){return n.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(a,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(35))},function(t,e,i){"use strict";var n=i(48);function emitErrorNT(t,e){t.emit("error",e)}t.exports={destroy:function destroy(t,e){var i=this,r=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return r||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(emitErrorNT,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(n.nextTick(emitErrorNT,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,i){"use strict";var n=i(49).Buffer,r=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(t){var e;switch(this.encoding=function normalizeEncoding(t){var e=function _normalizeEncoding(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var e=this.lastTotal-this.lastNeed,i=function utf8CheckExtraBytes(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function utf16End(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function base64Text(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function base64End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}e.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},StringDecoder.prototype.end=function utf8End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},StringDecoder.prototype.text=function utf8Text(t,e){var i=function utf8CheckIncomplete(t,e,i){var n=e.length-1;if(n<i)return 0;var r=utf8CheckByte(e[n]);if(r>=0)return r>0&&(t.lastNeed=r-1),r;if(--n<i||-2===r)return 0;if((r=utf8CheckByte(e[n]))>=0)return r>0&&(t.lastNeed=r-2),r;if(--n<i||-2===r)return 0;if((r=utf8CheckByte(e[n]))>=0)return r>0&&(2===r?r=0:t.lastNeed=r-3),r;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,i){"use strict";t.exports=Transform;var n=i(30),r=i(44);function afterTransform(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);n.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"==typeof this._flush?this._flush(function(e,i){done(t,e,i)}):done(this,null,null)}function done(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=i(34),r.inherits(Transform,n),Transform.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},Transform.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},Transform.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},Transform.prototype._destroy=function(t,e){var i=this;n.prototype._destroy.call(this,t,function(t){e(t),i.emit("close")})}},function(t,e,i){var n;
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(r){function SignalBinding(t,e,i,n,r){this._listener=e,this._isOnce=i,this.context=n,this._signal=t,this._priority=r||0}function validateListener(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function Signal(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){Signal.prototype.dispatch.apply(t,arguments)}}SignalBinding.prototype={active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},Signal.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,i,n){var r,s=this._indexOfListener(t,i);if(-1!==s){if((r=this._bindings[s]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else r=new SignalBinding(this,t,e,i,n),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},_addBinding:function(t){var e=this._bindings.length;do{--e}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){return validateListener(t,"add"),this._registerListener(t,!1,e,i)},addOnce:function(t,e,i){return validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},remove:function(t,e){validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=i),n){e=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(e[n]&&this._shouldPropagate&&!1!==e[n].execute(i))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=Signal;s.Signal=Signal,void 0===(n=function(){return s}.call(e,i,e,t))||(t.exports=n)}()},,,,,,,,,,,,,,function(t,e,i){(function(e){var n=i(127),r=i(131),s=i(135),o=i(136);t.exports=function createTextGeometry(t){return new TextGeometry(t)};class TextGeometry extends e.BufferGeometry{constructor(t){super(),"string"==typeof t&&(t={text:t}),this._opt=Object.assign({},t),t&&this.update(t)}update(t){if("string"==typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=n(t);var i=!1!==t.flipY,o=t.font,a=o.common.scaleW,l=o.common.scaleH,c=this.layout.glyphs.filter(function(t){var e=t.data;return e.width*e.height>0});this.visibleGlyphs=c;var h=s.positions(c),u=s.uvs(c,a,l,i),d=r([],{clockwise:!0,type:"uint16",count:c.length});if(this.setIndex(d),this.setAttribute("position",new e.BufferAttribute(h,2)),this.setAttribute("uv",new e.BufferAttribute(u,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var m=s.pages(c);this.setAttribute("page",new e.BufferAttribute(m,1))}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var t=this.attributes.position.array,i=this.attributes.position.itemSize;if(!t||!i||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);o.computeSphere(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.boundingBox,i=this.attributes.position.array,n=this.attributes.position.itemSize;!i||!n||i.length<2?t.makeEmpty():o.computeBox(i,t)}}}).call(this,i(0))},,,,,,,,function(t,e,i){var n=i(137),r=i(138).US,s=i(139),o=i(156),a=i(158);t.exports=function FPSCameraController(t,e,i){i=i||{};var l=t,c=new n(r),h=new o(e),u=i.onChangedCallback,d=a(i.movementSpeed,.1),m=a(i.movementRunSpeedScale,2.5),p=a(i.rotationSpeed,.005),f=a(i.minFov,10),_=a(i.maxFov,100),g=a(i.zoomSpeed,.001),b=a(i.yUp,!0),y=a(i.rotateActive,!1),x=a(i.rotateActiveOnlyInPointerLock,!0),v=a(i.arrowKeysRotate,!1),S=1;x||(y=!0);var w,M,A=new s(e);A.on("data",function onPointerTrapData(t){y&&(l.rotateY(t.x*-p),l.rotateX(t.y*-p),b&&uprightCamera(),w=!0)}),A.onAttainSignal.add(function(){x&&(y=!0)}),A.onReleaseSignal.add(function(){x&&(y=!1)});var V,C,T=A.onAttainSignal,B=A.onReleaseSignal;function uprightCamera(){_lookAtTarget.position.copy(l.position),_lookAtTarget.rotation.copy(l.rotation),_lookAtTarget.translateZ(-1),l.lookAt(_lookAtTarget.position)}h.onWheelSignal.add(function zoomOnMouseWheel(t){V=t*g,C=l.fov,C*=1+V,C=Math.min(_,Math.max(f,C)),l.fov=C,l.updateProjectionMatrix(),u&&u()}),b&&(_lookAtTarget=l.clone()),this.onPointerLockAttainSignal=T,this.onPointerLockReleaseSignal=B,this.update=function update(){S=c.isPressed("shift")?m:1,c.isPressed("a")&&(M=!0,l.translateX(-d*S)),c.isPressed("d")&&(M=!0,l.translateX(d*S)),c.isPressed("w")&&(M=!0,l.translateZ(-d*S)),c.isPressed("s")&&(M=!0,l.translateZ(d*S)),c.isPressed("e")&&(M=!0,l.position.y+=d*S),c.isPressed("q")&&(M=!0,l.position.y+=-d*S),v&&(c.isPressed("left")&&(l.rotateY(p),w=!0),c.isPressed("right")&&(l.rotateY(-p),w=!0),c.isPressed("up")&&(l.rotateX(p),w=!0),c.isPressed("down")&&(l.rotateX(-p),w=!0),w&&b&&uprightCamera()),(M||w)&&u&&(u(),M=w=!1)},Object.defineProperty(this,"keyboard",{get:function(){return c}}),Object.defineProperty(this,"movementSpeed",{get:function(){return d},set:function(t){d=t}}),Object.defineProperty(this,"rotationSpeed",{get:function(){return p},set:function(t){p=t}}),Object.defineProperty(this,"zoomSpeed",{get:function(){return g},set:function(t){g=t}})}},,,,,,,,,,,,,function(t,e,i){(function(t){var n=Object.getOwnPropertyDescriptors||function getOwnPropertyDescriptors(t){for(var e=Object.keys(t),i={},n=0;n<e.length;n++)i[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return i},r=/%[sdj%]/g;e.format=function(t){if(!isString(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(inspect(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,s=n.length,o=String(t).replace(r,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),a=n[i];i<s;a=n[++i])isNull(a)||!isObject(a)?o+=" "+a:o+=" "+inspect(a);return o},e.deprecate=function(i,n){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return e.deprecate(i,n).apply(this,arguments)};var r=!1;return function deprecated(){if(!r){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),r=!0}return i.apply(this,arguments)}};var s,o={};function inspect(t,i){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(i)?n.showHidden=i:i&&e._extend(n,i),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,t,n.depth)}function stylizeWithColor(t,e){var i=inspect.styles[e];return i?"["+inspect.colors[i][0]+"m"+t+"["+inspect.colors[i][1]+"m":t}function stylizeNoColor(t,e){return t}function formatValue(t,i,n){if(t.customInspect&&i&&isFunction(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,t);return isString(r)||(r=formatValue(t,r,n)),r}var s=function formatPrimitive(t,e){if(isUndefined(e))return t.stylize("undefined","undefined");if(isString(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(isNumber(e))return t.stylize(""+e,"number");if(isBoolean(e))return t.stylize(""+e,"boolean");if(isNull(e))return t.stylize("null","null")}(t,i);if(s)return s;var o=Object.keys(i),a=function arrayToHash(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),isError(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(i);if(0===o.length){if(isFunction(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(isRegExp(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(isDate(i))return t.stylize(Date.prototype.toString.call(i),"date");if(isError(i))return formatError(i)}var c,h="",u=!1,d=["{","}"];(isArray(i)&&(u=!0,d=["[","]"]),isFunction(i))&&(h=" [Function"+(i.name?": "+i.name:"")+"]");return isRegExp(i)&&(h=" "+RegExp.prototype.toString.call(i)),isDate(i)&&(h=" "+Date.prototype.toUTCString.call(i)),isError(i)&&(h=" "+formatError(i)),0!==o.length||u&&0!=i.length?n<0?isRegExp(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),c=u?function formatArray(t,e,i,n,r){for(var s=[],o=0,a=e.length;o<a;++o)hasOwnProperty(e,String(o))?s.push(formatProperty(t,e,i,n,String(o),!0)):s.push("");return r.forEach(function(r){r.match(/^\d+$/)||s.push(formatProperty(t,e,i,n,r,!0))}),s}(t,i,n,a,o):o.map(function(e){return formatProperty(t,i,n,a,e,u)}),t.seen.pop(),function reduceToSingleString(t,e,i){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(c,h,d)):d[0]+h+d[1]}function formatError(t){return"["+Error.prototype.toString.call(t)+"]"}function formatProperty(t,e,i,n,r,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),hasOwnProperty(n,r)||(o="["+r+"]"),a||(t.seen.indexOf(l.value)<0?(a=isNull(i)?formatValue(t,l.value,null):formatValue(t,l.value,i-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),isUndefined(o)){if(s&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function isArray(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}function isNull(t){return null===t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject(t)&&"[object RegExp]"===objectToString(t)}function isObject(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject(t)&&"[object Date]"===objectToString(t)}function isError(t){return isObject(t)&&("[object Error]"===objectToString(t)||t instanceof Error)}function isFunction(t){return"function"==typeof t}function objectToString(t){return Object.prototype.toString.call(t)}function pad(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(i){if(isUndefined(s)&&(s=t.env.NODE_DEBUG||""),i=i.toUpperCase(),!o[i])if(new RegExp("\\b"+i+"\\b","i").test(s)){var n=t.pid;o[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,n,t)}}else o[i]=function(){};return o[i]},e.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=isArray,e.isBoolean=isBoolean,e.isNull=isNull,e.isNullOrUndefined=function isNullOrUndefined(t){return null==t},e.isNumber=isNumber,e.isString=isString,e.isSymbol=function isSymbol(t){return"symbol"==typeof t},e.isUndefined=isUndefined,e.isRegExp=isRegExp,e.isObject=isObject,e.isDate=isDate,e.isError=isError,e.isFunction=isFunction,e.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i(159);var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function timestamp(){var t=new Date,e=[pad(t.getHours()),pad(t.getMinutes()),pad(t.getSeconds())].join(":");return[t.getDate(),a[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=i(160),e._extend=function(t,e){if(!e||!isObject(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t};var l="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function callbackifyOnRejected(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function promisify(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(l&&t[l]){var e;if("function"!=typeof(e=t[l]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,l,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,n=new Promise(function(t,n){e=t,i=n}),r=[],s=0;s<arguments.length;s++)r.push(arguments[s]);r.push(function(t,n){t?i(t):e(n)});try{t.apply(this,r)}catch(t){i(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),l&&Object.defineProperty(e,l,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=l,e.callbackify=function callbackify(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function callbackified(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var r=i.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var s=this,o=function(){return r.apply(s,arguments)};e.apply(this,i).then(function(e){t.nextTick(o,null,e)},function(e){t.nextTick(callbackifyOnRejected,e,o)})}return Object.setPrototypeOf(callbackified,Object.getPrototypeOf(e)),Object.defineProperties(callbackified,n(e)),callbackified}}).call(this,i(36))},,,,,,,,,,,function(t,e,i){var n=i(128),r=i(129),s=i(130),o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0),u=0,d=1,m=2;function TextLayout(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function wrapper(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function getGlyphById(t,e){if(!t.chars||0===t.chars.length)return null;var i=findChar(t.chars,e);return i>=0?t.chars[i]:null}function getKerning(t,e,i){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,r=0;r<n.length;r++){var s=n[r];if(s.first===e&&s.second===i)return s.amount}return 0}function findChar(t,e,i){for(var n=i=i||0;n<t.length;n++)if(t[n].id===e)return n;return-1}t.exports=function createLayout(t){return new TextLayout(t)},TextLayout.prototype.update=function(t){if(t=r({measure:this._measure},t),this._opt=t,this._opt.tabSize=s(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var e=this.glyphs,i=t.text||"",a=t.font;this._setupSpaceGlyphs(a);var c=n.lines(i,t),h=t.width||0;e.length=0;var p=c.reduce(function(t,e){return Math.max(t,e.width,h)},0),f=0,_=0,g=s(t.lineHeight,a.common.lineHeight),b=a.common.base,y=g-b,x=t.letterSpacing||0,v=g*c.length-y,S=function getAlignType(t){if("center"===t)return d;if("right"===t)return m;return u}(this._opt.align);_-=v,this._width=p,this._height=v,this._descender=g-b,this._baseline=b,this._xHeight=function getXHeight(t){for(var e=0;e<o.length;e++){var i=o[e].charCodeAt(0),n=findChar(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(a),this._capHeight=function getCapHeight(t){for(var e=0;e<l.length;e++){var i=l[e].charCodeAt(0),n=findChar(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(a),this._lineHeight=g,this._ascender=g-y-this._xHeight;var w=this;c.forEach(function(t,n){for(var r,s=t.start,o=t.end,l=t.width,c=s;c<o;c++){var h=i.charCodeAt(c),u=w.getGlyph(a,h);if(u){r&&(f+=getKerning(a,r.id,u.id));var b=f;S===d?b+=(p-l)/2:S===m&&(b+=p-l),e.push({position:[b,_],data:u,index:c,line:n}),f+=u.xadvance+x,r=u}}_+=g,f=0}),this._linesTotal=c.length},TextLayout.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=getGlyphById(t,h)||function getMGlyph(t){for(var e=0;e<a.length;e++){var i=a[e].charCodeAt(0),n=findChar(t.chars,i);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],i=this._opt.tabSize*e.xadvance;this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=r(e,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},TextLayout.prototype.getGlyph=function(t,e){var i=getGlyphById(t,e);return i||(e===c?this._fallbackTabGlyph:e===h?this._fallbackSpaceGlyph:null)},TextLayout.prototype.computeMetrics=function(t,e,i,n){var r,s=this._opt.letterSpacing||0,o=this._opt.font,a=0,l=0,c=0;if(!o.chars||0===o.chars.length)return{start:e,end:e,width:0};i=Math.min(t.length,i);for(var h=e;h<i;h++){var u,d=t.charCodeAt(h);if(u=this.getGlyph(o,d)){u.xoffset;var m=(a+=r?getKerning(o,r.id,u.id):0)+u.xadvance+s,p=a+u.width;if(p>=n||m>=n)break;a=m,l=p,r=u}c++}return r&&(l+=r.xoffset),{start:e,end:e+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function addGetter(t){Object.defineProperty(TextLayout.prototype,t,{get:wrapper(t),configurable:!0})})},function(t,e){var i=/\n/,n="\n",r=/\s/;function idxOf(t,e,i,n){var r=t.indexOf(e,i);return-1===r||r>n?n:r}function isWhitespace(t){return r.test(t)}function monospace(t,e,i,n){return{start:e,end:e+Math.min(n,i-e)}}t.exports=function(e,i){return t.exports.lines(e,i).map(function(t){return e.substring(t.start,t.end)}).join("\n")},t.exports.lines=function wordwrap(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var r="number"==typeof e.width?e.width:Number.MAX_VALUE,s=Math.max(0,e.start||0),o="number"==typeof e.end?e.end:t.length,a=e.mode,l=e.measure||monospace;return"pre"===a?function pre(t,e,n,r,s){for(var o=[],a=n,l=n;l<r&&l<e.length;l++){var c=e.charAt(l),h=i.test(c);if(h||l===r-1){var u=h?l:l+1,d=t(e,a,u,s);o.push(d),a=l+1}}return o}(l,t,s,o,r):function greedy(t,e,i,r,s,o){var a=[],l=s;"nowrap"===o&&(l=Number.MAX_VALUE);for(;i<r&&i<e.length;){for(var c=idxOf(e,n,i,r);i<c&&isWhitespace(e.charAt(i));)i++;var h=t(e,i,c,l),u=i+(h.end-h.start),d=u+n.length;if(u<c){for(;u>i&&!isWhitespace(e.charAt(u));)u--;if(u===i)d>i+n.length&&d--,u=d;else for(d=u;u>i&&isWhitespace(e.charAt(u-n.length));)u--}if(u>=i){var m=t(e,i,u,l);a.push(m)}i=d}return a}(l,t,s,o,r,a)}},function(t,e){t.exports=function extend(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)i.call(n,r)&&(t[r]=n[r])}return t};var i=Object.prototype.hasOwnProperty},function(t,e){t.exports=function numtype(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}},function(t,e,i){var n=i(132),r=i(133),s=i(134),o=[0,2,3],a=[2,1,3];t.exports=function createQuadElements(t,e){t&&(r(t)||s(t))||(e=t||{},t=null);for(var i="string"==typeof(e="number"==typeof e?{count:e}:e||{}).type?e.type:"uint16",l="number"==typeof e.count?e.count:1,c=e.start||0,h=!1!==e.clockwise?o:a,u=h[0],d=h[1],m=h[2],p=6*l,f=t||new(n(i))(p),_=0,g=0;_<p;_+=6,g+=4){var b=_+c;f[b+0]=g+0,f[b+1]=g+1,f[b+2]=g+2,f[b+3]=g+u,f[b+4]=g+d,f[b+5]=g+m}return f}},function(t,e){t.exports=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},function(t,e){var i=Object.prototype.toString;t.exports=function anArray(t){return t.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===i.call(t.buffer)||Array.isArray(t)}},function(t,e){function isBuffer(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(isBuffer(t)||function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isBuffer(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e){t.exports.pages=function pages(t){var pages=new Float32Array(4*t.length*1),e=0;return t.forEach(function(t){var i=t.data.page||0;pages[e++]=i,pages[e++]=i,pages[e++]=i,pages[e++]=i}),pages},t.exports.uvs=function uvs(t,e,i,n){var uvs=new Float32Array(4*t.length*2),r=0;return t.forEach(function(t){var s=t.data,o=s.x+s.width,a=s.y+s.height,l=s.x/e,c=s.y/i,h=o/e,u=a/i;n&&(c=(i-s.y)/i,u=(i-a)/i),uvs[r++]=l,uvs[r++]=c,uvs[r++]=l,uvs[r++]=u,uvs[r++]=h,uvs[r++]=u,uvs[r++]=h,uvs[r++]=c}),uvs},t.exports.positions=function positions(t){var positions=new Float32Array(4*t.length*2),e=0;return t.forEach(function(t){var i=t.data,n=t.position[0]+i.xoffset,r=t.position[1]+i.yoffset,s=i.width,o=i.height;positions[e++]=n,positions[e++]=r,positions[e++]=n,positions[e++]=r+o,positions[e++]=n+s,positions[e++]=r+o,positions[e++]=n+s,positions[e++]=r}),positions}},function(t,e){var i=2,n={min:[0,0],max:[0,0]};function bounds(t){var e=t.length/i;n.min[0]=t[0],n.min[1]=t[1],n.max[0]=t[0],n.max[1]=t[1];for(var r=0;r<e;r++){var s=t[r*i+0],o=t[r*i+1];n.min[0]=Math.min(s,n.min[0]),n.min[1]=Math.min(o,n.min[1]),n.max[0]=Math.max(s,n.max[0]),n.max[1]=Math.max(o,n.max[1])}}t.exports.computeBox=function(t,e){bounds(t),e.min.set(n.min[0],n.min[1],0),e.max.set(n.max[0],n.max[1],0)},t.exports.computeSphere=function(t,e){bounds(t);var i=n.min[0],r=n.min[1],s=n.max[0]-i,o=n.max[1]-r,a=Math.sqrt(s*s+o*o);e.center.set(i+s/2,r+o/2,0),e.radius=a/2}},function(t,e,i){"use strict";function Keyboard(t){this.keys={};var e=this;for(var i in t)t.hasOwnProperty(i)&&(this.keys[t[i]]=0);window.addEventListener("keydown",function(i){if(i.preventDefault(),t.hasOwnProperty(i.keyCode))return 0===e.keys[t[i.keyCode]]&&(e.keys[t[i.keyCode]]=2),!1}),window.addEventListener("keyup",function(i){if(i.preventDefault(),t.hasOwnProperty(i.keyCode))return e.keys[t[i.keyCode]]=0,!1})}Keyboard.prototype.isPressed=function(t){return this.keys[t]>=1},Keyboard.prototype.consumePressed=function(t){var e=2===this.keys[t];return e&&(this.keys[t]=1),e},t.exports=Keyboard},function(t,e){t.exports={US:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftwindow",92:"rightwindow",93:"select",96:"numpad-0",97:"numpad-1",98:"numpad-2",99:"numpad-3",100:"numpad-4",101:"numpad-5",102:"numpad-6",103:"numpad-7",104:"numpad-8",105:"numpad-9",106:"multiply",107:"add",109:"subtract",110:"decimalpoint",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equals",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"}}},function(t,e,i){var n=i(140),r=i(154),s=i(155),o=Math.min,a=Math.max,l=i(81);t.exports=function trap(t,e){var i;switch(e){case"deltas":i=writeDeltas;break;case"clamped":i=function writeClamped(e){u.x+=e.dx,u.y+=e.dy,u.x=o(a(u.x,0),t.clientWidth),u.y=o(a(u.y,0),t.clientHeight),this.queue(u)};break;case"unclamped":i=function writeUnclamped(t){u.x+=t.dx,u.y+=t.dy,this.queue(u)};break;default:i=writeDeltas}var c=n(t),h=s(i),u=h.pos={},d=new l.Signal,m=new l.Signal;h.trapped=!1,h.onAttainSignal=d,h.onReleaseSignal=m,t.style.cursor="none";var p,f,_={dx:0,dy:0};function writeDeltas(t){u.x=t.dx,u.y=t.dy,this.queue(u)}return t.addEventListener("mousemove",function(t){h.trapped||(void 0===p&&(p=t.pageX),void 0===f&&(f=t.pageY),_.dx=t.pageX-p,_.dy=t.pageY-f,p=t.pageX,f=t.pageY,h.write(_))}),t.addEventListener("click",function(t){h.trapped||(u.x=t.pageX,u.y=t.pageY,c.request())}),c.on("attain",function(t){h.trapped=!0,t.pipe(h,{end:!1}),d.dispatch()}),c.on("release",function(){h.trapped=!1,m.dispatch()}),c.on("error",function(t){h.trapped=!1,m.dispatch()}),c.on("fullscreen",function(){r(t).once("attain",function(){c.request()}).request()}),h}},function(t,e,i){t.exports=pointer,pointer.available=function available(){return!!shim(document.body)};var n=i(43).EventEmitter,r=i(73).Stream;function pointer(t){var e,i=t.addEventListener||t.attachEvent,s=t.removeEventListener||t.detachEvent,o=t.ownerDocument,a=o.body,l=shim(t),c={dx:0,dy:0,dt:0},h=new n,u=null,d=4,m=0,p=0,f=0,_=0,g=0,b=0,y=0,x=0,v=!1;i.call(t,"mousedown",onmousedown,!1),i.call(t,"mouseup",onmouseup,!1),i.call(a,"mousemove",onmove,!1);for(var S=["","webkit","moz","ms","o"],w=0,M=S.length;w<M;++w)i.call(o,S[w]+"pointerlockchange",onpointerlockchange),i.call(o,S[w]+"pointerlockerror",onpointerlockerror);return h.release=release,h.target=pointerlockelement,h.request=onmousedown,h.destroy=function(){s.call(t,"mouseup",onmouseup,!1),s.call(t,"mousedown",onmousedown,!1),s.call(t,"mousemove",onmove,!1)},shim||setTimeout(function(){h.emit("error",new Error("pointer lock is not supported"))},0),h;function onmousedown(i){pointerlockelement()||(e=+new Date,l.call(t))}function onmouseup(t){v&&(h.emit("needs-fullscreen"),v=!1)}function onpointerlockchange(t){f=_=0,pointerlockelement()?((u=new r).readable=!0,u.initial={x:m,y:p,t:Date.now()},h.emit("attain",u)):u&&release()}function onpointerlockerror(t){+new Date-e<100?v=!0:(h.emit("error"),u&&u.emit("error",t),u=null)}function release(){h.emit("release"),u&&(u.emit("end"),u.readable=!1,u.emit("close"),u=null),pointerlockelement()&&(o.exitPointerLock||o.mozExitPointerLock||o.webkitExitPointerLock||o.msExitPointerLock||o.oExitPointerLock).call(o)}function onmove(t){if(m=t.pageX,p=t.pageY,u){var e=t.movementX||t.webkitMovementX||t.mozMovementX||t.msMovementX||t.oMovementX||0,i=t.movementY||t.webkitMovementY||t.mozMovementY||t.msMovementY||t.oMovementY||0;c.dx=e,c.dy=i,c.dt=Date.now()-u.initial.t,g+=e,b+=i;var n=!1;(e>0&&e>f||e<0&&e<-f)&&(f=Math.abs(e),n=!0),(i>0&&i>_||i<0&&i<-_)&&(_=Math.abs(i),n=!0),n&&(y=g,x=b),Math.abs(g-y)<d&&Math.abs(b-x)<d&&(c.dx=0,c.dy=0),h.emit("data",c),u.emit("data",c)}}function pointerlockelement(){return o.pointerLockElement||o.mozPointerLockElement||o.webkitPointerLockElement||o.msPointerLockElement||o.oPointerLockElement||null}}function shim(t){return t.requestPointerLock||t.webkitRequestPointerLock||t.mozRequestPointerLock||t.msRequestPointerLock||t.oRequestPointerLock||null}},function(t,e,i){"use strict";e.byteLength=function byteLength(t){var e=getLens(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function toByteArray(t){for(var e,i=getLens(t),n=i[0],o=i[1],a=new s(function _byteLength(t,e,i){return 3*(e+i)/4-i}(0,n,o)),l=0,c=o>0?n-4:n,h=0;h<c;h+=4)e=r[t.charCodeAt(h)]<<18|r[t.charCodeAt(h+1)]<<12|r[t.charCodeAt(h+2)]<<6|r[t.charCodeAt(h+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;2===o&&(e=r[t.charCodeAt(h)]<<2|r[t.charCodeAt(h+1)]>>4,a[l++]=255&e);1===o&&(e=r[t.charCodeAt(h)]<<10|r[t.charCodeAt(h+1)]<<4|r[t.charCodeAt(h+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e);return a},e.fromByteArray=function fromByteArray(t){for(var e,i=t.length,r=i%3,s=[],o=0,a=i-r;o<a;o+=16383)s.push(encodeChunk(t,o,o+16383>a?a:o+16383));1===r?(e=t[i-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return s.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=o.length;a<l;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function getLens(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function encodeChunk(t,e,i){for(var r,s,o=[],a=e;a<i;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,c=l>>1,h=-7,u=i?r-1:0,d=i?-1:1,m=t[e+u];for(u+=d,s=m&(1<<-h)-1,m>>=-h,h+=a;h>0;s=256*s+t[e+u],u+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+t[e+u],u+=d,h-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(m?-1:1);o+=Math.pow(2,n),s-=c}return(m?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,l,c=8*s-r-1,h=(1<<c)-1,u=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:s-1,p=n?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=h?(a=0,o=h):o+u>=1?(a=(e*l-1)*Math.pow(2,r),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;t[i+m]=255&a,m+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[i+m]=255&o,m+=p,o/=256,c-=8);t[i+m-p]|=128*f}},,function(t,e,i){"use strict";var n=i(49).Buffer,r=i(145);t.exports=function(){function BufferList(){!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},BufferList.prototype.unshift=function unshift(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},BufferList.prototype.concat=function concat(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e,i,r,s=n.allocUnsafe(t>>>0),o=this.head,a=0;o;)e=o.data,i=s,r=a,e.copy(i,r),a+=o.data.length,o=o.next;return s},BufferList}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+" "+t})},,function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function Timeout(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new Timeout(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new Timeout(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function onTimeout(){t._onTimeout&&t._onTimeout()},e))},i(147),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(35))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r=1,s={},o=!1,a=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){n=function(t){e.nextTick(function(){runIfPresent(t)})}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},n=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function installReadyStateChangeImplementation(){var t=a.documentElement;n=function(e){var i=a.createElement("script");i.onreadystatechange=function(){runIfPresent(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():function installSetTimeoutImplementation(){n=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&runIfPresent(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),n=function(i){t.postMessage(e+i,"*")}}(),l.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var o={callback:t,args:e};return s[r]=o,n(r),r++},l.clearImmediate=clearImmediate}function clearImmediate(t){delete s[t]}function runIfPresent(t){if(o)setTimeout(runIfPresent,0,t);else{var e=s[t];if(e){o=!0;try{!function run(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{clearImmediate(t),o=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(35),i(36))},function(t,e,i){(function(e){function config(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function deprecate(t,e){if(config("noDeprecation"))return t;var i=!1;return function deprecated(){if(!i){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}}}).call(this,i(35))},function(t,e,i){"use strict";t.exports=PassThrough;var n=i(80),r=i(44);function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);n.call(this,t)}r.inherits=i(34),r.inherits(PassThrough,n),PassThrough.prototype._transform=function(t,e,i){i(null,t)}},function(t,e,i){t.exports=i(67)},function(t,e,i){t.exports=i(30)},function(t,e,i){t.exports=i(66).Transform},function(t,e,i){t.exports=i(66).PassThrough},function(t,e,i){t.exports=fullscreen,fullscreen.available=function available(){return!!shim(document.body)};var n=i(43).EventEmitter;function fullscreen(t){for(var e=t.addEventListener||t.attachEvent,i=t.ownerDocument,r=(i.body,shim(t)),s=new n,o=["","webkit","moz","ms","o"],a=0,l=o.length;a<l;++a)e.call(i,o[a]+"fullscreenchange",onfullscreenchange),e.call(i,o[a]+"fullscreenerror",onfullscreenerror);return s.release=function release(){(t.exitFullscreen||t.exitFullscreen||t.webkitExitFullScreen||t.webkitExitFullscreen||t.mozExitFullScreen||t.mozExitFullscreen||t.msExitFullScreen||t.msExitFullscreen||t.oExitFullScreen||t.oExitFullscreen).call(t)},s.request=function request(){return r.call(t)},s.target=fullscreenelement,shim||setTimeout(function(){s.emit("error",new Error("fullscreen is not supported"))},0),s;function onfullscreenchange(){if(!fullscreenelement())return s.emit("release");s.emit("attain")}function onfullscreenerror(){s.emit("error")}function fullscreenelement(){return i.fullScreenElement||i.fullscreenElement||i.webkitFullScreenElement||i.webkitFullscreenElement||i.mozFullScreenElement||i.mozFullscreenElement||i.msFullScreenElement||i.msFullscreenElement||i.oFullScreenElement||i.oFullscreenElement||null}}function shim(t){return t.requestFullscreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.msRequestFullScreen||t.oRequestFullscreen||t.oRequestFullScreen}},function(t,e,i){(function(e){var n=i(73);function through(t,i,r){t=t||function(t){this.queue(t)},i=i||function(){this.queue(null)};var s=!1,o=!1,a=[],l=!1,c=new n;function drain(){for(;a.length&&!c.paused;){var t=a.shift();if(null===t)return c.emit("end");c.emit("data",t)}}return c.readable=c.writable=!0,c.paused=!1,c.autoDestroy=!(r&&!1===r.autoDestroy),c.write=function(e){return t.call(this,e),!c.paused},c.queue=c.push=function(t){return l?c:(null===t&&(l=!0),a.push(t),drain(),c)},c.on("end",function(){c.readable=!1,!c.writable&&c.autoDestroy&&e.nextTick(function(){c.destroy()})}),c.end=function(t){if(!s)return s=!0,arguments.length&&c.write(t),function _end(){c.writable=!1,i.call(c),!c.readable&&c.autoDestroy&&c.destroy()}(),c},c.destroy=function(){if(!o)return o=!0,s=!0,a.length=0,c.writable=c.readable=!1,c.emit("close"),c},c.pause=function(){if(!c.paused)return c.paused=!0,c},c.resume=function(){return c.paused&&(c.paused=!1,c.emit("resume")),drain(),c.paused||c.emit("drain"),c},c}t.exports=through,through.through=through}).call(this,i(36))},function(t,e,i){var n=i(157),r=i(81);t.exports=function(t){var e=new r.Signal;function onElementMouseWheel(t){var i;void 0!==t.wheelDelta?i=t.wheelDelta:void 0!==t.detail&&(i=-30*t.detail),e.dispatch(i,t)}n.addEvent(t,"mousewheel",onElementMouseWheel),n.addEvent(t,"DOMMouseScroll",onElementMouseWheel),this.onWheelSignal=e}},function(t,e){t.exports={addEvent:function(t,e,i){null!=t&&void 0!==t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)}}},function(t,e){t.exports=function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]}},function(t,e){t.exports=function isBuffer(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function inherits(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function inherits(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}]]);