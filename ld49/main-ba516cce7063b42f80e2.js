!function(e){function webpackJsonpCallback(t){for(var s,r,a=t[0],c=t[1],h=t[2],l=0,u=[];l<a.length;l++)r=a[l],n[r]&&u.push(n[r][0]),n[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(o&&o(t);u.length;)u.shift()();return i.push.apply(i,h||[]),checkDeferredModules()}function checkDeferredModules(){for(var e,t=0;t<i.length;t++){for(var s=i[t],r=!0,a=1;a<s.length;a++){var o=s[a];0!==n[o]&&(r=!1)}r&&(i.splice(t--,1),e=__webpack_require__(__webpack_require__.s=s[0]))}return e}var t={},n={0:0},i=[];function __webpack_require__(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)__webpack_require__.d(n,i,function(t){return e[t]}.bind(null,i));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],r=s.push.bind(s);s.push=webpackJsonpCallback,s=s.slice();for(var a=0;a<s.length;a++)webpackJsonpCallback(s[a]);var o=r;i.push([126,1]),checkDeferredModules()}([,,function(e,t,n){"use strict";const i=new class Device{constructor(){this.targetFPS=60,this.listeners=new Set,this.cachedPPCm=-1,this.handleChange=()=>{this.useTouch=/Mobi|Android|iPhone|iPad|BlackBerry|Windows Phone|webOS/i.test(navigator.userAgent),this.width===window.innerWidth&&this.height===window.innerHeight||(this.width=window.innerWidth,this.height=window.innerHeight,this.aspect=this.width/this.height,this.deviceHeight=Math.min(this.width,this.height),this.deviceWidth=Math.max(this.width,this.height),this.deviceAspect=this.deviceWidth/this.deviceHeight,this.pixelRatio=window.devicePixelRatio,this.orientation=this.aspect<1?"portrait":"landscape",this.type=this.useTouch?this.deviceWidth<1024&&this.deviceAspect>1.6?"mobile":"tablet":"desktop",this.listeners.forEach(e=>e()))},window.addEventListener("resize",()=>{this.handleChange(),setTimeout(this.handleChange,50)}),this.handleChange()}onChange(e,t=!1){return this.listeners.add(e),t&&e(),()=>this.listeners.delete(e)}get isMobile(){return"mobile"===this.type}get isTablet(){return"tablet"===this.type}get isDesktop(){return"desktop"===this.type}get pixelsPerCm(){if(-1===this.cachedPPCm){const e=document.createElement("div");e.style.height="1in";const t=document.getElementsByTagName("body")[0];t.appendChild(e);const n=getComputedStyle(e,null).getPropertyValue("height");t.removeChild(e),this.cachedPPCm=2.54*parseFloat(n)}return this.cachedPPCm}get screenHeightCms(){return this.height/this.pixelsPerCm}get screenWidthCms(){return this.width/this.pixelsPerCm}get screenShorterCms(){return Math.min(this.width,this.height)/this.pixelsPerCm}setFPS(e=60){this.targetFPS=e}};window.device=i,t.a=i},function(e,t,n){"use strict";n.d(t,"d",function(){return createPhysicBoxFromPixels}),n.d(t,"g",function(){return createStaticBox}),n.d(t,"f",function(){return createSensorBox}),n.d(t,"l",function(){return isArchitectParams}),n.d(t,"b",function(){return createArchitectMeshAndFixtures}),n.d(t,"k",function(){return getContactBetweenSensorAndRigidBody}),n.d(t,"h",function(){return deconstructConcavePath2}),n.d(t,"i",function(){return deconstructConcavePath3}),n.d(t,"j",function(){return makePolygonPhysics}),n.d(t,"o",function(){return textToPhysicsBodies}),n.d(t,"a",function(){return convertTob2Space}),n.d(t,"m",function(){return makeBitMask}),n.d(t,"p",function(){return translateCategoryBitsToString}),n.d(t,"e",function(){return createPhysicsCircle}),n.d(t,"c",function(){return createImprovedPhysicsCircle}),n.d(t,"n",function(){return queryForSingleArchitectureBody});var i=n(1),s=n(0),r=n(2),a=n(9),o=n(4),c=n(7),h=n(5),l=n(13),u=n(23),d=n(53),f=n(68);function createPhysicBoxFromPixels(e,t,n,s,r,a=!1){createStaticBox(e,(t+-16-.5*s)*o.g,(8-n-.5*r)*o.g,s*o.g,r*o.g,i.BodyType.b2_staticBody,void 0,void 0,a)}function createStaticBox(e,t,n,s,r,a=i.BodyType.b2_staticBody,o=.1,c=1,h=!1){const u=new i.BodyDef,d=new i.FixtureDef;u.fixedRotation=!1,u.type=a;const f=Object(l.a)(e).createBody(u);f.SetPositionXY(t,n),d.friction=o,d.restitution=.7,d.density=c,d.isSensor=h,a===i.BodyType.b2_staticBody&&(d.filter.categoryBits=makeBitMask(["environment"]));const p=(new i.PolygonShape).SetAsBox(.5*s,.5*r);return d.shape=p,f.CreateFixture(d),f}function createSensorBox(e,t,n,s,r,a,o,c=i.BodyType.b2_staticBody,h=.1,u=1,d=!0,f){const p=new i.BodyDef,g=new i.FixtureDef;p.fixedRotation=!1,p.type=c,p.userData=f;const m=Object(l.a)(e).createBody(p);m.SetPositionXY(t,n),g.friction=h,g.restitution=.7,g.density=u,g.isSensor=d,a&&o&&(g.filter.categoryBits=makeBitMask(a),g.filter.maskBits=makeBitMask(o));const y=(new i.PolygonShape).SetAsBox(.5*s,.5*r);return g.shape=y,m.CreateFixture(g),m}function isArchitectParams(e){return!!e&&("object"==typeof e&&("number"==typeof e.x&&("number"==typeof e.y&&("number"==typeof e.angle&&("string"==typeof e.meshName&&(void 0===e.colliderName||"string"==typeof e.colliderName))))))}async function createArchitectMeshAndFixtures(e,t){var n,s;const r=new i.BodyDef;r.fixedRotation=!1,r.type=null!==(n=t.bodyType)&&void 0!==n?n:i.BodyType.b2_dynamicBody,r.userData=t;const a=Object(l.a)(e).createBody(r);a.SetPositionXY(t.x,t.y),a.SetAngularVelocity(t.vAngle||0),a.SetLinearVelocity(new i.Vec2(t.vx,t.vy)),a.SetAngle(t.angle);const o=await Object(d.a)(a,t.meshName,null!==(s=t.colliderName)&&void 0!==s?s:"collider",t.categoryArray,t.maskArray);return Object(u.a)(e).createBody(a,o),{body:a,mesh:o}}const p=new class ContactPair{set(e,t){return this.sensor=e,this.rigidBody=t,this}};function getContactBetweenSensorAndRigidBody(e){const t=e.GetFixtureA(),n=e.GetFixtureB();if(t.m_isSensor!==n.m_isSensor)return t.m_isSensor?p.set(t,n):p.set(n,t)}const g=new s.Vector2;class AngledVec2{constructor(e,t){this.vec=e,this.angle=t}}function updateAngle(e,t){const n=t.indexOf(e.vec);return function updateAngledVec(e,t,n){const i=g.subVectors(t,e.vec).angle(),s=g.subVectors(e.vec,n).angle();e.angle=Object(h.i)(s-i,-Math.PI,Math.PI)}(e,Object(c.c)(t,n-1),Object(c.c)(t,n+1)),e}function deconstructConcavePath2(e){const t=[],n=e.slice(),i=e.map(e=>updateAngle(new AngledVec2(e,0),n));for(;n.length>=3;){i.sort((e,t)=>t.angle-e.angle);const e=i.shift(),s=n.indexOf(e.vec),r=[Object(c.c)(n,s-1),e.vec,Object(c.c)(n,s+1)];n.splice(s,1);for(const e of i)-1!==r.indexOf(e.vec)&&updateAngle(e,n);t.push(r)}return t.map(e=>Array.from(new Set(e))).filter(e=>e.length>=3)}class Edge{constructor(e,t){this.v1=e,this.v2=t}}function deconstructConcavePath3(e){const t=deconstructConcavePath2(e);console.warn("Not done yet.");const n=new Map;function findOrSet(e,t){return n.has(e)?n.get(e):void n.set(e,t)}for(const n of t)for(const t of n){const i=Object(c.b)(n,t),s=e.indexOf(t),r=e.indexOf(i);let a;a=s<r?findOrSet(s+"-"+r,new Edge(t,i)):findOrSet(r+"-"+s,new Edge(i,t))}return t}const m=new s.Vector2;function makePolygonPhysics(e,t,n,s=i.BodyType.b2_staticBody,r=m,a=function deconstructConcavePath(e){const t=[];let n,i=5;do{n=[],i--;let s=[];for(let i=0;i<e.length;i++){const r=Object(c.c)(e,i-1),a=Object(c.c)(e,i),o=Object(c.c)(e,i+1),l=g.subVectors(r,a).angle(),u=g.subVectors(a,o).angle();Object(h.i)(u-l,-Math.PI,Math.PI)>=0?s.push(r,a,o):(n.push(a),t.push(s),s=[a])}t.push(s),e=n}while(n.length>3&&i>0);return t.map(e=>Array.from(new Set(e))).filter(e=>e.length>=3)}){const o=new i.BodyDef;o.type=s,t||(t=Object(l.a)(e).createBody(o)),t.SetPositionXY(r.x,r.y);const u=a(n);for(const e of u){if(e.length<3)continue;const n=new i.FixtureDef,s=new i.PolygonShape;s.Set(e),n.shape=s,n.filter.categoryBits=makeBitMask(["environment"]),t.CreateFixture(n)}return t}function textToPhysicsBodies(e,t){const n=[];if(e.geometry instanceof s.BufferGeometry){const i=e.geometry.attributes.position.array,s=4*e.geometry.attributes.position.itemSize,r=e.position;for(let e=0;e<i.length;e+=s){const s=i[e+0],a=i[e+4],c=i[e+1],h=i[e+3],l=createStaticBox(t,5.275*((s+a)/2+r.x*o.g-.1),5.275*((c+h)/2+r.y*o.g),5.275*(a-s),6.5*(c-h));n.push(l)}}return n}function convertTob2Space(e,t,n){const s=new i.Vec2,o=(t/r.a.width*2-1)*(1/a.c)*r.a.aspect+e.offset.x,c=-(n/r.a.height*2-1)*(1/a.c)+e.offset.y;return s.Set(o,c),s}const y=["environment","architecture","penalty","goal","enemyWeapon","sound","noiseMaker","item","stink"];function makeBitMask(e){let t=0;for(const n of e)t|=Math.pow(2,y.indexOf(n)+1);return t}function translateCategoryBitsToString(e){const t=e.toString(2);if(t.indexOf("1")!==t.lastIndexOf("1"))throw new Error("Category Bits not a power of 2");const n=Math.log2(e)-1;return y[n]}function createPhysicsCircle(e,t,n,s,r=!0){const a=new i.CircleShape(s),o=new i.FixtureDef;o.shape=a,o.density=1,o.friction=.2,o.restitution=.7;const c=new i.BodyDef;c.type=i.BodyType.b2_dynamicBody;const h=Object(l.a)(e).createBody(c);return h.SetPositionXY(t,n),h.CreateFixture(o),h}function createImprovedPhysicsCircle(e,t,n,s,r,a,o,c,h,u,d){const f=new i.CircleShape(s),p=new i.FixtureDef;p.shape=f,p.density=1,u&&(p.density=u),p.friction=.2,p.restitution=.7;const g=new i.BodyDef;g.userData=o,g.type=d||i.BodyType.b2_dynamicBody,r&&a&&(p.filter.categoryBits=makeBitMask(r),p.filter.maskBits=makeBitMask(a)),c&&(p.isSensor=!0),h&&(g.bullet=!0);const m=Object(l.a)(e).createBody(g);return m.SetPositionXY(t,n),m.CreateFixture(p),m}new f.b(void 0);const w=new f.a(void 0),b=new i.AABB;function queryForSingleArchitectureBody(e,t,n){return n||(n=.001),b.lowerBound.Set(t.x-n,t.y-n),b.upperBound.Set(t.x+n,t.y+n),w.reset(),w.clickedGameSpace=t,e.QueryAABB(w,b),w.architectureBody?w.architectureBody:void 0}},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"g",function(){return r}),n.d(t,"h",function(){return a}),n.d(t,"a",function(){return o}),n.d(t,"d",function(){return c}),n.d(t,"e",function(){return h}),n.d(t,"f",function(){return l}),n.d(t,"c",function(){return u});var i=n(6);const s=Object(i.b)("resetSettings"),r=.05,a=.2,o=.5,c=30,h=5,l=6,u=-10},function(e,t,n){"use strict";n.d(t,"b",function(){return clamp}),n.d(t,"i",function(){return wrap}),n.d(t,"a",function(){return absFloor}),n.d(t,"c",function(){return hitTestPlaneAtPixel}),n.d(t,"e",function(){return lerp}),n.d(t,"f",function(){return rand}),n.d(t,"h",function(){return randInt}),n.d(t,"g",function(){return rand2}),n.d(t,"d",function(){return inferDirection});var i=n(1),s=n(0);n(2);function clamp(e,t,n){return Math.min(n,Math.max(t,e))}function wrap(e,t,n){const i=n-t;return((e-t)%i+i)%i+t}function absFloor(e){return Math.floor(Math.abs(e))*(e<0?-1:1)}Math.PI,Math.PI,Math.PI;new s.Ray,new s.Plane(new s.Vector3(0,-1,0),1),new s.Plane(new s.Vector3(0,-1,0),1),new s.Vector3;new s.Vector2,new s.Raycaster;const r=new s.Ray,a=new s.Vector3;function hitTestPlaneAtPixel(e,t,n,i){return i instanceof s.PerspectiveCamera?(r.origin.setFromMatrixPosition(i.matrixWorld),r.direction.set(e,t,.5).unproject(i).sub(r.origin).normalize()):i instanceof s.OrthographicCamera?(r.origin.set(e,t,(i.near+i.far)/(i.near-i.far)).unproject(i),r.direction.set(0,0,-1).transformDirection(i.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type: "+i.type),r.intersectPlane(n,a)?a:null}function lerp(e,t,n){const i=e+n*(t-e);return Math.abs(t-i)>1e-5?i:t}Math.PI,Math.PI;function rand(e=0,t=1){return Math.random()*(t-e)+e}function randInt(e=1,t=0){return~~(Math.random()*e)+t}function rand2(e=1,t=0){return(2*Math.random()-1)*e+t}function inferDirection(e,t=1e-5){return e<-t?-1:e>t?1:0}new i.Vec2},function(e,t,n){"use strict";n.d(t,"e",function(){return getUrlParam}),n.d(t,"b",function(){return getUrlFlag}),n.d(t,"c",function(){return getUrlFloat}),n.d(t,"d",function(){return getUrlInt}),n.d(t,"a",function(){return getUrlColor});var i=n(0),s=n(52),r=n(5);function getUrlParam(e){return function __setReminder(e){a.includes(e)||(a.push(e),o||(o=!0,setTimeout(()=>{console.log("Nice Parameters to try: "+a.join(", ")),o=!1},2e3)))}(e),new URL(window.location.href).searchParams.get(e)}function getUrlFlag(e){const t=getUrlParam(e);return!!(""===t||t&&"false"!==t)}function __getUrlNumber(e,t,n,i=-1/0,s=1/0){return Object(r.b)(n(getUrlParam(e)||t.toString()),i,s)}function getUrlFloat(e,t,n=-1/0,i=1/0){return __getUrlNumber(e,t,parseFloat,n,i)}function getUrlInt(e,t,n=-1/0,i=1/0){return __getUrlNumber(e,t,parseInt,n,i)}function getUrlColor(e,t){let n=getUrlParam(e);if(!n){if(t instanceof i.Color)return t;n=t}return Object(s.a)("#"+n)}const a=[];let o=!1},function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"a",function(){return r}),n.d(t,"c",function(){return getArrWrap}),n.d(t,"b",function(){return getArrNext});n(5);const i=(e,t,n=!1)=>{const i=e.indexOf(t);if(-1!==i)e.splice(i,1);else if(n)throw new Error("could not find value in array");return t};const s=(e,t,n,i=!1)=>{e.has(t)||e.set(t,[]);const s=e.get(t);s&&(i?-1===s.indexOf(n)&&s.push(n):s.push(n))},r=(e,t,n)=>{if(!e.has(t))return;const s=e.get(t);s&&(i(s,n),0===s.length&&e.delete(t))};function getArrWrap(e,t){const n=e.length;return e[(t%n+n)%n]}function getArrNext(e,t){return getArrWrap(e,e.indexOf(t)+1)}},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var i=n(16),s=n(19),r=n(97);const a={fontFace:s.a.GothicA1Regular,size:24,align:"center",vAlign:"center",letterSpacing:0,color:i.d,strokeWidth:0,strokeBias:1,alphaTest:0,strokeColor:i.a,scaleDownToPhysicalSize:!0,shadow:!1,screenSpace:!1,constantSizeOnScreen:!1,prescale:1},o={...a,fontFace:s.a.GothicA1Bold,scaleDownToPhysicalSize:!1},c={...o,fontFace:s.a.GothicA1ExtraBold},h={...c,strokeColor:i.a,strokeBias:1,strokeWidth:.45},l={...o,...r.a.title,lineHeight:1.175,size:72,color:i.a,strokeWidth:.5,strokeBias:.5,strokeColor:i.d,fontFace:s.a.GothicA1ExtraBold},u={...a,lineHeight:1.175,size:24,color:i.d,fontFace:s.a.GothicA1Regular},d={...u,lineHeight:1.2,fontFace:s.a.GothicA1Bold,size:14},f={...u,fontFace:s.a.GothicA1Bold,size:10},p={...a,align:"left",fontFace:s.a.CourierPrimeRegular,size:32,lineHeight:3,color:39168},g={...o,fontFace:s.a.CourierPrimeRegular,size:72},m={...g,size:32},y={generic:a,leaderBoardTitle:g,leaderBoardEntry:m,leaderBoardEntryLeft:{...m,align:"left"},leaderBoardEntryRight:{...m,align:"right"},ui:o,bold:c,height:h,title:l,keyLabel:u,keyLabelDouble:d,keyLabelSmall:f,code:p}},function(e,t,n){"use strict";n.d(t,"c",function(){return h}),n.d(t,"b",function(){return m}),n.d(t,"a",function(){return Box2DPreviewMesh});var i=n(1),s=n(0),r=n(2),a=n(89),o=n(6),c=n(5);let h=.6;const l=16,u=6,d=new s.Vector3(1,0,0),f=(new s.Matrix4).compose(new s.Vector3(.5,.5,.5),new s.Quaternion,new s.Vector3(.5,.5,.5)),p=new s.Quaternion,g=new s.Vector3(.5,.5,.5),m={value:Object(o.b)("debugPhysicsPolygon")};class DebugColors{constructor(){this.fixtureColors=new Map,this.bodyMatrices=new Map}getFixtureColor(e){if(!this.fixtureColors.has(e)){const t=new s.Vector3(Object(c.g)(),Object(c.g)(),Object(c.g)()).applyMatrix4(this.getBodyMatrix(e.m_body)).applyMatrix4(f);return this.fixtureColors.set(e,t),t}return this.fixtureColors.get(e)}getBodyMatrix(e){if(!this.bodyMatrices.has(e)){const t=(new s.Matrix4).compose(new s.Vector3(Object(c.g)(.5,.5),Object(c.g)(.5,.5),Object(c.g)(.5,.5)),p,g);return this.bodyMatrices.set(e,t),t}return this.bodyMatrices.get(e)}}function getShapeWorldVerts(e,t){switch(e.m_type){case i.ShapeType.e_polygonShape:return m.value?function getPolygonShapeWorldVerts(e,t){return e.m_vertices.map(e=>{const n=new i.Vec2;return t.GetWorldPoint(e,n),n.x/=r.a.aspect,n})}(e,t):void 0;case i.ShapeType.e_circleShape:return function getCircleShapeWorldVerts(e,t){const n=[],s=e.m_radius,a=e.m_p;for(let e=0;e<l;e++){const o=e/l*Math.PI*2,c=new i.Vec2(Math.cos(o)*s,Math.sin(o)*s).SelfAdd(a),h=new i.Vec2;t.GetWorldPoint(c,h),h.x/=r.a.aspect,n.push(h)}return n}(e,t);default:return void console.error("unsupported box2d shape type for debug view")}}function getShapeWorldVertsCount(e){switch(e.m_type){case i.ShapeType.e_polygonShape:return m.value?e.m_vertices.length:0;case i.ShapeType.e_circleShape:return l;default:return 0}}function getContactWorldVerts(e){const t=[];for(let n=0;n<u;n++){const s=n/u*Math.PI*2,a=new i.Vec2(.02*Math.cos(s),.02*Math.sin(s)).SelfAdd(e);a.x/=r.a.aspect,t.push(a)}return t}function createGeometry(e,t,n){let a=0,o=e.m_bodyList;for(;o;){let e=o.m_fixtureList;for(;e;)a+=getShapeWorldVertsCount(e.m_shape)+3,e=e.m_next;o=o.m_next}const c=e.GetContactManager();let l=c.m_contactList;for(;l;)l.IsTouching()&&(a+=2*(u+3)),l=l.m_next;const f=new s.BufferGeometry;f.boundingSphere=new s.Sphere(void 0,1/0);const p=new Float32Array(2*a),g=new Float32Array(4*a);let m=0,y=0;function writeVert(e,t,n=1){p[m]=e.x,p[m+1]=e.y,m+=2,t.toArray(g,y),g[y+3]=n,y+=4}o=e.m_bodyList;const w=new i.Vec2(n.x/r.a.aspect,n.y);for(;o;){let e=o.m_fixtureList;for(;e;){const n=getShapeWorldVerts(e.m_shape,o);if(n){addVertsToGeometry(n,t.getFixtureColor(e))}e=e.m_next}o=o.m_next}for(l=c.m_contactList;l;){if(l.IsTouching())for(const e of[l.GetFixtureA(),l.GetFixtureB()]){addVertsToGeometry(getContactWorldVerts(e.GetBody().GetPosition()),d)}l=l.m_next}return f.setAttribute("position",new s.Float32BufferAttribute(p,2)),f.setAttribute("color",new s.Float32BufferAttribute(g,4)),f;function addVertsToGeometry(e,t){if(0!==n.x||0!==n.y)for(const t of e)t.SelfSub(w);if("landscape"===r.a.orientation&&r.a.isMobile?h=1.2:"portrait"===r.a.orientation&&r.a.isMobile&&(h=.55),1!==h)for(const t of e)t.SelfMul(h);const i=e[0];writeVert(i,t,0);for(const n of e)writeVert(n,t,1);writeVert(i,t,1),writeVert(i,t,0)}}class Box2DPreviewMesh extends s.Line{constructor(e){const t=new DebugColors,n=new i.Vec2;super(createGeometry(e,t,n),new a.a),this.debugColors=t,this.b2World=e,this.offset=n,this.renderOrder=1e5}update(e){this.geometry.dispose(),this.geometry=createGeometry(this.b2World,this.debugColors,this.offset)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TextMesh});var i=n(0),s=n(95),r=n.n(s),a=n(21),o=n(69),c=n(55),h=n(56),l=n(20),u=n(96),d=n.n(u),f=n(8),p=n(98),g=n.n(p);class Gradient{constructor(e){Object.keys(e).forEach(t=>{const n=e[t];if(n){const e=_(n);this[t]=e}})}set top(e){this.topLeft=_(e),this.topRight=_(e)}set bottom(e){this.bottomLeft=_(e),this.bottomRight=_(e)}set left(e){this.topLeft=_(e),this.bottomLeft=_(e)}set right(e){this.topRight=_(e),this.bottomRight=_(e)}}const m=new i.Matrix4,y=[];class TextMesh extends i.Mesh{constructor(e="",t=f.a.generic,n,i,s,r=!0){super(v(e,t),w(t)),this.onFontFaceChange=(e,t)=>{t&&(Object(l.b)(t,"msdfTexture",this.onFontTextureUpdate),Object(l.b)(t,"font",this.onFontUpdate)),Object(l.a)(e,"msdfTexture",this.onFontTextureUpdate),Object(l.a)(e,"font",this.onFontUpdate),e.init(),this._fontFace=e},this.onFontTextureUpdate=e=>{this.newTexture=e,this.dirty=!0},this.onFontUpdate=e=>{this.dirty=!0},this.onBeforeRender=(e,t,n,i,s,r)=>{if(this.settings.screenSpace){const e=this.material.uniforms.clipSpacePosition.value;m.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld).premultiply(n.projectionMatrix),e.set(0,0,0,1).applyMatrix4(m)}this.dirty&&(this.dirty=!1,this.regenerateGeometry(),this.newTexture&&(this.optimizeRenderOrder&&(this.renderOrder=this.renderOrder||100+function getFontFaceSubOrder(e){if(!e)return-1;const t=y.indexOf(e);return-1===t?(y.push(e),y.length-1):t}(this.newTexture)),this.material.uniforms.msdf.value=this.newTexture,this.newTexture=void 0))},this.updateText=(e="")=>{this.text=`${e}`},this.onMeasurementsUpdated=s,this.optimizeRenderOrder=r,Object(l.a)(t,"fontFace",this.onFontFaceChange,!0),this._text=e,this.updateMeasurements(),this.userData.isFrontFacing=!0,this.userData.doNotBillboard=!0,this.settings=t,this.livePropObject=n,this.livePropName=i,this.frustumCulled=!1}set text(e){"number"==typeof e&&(e=String(e)),this._text!==e&&(this._text=e,this.dirty=!0)}set color(e){"object"!=typeof e&&(e=_(e)),this._globalColor=e;const{topLeft:t,topRight:n,bottomLeft:i,bottomRight:s}=x(e),r=this.geometry.getAttribute("color");if(r){const e=r.array;for(let r=0;r<e.length;r+=12)e.set(t,r+0),e.set(i,r+3),e.set(s,r+6),e.set(n,r+9);r.needsUpdate=!0}}set strokeWidth(e){const t=this.material;if(t.uniforms.strokeWidth.value!==e){t.uniforms.strokeWidth.value=e;const n=e>0;n!==t.defines.USE_STROKE&&(t.defines.USE_STROKE=n,t.needsUpdate=!0)}}get opacity(){return this.material.uniforms.opacity.value}set opacity(e){this.material.uniforms.opacity.value=e}onAdd(){this.livePropObject&&this.livePropName&&Object(l.a)(this.livePropObject,this.livePropName,this.updateText,!0)}onRemove(){Object(l.b)(this.settings,"fontFace",this.onFontFaceChange),this.livePropObject&&this.livePropName&&Object(l.b)(this.livePropObject,this.livePropName,this.updateText),this._fontFace&&(Object(l.b)(this._fontFace,"msdfTexture",this.onFontTextureUpdate),Object(l.b)(this._fontFace,"font",this.onFontUpdate))}setSize(e,t){}regenerateGeometry(){this.geometry&&this.geometry!==b&&Object(h.b)(()=>this.geometry.dispose()),this.geometry=v(this._text,this.settings,this._globalColor),this.updateMeasurements()}updateMeasurements(){this.geometry.boundingBox||this.geometry.computeBoundingBox();const e=this.geometry.boundingBox;this.width=e.max.x-e.min.x,this.height=Math.abs(e.max.y-e.min.y),this.userData.resolution=new i.Vector2(this.width,this.height),this.onMeasurementsUpdated&&this.onMeasurementsUpdated(this)}}const w=e=>{const t={msdf:new i.Uniform(e.fontFace.msdfTexture),alphaTest:new i.Uniform(e.alphaTest),strokeWidth:new i.Uniform(e.strokeWidth),strokeBias:new i.Uniform(e.strokeBias),strokeColor:new i.Uniform(new i.Color(e.strokeColor)),opacity:new i.Uniform(1)};e.screenSpace&&(t.offset=new i.Uniform(e.offset),t.clipSpacePosition=new i.Uniform(new i.Vector4),t.pixelSizeInClipSpace=a.b,t.prescale=new i.Uniform(e.prescale));const n=e.alphaTest>0&&e.alphaTest<1&&!e.shadow,s=new i.ShaderMaterial({defines:{USE_STROKE:e.strokeWidth>0,USE_ALPHATEST:n,USE_SHADOW:e.shadow,USE_SCREENSPACE:e.screenSpace,CONSTANT_SIZE_ON_SCREEN:e.constantSizeOnScreen},uniforms:t,vertexShader:g(),fragmentShader:d(),transparent:!0,depthWrite:n,extensions:{derivatives:!0}});return s.extensions.derivatives=!0,Object.defineProperty(s,"opacity",{get:()=>s.uniforms.opacity.value,set:e=>s.uniforms.opacity.value=e}),s},b=new i.PlaneBufferGeometry(.001,.001);b.computeBoundingBox();const v=(e,t,n)=>t.fontFace.font&&e?C(e,t,n):b,C=(e,t,n)=>{const s=t.fontFace.font,a=(e=>Array.isArray(e)?e.reduce((e,t)=>e.concat(t.text),""):String(e))(e),h=r()({text:`${a}`,font:s,align:t.align,width:void 0!==t.width?t.width/t.size*s.info.size:void 0,lineHeight:void 0!==t.lineHeight?t.lineHeight*s.info.size:void 0,letterSpacing:t.letterSpacing}),l=h.getAttribute("position").array,u=l.length/2,d=S(n||t.color),f=Array.isArray(e)?e:[{text:a,color:d}],{base:p}=s.common,g=new Float32Array(3*u),m=new Float32Array(u);let y=0;f.forEach(e=>{const{topLeft:t,topRight:n,bottomLeft:i,bottomRight:r}=x(e.color),a=e.fontWeight||1,o=e.italicSkew||0,c=e.xOffset||0,h=e.yOffset||0,u=e.text.replace(/\s+/g,""),d=y,f=y+u.length;for(let e=d;e<f;e++){const d=12*e,f=4*e,w=2*f,b=u[e-y],v=s.chars.find(e=>String(e.char)===b);g.set(t,d+0),g.set(i,d+3),g.set(r,d+6),g.set(n,d+9),m[f+0]=a,m[f+1]=a,m[f+2]=a,m[f+3]=a;const C=p*o,_=v.height+v.yoffset-p,S=(p-v.yoffset)/p*C,x=_>0?_/p*-C:0;l[w+0]+=S,l[w+6]+=S,l[w+2]+=x,l[w+4]+=x,l[w+0]+=c,l[w+1]+=h,l[w+2]+=c,l[w+3]+=h,l[w+4]+=c,l[w+5]+=h,l[w+6]+=c,l[w+7]+=h}y=f}),h.setAttribute("color",new i.BufferAttribute(g,3)),h.setAttribute("weight",new i.BufferAttribute(m,1));const w=t.bakedOffset?t.bakedOffset.x:0,b=t.bakedOffset?t.bakedOffset.y:0;h.computeBoundingBox();const v=h.boundingBox;if(t.width){const e=h.layout.width;v.max.x=e-v.min.x}const C=v.min,_=v.max,M=h.attributes.position,B=M.itemSize,P=M.array;if("1"===e)for(let e=0;e<P.length;e+=B)P[e]-=2;const k=_.x-C.x,O=h.layout,T=(O._linesTotal-1)*O.lineHeight+O.capHeight,j=w+k*Object(o.a)(t.align)-C.x,L=b+T*Object(o.b)(t.vAlign);for(let e=0;e<P.length;e+=B)P[e]+=j,P[e+1]+=L;_.x+=j,C.x+=j,_.y+=L,C.y+=L;for(let e=1;e<P.length;e+=B)P[e]*=-1;C.y*=-1,_.y*=-1;let A=t.size/s.info.size;t.scaleDownToPhysicalSize&&(A/=c.a);for(let e=0;e<P.length;e++)P[e]*=A;if(C.multiplyScalar(A),_.multiplyScalar(A),C.y>_.y){const e=C.y;C.y=_.y,_.y=e}return h},_=e=>e instanceof i.Color?e:new i.Color(e),S=e=>e instanceof Gradient?e:new Gradient({top:e,bottom:e}),x=e=>({topLeft:(e=S(e||16777215)).topLeft.toArray(),topRight:e.topRight.toArray(),bottomLeft:e.bottomLeft.toArray(),bottomRight:e.bottomRight.toArray()})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=new(n(86).a)(void 0,!1)},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsScene});var i=n(1),s=n(9),r=n(13),a=n(3),o=n(5),c=n(27);class TestPhysicsScene extends c.a{constructor(e=!0,t=20,n=!0){super(),this.circleBodies=[];const c=new i.World(new i.Vec2(0,-9.8));Object(r.a)(c).init(c);const h=new s.a(c);this.scene.add(h),this.b2World=c,this.b2Preview=h;for(let e=0;e<t;e++){const e=Object(a.e)(this.b2World,Object(o.f)(-1,1),1+Object(o.f)(-.2,.2),.05,n);this.circleBodies.push(e)}if(e){Object(a.g)(this.b2World,0,-.3,1,.1),Object(a.g)(this.b2World,.2,.3,1,.1),Object(a.g)(this.b2World,1.8,0,1,.1).SetAngle(.25*Math.PI)}}update(e){super.update(e),this.b2World.Step(e,10,4),this.b2Preview.update(e);for(const e of this.circleBodies){e.GetPosition().y<-2&&(e.SetLinearVelocity(new i.Vec2(0,0)),e.SetPositionXY(Object(o.f)(-1,1),1+Object(o.f)(-.2,.2)))}}render(e){super.render(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return getBodyEventManager});var i=n(7);class BodyEventManager{constructor(){this.bodies=[],this.createCallbacks=[],this.destroyCallbacks=[]}init(e){if(this.world)throw new Error("cannot initialize twice");this.world=e}createBody(e){const t=this.world.CreateBody(e);for(const e of this.createCallbacks)e(t);return this.bodies.push(t),t}destroyBody(e){Object(i.e)(this.bodies,e);for(const t of this.destroyCallbacks)t(e);this.world.DestroyBody(e)}startListeningForCreate(e){for(const t of this.bodies)e(t);this.createCallbacks.push(e)}startListeningForDestroy(e){this.destroyCallbacks.push(e)}}const s=new Map;function getBodyEventManager(e){return s.has(e)||s.set(e,new BodyEventManager),s.get(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestLightingScene});var i=n(0),s=n(40),r=n(6),a=n(105),o=n(27);class TestLightingScene extends o.a{constructor(e=!0,t=!0){super();const n=Object(a.a)(this.scene,this.bgColor);this.sunLight=n.sunLight,this.ambientLight=n.ambientLight;const o=new s.a(this.camera);Object(r.b)("fpsCam")&&o.toggle(!0);(async()=>{const n=new i.MeshStandardMaterial({color:11197934,roughness:.7});if(t){const e=new i.Mesh(new i.PlaneBufferGeometry(1,1,1,1),n);e.scale.multiplyScalar(10),e.castShadow=!1,e.receiveShadow=!0,this.scene.add(e),e.rotation.x=-.5*Math.PI}if(e){const e=new i.Mesh(new i.SphereBufferGeometry(.3,32,16),n);e.castShadow=!0,e.receiveShadow=!0,e.position.x=-.3,e.position.y=.3,e.name="Sphere",this.scene.add(e);const t=new i.Mesh(new i.BoxBufferGeometry(.6,.6,.6),n);t.castShadow=!0,t.receiveShadow=!0,t.position.x=.3,t.position.y=.3,t.name="Cube",this.scene.add(t)}})()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i={Linear:e=>e,Quadratic:{In:e=>e*e,Out:e=>e*(2-e),InOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Cubic:{In:e=>e*e*e,Out:e=>--e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Quartic:{In:e=>e*e*e*e,Out:e=>1- --e*e*e*e,InOut:e=>(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},Quintic:{In:e=>e*e*e*e*e,Out:e=>--e*e*e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},Sinusoidal:{In:e=>1-Math.cos(e*Math.PI/2),Out:e=>Math.sin(e*Math.PI/2),InOut:e=>.5*(1-Math.cos(Math.PI*e))},Exponential:{In:e=>0===e?0:Math.pow(1024,e-1),Out:e=>1===e?1:1-Math.pow(2,-10*e),InOut:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},Circular:{In:e=>1-Math.sqrt(1-e*e),Out:e=>Math.sqrt(1- --e*e),InOut:e=>(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},Elastic:{In(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut(e){let t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)}},Back:{In(e){const t=1.70158;return e*e*((t+1)*e-t)},Out(e){const t=1.70158;return--e*e*((t+1)*e+t)+1},InOut(e){const t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:e=>1-i.Bounce.Out(1-e),Out:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,InOut:e=>e<.5?.5*i.Bounce.In(2*e):.5*i.Bounce.Out(2*e-1)+.5}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"d",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return o});var i=n(0);const s=new i.Color(0),r=new i.Color(16777215),a=new i.Color(0,1,0),o=new i.Color(.7,.7,.7)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(0);const s=new class MaterialLibrary{get keyboardPlasticKey(){return this._keyboardPlasticKey||(this._keyboardPlasticKey=new i.MeshStandardMaterial({color:15654314})),this._keyboardPlasticKey}get keyboardPlasticKeyMouth(){return this._keyboardPlasticKeyMouth||(this._keyboardPlasticKeyMouth=new i.MeshStandardMaterial({color:2232593,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticKeyMouth}get scoopMask(){return this._scoopMask||(this._scoopMask=new i.MeshBasicMaterial({color:16711935,depthWrite:!1,colorWrite:!1})),this._scoopMask}get keyboardPlasticKeyUnderside(){return this._keyboardPlasticKeyUnderside||(this._keyboardPlasticKeyUnderside=new i.MeshStandardMaterial({color:15654314,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticKeyUnderside}get keyboardPlastic(){return this._keyboardPlastic||(this._keyboardPlastic=new i.MeshStandardMaterial({color:11180441})),this._keyboardPlastic}get keyboardPlasticHole(){return this._keyboardPlasticHole||(this._keyboardPlasticHole=new i.MeshStandardMaterial({color:5588036,depthFunc:i.GreaterDepth,side:i.BackSide})),this._keyboardPlasticHole}get levelMaterial(){return this._levelMaterial||(this._levelMaterial=new i.MeshStandardMaterial({color:1122867})),this._levelMaterial}}},function(e,t,n){"use strict";n.d(t,"a",function(){return changeCursor});const i=[void 0,void 0,void 0,void 0];function changeCursor(e,t){if(e!==i[t]){i[t]=e;for(let t=i.length-1;t>=0;t--)if(void 0!==i[t]){e=i[t];break}document.body.style.cursor=e||"default"}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),s=n(70);function url(e,t){return`fonts/${e}.${t}`}class FontFace{constructor(e){this.name=e}async init(){this.initd||(this.initd=!0,this.msdfTexture=await Object(s.b)(url(this.name,"png")),this.msdfTexture.minFilter=i.LinearFilter,this.msdfTexture.magFilter=i.LinearFilter,this.font=await Object(s.a)(url(this.name,"json")))}}const r={CourierPrimeRegular:new FontFace("CourierPrime-Regular"),CourierPrimeBold:new FontFace("CourierPrime-Bold"),GothicA1Black:new FontFace("GothicA1-Black"),GothicA1Bold:new FontFace("GothicA1-Bold"),GothicA1ExtraBold:new FontFace("GothicA1-ExtraBold"),GothicA1ExtraLight:new FontFace("GothicA1-ExtraLight"),GothicA1Light:new FontFace("GothicA1-Light"),GothicA1Medium:new FontFace("GothicA1-Medium"),GothicA1Regular:new FontFace("GothicA1-Regular"),GothicA1SemiBold:new FontFace("GothicA1-SemiBold"),GothicA1Thin:new FontFace("GothicA1-Thin")}},function(e,t,n){"use strict";n.d(t,"a",function(){return listenToProperty}),n.d(t,"b",function(){return stopListeningToProperty});var i=n(7);class LiveProperty{constructor(e,t){this.propName=t,this.listeners=[],this.setValue=this.setValue.bind(this),this.attach(e)}get listenerCount(){return this.listeners.length}attach(e){this.obj&&this.release(),this.obj=e;const t=this.obj[this.propName];Object.defineProperty(e,this.propName,{configurable:!0,set:this.setValue,get:()=>this.value}),this.setValue(t)}release(){Object.defineProperty(this.obj,this.propName,{value:this.value,writable:!0})}hasListener(e){return-1!==this.listeners.indexOf(e)}addListener(e,t=!0){t&&e(this.value,void 0),this.listeners.push(e)}removeListener(e){Object(i.e)(this.listeners,e)}setValue(e){if(this.value===e)return;const t=this.value;this.value=e;for(const n of this.listeners)n(e,t)}}const s=new Map;function getObjectPropGroup(e){return s.has(e)||s.set(e,new Map),s.get(e)}function listenToProperty(e,t,n,i=!0){(function getLiveProperty(e,t){const n=getObjectPropGroup(e);return n.has(t)||n.set(t,new LiveProperty(e,t)),n.get(t)})(e,t).addListener(n,i)}function stopListeningToProperty(e,t,n){const i=s.get(e);if(i){const r=i.get(t);r&&(r.removeListener(n),0===r.listenerCount&&(r.release(),i.delete(t))),0===i.size&&s.delete(e)}}},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o});var i=n(0),s=n(2);const r=new i.Uniform(0),a=new i.Uniform(s.a.pixelRatio),o=new i.Uniform(new i.Vector2(2/s.a.width,2/s.a.height))},function(e,t,n){"use strict";n.d(t,"c",function(){return SimpleGUIOverlay}),n.d(t,"b",function(){return ToggleButtonUserData}),n.d(t,"a",function(){return ButtonUserData});var i=n(0),s=n(2),r=n(32),a=n(4),o=n(57),c=n(7),h=n(25),l=n(5);const u=new i.Raycaster;class SimpleGUIOverlay{constructor(){this.onOverlayActiveChange=new h.a,this.overlayActive=new o.a(e=>{this._camera.top=Object(l.e)(.25*window.innerHeight,0,e),this._camera.bottom=Object(l.e)(.75*window.innerHeight,window.innerHeight,e),this._camera.left=Object(l.e)(.25*window.innerWidth,0,e),this._camera.right=Object(l.e)(.75*window.innerWidth,window.innerWidth,e),this._camera.updateProjectionMatrix(),this.onOverlayActiveChange.dispatch(e)},!0),this.narrowerWindowDimension=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,this.squareButtonDimensions=2,this.scene=new i.Scene,this._camera=new i.OrthographicCamera(0,window.innerWidth,0,window.innerHeight,1,200),this._fixedRadius=33.3,this._uiMeshes=[],this._uiButtonMeshes=[],this.scene.add(this._camera),s.a.onChange(()=>{this._camera.right=window.innerWidth,this._camera.bottom=window.innerHeight,this._camera.updateProjectionMatrix(),this.narrowerWindowDimension=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,"landscape"===s.a.orientation&&s.a.isMobile?(this.relativeButtonSpacingWidth=window.innerWidth/18,this.relativeButtonSpacingHeight=window.innerHeight/8):"portrait"===s.a.orientation&&s.a.isMobile?(this.relativeButtonSpacingHeight=window.innerHeight/18,this.relativeButtonSpacingWidth=window.innerWidth/10):(this.relativeButtonSpacingWidth=window.innerWidth/18,this.relativeButtonSpacingHeight=window.innerHeight/8)},!0)}rayCastForButton(e,t){Object(r.a)(u,e,t,this._camera);const n=u.intersectObjects(this._uiButtonMeshes);for(const e of n)if(e.object.userData instanceof ToggleButtonUserData||e.object.userData instanceof ButtonUserData)return e.object.userData}setPosition(e,t,n){e.position.set(t,n,a.c)}removeUI(e){return this.scene.remove(e),Object(c.e)(this._uiMeshes,e),e}removeButtonUI(e){return this.scene.remove(e),Object(c.e)(this._uiButtonMeshes,e),e}render(e){e.render(this.scene,this._camera)}makeTimerBar(e,t,n,i=!0){const s=this._makeUI(this.getTimerBarGeometry(),e,t,n,i);return s.material.color.set("white"),s.material.opacity=.5,s}makeBiggerCircle(e,t){return this._makeUI(this.getBiggerCircleGeometry(),e,t)}makeBigCircle(e,t){return this._makeUI(this.getBigCircleGeometry(),e,t)}makeMediumCircle(e,t){return this._makeUI(this.getMediumCircleGeometry(),e,t)}makeSmallCircle(e,t){return this._makeUI(this.getSmallCircleGeometry(),e,t)}makeSmallSquare(e,t,n,i=!1){return this._makeUI(this.getSmallSquareGeometry(),e,t,n,i)}registerButton(e){this._uiButtonMeshes.push(e)}_makeUI(e,t,n,s,r=!1){const o=new i.Mesh(e,this.getMaterial(r));return o.position.set(t,n,a.c),o.rotation.x=Math.PI,o.scale.setScalar(this._fixedRadius),this.scene.add(o),s?this._uiButtonMeshes.push(o):this._uiMeshes.push(o),o}getMaterial(e=!1){return this._material||(this._material=new i.MeshBasicMaterial({opacity:.3,transparent:!0})),e?this._material.clone():this._material}getBiggerCircleGeometry(){return this._geometryBigger||(this._geometryBigger=new i.CircleBufferGeometry(3.5,32)),this._geometryBigger}getBigCircleGeometry(){return this._geometryBig||(this._geometryBig=new i.CircleBufferGeometry(2.5,32)),this._geometryBig}getMediumCircleGeometry(){return this._geometryMedium||(this._geometryMedium=new i.CircleBufferGeometry(1,32)),this._geometryMedium}getSmallCircleGeometry(){return this._geometrySmall||(this._geometrySmall=new i.CircleBufferGeometry(.5,32)),this._geometrySmall}getSmallSquareGeometry(){return this._geometrySqaureSmall||(this._geometrySqaureSmall=new i.PlaneBufferGeometry(this.squareButtonDimensions,this.squareButtonDimensions)),this._geometrySqaureSmall}getTimerBarGeometry(){return this._geometryTimerBar||(this._geometryTimerBar=new i.PlaneBufferGeometry(1,1)),this._geometryTimerBar}}class ToggleButtonUserData{constructor(){this.enabled=!1,this.callbacks=[]}hit(){this.enabled=!this.enabled;for(const e of this.callbacks)e(this.enabled)}registerHitCallback(e){this.callbacks.push(e)}}class ButtonUserData{constructor(e){this.node=e,this.callbacks=[]}hit(){for(const e of this.callbacks)e(this)}registerHitCallback(e){this.callbacks.push(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return getBodyMeshEventManager});class BodyMeshEventManager{constructor(){this.bodiesToMeshes=new Map,this.createCallbacks=[],this.destroyCallbacks=[]}init(e){if(this.world)throw new Error("cannot initialize twice");this.world=e}createBody(e,t){for(const n of this.createCallbacks)n(e,t);this.bodiesToMeshes.set(e,t)}destroyBody(e){const t=this.bodiesToMeshes.get(e);this.bodiesToMeshes.delete(e);for(const n of this.destroyCallbacks)n(e,t);this.world.DestroyBody(e)}startListeningForCreate(e){for(const t of Array.from(this.bodiesToMeshes.keys()))e(t,this.bodiesToMeshes.get(t));this.createCallbacks.push(e)}startListeningForDestroy(e){this.destroyCallbacks.push(e)}}const i=new Map;function getBodyMeshEventManager(e){return i.has(e)||i.set(e,new BodyMeshEventManager),i.get(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return getBodyDestructionManager});var i=n(13),s=n(23);class BodyDestructionManager{constructor(){this.destructionQueue=[],this.destructionQueueClearedCallbacks=[]}init(e){if(this.world)throw new Error("cannot initialize twice");this.world=e}queueDestruction(e){this.destructionQueue.push(e)}onDestructionQueueCleared(e){this.destructionQueueClearedCallbacks.push(e)}processDestructions(){if(this.destructionQueue.length>0){for(const e of this.destructionQueue)this.destructBody(e);this.destructionQueue.length=0}if(this.destructionQueueClearedCallbacks.length>0){for(const e of this.destructionQueueClearedCallbacks)e();this.destructionQueueClearedCallbacks.length=0}}destructBody(e){try{Object(i.a)(this.world).destroyBody(e),Object(s.a)(this.world).destroyBody(e)}catch(e){console.log(e)}}}const r=new Map;function getBodyDestructionManager(e){return r.has(e)||r.set(e,new BodyDestructionManager),r.get(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return EventDispatcher});class EventDispatcher{constructor(){this._listeners=[]}dispatch(e){this._lastKnownValue=e;for(const t of this._listeners)t(e)}addListener(e,t=!0){this._listeners.push(e),this._lastKnownValue&&e(this._lastKnownValue)}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return BaseTestScene});var i=n(0),s=n(2),r=n(6);const a=35,o=35;class BaseTestScene{constructor(){this.autoClear=!0;const e=new i.Scene,t=Object(r.a)("bgColor",new i.Color(11522047));e.fog=new i.Fog(t.getHex(),0,60),e.autoUpdate=!1,e.matrixAutoUpdate=!1;const n=new i.PerspectiveCamera(s.a.isMobile?o:a,s.a.aspect,.1,100);s.a.onChange(()=>{n.fov=s.a.isMobile?o:a,n.aspect=s.a.aspect,n.updateProjectionMatrix()},!0),n.position.set(0,3,3),n.lookAt(0,0,0),n.updateProjectionMatrix(),e.add(n),this.scene=e,this.camera=n,this.bgColor=t}update(e){this.scene.updateMatrixWorld(!1)}render(e){this.autoClear&&(e.setClearColor(this.bgColor,1),e.clear(!0,!0,!0)),e.render(this.scene,this.camera)}}},function(e,t,n){"use strict";n.d(t,"b",function(){return getChamferedBoxGeometry}),n.d(t,"a",function(){return getCachedChamferedBoxGeometry});var i=n(0),s=n(5);function getChamferedBoxGeometry(e,t,n,r=.005){const a=new i.SphereBufferGeometry(.02,8,5,.125*Math.PI),o=a.attributes.position.array,c=a.attributes.normal.array,h=new i.Vector3,l=new i.Vector3,u=.5*e-r,d=.5*t-r,f=.5*n-r;for(let e=0;e<c.length;e+=3)h.fromArray(c,e),l.fromArray(o,e),h.round(),1===h.y&&h.set(0,1,0),-1===h.y&&h.set(0,-1,0),h.toArray(c,e),h.multiplyScalar(r),h.x+=u*Object(s.d)(l.x),h.y+=d*Object(s.d)(l.y),h.z+=f*Object(s.d)(l.z),h.toArray(o,e);return a}const r=new Map;function getCachedChamferedBoxGeometry(e,t,n,i=.005){const s=`${e};${t};${n};${i};`;return r.has(s)||r.set(s,getChamferedBoxGeometry(e,t,n,i)),r.get(s)}},function(e,t,n){"use strict";n.d(t,"c",function(){return listenForLeadersRefresh}),n.d(t,"b",function(){return getLeaders}),n.d(t,"a",function(){return getDetails}),n.d(t,"d",function(){return record});const i="https://pillars.attente.ca",s=[];function listenForLeadersRefresh(e){s.push(e),r&&e(r)}let r;async function getLeaders(e,t){const n=void 0===t?void 0===e?`${i}/leaders`:`${i}/leaders?limit=${e}`:void 0===e?`${i}/leaders?offset=${t}`:`${i}/leaders?offset=${t}&limit=${e}`,a=await fetch(n);return r=await a.json(),function __updateLeadersListeners(){for(const e of s)e(r)}(),r}async function getDetails(e){const t=await fetch(`${i}/details?id=${e}`),n=await t.json();return JSON.parse(n.details)}function record(e){return fetch(`${i}/record`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},,function(e,t,n){"use strict";n.d(t,"a",function(){return getKeyboardInput});var i=n(93);let s;function getKeyboardInput(e=!0){return s||(s=new i.a(e)),s}},function(e,t,n){"use strict";n.d(t,"a",function(){return setRayCasterToCameraInPixels}),n.d(t,"b",function(){return setRayCasterToCameraInUV});n(1);function setRayCasterToCameraInPixels(e,t,n,i){e.setFromCamera({x:t/window.innerWidth*2-1,y:-(n/window.innerHeight*2-1)},i)}function setRayCasterToCameraInUV(e,t,n,i){e.setFromCamera({x:2*t-1,y:2*n-1},i)}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(0),s=n(4),r=n(2),a=n(21),o=n(6),c=n(104);const h=document.createElement("canvas");h.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()};const l={canvas:h,antialias:!0,premultipliedAlpha:!1};Object(o.b)("forceWebGL1")&&(l.context=h.getContext("webgl"));const u=new i.WebGLRenderer(l);document.body.append(h);["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach(e=>{u.getContext().canvas.style.setProperty("image-rendering",e)}),u.shadowMap.enabled=!0,u.shadowMap.type=i.PCFShadowMap,u.autoClear=!1;const d=new c.a("pixel-down-sample-3","Graphics Quality",0,0,10,e=>e,e=>e+"",!0,s.b,1);let f=1;function updatePixelRatio(){const e=r.a.pixelRatio/f;a.a.value=e,u.setPixelRatio(e)}d.listen(e=>{f=Math.round(e+1),updatePixelRatio()}),r.a.onChange(()=>{updatePixelRatio();const{width:e,height:t}=r.a;u.setSize(e,t),a.a.value=r.a.pixelRatio,a.b.value.set(2/e,2/t)},!0);Math.min(8192,u.capabilities.maxTextureSize);t.b=u},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphics3D});var i=n(1),s=n(0),r=n(2),a=n(84),o=n(15),c=n(11),h=n(3),l=n(6),u=n(5),d=n(92),f=n(38),p=n(39),g=n(14);const m={floating:{color:new s.Color(1,1,.8),emissive:new s.Color(.2,.15,0)},falling:{color:new s.Color(.9,.9,.9),emissive:new s.Color(.1,.1,.1)},frozen:{color:new s.Color(.6,.6,.6),emissive:new s.Color(0,0,0)}},y=new Map,w=new Map;class TestGraphics3D extends g.a{constructor(e=((e,t)=>!0),t=(e=>{})){super(!1,!1),this.camera.position.set(0,0,5),this.camera.lookAt(new s.Vector3(0,0,0)),this.gameCamera=this.camera.clone();const n=new s.Plane(new s.Vector3(0,0,-1));this.testB2World=new p.a((e,t)=>{const s=new i.Vec2(e,t),a=Object(u.c)(e/r.a.width*2-1,-(t/r.a.height*2-1),n,this.camera);return a&&(s.x=a.x,s.y=a.y),s},e,Object(l.b)("debugPysics")),this.testB2World.onCursorStartEvent.addListener(t),this.testB2World.onLevelChange.addListener(e=>{this.levelChangeCallback(e)}),this.testB2World.onPieceStateChange.addListener(e=>{this.pieceStateChangeCallback(e)}),this.testB2World.onCameraChange.addListener(e=>{this.cameraChangeCallback(e,this.testB2World.state,this.testB2World.player)}),this.testB2World.autoClear=!1,this.graphicsPack=new a.a(this.scene,this.testB2World.b2World);(async()=>{const e=await Object(d.a)(),t=e.getObjectByName("heightGoal"),n=e.getObjectByName("dangerZone"),i=e.getObjectByName("sky");if(e.scale.multiplyScalar(.1),e.rotation.y+=Math.PI,e.position.y-=1.5,this.scene.add(e),t&&(t.scale.multiplyScalar(2),this.scene.attach(t),t.castShadow=!1,t.receiveShadow=!1,t.position.y=-.25),n&&(n.scale.multiplyScalar(2),this.scene.attach(n),n.position.y=-1.55,n instanceof s.Mesh&&n.material instanceof s.MeshStandardMaterial)){n.castShadow=!1,n.receiveShadow=!1;const e=n.material.map;n.material=new s.MeshBasicMaterial({map:e,transparent:!0,opacity:.5})}if(i&&i instanceof s.Mesh&&i.material instanceof s.MeshStandardMaterial){i.castShadow=!1,i.receiveShadow=!1;const e=i.material.map,t=new s.Color(2,2,2);i.material=new s.MeshBasicMaterial({map:e,fog:!1,color:t})}this.heightGoal=t,this.dangerZone=n})()}update(e){this.testB2World.update(e),this.graphicsPack.update(e),this.updateCamera(),super.update(e)}render(e){super.render(e),this.testB2World.render(e)}updateCamera(){this.camera.position.copy(this.gameCamera.position),this.camera.quaternion.copy(this.gameCamera.quaternion)}pieceStateChangeCallback(e){const t=this.graphicsPack.bodyMeshMap.get(e),n=e.GetUserData();if(t&&Object(h.l)(n)){const e=t.getObjectByName(n.meshName);e instanceof s.Mesh&&e.material instanceof s.MeshStandardMaterial&&(e.material=function __getMaterialVariation(e,t){const n=w.has(e)?w.get(e):e;y.has(n)||y.set(n,new Map);const i=y.get(n);if(!i.has(t)){const n=e.clone();n.color.copy(m[t].color),n.emissive.copy(m[t].emissive),i.set(t,n)}return i.get(t)}(e.material,n.state))}}levelChangeCallback(e){const t=this.testB2World.spectatorMode?Object(f.a)(e):2e3;c.a.to({target:this.gameCamera.position,propertyGoals:{y:e},easing:o.a.Quartic.InOut,duration:t}),this.heightGoal&&c.a.to({target:this.heightGoal.position,propertyGoals:{y:e-.25},easing:o.a.Quartic.InOut,duration:t}),this.dangerZone&&c.a.to({target:this.dangerZone.position,propertyGoals:{y:e-1.55},easing:o.a.Quartic.InOut,duration:t}),this.testB2World.spectatorMode&&setTimeout(()=>{c.a.to({target:this.gameCamera.position,propertyGoals:{y:e/2,z:5+e+e/2},easing:o.a.Quartic.InOut,duration:1e3})},t+500)}cameraChangeCallback(e,t,n){switch(console.log(`The current state: ${t}`),console.log(`The player's current level: ${n.currentLevel}`),t){case"gameOver":c.a.to({target:this.gameCamera.position,propertyGoals:{y:n.currentLevel/2,z:5+n.currentLevel+n.currentLevel/2},easing:o.a.Quartic.InOut,duration:1e3});break;case"waitingForInput":c.a.to({target:this.gameCamera.position,propertyGoals:{y:n.currentLevel,z:5},easing:o.a.Quartic.InOut,duration:1e3});break;default:this.gameCamera.position.y+e<0?c.a.to({target:this.gameCamera.position,propertyGoals:{y:0},easing:o.a.Quartic.InOut,duration:500}):c.a.to({target:this.gameCamera.position,propertyGoals:{y:this.gameCamera.position.y+e},easing:o.a.Quartic.InOut,duration:500})}}}},function(e,t,n){"use strict";function getCameraSlideDurationForLevel(e){return 500*e}n.d(t,"a",function(){return getCameraSlideDurationForLevel})},function(e,t,n){"use strict";n.d(t,"a",function(){return Testb2World});var i=n(1),s=n(0),r=n(2),a=n(31),o=n(29),c=n(9),h=n(94),l=n(13),u=n(23),d=n(24),f=n(54),p=n(3),g=n(47),m=n(4),y=n(7),w=n(18),b=n(25),v=n(45),C=n(6),_=n(41),S=n(99),x=n(71),M=n(101),B=n(102),P=n(38);const k=35,O=28;let T=!1,j=!1,L=!1;const A=e=>{},F=()=>{},I=1/120,G=new i.Vec2,E=.9;class Testb2World{constructor(e,t=function __alwaysAllowCursor(e,t){return!0},n=!0){this.rayCastConverter=e,this._cursorClearCheck=t,this.autoClear=!0,this.player=new M.a,this.onAnnouncementChange=new b.a,this.onStateChange=new b.a,this.onLevelChange=new b.a,this.onPieceStateChange=new b.a,this.onCameraChange=new b.a,this.onCursorStartEvent=new b.a,this.stateChanges={uninitialized:F,waitingForInput:()=>{this.onCameraChange.dispatch(0),this.changeAnnouncement(`${r.a.isDesktop?"Click":"Touch"} to Start!`),this.simulating=!1,this.interactive=!0},playing:()=>{this.changeAnnouncement(""),this.simulating=!0,this.interactive=!0},settling:()=>{this.changeAnnouncement(""),this.interactive=!1,this.simulating=!0,this.turnGravityOn(),this.delayedGameEvent(()=>{this.spectatorMode||(this.state="checking")},5)},checking:()=>{let e=this.goalLine.m_contactList;this.simulating=!0;let t=!1;for(;e;){if(e.contact.IsTouching()){t=!0;break}e=e.next}0===this.player.currentHealth&&(t=!1),t?(this.activeArchitectureBodies.forEach(e=>{let t=e.GetFixtureList();const n=["environment"];e.GetUserData().categoryArray=n;const i=Object(p.m)(n);for(;t;)t.m_filter.categoryBits=i,t=t.m_next}),console.log("Congrats, you passed the level!"),this.changeLevel(this.player.currentLevel+1),this.delayedGameEvent(()=>{this.spawn5Pieces(),this.state="waitingForInput"},2),this.state="transitioning"):this.state="gameOver"},transitioning:()=>{this.simulating=!1;for(const e of this.activeArchitectureBodies){const t=e.GetUserData();Object(p.l)(t)&&t.level<this.player.currentLevel-2&&this.setPieceMode(e,"frozen")}},gameOver:async()=>{if(this.spectatorMode)return;this.simulating=!1;const e=this.player.currentHeight*m.f,t=~~(100*e);try{const n=await Object(o.b)(10,0);let i=n.length<10?n.length:-1;if(-1===i)for(const e of n)if(e.score<t){i=e.place;break}if(-1!==i){let n=Object(v.b)("initials")||"---";do{n=window.prompt(`You ranked ${i} at ${e.toFixed(2)}m! Input your initials (3 chars):`,(n+"---").slice(0,3))||"---"}while(3!==n.length);Object(v.c)("initials",n),(await Object(o.d)({score:t,summary:n,details:JSON.stringify(this.savedWorldBeforeSettling)})).ok&&Object(o.b)(10)}}catch(e){console.warn("Leaderboard not available")}this.onCameraChange.dispatch(0),this.delayedGameEvent(()=>{for(const e of this.activeArchitectureBodies){const t=e.GetUserData();Object(p.l)(t)&&this.setPieceMode(e,"falling")}this.changeAnnouncement("Game Over!"),this.simulating=!0},.5),this.delayedGameEvent(()=>{this.failedPieces.length=0,this.activeArchitectureBodies.forEach(e=>{const t=e.GetFixtureList();t&&Object(d.a)(this.b2World).queueDestruction(t.GetBody())}),this.activeArchitectureBodies.length=0},9),this.delayedGameEvent(()=>{this.changeLevel(0),this.spawn5Pieces(),this.player.currentHeight=0,this.player.currentHealth=5,this.state="waitingForInput"},10)}},this.stateUpdates={uninitialized:A,waitingForInput:e=>{0===this.player.currentHealth&&(this.state="gameOver")},playing:e=>{this.player.currentTimer-=e,this.updateHeightMeasurement(),this.player.currentTimer<0?(this.player.currentTimer=0,this.spectatorMode||(this.savedWorldBeforeSettling=Object(g.d)(this.state,this.player,this.b2World)),this.state="settling"):0!==this.player.currentHealth||this.spectatorMode||(this.state="gameOver")},settling:()=>{this.updateHeightMeasurement()},checking:A,transitioning:A,gameOver:A},this.debugMode=Object(C.b)("debugMode"),this.failedPieces=[],this.activeArchitectureBodies=[],this.timedTasks=[],this._isCameraChanging=!1,this._state="uninitialized",this._postUpdates=[],this.onNewPiece=e=>{this.activeArchitectureBodies.push(e.body),this.setPieceMode(e.body),this.onPieceStateChange.dispatch(e.body)},this.initiateScene();const s=new i.World(new i.Vec2(0,0));if(s.SetGravity(new i.Vec2(0,-9.8)),Object(l.a)(s).init(s),Object(u.a)(s).init(s),Object(d.a)(s).init(s),n){const t=new c.a(s);this.b2Preview=t,this.b2Preview&&!e&&(this.rayCastConverter=p.a.bind(null,this.b2Preview)),this.scene.add(this.b2Preview),c.b.value=!0}this.b2World=s;const f=Object(S.a)(),w=new h.a;function getFirstTouch(e){return e.touches.item(0)}w.listenForHealthChanges((e,t)=>{this.failedPieces.includes(t)||(this.failedPieces.push(t),this.player.currentHealth=Math.max(0,this.player.currentHealth+e)),Object(d.a)(s).queueDestruction(t),Object(y.e)(this.activeArchitectureBodies,t)}),f.register(w),this.b2World.SetContactListener(f),Object(a.a)().addListener(this.HandleKey),this.playerCursorBody=Object(p.c)(this.b2World,0,0,.05,void 0,void 0,void 0,!0,void 0,void 0,i.kinematicBody),Object(p.g)(this.b2World,0,-1,2,.1),Object(p.g)(this.b2World,-1,-.9,.2,.1),Object(p.g)(this.b2World,1,-.9,.2,.1),this.penaltyLine=Object(p.f)(this.b2World,0,-1.5,10,.1,["penalty"],["architecture"]),this.goalLine=Object(p.f)(this.b2World,0,-.25,10,.1,["goal"],["architecture","environment"]),setTimeout(()=>{this.spectatorMode||this.spawn5Pieces()},100);document.addEventListener("mousedown",e=>{this.onCursorStart(e.clientX,e.clientY)},!1),document.addEventListener("mouseup",e=>{this.onCursorStop()},!1),document.addEventListener("mousemove",e=>{this.onCursorMove(e.clientX,e.clientY)},!1),document.addEventListener("touchstart",e=>{const t=getFirstTouch(e);this.onCursorStart(t.clientX,t.clientY)},!1),document.addEventListener("touchend",e=>{this.onCursorStop()},!1),document.addEventListener("touchmove",e=>{const t=getFirstTouch(e);this.onCursorMove(t.clientX,t.clientY)},!1),document.addEventListener("wheel",e=>{if("waitingForInput"===this.state||"settling"===this.state||"checking"===this.state){const t=e.deltaY>0?-1:1;this._isCameraChanging||(this._isCameraChanging=!0,this.onCameraChange.dispatch(t),_.a.add(()=>{this._isCameraChanging=!1},.5))}},!1),Object(a.a)().addListener(async(e,t)=>{if(t)if("F5"===e)Object(g.c)(this.state,this.player,this.b2World);else if("F9"===e){const e=Object(d.a)(s);this.activeArchitectureBodies.forEach(t=>e.queueDestruction(t)),this.activeArchitectureBodies.length=0;const t=await Object(g.b)(this.b2World,this.player,this.onNewPiece);t&&(this.state=t.gameState,this.changeLevel(t.player.currentLevel,!1)),this.clearDelayedGameEvents()}}),this.state="waitingForInput"}get state(){return this._state}set state(e){this.state!==e&&(console.log(e),this._state=e,this.onStateChange.dispatch(e),this.stateUpdate=this.stateUpdates[e],this.stateChanges[e]())}get interactive(){return this._interactive}set interactive(e){this._interactive=e,e||this.detachCursorJoint()}async loadGame(e,t=!0){this.spectatorMode=t;const n=Object(d.a)(this.b2World);this.activeArchitectureBodies.forEach(e=>n.queueDestruction(e)),this.activeArchitectureBodies.length=0,await Object(g.a)(this.b2World,this.player,e,this.onNewPiece),this.changeLevel(e.player.currentLevel,!1),this.state=e.gameState,t&&(this.player.currentTimer=.001*Object(P.a)(this.player.currentLevel),this.delayedGameEvent(()=>{for(const e of this.activeArchitectureBodies){const t=e.GetUserData();Object(p.l)(t)&&this.setPieceMode(e,"falling")}},this.player.currentTimer+.5))}changeAnnouncement(e){this.onAnnouncementChange.dispatch(e)}updateHeightMeasurement(){const e=this.activeArchitectureBodies.sort((e,t)=>t.GetPosition().y-e.GetPosition().y).slice(0,Math.min(3,this.activeArchitectureBodies.length)).reduce((e,t)=>{let n=-1/0,s=t.GetFixtureList();const r=t.GetTransform();for(;s;){const e=s.GetShape();if(e instanceof i.PolygonShape)for(const t of e.m_vertices)i.Transform.MulXV(r,t,G),n=Math.max(n,G.y);s=s.m_next}return Math.max(e,n)},-1/0)+E;this.player.currentHeight=e}delayedGameEvent(e,t){this.timedTasks.push(_.a.add(e,t))}clearDelayedGameEvents(){for(const e of this.timedTasks)_.a.cancel(e);this.timedTasks.length=0}spawn5Pieces(){B.a.forEach(e=>{const{meshName:t,colliderName:n}=Object(x.a)();Object(p.b)(this.b2World,{level:this.player.currentLevel,state:"floating",x:e.x,y:e.y+this.player.currentLevel,vx:0,vy:0,angle:0,vAngle:0,meshName:t,colliderName:n,categoryArray:["architecture"],maskArray:["penalty","environment","architecture","goal"]}).then(this.onNewPiece)})}changeLevel(e,t=!0){this.player.currentLevel=e,this.b2Preview&&(this.b2Preview.offset.y=e),this.goalLine.SetPosition(new i.Vec2(0,-.25+e)),this.penaltyLine.SetPosition(new i.Vec2(0,-1.5+e)),t&&(this.player.maxTimer=m.d+e*m.e,this.player.currentTimer=this.player.maxTimer),this.onLevelChange.dispatch(e)}HandleKey(e,t){switch(e){case"KeyQ":T=t;break;case"KeyZ":j=t;break;case"KeyV":L=t}}update(e){if(this.scene.updateMatrixWorld(!1),this.simulating&&!this.paused){const t=this.player.physicsTime+e;for(;this.player.physicsTime<t;)this.player.physicsTime+=I,this.b2World.Step(I,5,2)}for(const t of this._postUpdates)t(e);this.b2Preview&&this.b2Preview.update(e),Object(d.a)(this.b2World).processDestructions(),Object(f.a)(e,this.player),this.stateUpdate(e)}render(e){this.autoClear&&(e.setClearColor(this.bgColor,1),e.clear(!0,!0,!0)),e.render(this.scene,this.camera)}onCursorStart(e,t){if(this.onCursorStartEvent.dispatch([e,t]),this._cursorClearCheck(e,t)){"waitingForInput"===this.state&&(this.onLevelChange.dispatch(this.player.currentLevel),this.state="playing"),this.cursorPosition=this.rayCastConverter(e,t);const n=this.rayCastConverter(e,t);if(this.interactive){const e=Object(p.n)(this.b2World,n);e&&this.attachCursorJoint(n,e)}if(this.debugMode){if(T){const{meshName:e,colliderName:t}=Object(x.a)();Object(p.b)(this.b2World,{level:this.player.currentLevel,state:"floating",x:n.x,y:n.y,vx:0,vy:0,angle:0,vAngle:0,meshName:e,colliderName:t,categoryArray:["architecture"],maskArray:["penalty","environment","architecture","goal"]}).then(this.onNewPiece)}if(j){const e=Object(p.c)(this.b2World,n.x,n.y,.2,["architecture"],["penalty","environment","architecture","goal"],this.player);this.activeArchitectureBodies.push(e)}}}}onCursorStop(){this.detachCursorJoint()}onCursorMove(e,t){if(this._cursorClearCheck(e,t)){const n=this.rayCastConverter(e,t);this.cursorPosition=this.rayCastConverter(e,t),this.playerCursorBody.SetPosition(this.cursorPosition),this.cursorJoint?(Object(w.a)("grabbing",0),this.cursorJoint.SetTarget(this.cursorPosition)):this.interactive&&Object(w.a)(Object(p.n)(this.b2World,n)?"grab":"default",0)}}detachCursorJoint(){this.cursorJoint&&(this.b2World.DestroyJoint(this.cursorJoint),this.cursorJoint=void 0)}attachCursorJoint(e,t){const n=new i.MouseJointDef;n.bodyA=this.playerCursorBody,n.bodyB=t,n.target.Copy(e),n.maxForce=20*t.GetMass(),Object(i.LinearStiffness)(n,5,.7,n.bodyA,n.bodyB),this.cursorJoint=this.b2World.CreateJoint(n),t.SetAwake(!0)}turnGravityOn(){this.activeArchitectureBodies.forEach(e=>{const t=e.GetUserData();Object(p.l)(t)&&"floating"===t.state&&this.setPieceMode(e,"falling")})}setPieceMode(e,t){const n=e.GetUserData();if(Object(p.l)(n))switch(void 0===t?t=n.state:(n.state=t,this.onPieceStateChange.dispatch(e)),t){case"floating":e.SetGravityScale(0),e.SetLinearDamping(5),e.SetAngularDamping(5),e.SetType(i.BodyType.b2_dynamicBody);break;case"falling":e.SetGravityScale(1),e.SetLinearDamping(0),e.SetAngularDamping(0),e.SetAwake(!0),e.SetType(i.BodyType.b2_dynamicBody);break;case"frozen":e.SetType(i.BodyType.b2_staticBody)}}initiateScene(){const e=new s.Scene,t=Object(C.a)("bgColor",new s.Color(2301728));e.fog=new s.Fog(t.getHex(),0,160),e.autoUpdate=!1,e.matrixAutoUpdate=!1;const n=new s.PerspectiveCamera(r.a.isMobile?O:k,r.a.aspect,.1,100);r.a.onChange(()=>{n.fov=r.a.isMobile?O:k,n.aspect=r.a.aspect,n.updateProjectionMatrix()},!0),n.position.set(0,0,0),n.lookAt(0,0,0),n.updateProjectionMatrix(),e.add(n),this.scene=e,this.camera=n,this.bgColor=t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return FPSControls});var i=n(0),s=n(103),r=n.n(s),a=n(33),o=n(42),c=n(6),h=n(5),l=n(58);const u=Object(c.c)("camDamping",0,0,.999),d=1-Object(h.b)(u,0,1);class FPSControls{constructor(e){this._camera=e,this._active=!1,this._fpsController=void 0}toggle(e){void 0===e&&(e=!this._active),this._fpsController||(this._cameraLocal=new i.PerspectiveCamera,function copyCam(e,t){e.position.copy(t.position),e.scale.copy(t.scale),e.quaternion.copy(t.quaternion),e.fov=t.fov}(this._cameraLocal,this._camera),this._camera.parent.add(this._cameraLocal),this._fpsController=new r.a(this._cameraLocal,a.b.domElement,{movementSpeed:.01}),l.a.register(this));const t=this._fpsController.onPointerLockAttainSignal,n=t._bindings[0]._listener;t._bindings[0]._listener=()=>{this._active&&n()},e||this._fpsController.onPointerLockReleaseSignal.dispatch(),this._active=e}update(){this._active&&this._fpsController&&(this._fpsController.update(),this._camera.position.lerp(this._cameraLocal.position,d),this._camera.quaternion.slerp(this._cameraLocal.quaternion,d),this._camera.scale.lerp(this._cameraLocal.scale,d),this._camera.fov=Object(h.e)(this._camera.fov,this._cameraLocal.fov,d),o.a.updateProjection())}}new FPSControls(o.a.camera)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(11),s=n(7);class TimedTask{constructor(e,t){this.expireTime=e,this._task=t}task(){this._task?(this._task(),this._task=void 0):console.warn("timed task asked to fire twice??")}}const r=new class Timer{constructor(){this.time=0,this.tasks=[]}update(e){for(this.time+=e;this.tasks.length>0&&this.tasks[0].expireTime<=this.time;)this.tasks.shift().task()}add(e,t,n=!1){n&&(t*=i.a.speed);const s=new TimedTask(this.time+t,e);return this.tasks.push(s),this.tasks.sort((e,t)=>e.expireTime-t.expireTime),s}runPrematurely(e){e.task(),Object(s.e)(this.tasks,e)}cancel(e){Object(s.e)(this.tasks,e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),s=n(2),r=n(5);const a=.1,o=200,c=6e3;const h=new i.PerspectiveCamera((s.a.isMobile,35),s.a.aspect,.01,10),l=new class CameraShaker{constructor(e){this.camera=e,this._time=0,this._timers=[],this._shakeScale=25e-5,this._shakeStrength=0;const t=e.clone();t.position.set(0,0,0),t.quaternion.setFromEuler(new i.Euler(0,0,0)),t.scale.set(1,1,1),e.add(t),this.shakyCamera=t}set shakeStrength(e){(e=Object(r.b)(e,0,1))!==this._shakeStrength&&(this._shakeStrength=e)}set shakeScale(e){(e=Object(r.b)(e,0,10))!==this._shakeScale&&(this._shakeScale=e)}updateProjection(){this.shakyCamera.fov=this.camera.fov,this.shakyCamera.aspect=this.camera.aspect,this.shakyCamera.updateProjectionMatrix()}update(e){if(this._time+=e,this.shakeStrength=this._shakeStrength+e/a*(this._timers.length>0?12:-1),this._shakeStrength>0){this.shakyCamera.position.set(0,0,0);let e=1;for(let t=o;t<c;t*=1.674,e*=.8){const n=1/e*this._shakeScale*this._shakeStrength;this.shakyCamera.position.x+=Math.sin(this._time*t)*n,this.shakyCamera.position.y+=Math.sin(this._time*t*1.235)*n,this.shakyCamera.position.z+=Math.sin(this._time*t*1.67235)*n}}for(;this._timers.length>0&&this._timers[0]<=this._time;)this._timers.shift()}add(e){this._timers.push(this._time+e),this._timers.sort()}}(h);s.a.onChange(()=>{h.fov=(s.a.isMobile,35),h.aspect=s.a.aspect,h.updateProjectionMatrix(),l.updateProjection()})},,,function(e,t,n){"use strict";n.d(t,"b",function(){return getLocalStorageParam}),n.d(t,"c",function(){return setLocalStorageParam}),n.d(t,"a",function(){return getLocalStorageFloat});n(52);var i=n(5);function getLocalStorageParam(e){return localStorage.getItem(e)}function setLocalStorageParam(e,t){return localStorage.setItem(e,t)}function __getLocalStorageNumber(e,t,n,s=-1/0,r=1/0){return Object(i.b)(n(getLocalStorageParam(e)||t.toString()),s,r)}function getLocalStorageFloat(e,t,n=-1/0,i=1/0){return __getLocalStorageNumber(e,t,parseFloat,n,i)}},function(e,t,n){"use strict";n.d(t,"a",function(){return getTexture});var i=n(0);const s=new Map,r=new i.TextureLoader;function getTexture(e){if(s.has(e))return s.get(e);{const t=r.loadAsync(e);return t.then(e=>{e.minFilter=i.NearestFilter,e.magFilter=i.NearestFilter}),s.set(e,t),t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return loadLevelData}),n.d(t,"d",function(){return serializeWorld}),n.d(t,"c",function(){return saveLevelDataToLocalStorage}),n.d(t,"b",function(){return loadLevelDataFromLocalStorage});var i=n(24),s=n(3);async function loadLevelData(e,t,n,r){const a=Object(i.a)(e);await new Promise(e=>a.onDestructionQueueCleared(e)),await Promise.all(n.bodies.map(t=>{const n=Object(s.b)(e,t);return n.then(e=>r(e)),n})),function loadPlayer(e,t){e.currentHealth=t.player.currentHealth,e.currentLevel=t.player.currentLevel,e.currentTimer=t.player.currentTimer,e.maxHealth=t.player.maxHealth,e.maxTimer=t.player.maxTimer,e.physicsTime=t.player.physicsTime,e.currentHeight=t.player.currentHeight}(t,n)}function serializeWorld(e,t,n){const i=[];for(let e=n.GetBodyList();e;e=e.m_next)if(Object(s.l)(e.m_userData)){const{x:t,y:n}=e.GetPosition(),{x:s,y:r}=e.GetLinearVelocity();i.push({...e.m_userData,x:t,y:n,vx:s,vy:r,angle:e.GetAngle(),vAngle:e.GetAngularVelocity()})}return{gameState:e,player:t,bodies:i}}function saveLevelDataToLocalStorage(e,t,n){const i=JSON.stringify(serializeWorld(e,t,n));console.log(`saved ${2*i.length} bytes of data`),localStorage.setItem("level",i)}async function loadLevelDataFromLocalStorage(e,t,n){const i=localStorage.getItem("level");if(i){const s=JSON.parse(i);return await loadLevelData(e,t,s,n),s}console.warn("no level data in localStorage")}},,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(0),s=n(26),r=n(51),a=n(4),o=n(85);class QueuedParams{constructor(e,t){this.params=e,this.resolve=t}}const c=new class ArchitectureModelFactory{constructor(){this._status="not started",this._bodiesPromisedMeshes=new Map,this._bodyMeshMap=new Map}async requestMesh(e){return new Promise(t=>{"ready"===this._status?t(this._makeMesh(e)):(this._bodiesPromisedMeshes.set(e.body,new QueuedParams(e,t)),"not started"===this._status&&this._init())})}deleteMesh(e){if(this._bodiesPromisedMeshes.has(e)&&this._bodiesPromisedMeshes.delete(e),this._bodyMeshMap.has(e)){const t=this._bodyMeshMap.get(e);return this._bodyMeshMap.delete(e),t}}async _init(){if("not started"!==this._status)throw new Error("cannot initialize twice");{this._status="initializing";const e=new s.a,t=await e.loadAsync("game/models/architecture.glb");this._gltf=t;for(const e of t.scene.children)e.traverse(e=>{e instanceof i.Mesh&&(e.name.includes("collider")?e.visible=!1:(e.castShadow=!0,e.receiveShadow=!0))});this._status="ready",this._bodiesPromisedMeshes.forEach((e,t)=>{e.resolve(this._makeMesh(e.params))})}}_makeMesh(e){const t=Object(o.a)(this._gltf,e.meshName),n=e.body.GetPosition();if(t.position.set(n.x,-n.y,0),e.addPivot){const n=new i.Object3D;n.add(t);const s=Object(r.a)(t,e.colliderName);for(let e=t.children.length;e>=0;e--){const n=t.children[e];n!==s&&t.remove(n)}return s.updateMatrix(),s.matrix.clone().invert().decompose(t.position,t.quaternion,t.scale),n.rotateX(.5*Math.PI),n.scale.multiplyScalar(a.a),this._bodyMeshMap.set(e.body,n),n}return t.scale.multiplyScalar(a.a),this._bodyMeshMap.set(e.body,t),t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return findCollider});var i=n(0);function findCollider(e,t){let n;if(e.traverse(e=>{e instanceof i.Mesh&&e.name.includes(t)&&(n=e)}),!n)throw new Error("no collider found");return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return hexColor});var i=n(0);n(5);new i.Color(1,1,1),new i.Color;function hexColor(e){const t=/^\#([A-Fa-f0-9]+)$/.exec(e);if(t){const e=t[1],n=e.length;if(3===n){const t=new i.Color;return t.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,t.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,t.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,t}if(6===n){const t=new i.Color;return t.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,t.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,t.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,t}}return new i.Color(1,0,1)}},function(e,t,n){"use strict";n.d(t,"a",function(){return getArchitectMeshAndFixtures});var i=n(1),s=n(0),r=n(50),a=n(4),o=n(51),c=n(3);const h=new Map;async function getArchitectMeshAndFixtures(e,t,n="collider",l,u){const d=await r.a.requestMesh({body:e,meshName:t,colliderName:n,addPivot:!0,categoryArray:l,maskArray:u}),f=`${t}:${n}`;if(!h.has(f)){const e=Object(o.a)(d,n),t=e.geometry.attributes.position,r=e.geometry.getIndex();if(t instanceof s.BufferAttribute&&r instanceof s.BufferAttribute){const e=t.array,n=r.array,s=new Set,o=[];for(let e=0;e<n.length;e+=3){const t=n[e],i=n[e+1],r=n[e+2],a=t+":"+i,o=i+":"+r,c=r+":"+t,h=t+":"+r,l=i+":"+t,u=r+":"+i;s.has(l)?s.delete(l):s.add(a),s.has(u)?s.delete(u):s.add(o),s.has(h)?s.delete(h):s.add(c)}const c=new Map;for(const e of s){const t=e.split(":").map(e=>parseInt(e,10));c.set(t[0],t[1])}for(;c.size>0;){const e=c.keys().next().value;let t=c.get(e);const n=[t];c.delete(e);do{const e=c.get(t);c.delete(t),n.push(e),t=e}while(t!==e);o.push(n)}h.set(f,o.map(t=>t.map(t=>{const n=3*t;return new i.Vec2(e[n]*a.a,e[n+2]*-a.a)})))}}const p=new i.FixtureDef;l&&u&&(p.filter.categoryBits=Object(c.m)(l),p.filter.maskBits=Object(c.m)(u)),p.density=1;for(const t of h.get(f)){const n=new i.PolygonShape;p.shape=n,n.Set(t),e.CreateFixture(p)}return d}},function(e,t,n){"use strict";n.d(t,"b",function(){return registerHUD}),n.d(t,"a",function(){return processHUD});var i=n(0),s=n(2),r=n(4),a=n(10),o=n(8),c=n(22),h=n(46);let l;const u=60,d=42,f=40,p=new i.Color(1.2,0,0),g=new i.Color(1,1,1);let m;function getSharedUiPlaneGeometry(){if(m)return m;{const e=(m=new i.PlaneBufferGeometry(1,1,1,1)).getAttribute("position").array;for(let t=0;t<e.length;t+=3)e[t+1]*=-1;return m}}class HUD{constructor(e,t,n,h,l,p){this._fullscreenEnterButtonTexture=h,this._fullscreenExitButtonTexture=l,this.barWidth=.3333*window.innerWidth,this.toggleFullscreenButton=e=>{this.fullScreenButton.material.map=e?this._fullscreenExitButtonTexture:this._fullscreenEnterButtonTexture},this.onResize=()=>{const e=.5*window.innerWidth;for(let e=0;e<this.hearts.length;e++){this.hearts[e].position.set((e+1)*f,1.25*f,r.c)}this.fullScreenButton.position.set(d,window.innerHeight-d,r.c),this.barWidth=.333*window.innerWidth;const t=.5*(window.innerWidth-this.barWidth);this.textTimer.position.set(e,u,r.c),this.labelBarTime.position.set(t-6,u,r.c),this.textLevel.position.set(e,.35*u,r.c),this.textHeight.position.set(e,window.innerHeight-30,r.c),this.hourGlassButton.position.set(window.innerWidth-d,window.innerHeight-d,r.c),this.labelAnnouncement.position.set(.5*window.innerWidth,.5*window.innerHeight,r.c)},this.hearts=[];const g=t.scene,m=getSharedUiPlaneGeometry();for(let t=0;t<e.maxHealth;t++){const e=new i.MeshBasicMaterial({map:n,color:new i.Color(1.2,0,0),transparent:!0,depthWrite:!1}),t=new i.Mesh(m,e);t.scale.setScalar(32),g.add(t),this.hearts.push(t)}function makeText(e,t=o.a.ui){const n=new a.a(e,t);return n.rotation.x=-Math.PI,g.add(n),n}this.timerBar=t.makeTimerBar(0,0),this.textTimer=makeText(`${e.currentTimer}`,o.a.ui),this.labelBarTime=makeText("Time:",{...o.a.ui,align:"right"}),this.textLevel=makeText(`Level: ${e.currentLevel+1}`,o.a.ui),this.textHeight=makeText(`${e.currentHeight}m`,o.a.height),this.labelAnnouncement=makeText("",o.a.title),this.fullScreenButton=new i.Mesh(getSharedUiPlaneGeometry(),new i.MeshBasicMaterial({map:h,transparent:!0})),this.fullScreenButton.scale.setScalar(64),t.registerButton(this.fullScreenButton);const y=new c.b;y.registerHitCallback(this.toggleFullscreenButton),this.fullScreenButton.userData=y,g.add(this.fullScreenButton),this.hourGlassButton=new i.Mesh(getSharedUiPlaneGeometry(),new i.MeshBasicMaterial({map:p,transparent:!0,side:i.DoubleSide})),this.hourGlassButton.scale.setScalar(64),this.hourGlassButton.position.z=r.c,t.registerButton(this.hourGlassButton),this.hourGlassButton.userData=new c.a(this.hourGlassButton),g.add(this.hourGlassButton),s.a.onChange(this.onResize,!0)}announce(e){this.labelAnnouncement.text=e}update(e,t){for(let e=0;e<this.hearts.length;e++){const n=this.hearts[e];e>=t.currentHealth?n.material.color.copy(g):n.material.color.copy(p)}const n=t.currentTimer/t.maxTimer*this.barWidth;this.timerBar.scale.x=n,this.timerBar.position.set(this.barWidth+.5*n,u,r.c),this.textTimer.text=`${t.currentTimer.toFixed(2)}`,this.textLevel.text=`Level: ${t.currentLevel+1}`,this.textHeight.text=`${(t.currentHeight*r.f).toFixed(2)}m`}}async function registerHUD(e,t){const n=await Object(h.a)("game/icons/heart-white.png"),i=await Object(h.a)("game/icons/fullscreen-enter.png"),s=await Object(h.a)("game/icons/fullscreen-exit.png"),r=await Object(h.a)("game/icons/hourglass-button.png");return l=new HUD(e,t,n,i,s,r)}function processHUD(e,t){l&&l.update(e,t)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=1/.0254*72},function(e,t,n){"use strict";n.d(t,"a",function(){return nextFrameUpdate}),n.d(t,"b",function(){return onNextFrame});const i=[];function nextFrameUpdate(){i.length>0&&(i.forEach(e=>e()),i.length=0)}function onNextFrame(e){i.push(e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return AnimatedBool});var i=n(15),s=n(11);class AnimatedBool{constructor(e,t=!1,n=500,s=i.a.Quartic.InOut,r=-1){this._onUpdate=e,this._durationMS=n,this.easing=s,this._value=t,this._durationMSOut=-1===r?n:r,this._animatedValue=t?1:0}pulse(){this.value=!0,this.value=!1}set animatedValue(e){this._animatedValue=e,this._onUpdate(e)}get animatedValue(){return this._animatedValue}set value(e){if(e===this._value)return;s.a.killTweensOf(this);const t=e?1:0,n=(t>this._animatedValue?this._durationMS:this._durationMSOut)*Math.abs(this._animatedValue-t);0===n?this.animatedValue=t:s.a.to({target:this,propertyGoals:{animatedValue:t},duration:n,easing:this.easing}),this._value=e}get value(){return this._value}}},function(e,t,n){"use strict";var i=n(7);const s=[],r={update:e=>{for(const t of s)t.update(e)},register:e=>{s.push(e)},unregister:e=>{Object(i.e)(s,e)}};t.a=r},function(e,t,n){"use strict";n.d(t,"a",function(){return GameGUI});var i=n(54),s=n(33),r=n(16),a=n(22);class GameGUI{constructor(e){this.gui=new a.c,this.queuedAnnouncement="",e.onStateChange.addListener(e=>{this.hourglassButton&&this.hourglassButton.material.color.copy("playing"===e?r.b:r.c)}),e.onAnnouncementChange.addListener(e=>{this.hud?this.hud.announce(e):this.queuedAnnouncement=e});(async()=>{const t=await Object(i.b)(e.player,this.gui);this.gui.onOverlayActiveChange.addListener(e=>{t.labelAnnouncement.position.y=window.innerHeight*(.5-(1-e))}),this.hud=t,this.queuedAnnouncement&&this.hud.announce(this.queuedAnnouncement),this.hourglassButton=t.hourGlassButton;const n=this.hourglassButton.userData;n instanceof a.a&&n.registerHitCallback(()=>{"playing"===e.state&&(e.player.currentTimer=0)});const r=t.fullScreenButton.userData;r instanceof a.b&&r.registerHitCallback(e=>{e?s.a.requestFullscreen():document.exitFullscreen()})})()}render(e){this.gui.render(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestTextPhysicsScene}),n.d(t,"b",function(){return runTextPhysicsTest});var i=n(13),s=n(3),r=n(19),a=n(10),o=n(8),c=n(40),h=n(6),l=n(12);class TestTextPhysicsScene extends l.a{constructor(){super();const e=new c.a(this.camera);Object(h.b)("fpsCam")&&e.toggle(!0);const t=runTextPhysicsTest(this.scene,this.b2World);setTimeout(()=>{t.settings.fontFace=r.a.GothicA1Black},2e3);(async()=>{})()}update(e){super.update(e)}render(e){super.render(e)}}function runTextPhysicsTest(e,t){let n;const r=new a.a(["/**","* For the brave souls who get this far: You are the chosen ones,","* the valiant knights of programming who toil away, without rest,","* testCode.scale.multiplyScalar(s)","* testCode.position.z -= 6","* testCode.position.x -= 2","* scene.add(testCode)","* ","* testCode.onMeasurementsUpdated = () => {","*                                            if (lastKnownTextBodies) {","*                                                                                 for (const body of lastKnownTextBodies) {","* }","* lastKnownTextBodies = undefined","* }","* lastKnownTextBodies = textToPhysicsBodies(testCode, b2World)","* }","* return testCode","*/"].join("\n"),o.a.code,void 0,void 0);return r.scale.multiplyScalar(10),r.position.z-=6,r.position.x-=2,e.add(r),r.onMeasurementsUpdated=()=>{if(n){for(const e of n)Object(i.a)(t).destroyBody(e);n=void 0}n=Object(s.o)(r,t)},r}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsLevelScene});var i=n(1),s=n(0),r=n(31),a=n(17),o=n(9),c=n(3),h=n(62),l=n(4),u=n(28),d=n(6),f=n(63),p=n(14);class TestGraphicsLevelScene extends p.a{constructor(e="test-layout"){super(!1,!1),this.checkpointBodies=[];const t=new i.World(new i.Vec2(0,-9.8));if(this.b2World=t,Object(d.b)("debugPhysics")){const e=new o.a(t);this.b2Preview=e,this.scene.add(e)}new h.a(Object(d.e)("level")||e,(e,n,i,r,o)=>{const h=16776960===o;Object(c.d)(t,e,n,i,r,h);const d=.5*(i+r);n+r>=32&&(r+=100);const f=a.a.levelMaterial.clone();f.color.setHex(o);const p=new s.Mesh(Object(u.a)(i*l.g,r*l.g,d*l.g,.01),f);p.receiveShadow=!0,p.castShadow=!0,p.position.set((e-.5*i)*l.g-.8,.4-(n+.5*r)*l.g,0),this.scene.add(p);const g=(.5*d+1)*l.g;if(16776960===o){const e=p.clone();e.position.z-=g,p.position.z+=g,this.scene.add(e)}},()=>{const e=new f.a,t=Object(r.a)();t.addListener(e.onKeyCodeEvent),e.scale.multiplyScalar(5),e.position.set(-0,0,-.5),this.scene.add(e),this.keyboardInput=t,this.keyboardMesh=e})}update(e){super.update(e),this.b2World.Step(e,10,4),this.b2Preview&&this.b2Preview.update(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return PNGLevel});var i=n(0);class BlocksRecipes{constructor(){this.blocks=new Map}register(e,t,n,i,s){this.blocks.has(e)||this.blocks.set(e,new Map);const r=this.blocks.get(e);r.has(s)||r.set(s,new Map);const a=r.get(s);a.has(n)||a.set(n,new Map);const o=a.get(n);let c=!1;for(const[e,n]of o.entries())e+n===t&&(o.set(e,n+1),c=!0);c||o.set(t,i)}process(e){this.blocks.forEach((t,n)=>{t.forEach((t,i)=>{t.forEach((t,s)=>{t.forEach((t,r)=>{e(n,r,s,t,i)})})})})}}class PNGLevel{constructor(e,t,n,s){const r=new Image;r.crossOrigin="Anonymous",r.onload=e=>{const s=new BlocksRecipes,a=document.createElement("canvas"),o=r.width,c=r.height;a.width=o,a.height=c;const h=a.getContext("2d");h.drawImage(r,0,0,o,c);const l=h.getImageData(0,0,o,c).data;let u=0;const d=new i.Color,f=new i.Color;function extractColour(e,t){e.r=l[4*t+0]/255,e.g=l[4*t+1]/255,e.b=l[4*t+2]/255}const p=o*c;for(let e=0;e<p;e++){extractColour(d,e);const t=l[4*e+3]>128,n=e+1;extractColour(f,n);const i=l[4*n+3]>128;let r=!1;if(t?(u++,d.equals(f)||(r=!0),t!==i&&(r=!0)):r=!0,n%o==0&&(r=!0),r&&u>0){const t=e%o,n=Math.floor(e/o);s.register(t,n,u,1,d.getHex()),u=0}}s.process(t),n&&n()},r.onerror=e=>{console.error("image not found: "+e)},r.src=`game/levels/${e}.png`}}},function(e,t,n){"use strict";n.d(t,"a",function(){return ProceduralKeyboardMesh});var i=n(0),s=n(17),r=n(28),a=n(115),o=n(64);const c=.015;class KeyInfo{constructor(e,t,n){this.label=e,this.width=t,this.eventCode=n,this.width*=c}}class KeySpace extends KeyInfo{constructor(e){super("",e,void 0)}}const h=[[new KeyInfo("ESC",1,"Escape"),new KeySpace(2),new KeyInfo("F1",1,"F1"),new KeyInfo("F2",1,"F2"),new KeyInfo("F3",1,"F3"),new KeyInfo("F4",1,"F4"),new KeyInfo("F5",1,"F5"),new KeyInfo("F6",1,"F6"),new KeyInfo("F7",1,"F7"),new KeyInfo("F8",1,"F8"),new KeyInfo("F9",1,"F9"),new KeyInfo("F10",1,"F10"),new KeyInfo("F11",1,"F11"),new KeyInfo("F12",1,"F12"),new KeySpace(.5),new KeyInfo("PRNT SCRN",1,"F13"),new KeyInfo("SCR LK",1,"F14"),new KeyInfo("PAUSE",1,"F15")],[new KeyInfo("~",1,"Backquote"),new KeyInfo("!\n1",1,"Digit1"),new KeyInfo("@\n2",1,"Digit2"),new KeyInfo("#\n3",1,"Digit3"),new KeyInfo("$\n4",1,"Digit4"),new KeyInfo("%\n5",1,"Digit5"),new KeyInfo("^\n6",1,"Digit6"),new KeyInfo("&\n7",1,"Digit7"),new KeyInfo("*\n8",1,"Digit8"),new KeyInfo("(\n9",1,"Digit9"),new KeyInfo(")\n0",1,"Digit0"),new KeyInfo("_\n-",1,"Minus"),new KeyInfo("+\n=",1,"Equal"),new KeyInfo("BACKSPACE",2,"Backspace"),new KeySpace(.5),new KeyInfo("INS",1,"Insert"),new KeyInfo("HOME",1,"Home"),new KeyInfo("PAGE UP",1,"PageUp")],[new KeyInfo("TAB",1.55,"Tab"),new KeyInfo("Q",1,"KeyQ"),new KeyInfo("W",1,"KeyW"),new KeyInfo("E",1,"KeyE"),new KeyInfo("R",1,"KeyR"),new KeyInfo("T",1,"KeyT"),new KeyInfo("Y",1,"KeyY"),new KeyInfo("U",1,"KeyU"),new KeyInfo("I",1,"KeyI"),new KeyInfo("O",1,"KeyO"),new KeyInfo("P",1,"KeyP"),new KeyInfo("{\n[",1,"BracketLeft"),new KeyInfo("}\n]",1,"BracketRight"),new KeyInfo("|\n\\",1.45,"Backslash"),new KeySpace(.5),new KeyInfo("DEL",1,"Delete"),new KeyInfo("END",1,"End"),new KeyInfo("PAGE DOWN",1,"PageDown")],[new KeyInfo("CAPS LCK",1.9,"CapsLock"),new KeyInfo("A",1,"KeyA"),new KeyInfo("S",1,"KeyS"),new KeyInfo("D",1,"KeyD"),new KeyInfo("F",1,"KeyF"),new KeyInfo("G",1,"KeyG"),new KeyInfo("H",1,"KeyH"),new KeyInfo("J",1,"KeyJ"),new KeyInfo("K",1,"KeyK"),new KeyInfo("L",1,"KeyL"),new KeyInfo(":\n;",1,"Semicolon"),new KeyInfo("\"\n'",1,"Quote"),new KeyInfo("ENTER",2.25,"Enter")],[new KeyInfo("⇧",2.65,"ShiftLeft"),new KeyInfo("Z",1,"KeyZ"),new KeyInfo("X",1,"KeyX"),new KeyInfo("C",1,"KeyC"),new KeyInfo("V",1,"KeyV"),new KeyInfo("B",1,"KeyB"),new KeyInfo("N",1,"KeyN"),new KeyInfo("M",1,"KeyM"),new KeyInfo("<\n,",1,"Comma"),new KeyInfo(">\n.",1,"Period"),new KeyInfo("?\n/",1,"Slash"),new KeyInfo("⇧",2.65,"ShiftRight"),new KeySpace(.5),new KeySpace(1),new KeyInfo("↑",1,"ArrowUp")],[new KeyInfo("CTRL",1.5,"ControlLeft"),new KeyInfo("FN",1,void 0),new KeyInfo("CMD",1.5,"MetaLeft"),new KeyInfo("ALT",1.5,"AltLeft"),new KeyInfo(" ",5.9,"Space"),new KeyInfo("ALT",1.5,"AltRight"),new KeyInfo("MENU",1.5,"ContextMenu"),new KeyInfo("CTRL",1.5,"ControlRight"),new KeySpace(.5),new KeyInfo("←",1,"ArrowLeft"),new KeyInfo("↓",1,"ArrowDown"),new KeyInfo("→",1,"ArrowRight")]],l=.34,u=.015,d=.13;class ProceduralKeyboardMesh extends i.Mesh{constructor(){super(Object(r.b)(l,u,d),s.a.keyboardPlastic),this.onKeyCodeEvent=(e,t)=>{this.buttonsByEventCode.has(e)&&(this.buttonsByEventCode.get(e).position.y=t?u-.012:u-.0075)},this.castShadow=!0,this.receiveShadow=!0,this.renderOrder=-2;const e=new Map,t=.15*c;let n=.5*-d+.01,i=0;for(const s of h){1===i&&(n+=.5*(c+t)),i++,n+=.5*(c+t);let r=.5*-l+.01;for(const i of s){if(r+=.5*(i.width+t),""!==i.label){const t=new a.a(i.width+.004,.012,c+.004,.001);this.add(t),t.position.set(r,u-.005,n);const s=new o.a(i.width,.01,c,i.label,.0015);void 0===i.eventCode||e.has(i.eventCode)||e.set(i.eventCode,s),this.add(s),s.position.set(r,u-.0075,n)}r+=.5*(i.width+t)}n+=.5*(c+t)}this.buttonsByEventCode=e,this.position.y+=u}}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyButtonMesh});var i=n(0),s=n(116),r=n(17),a=n(10),o=n(8),c=n(28),h=n(55);const l=o.a.keyLabel,u=o.a.keyLabelDouble,d=o.a.keyLabelSmall;function getFont(e){if(e.length>1&&e.length<=3&&"F"===e[0]){const t=e.split("F");if(Object(s.isNumber)(t[1]))return u}switch(e.length){case 1:return l;case 2:return d;case 3:return e.includes("\n")?u:d;default:return d}}class KeyButtonMesh extends i.Mesh{constructor(e,t,n,i="",s=.005){if(super(Object(c.a)(e,t,n,s),r.a.keyboardPlasticKey),""!==i){const t=new a.a(i,{...getFont(i),width:(e-.003)*h.a});t.position.y+=.0052,t.rotation.x=.5*-Math.PI,this.add(t)}this.renderOrder=10,this.castShadow=!0,this.receiveShadow=!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestKeyboardInputScene});var i=n(31),s=n(63),r=n(14);class TestKeyboardInputScene extends r.a{constructor(){super(!1);const e=new s.a;Object(i.a)().addListener(e.onKeyCodeEvent),this.scene.add(e),e.scale.multiplyScalar(10)}update(e){super.update(e)}render(e){super.render(e)}}},,,function(e,t,n){"use strict";n.d(t,"b",function(){return SingleEnvironmentBlockQueryCallBack}),n.d(t,"a",function(){return SingleArchitectureBodyQueryCallBack});var i=n(1),s=n(3);class SingleEnvironmentBlockQueryCallBack extends i.QueryCallback{constructor(e){super(),e&&(this.clickedGameSpace=e)}reset(){this.environmentBlockBody=void 0}ReportFixture(e){const t=e.GetShape();if("environment"===Object(s.p)(e.m_filter.categoryBits)){if(t.TestPoint(e.GetBody().GetTransform(),this.clickedGameSpace))return this.environmentBlockBody=e.GetBody(),!1}return!0}}class SingleArchitectureBodyQueryCallBack extends i.QueryCallback{constructor(e){super(),e&&(this.clickedGameSpace=e)}reset(){this.architectureBody=void 0}ReportFixture(e){const t=e.GetShape();if("architecture"===Object(s.p)(e.m_filter.categoryBits)){if(t.TestPoint(e.GetBody().GetTransform(),this.clickedGameSpace))return this.architectureBody=e.GetBody(),!1}return!0}}},function(e,t,n){"use strict";function getHorizontalBias(e){switch(e){case"left":return 0;case"center":return-.5;case"right":return-1;default:return 0}}function getVerticalBias(e){switch(e){case"top":return 1;case"center":return.5;case"bottom":default:return 0}}n.d(t,"a",function(){return getHorizontalBias}),n.d(t,"b",function(){return getVerticalBias})},function(e,t,n){"use strict";n.d(t,"a",function(){return loadJson}),n.d(t,"b",function(){return loadTexture});var i=n(0);const s=new i.LoadingManager;let r,a;async function loadJson(e){return new Promise((t,n)=>(function getFileLoader(){return r||(r=new i.FileLoader(s)),r})().load(e,e=>t(JSON.parse(e)),void 0,n))}const o=new Map;async function loadTexture(e,t){let n;return n=o.has(e)?new Promise((t,n)=>{o.get(e).push(t)}):new Promise((n,r)=>{o.set(e,[n]);(function getTextureLoader(){return a||(a=new i.TextureLoader(s)),a})().load(e,n=>{n.name=e,void 0!==t&&(n.flipY=t),o.get(e).forEach(e=>e(n)),o.delete(e)},void 0,r)})}},function(e,t,n){"use strict";n.d(t,"a",function(){return getArchitecturePiece});var i=n(5);const s={column1:2,column2:2,column3:2,column4:2,column5:1,vase:2},r=Object.keys(s);function getArchitecturePiece(e=r[Object(i.h)(r.length)],t="collider"+Object(i.h)(s[e],1)){return{meshName:e,colliderName:t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return makeWobblyCircleShapePath});var i=n(0);function makeWobblyCircleShapePath(e=.02,t=.03,n=20,s=3,r=0){const a=[],o=t-e;for(let t=0;t<n;t++){const c=t/n,h=2*Math.PI*(c+r),l=e+(.5*Math.sin(h*s)+.5)*o,u=new i.Vector2(Math.cos(h)*l,Math.sin(h)*l);a.push(u)}return a}},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return FullGame});var i=n(0),s=n(26),r=n(2),a=n(83),o=n(32),c=n(59),h=n(57),l=n(18),u=n(37);class FullGame extends u.a{constructor(){super((e,t)=>{const n=this.gui.gui.rayCastForButton(e,t);let i;if(n)Object(l.a)("pointer",2);else{if(i=this.rayCastForLeaderboard(e,t))return this.lookingAtTV?(Object(l.a)(void 0,1),this.leaderBoard&&i.uv&&this.leaderBoard.projectCursorMove(i.uv)):Object(l.a)("pointer",1),!1;Object(l.a)(this.lookingAtTV?"pointer":void 0,1)}return n||Object(l.a)(void 0,2),!n},e=>{const t=this.gui.gui.rayCastForButton(e[0],e[1]);let n;t?t.hit():(n=this.rayCastForLeaderboard(e[0],e[1]))?this.lookingAtTV?this.leaderBoard&&n.uv&&this.leaderBoard.projectCursorStart(n.uv):this.setLookingAtTV(!0):this.lookingAtTV&&this.setLookingAtTV(!1)}),this.tweenerForCameraGameOrTV=new h.a(()=>{}),this.lookingAtTV=!1,this.tvCamera=this.camera.clone(),this.gui=new c.a(this.testB2World);(async()=>{const e=new s.a,t=await e.loadAsync("game/models/tv.glb");for(const e of t.scene.children)e.traverse(e=>{e instanceof i.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)});const n=t.scene;n.scale.multiplyScalar(.35),n.rotation.order="YXZ",n.rotation.y=.2*Math.PI,n.rotation.x=-.1*Math.PI,this.scene.add(n);const o=new a.a(n.getObjectByName("screen"));this.leaderBoard=o,r.a.onChange(()=>{n.position.set(-.2*r.a.aspect,-.2,4),this.tvCamera.position.set(0,0,1),n.updateMatrixWorld(!0),this.tvCamera.position.applyMatrix4(n.matrixWorld),this.tvCamera.lookAt((new i.Vector3).applyMatrix4(n.matrixWorld))},!0)})()}setLookingAtTV(e){this.lookingAtTV=e,this.tweenerForCameraGameOrTV.value=this.lookingAtTV,this.gui.gui.overlayActive.value=!this.lookingAtTV,this.testB2World.paused=this.lookingAtTV}update(e){super.update(e),this.leaderBoard&&this.leaderBoard.update(e)}render(e){super.render(e),this.leaderBoard&&this.leaderBoard.render(e),this.gui.render(e)}updateCamera(){this.camera.position.lerpVectors(this.gameCamera.position,this.tvCamera.position,this.tweenerForCameraGameOrTV.animatedValue),this.camera.quaternion.slerpQuaternions(this.gameCamera.quaternion,this.tvCamera.quaternion,Math.pow(this.tweenerForCameraGameOrTV.animatedValue,2))}rayCastForLeaderboard(e,t){if(!this.leaderBoard)return;const n=new i.Raycaster;Object(o.a)(n,e,t,this.camera);const s=n.intersectObject(this.leaderBoard.mesh);return s.length>0?s[0]:void 0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return LeaderBoard});var i=n(0),s=n(37),r=n(38),a=n(29),o=n(106),c=n(109),h=n(32),l=n(4),u=n(10),d=n(8),f=n(22),p=n(16),g=n(18);class LeaderButtonUserData extends f.a{constructor(e,t){super(e),this.leader=t}}class LeaderBoard{constructor(e){this._leaderboardEntries=[],this._dirty=!0,this._highlightedIndex=-1,this._scene=new i.Scene,this._camera=new i.OrthographicCamera(0,640,480,0,1,200),this._renderTarget=new i.WebGLRenderTarget(640,480);const t=new o.a(this._renderTarget.texture);e?(t.blending=i.AdditiveBlending,t.depthTest=!1,t.transparent=!0,e.material=t,this.mesh=e):this.mesh=new i.Mesh(new i.PlaneBufferGeometry(1,1),t);const n=new u.a("LEADERBOARD",d.a.leaderBoardTitle);n.onMeasurementsUpdated=()=>{this._dirty=!0},n.position.set(320,440,l.c);const s=new u.a("PLEASE WAIT...",d.a.leaderBoardEntry);s.onMeasurementsUpdated=()=>{this._dirty=!0},s.position.set(320,240,l.c);const r=new i.PlaneBufferGeometry(420,32);Object(a.c)(e=>{this._dirty=!0,setTimeout(()=>{this._dirty=!0},1e3);for(const e of this._leaderboardEntries)this._scene.remove(e);this._leaderboardEntries.length=0;for(let t=0;t<e.length;t++){const n=e[t],s=new i.Mesh(r,new i.MeshBasicMaterial({transparent:!0,opacity:.2,color:p.d,depthWrite:!1,depthTest:!1}));s.material.visible=!1;const a=new LeaderButtonUserData(s,n);a.registerHitCallback(e=>this.selectedLeaderboardEntry(e)),s.userData=a;const o=new u.a((n.place+1).toString(),d.a.leaderBoardEntryLeft);o.onMeasurementsUpdated=()=>{this._dirty=!0};const c=new u.a(n.summary,d.a.leaderBoardEntry),h=new u.a(`${(.01*n.score).toFixed(2)}m`,d.a.leaderBoardEntryRight);o.position.x=-200,c.position.x=-60,h.position.x=200,s.add(o),s.add(c),s.add(h),s.position.set(320,370-36*t,l.c),this._leaderboardEntries.push(s),this._scene.add(s)}}),this.resetLeaders(),this._scene.add(n),this._labelLeaderboard=n,this._scene.add(s),s.visible=!1,this._labelPleaseWait=s,this.rayCaster=new i.Raycaster}get highlightedIndex(){return this._highlightedIndex}set highlightedIndex(e){this._highlightedIndex!==e&&(-1!==this._highlightedIndex&&this._leaderboardEntries.length>0&&(this._leaderboardEntries[this._highlightedIndex].material.visible=!1),this._highlightedIndex=e,-1!==this._highlightedIndex&&(this._leaderboardEntries[this._highlightedIndex].material.visible=!0),this._dirty=!0)}resetLeaders(){try{Object(a.b)(10)}catch(e){console.warn("leaderboard not available, hiding mesh"),this.mesh.visible=!1}}async selectedLeaderboardEntry(e){if(this._leaderGameStateData)return;this._leaderGameStateData=Object(a.a)(e.leader.id),this._labelPleaseWait.visible=!0,this._labelLeaderboard.visible=!1;for(const e of this._leaderboardEntries)e.parent.remove(e);this._leaderboardEntries.length=0,this._dirty=!0;const t=await this._leaderGameStateData;this._labelPleaseWait.visible=!1;const n=new s.a(()=>!1,()=>!1);this._gameConsole=n,await n.testB2World.loadGame(t),await Object(c.a)(Object(r.a)(t.player.currentLevel)+8e3),this._gameConsole=void 0,this._leaderGameStateData=void 0,this._labelLeaderboard.visible=!0,this._dirty=!0,this.resetLeaders()}update(e){this._gameConsole&&this._gameConsole.update(e)}render(e){(this._dirty||this._gameConsole)&&(this._dirty=!1,e.setRenderTarget(this._renderTarget),e.setClearColor(p.a),e.clear(!0,!0,!0),e.render(this._scene,this._camera),this._gameConsole&&this._gameConsole.render(e),e.setRenderTarget(null))}projectCursorMove(e){Object(h.b)(this.rayCaster,e.x,e.y,this._camera);const t=this.rayCaster.intersectObjects(this._leaderboardEntries,!1);if(0===t.length)this.highlightedIndex=-1,Object(g.a)(void 0,3);else{for(const e of t){const t=e.object;this.highlightedIndex=this._leaderboardEntries.indexOf(t)}Object(g.a)("pointer",3)}}projectCursorStart(e){Object(h.b)(this.rayCaster,e.x,e.y,this._camera);const t=this.rayCaster.intersectObjects(this._leaderboardEntries,!1);for(const e of t){const t=e.object;if(t.userData instanceof f.a){t.userData.hit();break}}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsPack});var i=n(50),s=n(23);class TestGraphicsPack{constructor(e,t){this.bodyMeshMap=new Map,Object(s.a)(t).startListeningForCreate((t,n)=>{e.add(n),this.bodyMeshMap.set(t,n)}),Object(s.a)(t).startListeningForDestroy(t=>{const n=i.a.deleteMesh(t);n&&e.remove(n)})}update(e){this.bodyMeshMap.forEach((e,t)=>{e.position.x=t.GetPosition().x,e.position.y=t.GetPosition().y,e.rotation.y=t.GetAngle()})}}},function(e,t,n){"use strict";n.d(t,"a",function(){return cloneMeshByName});var i=n(0);function cloneMeshByName(e,t,n=!1){let s;if(e.scene.traverse(e=>{e instanceof i.Mesh&&e.name===t&&(s=e)}),s)return s.clone(n);throw new Error(`Mesh named "${t}" not found in GLTF`)}},function(e,t,n){"use strict";n.d(t,"a",function(){return RafTweener});var i=n(87);class RafTweener extends i.a{constructor(e=0,t=!0){super(),this.discreteStepDuration=e,this.speed=1,this.requestStop=!1,this.paused=!1,this.ticking=!1,this.timeSnapshot=0,this.update=e>0?this.discreteStepTick:this.tick,this.rafTick=this._rafTick.bind(this),t&&this.start()}discreteStepTick(e){e*=this.speed;const t=this._now+e;for(;this._now<t;)this.tick(this.discreteStepDuration)}start(){this.timeSnapshot=performance.now(),this.discreteStepDuration>0&&(this.timeSnapshot-=this.timeSnapshot%this.discreteStepDuration),this._now=this.timeSnapshot,this.ticking||(this.ticking=!0,window.requestAnimationFrame(this.rafTick))}stop(){this.ticking&&!this.requestStop&&(this.requestStop=!0,this.ticking=!1)}pause(){this.paused=!0}unpause(){this.paused=!1}_rafTick(){if(this.requestStop)return void(this.requestStop=!1);const e=performance.now();let t=(e-this.timeSnapshot)*this.speed;if(this.paused)t=0;else{const e=this._now;this.update(t),t-=this._now-e}this.timeSnapshot=e-t,this.ticking&&window.requestAnimationFrame(this.rafTick)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return RawTweener});var i=n(88),s=n(5);const r={delay:0,duration:1e3,easing:n(15).a.Linear};class AnimatedProperty{constructor(e,t,n){this.key=e,this.valueStart=t,this.valueEnd=n}}class AnimatedObject{constructor(e,t,n,i,s,r,a,o){this.tweener=e,this.target=t,this.easing=n,this.startTime=i,this.endTime=s,this.animatedProperties=r,this.onUpdate=a,this.duration=s-i,this.finished=new Promise(e=>{this.onComplete=()=>{o&&o(),e()}})}kill(){this.tweener.kill(this)}}class RawTweener{constructor(){this._now=0,this._processingTick=!1,this._animations=[],this._animationsToComplete=[]}to(e){if(this.killTweensOf(e.target),Object(i.a)(e,r),"function"!=typeof e.easing)throw new Error("ease must be an easing function that takes in a number (0..1) and returns a number (0..1)");const t=e.target,n=e.propertyGoals,s=Object.keys(n).map(e=>{const i=t[e],s=n[e];if(isNaN(i)||isNaN(s))throw new Error("values must be numbers");return new AnimatedProperty(e,i,s)}),a=this._now+e.delay,o=a+e.duration,c=new AnimatedObject(this,t,e.easing,a,o,s,e.onUpdate,e.onComplete);return this._animations.push(c),c}tick(e){this._now+=e;const t=this._now,n=this._animations;this._processingTick=!0;for(const e of n)if(t>e.startTime){const n=e.target,i=Math.min((t-e.startTime)/e.duration,1);if(i<1){const t=e.easing(i);for(const i of e.animatedProperties)n[i.key]=Object(s.e)(i.valueStart,i.valueEnd,t);e.onUpdate&&e.onUpdate()}else this._animationsToComplete.push(e)}if(this._processingTick=!1,this._animationsToComplete.length>0){this._animationsToComplete.sort((e,t)=>e.endTime-t.endTime);for(const e of this._animationsToComplete)this.kill(e);this._animationsToComplete.length=0}}killTweensOf(e){if(this._processingTick)throw new Error("Not allowed during processing of tick");const t=this._animations;for(let n=t.length-1;n>=0;n--){const i=t[n];i.target===e&&this.kill(i,n)}}kill(e,t=-1){if(this._processingTick)throw new Error("Not allowed during processing of tick");if(-1===t&&(t=this._animations.indexOf(e)),-1!==t){for(const t of e.animatedProperties)e.target[t.key]=t.valueEnd;e.onUpdate&&e.onUpdate(),e.onComplete&&e.onComplete(),this._animations.splice(t,1)}}}},function(e,t,n){"use strict";function copyDefaults(e,t){for(const n of Object.keys(t))e.hasOwnProperty(n)||(e[n]=t[n])}n.d(t,"a",function(){return copyDefaults})},function(e,t,n){"use strict";n.d(t,"a",function(){return Box2DPreviewMaterial});var i=n(0),s=n(90),r=n.n(s),a=n(91),o=n.n(a);class Box2DPreviewMaterial extends i.RawShaderMaterial{constructor(){super({vertexShader:o(),fragmentShader:r(),transparent:!0,depthWrite:!1,depthTest:!1})}}},function(e,t){e.exports="precision lowp float;\n#define GLSLIFY 1\n\nvarying vec4 vColor;\n\nvoid main() {\n\tgl_FragColor = vColor;\n}\n"},function(e,t){e.exports="precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 color;\n\nvarying vec4 vColor;\n\nvoid main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n    vColor = color;\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return getCopyOfArtStage});var i=n(0),s=n(26);let r;async function getCopyOfArtStage(){if(!r){const e=new s.a;r=e.loadAsync("game/models/art.glb")}const e=await r;for(const t of e.scene.children)t.traverse(e=>{e instanceof i.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)});return e.scene.clone()}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyboardInput});var i=n(7);class KeyboardInput{constructor(e=!1){this._preventDefault=e,this._listeners=[],this._keyStates=new Map,this.onKeyEvent=(e,t)=>{const n=e.code;this._preventDefault&&e.preventDefault(),this._keyStates.set(n,t);for(const e of this._listeners)e(n,t)},window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1))}addListener(e){this._listeners.push(e)}removeListener(e){Object(i.e)(this._listeners,e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return BaseContactListener});var i=n(1),s=n(3);class BaseContactListener extends i.ContactListener{constructor(){super(...arguments),this._healthChangeCallbacks=[]}listenForHealthChanges(e){this._healthChangeCallbacks.push(e)}BeginContact(e){const t=e.GetFixtureA(),n=e.GetFixtureB(),i=s.p,r=i(t.m_filter.categoryBits),a=i(n.m_filter.categoryBits);"architecture"===r&&"penalty"===a?this._architectureHitsPenalty(t,n):"architecture"===a&&"penalty"===r&&this._architectureHitsPenalty(n,t)}EndContact(e){const t=e.GetFixtureA(),n=e.GetFixtureB(),i=s.p;i(t.m_filter.categoryBits),i(n.m_filter.categoryBits)}_architectureHitsPenalty(e,t){const n=e.GetBody();for(const e of this._healthChangeCallbacks)e(-1,n)}}BaseContactListener.k_maxContactPoints=2048},,function(e,t){e.exports="precision highp float;\n#define GLSLIFY 1\n\n#ifdef USE_ALPHATEST\nuniform float alphaTest;\n#endif\n\nuniform sampler2D msdf;\nuniform vec2 msdfSize;\n//uniform vec3 color;\nuniform float opacity;\n\n#ifdef USE_STROKE\nuniform float strokeWidth;\nuniform float strokeBias;\nuniform vec3 strokeColor;\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n\n#ifdef USE_SHADOW\nconst vec2 shadowVector = vec2(-0.00025, 0.0005);\nconst float shadowSoftness = 0.5;\nconst float shadowShrink = 0.2;\nconst float shadowOpacity = 0.5;\n#endif\n\nconst float contrastMultiplier = 80.0;\n\nvoid main() {\n  vec3 color = vColor;\n\n  vec3 texel = texture2D(msdf, vUv + vec2(0.0, -0.5/512.0)).rgb;\n  float unsignedDistance = median(texel.r, texel.g, texel.b);\n\n  float signedDistance = unsignedDistance - (1.0 - 0.5 * vWeight);\n\n  if ( unsignedDistance == 0.0 ) discard;\n  // float contrast = contrastMultiplier;\n  \n  float derX = dFdx(vUv.x);\n  float derY = dFdy(vUv.y);\n  float contrast = sqrt(derX * derX + derY * derY) * contrastMultiplier;\n\n  #ifdef USE_STROKE\n    float distanceOpacity = signedDistance + (strokeWidth * strokeBias);\n    float sigDistSrokeInner = signedDistance - (strokeWidth * (1.0 - strokeBias));\n    float colorMix = 1.0 - smoothstep(0.0, 1.0, sigDistSrokeInner / contrast + 0.5);\n    vec3 finalColor = mix(color, strokeColor, colorMix);\n  #else\n    float distanceOpacity = signedDistance;\n    vec3 finalColor = color;\n  #endif\n  \n  float alpha = smoothstep(0.0, 1.0, distanceOpacity / contrast + 0.5);\n  \n  #ifdef USE_SHADOW\n    //compute shadows\n    //shadow color is the same as stroke color for now\n    sample = texture2D(msdf, vUv + shadowVector).rgb;\n    unsignedDistance = median(sample.r, sample.g, sample.b);\n    float shadow = clamp(((unsignedDistance - shadowShrink) / shadowSoftness + shadowShrink), 0.0, 1.0) * shadowOpacity;\n    alpha = max(alpha, shadow);\n  #else \n    #ifdef USE_ALPHATEST\n      if ( alpha < alphaTest ) discard;\n    #endif\n  #endif\n  gl_FragColor = vec4(finalColor, alpha * opacity);\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return s});const i={align:"center",vAlign:"center"},s={centered:i,left:{...i,align:"left"},right:{...i,align:"right"},title:{...i,width:300}}},function(e,t){e.exports="#define GLSLIFY 1\n// attribute vec2 uv;\n// attribute vec4 position;\nattribute vec3 color;\nattribute float weight;\n\n#ifdef USE_SCREENSPACE\nuniform vec2 offset;\nuniform float prescale;\nuniform vec4 clipSpacePosition;\nuniform vec2 pixelSizeInClipSpace;\n#else\n// uniform mat4 projectionMatrix;\n// uniform mat4 modelViewMatrix;\n#endif\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nvoid main() {\n  vUv = uv;\n  vColor = color;\n  vWeight = weight;\n\n  #ifdef USE_SCREENSPACE\n    vec2 finalOffset = (offset + position.xy) * pixelSizeInClipSpace * prescale;\n    #ifdef CONSTANT_SIZE_ON_SCREEN\n     finalOffset *= clipSpacePosition.w;\n    #endif\n    gl_Position = clipSpacePosition;\n    gl_Position.xy += finalOffset;\n  #else\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  #endif\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return getMetaContactListener});var i=n(100);let s;function getMetaContactListener(){return s||(s=new i.a),s}},function(e,t,n){"use strict";n.d(t,"a",function(){return MetaContactListener});var i=n(1);class MetaContactListener extends i.ContactListener{constructor(){super(...arguments),this.registry=[]}register(e){this.registry.push(e)}BeginContact(e){for(const t of this.registry)t.BeginContact(e)}EndContact(e){for(const t of this.registry)t.EndContact(e)}BeginContactFixtureParticle(e,t){for(const n of this.registry)n.BeginContactFixtureParticle(e,t)}EndContactFixtureParticle(e,t){for(const n of this.registry)n.EndContactFixtureParticle(e,t)}BeginContactParticleParticle(e,t){for(const n of this.registry)n.BeginContactParticleParticle(e,t)}EndContactParticleParticle(e,t){for(const n of this.registry)n.EndContactParticleParticle(e,t)}PreSolve(e,t){for(const n of this.registry)n.PreSolve(e,t)}PostSolve(e,t){for(const n of this.registry)n.PostSolve(e,t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return Player});var i=n(4);class Player{constructor(){this.currentHealth=5,this.maxHealth=5,this.currentLevel=0,this.currentTimer=i.d,this.maxTimer=i.d,this.physicsTime=0,this.currentHeight=0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(1);const s=[new i.Vec2(-1.55,-.35),new i.Vec2(-.95,.65),new i.Vec2(0,1),new i.Vec2(.95,.65),new i.Vec2(1.55,-.35)];new i.Vec2(-1.55,-.35),new i.Vec2(-1.35,.3),new i.Vec2(-.95,.65),new i.Vec2(-.45,.85),new i.Vec2(0,1),new i.Vec2(.45,.85),new i.Vec2(.95,.65),new i.Vec2(1.35,.3),new i.Vec2(1.55,-.35)},,function(e,t,n){"use strict";n.d(t,"a",function(){return NiceParameter});var i=n(7),s=n(45),r=n(6),a=n(5);const o=[];class NiceParameter{constructor(e,t,n,i,a,c,h,l,u=!1,d=.01,f=0){this.name=e,this.label=t,this.defaultValue=n,this.minValue=i,this.maxValue=a,this.step=d,this.distribution=c,this.valueTextConverter=h,this._availableToUserMethod=!0===l||!1===l?()=>l:l,this._listeners=[],u&&(this.value=this.defaultValue),this._value=Object(s.a)("nice-param-"+e,n,i,a);const p=Object(r.c)(e,this._value,i,a);p!==this._value&&(this.value=p),o.push(this),0===f&&(f=o.length),this.sliderOrderPriority=f}listen(e){this._listeners.push(e),e(this.value)}stopListening(e){Object(i.e)(this._listeners,e)}set value(e){e!==this._value&&(e=Object(a.b)(e,this.minValue,this.maxValue))!==this._value&&(this._value=e,localStorage.setItem("nice-param-"+this.name,String(e)),this._listeners.forEach(t=>t(e)))}get value(){return this._value}get availableToUser(){return this._availableToUserMethod()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return addPrettyLights});var i=n(0),s=n(6);const r=new i.Color(5193519).multiplyScalar(1.8),a=new i.Color(11517935).multiplyScalar(1.8),o=new i.Vector3(8,2,6),c=new i.Vector3(0,.5,.4),h=new i.Vector3;function addPrettyLights(e,t){const n=new i.HemisphereLight(a,r);e.add(n);const l=new i.DirectionalLight(16777135,.75);e.add(l),l.name="sunlight",l.castShadow=!0,l.shadow.camera.near=.1,l.shadow.camera.far=10,l.shadow.camera.left=-5,l.shadow.camera.right=5,l.shadow.camera.top=-3,l.shadow.camera.bottom=3,l.shadow.camera.updateProjectionMatrix(),l.shadow.mapSize.width=l.shadow.mapSize.height=1024,l.shadow.bias=-.0025;l.position.set(5*Math.cos(.6),5*Math.sin(.6),0),l.lookAt(h),l.updateMatrix(),l.updateMatrixWorld(!0);const u=l.shadow.camera;u.updateMatrix(),u.updateMatrixWorld(!0),u.top=-1/0,u.bottom=1/0,u.left=1/0,u.right=-1/0,u.near=1/0,u.far=-1/0;const d=new i.Vector3;for(let e=0;e<8;e++)d.x=e%2-.5,d.y=-(~~(e/2)%2-.5),d.z=~~(e/4)%2-.5,d.multiply(o),d.sub(c),l.worldToLocal(d),u.top=Math.max(u.top,-d.y),u.bottom=Math.min(u.bottom,-d.y),u.left=Math.min(u.left,d.x),u.right=Math.max(u.right,d.x),u.near=Math.min(u.near,d.z+10),u.far=Math.max(u.far,d.z+10);if(u.updateProjectionMatrix(),Object(s.b)("debugLights")){const t=new i.DirectionalLightHelper(l),n=new i.CameraHelper(l.shadow.camera);e.add(t),e.add(n),t.update(),n.update()}return e.fog=new i.Fog(t.getHex(),0,50),{sunLight:l,ambientLight:n}}},function(e,t,n){"use strict";n.d(t,"a",function(){return VhsMaterial});var i=n(0),s=n(21),r=n(107),a=n.n(r),o=n(108),c=n.n(o);class VhsMaterial extends i.ShaderMaterial{constructor(e){super({uniforms:{uTexture:new i.Uniform(e),uTime:s.c},vertexShader:c(),fragmentShader:a(),transparent:!0,depthWrite:!1,depthTest:!1,blending:i.AdditiveBlending})}}},function(e,t){e.exports="#define GLSLIFY 1\n//slightly editted version of VHS shader by FMS_Cat https://www.shadertoy.com/view/XtBXDt\n\n#define PI 3.14159265\n\nuniform float uTime;\nuniform sampler2D uTexture;\nvarying vec2 vUv;\n\nfloat hash( vec2 _v ){\n  return fract( sin( dot( _v, vec2( 89.44, 19.36 ) ) ) * 22189.22 );\n}\n\nfloat iHash( vec2 _v, vec2 _r ){\n  float h00 = hash( vec2( floor( _v * _r + vec2( 0.0, 0.0 ) ) / _r ) );\n  float h10 = hash( vec2( floor( _v * _r + vec2( 1.0, 0.0 ) ) / _r ) );\n  float h01 = hash( vec2( floor( _v * _r + vec2( 0.0, 1.0 ) ) / _r ) );\n  float h11 = hash( vec2( floor( _v * _r + vec2( 1.0, 1.0 ) ) / _r ) );\n  vec2 ip = vec2( smoothstep( vec2( 0.0, 0.0 ), vec2( 1.0, 1.0 ), mod( _v*_r, 1. ) ) );\n  return ( h00 * ( 1. - ip.x ) + h10 * ip.x ) * ( 1. - ip.y ) + ( h01 * ( 1. - ip.x ) + h11 * ip.x ) * ip.y;\n}\n\nfloat noise( vec2 _v ){\n  float sum = 0.;\n  for( int i=1; i<9; i++ )\n  {\n    sum += iHash( _v + vec2( i ), vec2( 2. * pow( 2., float( i ) ) ) ) / pow( 2., float( i ) );\n  }\n  return sum;\n}\n\nvoid main(){\n  vec2 uvn = vUv;\n  vec3 col = vec3( 0.0 );\n\n  // tape wave\n  uvn.x += ( noise( vec2( uvn.y, uTime ) ) - 0.5 )* 0.005;\n  uvn.x += ( noise( vec2( uvn.y * 100.0, uTime * 10.0 ) ) - 0.5 ) * 0.01;\n\n  // tape crease\n  float tcPhase = clamp( ( sin( uvn.y * 8.0 - uTime * PI * 1.2 ) - 0.92 ) * noise( vec2( uTime ) ), 0.0, 0.01 ) * 10.0;\n  float tcNoise = max( noise( vec2( uvn.y * 100.0, uTime * 10.0 ) ) - 0.5, 0.0 );\n  uvn.x = uvn.x - tcNoise * tcPhase;\n\n  // switching noise\n  float snPhase = smoothstep( 0.03, 0.0, uvn.y );\n  uvn.y += snPhase * 0.3;\n  uvn.x += snPhase * ( ( noise( vec2( vUv.y * 100.0, uTime * 10.0 ) ) - 0.5 ) * 0.2 );\n    \n  col = texture2D( uTexture, uvn ).xyz;\n  col *= 1.0 - tcPhase;\n  col = mix(\n    col,\n    col.yzx,\n    snPhase\n  );\n\n  // bloom\n  for( float x = -4.0; x < 2.5; x += 1.0 ){\n    col.xyz += vec3(\n      texture2D( uTexture, uvn + vec2( x - 0.0, 0.0 ) * 7E-3 ).x,\n      texture2D( uTexture, uvn + vec2( x - 2.0, 0.0 ) * 7E-3 ).y,\n      texture2D( uTexture, uvn + vec2( x - 4.0, 0.0 ) * 7E-3 ).z\n    ) * 0.1;\n  }\n  col *= 0.6;\n\n  // ac beat\n  col *= 1.0 + clamp( noise( vec2( 0.0, vUv.y + uTime * 0.2 ) ) * 0.6 - 0.25, 0.0, 0.1 );\n\n  gl_FragColor = vec4( col, 1.0 );\n}"},function(e,t){e.exports="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vUv = uv;\n}"},function(e,t,n){"use strict";async function delay(e){return new Promise(t=>setTimeout(t,e))}n.d(t,"a",function(){return delay})},function(e,t,n){"use strict";n.d(t,"a",function(){return Testb2WorldWithGui});var i=n(59),s=n(39);class Testb2WorldWithGui{constructor(){this.b2World=new s.a(void 0,(e,t)=>!this.gui.gui.rayCastForButton(e,t)),this.gui=new i.a(this.b2World)}update(e){this.b2World.update(e)}render(e){this.b2World.render(e),this.gui.render(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestCharacterControlScene});var i=n(9),s=n(3),r=n(12);class TestCharacterControlScene extends r.a{constructor(){super(!1,20,!1),i.b.value=!0;for(let e=0;e<10;e++)Object(s.g)(this.b2World,e-5,-.3,.5,.1)}update(e){super.update(e),this._postUpdate(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestCharacterControlOnTextScene});var i=n(9),s=n(3),r=n(12),a=n(60);class TestCharacterControlOnTextScene extends r.a{constructor(){super(!1,20,!1),i.b.value=!0;for(let e=0;e<10;e++)Object(s.g)(this.b2World,e-5,-.3,.5,.1);Object(a.b)(this.scene,this.b2World)}update(e){super.update(e),this._postUpdate(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestGraphicsCharacterScene});var i=n(114),s=n(6),r=n(61);class TestGraphicsCharacterScene extends r.a{constructor(){super("test-layout");const e=new i.a;this.b2World.SetContactListener(e);for(let e=0;e<Object(s.d)("characters",1,1,4);e++);}update(e){super.update(e),this.sunLight.position.x=this.camera.position.x+.2,this.sunLight.target.position.x=this.camera.position.x,this.sunLight.target.updateMatrixWorld(!0),this.sunLight.updateMatrixWorld(!0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return AvatarContactListener});var i=n(1),s=n(3),r=n(7);class AvatarContactListener extends i.ContactListener{constructor(){super(),this.contactPairs=new Map,this.sensorBeginCallbacks=new Map,this.sensorEndCallbacks=new Map}listenForSensorBeginContact(e,t){Object(r.d)(this.sensorBeginCallbacks,e,t)}listenForSensorEndContact(e,t){Object(r.d)(this.sensorEndCallbacks,e,t)}BeginContact(e){const t=Object(s.k)(e);if(t){if(this.sensorBeginCallbacks.has(t.sensor))for(const e of this.sensorBeginCallbacks.get(t.sensor))e(t.rigidBody);Object(r.d)(this.contactPairs,t.sensor,t.rigidBody)}}EndContact(e){const t=Object(s.k)(e);if(t){if(this.sensorEndCallbacks.has(t.sensor))for(const e of this.sensorEndCallbacks.get(t.sensor))e(t.rigidBody);t&&Object(r.a)(this.contactPairs,t.sensor,t.rigidBody)}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return KeyButtonHoleMesh});var i=n(0),s=n(17),r=n(28);class KeyButtonHoleMesh extends i.Mesh{constructor(e,t,n,i=.005){super(Object(r.a)(e+.001,t,n+.001,2*i),s.a.keyboardPlasticHole),this.renderOrder=-1,this.receiveShadow=!0}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return TestKeyboardCharacterScene});var i=n(9),s=n(27),r=n(65),a=n(12);class TestKeyboardCharacterScene extends s.a{constructor(){super();const e=new r.a,t=new a.a;this.scenes=[e,t],this.scenes[1].autoClear=!1,i.b.value=!0}update(e){for(const t of this.scenes)t.update(e)}render(e){for(const t of this.scenes)t.render(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestLitModelsScene});var i=n(26),s=n(14);class TestLitModelsScene extends s.a{constructor(){super(!1,!1);(async()=>{const e=new i.a,t=await e.loadAsync("game/models/columns.glb");for(const e of t.scene.children.slice()){this.scene.add(e),e.position.z+=1,e.castShadow=!0,e.receiveShadow=!0;const t=Math.sqrt(Math.pow(e.position.x,2)+Math.pow(e.position.z,2)),n=Math.atan2(e.position.z,e.position.x)+.5*Math.PI;e.position.set(Math.cos(n)*t,e.position.y,Math.sin(n)*t)}})()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestConcaveBodiesScene});var i=n(1),s=n(0),r=n(9),a=n(72),o=n(3),c=n(12);class TestConcaveBodiesScene extends c.a{constructor(){super(!1,20,!1),this.postUpdates=[],r.b.value=!0;for(let e=0;e<10;e++)Object(o.g)(this.b2World,e-5,-.3,.5,.1);const e=Object(a.a)(.1,.25,40,6);Object(o.j)(this.b2World,void 0,e,i.BodyType.b2_staticBody,new s.Vector2(-.5,0),o.h);const t=Object(a.a)(.2,.125,12,3,.25),n=new s.Vector2(-1,0);Object(o.j)(this.b2World,void 0,t,i.BodyType.b2_staticBody,n,o.i)}update(e){super.update(e);for(const t of this.postUpdates)t(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsMeshDerivativeBodiesScene});var i=n(9),s=n(53),r=n(3),a=n(12);class TestPhysicsMeshDerivativeBodiesScene extends a.a{constructor(){super(!1,20,!1),this.postUpdates=[],i.b.value=!0;for(let e=0;e<10;e++)Object(r.g)(this.b2World,e-5,-.3,.5,.1);(async()=>{const e=this.b2World.CreateBody();Object(s.a)(e,"column1","collider1")})()}update(e){super.update(e);for(const t of this.postUpdates)t(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestPhysicsPNGScene});var i=n(3),s=n(62),r=n(6),a=n(12);class TestPhysicsPNGScene extends a.a{constructor(e="test",t=20,n){super(!1,t);new s.a(Object(r.e)("level")||e,i.d.bind(this,this.b2World),n)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestStencilsScene});var i=n(123),s=n(14);class TestStencilsScene extends s.a{constructor(){super();const e=new i.a(.013,.012);e.rotation.y+=-.15*Math.PI,e.position.set(0,.15,.3),this.scene.add(e),this.characterMesh=e}update(e){super.update(e),this.characterMesh.rotation.z+=.5*e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return CharacterMesh});var i=n(0),s=n(124),r=n(17),a=n(64);let o=13;class CharacterMesh extends a.a{constructor(e,t,n=""){super(e,t,e,n,.01);const a=new i.SphereBufferGeometry(.045,16,8),c=a.attributes.position.array;for(let e=1;e<c.length;e+=3)c[e]<0&&(c[e]=0);const h=new i.Mesh(a,r.a.keyboardPlasticKeyUnderside);h.receiveShadow=!0,h.renderOrder=o,o+=2,h.position.y=.5*-t-1e-4,h.rotation.y=2*Math.PI/32,this.add(h),Object(s.a)(h),this.castShadow=!0,this.receiveShadow=!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return makeScoopMesh});var i=n(0),s=n(17);function makeScoopMesh(e){const t=new i.Mesh(e.geometry,s.a.scoopMask);t.renderOrder=e.renderOrder-1,e.add(t),t.onBeforeRender=(e,t,n,i,s,r)=>{!function maskPreRender(e,t){t.setTest(!0),t.setClear(1),t.setMask(255),t.setOp(e.KEEP,e.KEEP,e.REPLACE),t.setFunc(e.ALWAYS,2,255)}(e.context,e.state.buffers.stencil)},t.onAfterRender=(e,t,n,i,s,r)=>{e.context,e.state.buffers.stencil},e.onBeforeRender=(e,t,n,i,s,r)=>{!function meshPreRender(e,t){t.setFunc(e.EQUAL,2,255),t.setMask(0)}(e.context,e.state.buffers.stencil)},e.onAfterRender=(e,t,n,i,s,r)=>{!function meshPostRender(e,t){t.setTest(!1)}(e.context,e.state.buffers.stencil)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return TestTextScene});var i=n(10),s=n(8),r=n(40),a=n(6),o=n(27);class TestTextScene extends o.a{constructor(){super();const e=new r.a(this.camera);Object(a.b)("fpsCam")&&e.toggle(!0);const t=new i.a("Hello World!");t.scale.multiplyScalar(10),this.scene.add(t);const n=new i.a("ANY KEY",s.a.title);n.scale.multiplyScalar(10),this.scene.add(n);const o=new i.a("Q W E R T Y",s.a.keyLabel);o.scale.multiplyScalar(10),o.position.y=-.4,this.scene.add(o);const c=new i.a("← ↑ → ↓ ⇧",s.a.keyLabel);c.scale.multiplyScalar(10),c.position.y=-.5,this.scene.add(c);(async()=>{})()}update(e){super.update(e)}render(e){super.render(e)}}},function(e,t,n){"use strict";n.r(t);var i=n(0),s=n(82),r=n(39),a=n(110),o=n(111),c=n(112),h=n(37),l=n(113),u=n(61),d=n(117),f=n(65),p=n(14),g=n(118),m=n(12),y=n(119),w=n(120),b=n(121),v=n(122),C=n(125),_=n(60),S=n(11),x=n(33),M=n(21),B=n(42),P=n(6),k=n(56),O=n(41),T=n(58);document.addEventListener("gesturestart",e=>e.preventDefault());const j=new i.Clock;x.b.setClearColor(new i.Color(3425622),1),B.a.camera.position.set(0,.5,.5),B.a.camera.lookAt(new i.Vector3);const L={characterControl:o.a,characterControlOnText:c.a,graphicsLevel:u.a,graphicsCharacter:l.a,keyboard:f.a,keyboardCharacter:d.a,lighting:p.a,litModels:g.a,physics:m.a,textPhysics:_.a,physicsConcave:y.a,physicsMeshDerivatives:w.a,physicsPNG:b.a,stencils:v.a,text:C.a,b2d:r.a,b2dWithGui:a.a,graphics3D:h.a,fullGame:s.a};let A=p.a;const F=Object(P.e)("test")||"fullGame",I=Object(P.d)("fps",60,1,240);L.hasOwnProperty(F)&&(A=L[F]);const G=new A;let E=0,D=0;const W=1/I;requestAnimationFrame(function loop(){requestAnimationFrame(loop);const e=Math.min(j.getDelta(),.1)*S.a.speed;(E+=e)-D>W&&(D+=W,Object(k.a)(),S.a.rafTick(),T.a.update(W),O.a.update(W),M.c.value+=W,G.update(W),G.render(x.b))})},,,,,,,,,,,,,,,,,function(e,t){},,function(e,t){}]);